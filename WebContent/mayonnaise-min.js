function F_CheckKey(a,b){a=(a)?a:window.event;code=(a.keyCode)?a.keyCode:a.charCode;var f=b.length;for(var c=0;c<f;c++){if(b[c]==code){return true}}return false}var firstCache=null;var secondCache=null;var runThumbnail=true;var lastSelected=null;var scrCopy=null;JinoController=function(c){this.map=c;this.nodeEditor=null;this.enterKeyDown=false;document.onkeydown=function(f){f=f||window.event;var g=f.keyCode;if(g==27){jMap.controller.stopNodeEdit(true)}if((f.metaKey||f.ctrlKey)&&g==86){return true}if(jMap.work.hasFocus()){return false}return true};this.setNodeEditor(c.nodeEditorHandle[0]);$(this.map.work).on("vmousedown",{controller:this},this.mousedown);$(this.map.work).on("vmousemove",{controller:this},this.mousemove);$(this.map.work).on("vmouseup",{controller:this},this.mouseup);$(this.map.work).on("vclick",{controller:this},this.click);$("#main").on("mouseleave",{controller:this},this.mouseup);this.map.work.addEventListener("touchstart",this.touchstart,false);this.map.work.addEventListener("touchmove",this.touchmove,false);this.map.work.onkeydown=this.keyDown;this.map.work.onkeyup=this.keyUp;this.map.work.ondragenter=function(f){f=f||window.event;if(f.preventDefault){f.preventDefault()}else{f.returnValue=false}};this.map.work.ondragover=function(f){f=f||window.event;if(f.preventDefault){f.preventDefault()}else{f.returnValue=false}};this.map.work.ondrop=function(f){f=f||window.event;if(f.preventDefault){f.preventDefault()}else{f.returnValue=false}};function b(f){if(f<0){if(jMap.scaleTimes<0.2){return}jMap.scale(jMap.scaleTimes-0.1)}else{if(jMap.scaleTimes>2.5){return}jMap.scale(jMap.scaleTimes+0.1)}}function a(f){var g=0;if(!f){f=window.event}if(f.wheelDelta){g=f.wheelDelta/120;if(window.opera){g=-g}}else{if(f.detail){g=-f.detail/3}}if(g){b(g)}if(f.preventDefault){f.preventDefault()}f.returnValue=false}};JinoController.prototype.type="JinoController";JinoController.prototype.keyUp=function(a){var b=a.keyCode;switch(b){case 13:this.enterKeyDown=false;break}};JinoController.prototype.keyDown=function(n){if(STAT_NODEEDIT){return true}n=n||window.event;var m=document;var a=null;if(n){a=n.ctrlKey}else{if(n&&m.getElementById){a=(Event.META_MASK||Event.CTRL_MASK)}else{if(n&&m.layers){a=(n.metaKey||n.ctrlKey)}}}var l=n.altKey;var f=n.shiftKey;var b=n.keyCode;switch(b){case 35:if(l){unfoldingAllAction()}break;case 36:if(l){foldingAllAction()}break;case 37:if(ScaleAnimate.isShowMode()){ScaleAnimate.prevShow(30);return false}var g=jMap.getSelecteds().getLastElement();switch(jMap.layoutManager.type){case"jMindMapLayout":if(g.isRootNode()){var c=g.getChildren();var o=c.length;for(var k=0;k<c.length;k++){if(c[k].position=="left"){c[k].focus(true);break}}}else{if(g.isLeft()){jMap.controller.childNodeFocusAction(g)}else{jMap.controller.parentNodeFocusAction(g)}}break;case"jTreeLayout":jMap.controller.prevSiblingNodeFocusAction(g);break;default:}break;case 38:if(a){ScaleAnimate.tempRotate(jMap.getSelecteds().getLastElement());return false}var g=jMap.getSelecteds().getLastElement();switch(jMap.layoutManager.type){case"jMindMapLayout":if(g.isRootNode()){}else{jMap.controller.prevSiblingNodeFocusAction(g)}break;case"jTreeLayout":jMap.controller.parentNodeFocusAction(g);break;default:}break;case 39:if(ScaleAnimate.isShowMode()){ScaleAnimate.nextShow(30);return false}var g=jMap.getSelecteds().getLastElement();switch(jMap.layoutManager.type){case"jMindMapLayout":if(g.isRootNode()){var c=g.getChildren();var o=c.length;for(var k=0;k<o;k++){if(c[k].position=="right"){c[k].focus(true);break}}}else{if(g.isLeft()){jMap.controller.parentNodeFocusAction(g)}else{jMap.controller.childNodeFocusAction(g)}}break;case"jTreeLayout":jMap.controller.nextSiblingNodefocusAction(g);break;default:}break;case 40:var g=jMap.getSelecteds().getLastElement();switch(jMap.layoutManager.type){case"jMindMapLayout":if(g.isRootNode()){}else{jMap.controller.nextSiblingNodefocusAction(g)}break;case"jTreeLayout":jMap.controller.childNodeFocusAction(g);break;default:}break;case 48:if(a||n.metaKey){jMap.clipboardManager.clipboard=""}if(l){$("div#edit-menu .menu[data-action=decorate]").click()}break;case 49:if(l){imageProviderAction()}else{if(a){NodeColorMix(jMap.rootNode)}else{if(f){}}}break;case 50:if(l){videoProviderAction()}else{if(a){}else{if(f){}}}break;case 51:if(l){insertIFrameAction()}else{if(a){}else{if(f){}}}break;case 52:if(l){insertWebPageAction()}else{if(a){}else{if(f){}}}break;case 53:if(l){insertLTIAction()}else{if(a){}else{if(f){}}}break;case 54:if(l){iotProvidersAction()}else{if(a){}else{if(f){}}}break;case 55:if(l){fileProviderAction()}else{if(a){}else{if(f){}}}break;case 56:if(l){insertNoteAction()}else{if(a){}else{if(f){}}}break;case 57:if(l){insertHyperAction()}else{if(a){}else{if(f){}}}break;case 65:if(a){}break;case 66:if(a){nodeBGColorAction()}else{if(l){splitMap()}}break;case 67:if(a){if(l){changeNodeAllColorAction()}else{copyAction()}}if(l){changeNodeAllColorAction()}break;case 68:if(l){}break;case 69:if(l){}else{if(a){nodeTextColorAction()}else{if(f){}}}break;case 70:if(a){if(l){}else{}}break;case 71:if(a){if(l){changeMapBackgroundAction()}else{googleSearch();break}}if(l){changeMapBackgroundAction();break}break;case 72:if(a){if(l){}}break;case 73:if(a){}else{if(l){clipBoard()}else{if(f){}}}break;case 75:if(a){insertHyperAction()}if(l){imageProviderAction()}break;case 76:if(a){nodeEdgeColorAction()}break;case 77:if(a){}if(l){}break;case 78:if(l){newMap()}else{if(f){jMap.controller.prevFindNodeAction()}else{jMap.controller.nextFindNodeAction()}}break;case 79:if(a){openMap()}if(l){clipBoard()}break;case 80:if(a){if(ScaleAnimate.isShowMode()){ScaleAnimate.endShowMode()}else{ScaleAnimate.startShowMode(30,20,true)}}if(l){presentationEditMode()}break;case 81:if(a){}if(l){}break;case 82:if(a){resetCoordinateAction()}if(l){changeMapName()}break;case 84:if(a){if(l){rightPanelFolding();break}}if(l){rightPanelFolding();break}else{if(a){}}break;case 114:if(a){resetCoordinateAction()}break;case 83:if(a){if(!jMap.isSaved()){saveMap()}}if(l){okmPreference()}break;case 88:if(a){cutAction()}else{if(l){}else{if(f){}}}break;case 86:if(a){pasteAction()}if(a||n.metaKey){return true}break;case 89:if(a){}break;case 90:if(l){CtrlRAction()}if(f){timelineMode();break}case 113:editNodeAction();break;case 13:if(f){zoomnotAction();break}if(!a&&!l&&!f){if(!this.enterKeyDown){insertSiblingAction();this.enterKeyDown=true;break}}case 27:if(a){}break;case 32:if(a){}else{if(l){}else{if(f){foldingAll()}else{foldingAction()}}}break;case 8:case 46:if(l){delMap();break}if(!a&&!l&&!f){deleteAction()}break;case 9:case 45:insertAction();break;case 107:if(f){zoominAction(0.1)}if(a){increaseFontSizeAction()}break;case 109:if(f){zoomoutAction(0.1)}if(a){decreaseFontSizeAction()}break;case 187:if(f){zoominAction(0.1);break}if(a){increaseFontSizeAction();break}break;case 189:if(f){zoomoutAction(0.1);break}if(a){decreaseFontSizeAction();break}break;case 191:if(f){EditorManager.temporarily()}break}return false};JinoController.prototype.mousemove=function(u){var q;var w;if(!u){var u=window.event}w=u.originalEvent.originalEvent||u.originalEvent||u;if(w.target){q=w.target}else{if(w.srcElement){q=w.srcElement}}if(q.nodeType==3){q=q.parentNode}if(q.id=="nodeEditor"){return true}if(w.preventDefault){w.preventDefault()}else{w.returnValue=false}var l=(u.clientX||(u.targetTouches&&u.targetTouches[0]&&u.targetTouches[0].pageX));var k=(u.clientY||(u.targetTouches&&u.targetTouches[0]&&u.targetTouches[0].pageY));var n=l-DRAG_POS.x;var m=k-DRAG_POS.y;DRAG_POS.x=l;DRAG_POS.y=k;if(jMap.DragPaper){this.scrollTop-=m;this.scrollLeft-=n}if(jMap.mouseRightClicked){return}var f=jMap.dragEl;if(f&&f._drag&&!jMap.movingNode&&!jMap.mouseRightClicked){if(!jMap.isAllowNodeEdit(f.node)){jMap.DragPaper=false;jMap.positionChangeNodes=false;jMap.dragEl._drag=null;delete jMap.dragEl._drag;jMap.dragEl=null;delete jMap.dragEl;return}$("body").addClass("onDrag");var o=jMap.getSelecteds();jMap.positionChangeNodes=o;jMap.movingNode=RAPHAEL.rect();var g=jMap.movingNode;var p=f.node.body;g.ox=p.type=="rect"?p.attr("x"):p.attr("cx");g.oy=p.type=="rect"?p.attr("y"):p.attr("cy");var b=p.attr();delete b.scale;delete b.translation;delete b.gradient;b["fill-opacity"]=0.2;b.fill=f.node.background_color;b.stroke=f.node.edge.color;g.attr(b);g.toBack()}if(f&&f._drag&&jMap.movingNode&&!jMap.movingNode.removed){var l=u.clientX;var k=u.clientY;var v=document;var s=v.documentElement.scrollTop||v.body.scrollTop;var t=v.documentElement.scrollLeft||v.body.scrollLeft;l+=t;k+=s;var n=l-f._drag.x;var m=k-f._drag.y;var g=jMap.movingNode;var c=n/jMap.cfg.scale;var a=m/jMap.cfg.scale;var r=g.type=="rect"?{x:g.ox+c,y:g.oy+a}:{cx:g.ox+c,cy:g.oy+a};g.attr(r)}};JinoController.prototype.MoveWithChildNode=function(g,c,a){g.translate(c,a);var b=g.children.length;for(var f=b;f--;){MoveWithChildNode(g.children[f],c,a)}};JinoController.prototype.touchmove=function(a){};JinoController.prototype.touchstart=function(e){if(ISMOBILE||supportsTouch){var target=e.target;var node=target.parentNode;if(target.className=="node-menu"){eval(node.attributes[2].value)}if(target.id==""){if(node.href!=undefined&&node.href.baseVal!=undefined){if(node.href.baseVal.match("http")){window.open(node.href.baseVal)}if(node.href.baseVal.match("javascript")){eval(node.href.baseVal)}}}}if(ISMOBILE&&supportsTouch&&e.touches&&e.touches.length==2){var selectedNode=jMap.getSelecteds().getLastElement();if(selectedNode){selectedNode.setFolding(!selectedNode.folded);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(node);jMap.layoutManager.layout(true)}}};JinoController.prototype.mousedown=function(c){var b;var a;if(!c){var c=window.event}a=c.originalEvent.originalEvent||c.originalEvent||c;if(a.target){b=a.target}else{if(a.srcElement){b=a.srcElement}}if(b.nodeType==3){b=b.parentNode}if(b.id=="nodeEditor"){return true}if(!(ISMOBILE||supportsTouch)){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}}if(STAT_NODEEDIT){jMap.controller.stopNodeEdit(true)}if(b.id=="paper_mapview"){DRAG_POS.x=c.clientX;DRAG_POS.y=c.clientY;jMap.DragPaper=true;selectedMenu("global");jMap.controller.blurAll()}else{if(b.id=="jinomap"){if(b.offsetLeft<=c.clientX&&c.clientX<b.clientWidth+b.offsetLeft&&b.offsetTop<=c.clientY&&c.clientY<b.clientHeight+b.offsetTop){DRAG_POS.x=c.clientX;DRAG_POS.y=c.clientY;jMap.DragPaper=true}if(!ISMOBILE){jMap.controller.blurAll()}}}$("#edgeMenuContent").hide();$("#edgeMenuContent").removeClass("show");$("#fontMenuContent").hide();$("#fontMenuContent").removeClass("show");$("#googleTranslateContent").hide();$("#googleTranslateContent").removeClass("show")};JinoController.prototype.mouseover=function(a){};JinoController.prototype.mouseup=function(c){var g;var a;if(!c){var c=window.event}a=c.originalEvent.originalEvent||c.originalEvent||c;if(a.target){g=a.target}else{if(a.srcElement){g=a.srcElement}}if(g.nodeType==3){g=g.parentNode}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}jMap.DragPaper=false;jMap.positionChangeNodes=false;var b=jMap.dragEl;if(jMap.movingNode&&!jMap.movingNode.removed){var l=c.clientX;var k=c.clientY;var f=document;var m=f.documentElement.scrollTop||f.body.scrollTop;var n=f.documentElement.scrollLeft||f.body.scrollLeft;l+=n;k+=m;var t=l-b._drag.x;var q=k-b._drag.y;jMap.movingNode.connection&&jMap.movingNode.connection.line.remove();jMap.movingNode.remove();delete jMap.movingNode;jMap.dragEl._drag=null;delete jMap.dragEl._drag;var s=t/jMap.cfg.scale;var p=q/jMap.cfg.scale;var r=(s>0)?s:-s;var o=(p>0)?p:-p;if(r>NODE_MOVING_IGNORE||o>NODE_MOVING_IGNORE){b.node.relativeCoordinate(s,p)}jMap.dragEl=null;delete jMap.dragEl}else{if(jMap.dragEl){jMap.dragEl._drag=null;delete jMap.dragEl._drag}jMap.dragEl=null;delete jMap.dragEl}jMap.startedArrowLink=false;$("body").removeClass("onDrag")};JinoController.prototype.click=function(c){var b;var a;if(!c){var c=window.event}a=c.originalEvent.originalEvent||c.originalEvent||c;if(a.target){b=a.target}else{if(a.srcElement){b=a.srcElement}}if(b.nodeType==3){b=b.parentNode}if(runThumbnail){thumbnail();runThumbnail=false}$("input.sinp").blur()};JinoController.prototype.nodeEditKeyDown=function(c){c=c||window.event;c=window.event;if(F_CheckKey(c,[27])){if(J_NODE_CREATING){var f=null;var a=null;while(f=jMap.getSelecteds().pop()){a=f.getParent();f.remove()}J_NODE_CREATING.focus(true);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(a);jMap.layoutManager.layout(true)}jMap.controller.stopNodeEdit(false)}else{if(F_CheckKey(c,[13])){if(BrowserDetect.browser=="Firefox"&&jMap.keyEnterHit++==0){return false}if(c.ctrlKey){}else{if(c.altKey){jMap.controller.stopNodeEdit(true);insertSiblingAction()}else{if(c.shiftKey){var f=jMap.getSelected();var k=jMap.controller.nodeEditor;var l=f.text.attr()["font-size"]*jMap.cfg.scale;var g=k.value;var b=g.split(/\r|\r\n|\n/);k.style.height=(l+2)*(b.length+1)+18+"px";return true}else{jMap.controller.stopNodeEdit(true)}}}return false}}return true};JinoController.prototype.setNodeEditor=function(a){this.nodeEditor=a;if(this.nodeEditor){this.nodeEditor.style.display="none";this.nodeEditor.onkeypress=this.nodeEditKeyDown}};JinoController.prototype.startNodeEdit=function(f){if(!this.nodeEditor||this.nodeEditor==null||f.removed||!jMap.isAllowNodeEdit(f)){return false}var l=TEXT_HGAP;var a=TEXT_VGAP;if(STAT_NODEEDIT){this.stopNodeEdit(true)}if(ISMOBILE){navbarMenusToggle(false)}STAT_NODEEDIT=true;this.nodeEditor.setAttribute("nodeID",f.id);var g=this.nodeEditor;var o=[];o.x=0;o.y=0;o.width=RAPHAEL.getSize().width;o.height=RAPHAEL.getSize().height;if(RAPHAEL.canvas.getAttribute("viewBox")){var k=RAPHAEL.canvas.getAttribute("viewBox").split(" ");o.x=k[0];o.y=k[1];o.width=k[2];o.height=k[3]}g.style.fontFamily=f.text.attr()["font-family"];g.style.fontSize=parseInt(f.text.attr()["font-size"]||(f.parent&&f.parent.isRootNode()?jMap.cfg.nodeFontSizes[1]:jMap.cfg.nodeFontSizes[2]))*this.map.cfg.scale+"px";if(f.isLeft&&f.isLeft()){g.style.textAlign="right"}else{g.style.textAlign="left"}var b=Math.max(f.body.getBBox().width*this.map.cfg.scale-l,jMap.cfg.default_node_size);var n=f.body.getBBox().height*this.map.cfg.scale-a;if(f.isLeft()){var c=(f.body.getBBox().x-o.x+8)*RAPHAEL.getSize().width/o.width+l/4}else{var c=(f.body.getBBox().x-o.x-2)*RAPHAEL.getSize().width/o.width+l/4}var m=(f.body.getBBox().y-o.y)*RAPHAEL.getSize().height/o.height+a/4;g.style.display="";g.style.width=b+"px";g.style.height=n+a+"px";g.style.left=c+"px";g.style.top=m-a/4+"px";g.style.zIndex=999;g.isleft=f.isLeft();g.value=f.getText();g.focus();return true};JinoController.prototype.stopNodeEdit=function(b){if(ISMOBILE){navbarMenusToggle($.cookie("toggleMenus")=="true")}STAT_NODEEDIT=false;J_NODE_CREATING=false;jMap.work.focus();var a=this.nodeEditor;if(this.nodeEditor==undefined||this.nodeEditor==null){return null}if(b==false){a.style.display="none";return null}var f=a.getAttribute("nodeID");if(f==undefined||f==null||f==""){a.style.display="none";return null}var c=this.map.getNodeById(f);if(c==undefined||c==null){a.style.display="none";return null}a.style.display="none";a.setAttribute("nodeID","");var k=this.nodeEditor;var g=JinoUtil.trimStr(k.value);$(k).val("");if(g==c.getText()){return null}c.setText(g);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(c);jMap.layoutManager.layout(true);if(ISMOBILE||supportsTouch){$("html").offset({top:0})}return c};JinoController.prototype.blurAll=function(){var b=jMap.getSelecteds();for(var a=b.length-1;a>=0;a--){b[a].blur()}};JinoController.prototype.copyAction=function(a){scrCopy=jMap.getSelected();jMap.clipboardManager.toClipboard(jMap.getSelecteds(),true)};JinoController.prototype.cutAction=function(f){if(!f){f=jMap.getSelecteds()}scrCopy=jMap.getSelected();var b=f.length;for(var c=0;c<b;c++){if(!jMap.isAllowNodeEdit(f[c])){return false}}var a=f[0].getParent();jMap.clipboardManager.toClipboard(f);for(var c=0;c<b;c++){f[c].remove()}jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(a);jMap.layoutManager.layout(true);return a};JinoController.prototype.unfoldAllChild=function(c){if(c==undefined){return}var a=c.getChildren();if(a.length>0){c.setFolding(false);for(var b=0;b<a.length;b++){this.unfoldAllChild(a[b])}}};JinoController.prototype.pasteAction=function(c){if(!jMap.saveAction.isAlive()){return null}if(c==null){c=jMap.getSelected()}var f=jMap.loadManager.pasteNode(c,jMap.clipboardManager.getClipboardText());var b=function(){var m=f.length;for(var p=0;p<m;p++){jMap.saveAction.pasteAction(f[p])}if(jMap.cfg.lazyLoading){for(var p=0;p<m;p++){var o=f[p].getChildren();var l=o.length-1;for(var q=l;q>=0;q--){o[q].removeExecute()}}}var g="<clipboard>";for(var p=0;p<m;p++){var n=f[p].toXML();g+=n}g+="</clipboard>";jMap.fireActionListener(ACTIONS.ACTION_NODE_PASTE,c,g);if(c.isRootNode()){jMap.initFolding(c);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(c);var k=c.getChildren();if(k.length>0){for(var p=0;p<k.length;p++){if(k[p].folded){k[p].setFolding(false);k[p].setFolding(true)}else{k[p].setFolding(true);k[p].setFolding(false)}}}}else{if(c.folded){c.setFolding(false);c.setFolding(true)}else{jMap.initFolding(c);c.setFolding(true);c.setFolding(false)}}jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();jMap.layoutManager.layout(true)};if(jMap.loadManager.imageLoading.length==0){b()}else{var a=jMap.addActionListener(ACTIONS.ACTION_NODE_IMAGELOADED,function(){b();jMap.removeActionListener(a)})}return f};JinoController.prototype.deleteAction=function(){var g=jMap.getSelecteds();for(var b=0;b<g.length;b++){if(!jMap.isAllowNodeEdit(g[b])){return false}}var c=null;var a=null;var f=-1;while(c=jMap.getSelecteds().pop()){a=c.getParent();f=c.getIndexPos();c.remove()}if(a){jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(a);jMap.layoutManager.layout(true);if(f!=-1){if(a.getChildren().length<=0){a.focus()}else{if(a.getChildren().length>f){a.getChildren()[f].focus()}else{a.getChildren()[a.getChildren().length-1].focus()}}}}else{jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();jMap.getRootNode().screenFocus()}};JinoController.prototype.editNodeAction=function(){jMap.getSelecteds().getLastElement()&&jMap.controller.startNodeEdit(jMap.getSelecteds().getLastElement())};JinoController.prototype.ShiftenterAction=function(){var a=jMap.controller.nodeEditor;a.focus(true);$(a).insertAtCaret("\n");a.style.height=a.offsetHeight+9+"px"};JinoController.prototype.insertAction=function(){var b=jMap.getSelecteds().getLastElement();if(b){J_NODE_CREATING=b;b.folded&&b.setFolding(false);var c={parent:b};if(b.children.length>0){c.sibling=b.children[b.children.length-1]}var a=jMap.createNodeWithCtrl(c);a.focus(true);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(b);jMap.layoutManager.layout(true);a.setTextExecute("");jMap.controller.startNodeEdit(a)}};JinoController.prototype.insertSiblingAction=function(){if(BrowserDetect.browser=="Firefox"){jMap.keyEnterHit=0}var g=jMap.getSelecteds().getLastElement();var f=g&&g.parent;if(f){J_NODE_CREATING=g;var b=g.getIndexPos()+1;var a=null;if(g.position&&g.getParent().isRootNode()){a=g.position}var k={parent:f,index:b,position:a,sibling:g};var c=jMap.createNodeWithCtrl(k);c.focus(true);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(c.parent);jMap.layoutManager.layout(true);c.setTextExecute("");jMap.controller.startNodeEdit(c)}};JinoController.prototype.insertTextOnBranch=function(){var a=jMap.getSelected();if(!jMap.isAllowNodeEdit(a)){return false}JinoUtil.showDialog({url:jMap.cfg.contextPath+"/jsp/fn/insertTextOnBranch.jsp"})};JinoController.prototype.deleteTextOnBranchAction=function(){var a=jMap.getSelected();a.setAttributeExecute("branchText","");jMap.fireActionListener(ACTIONS.ACTION_NODE_BRANCH_TEXT,a);jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap()};JinoController.prototype.insertHyperAction=function(){var a=jMap.getSelected();if(!jMap.isAllowNodeEdit(a)){return false}JinoUtil.showDialog({url:jMap.cfg.contextPath+"/jsp/fn/insertHyperAction.jsp"})};JinoController.prototype.deleteHyperAction=function(){var a=jMap.getSelected();a.setHyperlink(null);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(a);jMap.layoutManager.layout(true)};JinoController.prototype.insertImageAction=function(){var c=jMap.getSelected();if(!jMap.isAllowNodeEdit(c)){return false}var b=c.imgInfo.href&&c.imgInfo.href;b=b||"http://";var a='<form><div class="dialog_content"><br />URL:<br /><input type="text" id="jino_input_img_url"name="jino_input_img_url" value='+b+" /></div></form>";function f(g,k){if(g){c.setImage(k.jino_input_img_url);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(c);jMap.layoutManager.layout(true)}$("#dialog").dialog("close");jMap.work.focus()}$("#dialog").append(a);$("#dialog").dialog({autoOpen:false,closeOnEscape:true,width:350,modal:true,resizable:false,close:function(g,k){$("#dialog .dialog_content").remove();$("#dialog").dialog("destroy");jMap.work.focus()},});$("#dialog").dialog("option","width","none");$("#dialog").dialog("option","buttons",[{text:"<spring:message code='button.apply'/>",click:function(){var g=parseCallbackParam($("#dialog form").serializeArray());f(true,g)}}]);$("#dialog").dialog("option","title",_saveAs);$("#dialog").dialog("open")};JinoController.prototype.imageRemoveAction=function(b){var a=jMap.getSelected();a.setImage();jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(a);jMap.layoutManager.layout(true)};JinoController.prototype.fileRemoveAction=function(b){var a=jMap.getSelected();a.setFile("");jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(a);jMap.layoutManager.layout(true)};JinoController.prototype.deleteNoteAction=function(b){var a=jMap.getSelected();a.setNote("");jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(a);jMap.layoutManager.layout(true)};JinoController.prototype.imageResizerAction=function(a){if(!a){a=jMap.getSelected()}JinoUtil.imgResizer(a)};JinoController.prototype.videoResizerAction=function(a){if(!a){a=jMap.getSelected()}JinoUtil.videoResizer(a)};JinoController.prototype.videoRemoveAction=function(){var a=jMap.getSelected();a.setForeignObject("");jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(a);jMap.layoutManager.layout(true)};JinoController.prototype.findNodeAction=function(a,b){this.executeFindNodeAction(a,b)};JinoController.prototype.executeFindNodeAction=function(a,b){jMap.foundNodes=jMap.findNode(a,b,jMap.getSelected());jMap.findIndex=0;if(jMap.foundNodes.length==0){$("#form_search_results").html("0/0")}else{$("#form_search_prev").removeClass("d-none");$("#form_search_next").removeClass("d-none");jMap.findIndex=-1;jMap.controller.nextFindNodeAction()}return false};JinoController.prototype.nextFindNodeAction=function(){var f=jMap.foundNodes;if(f.length==0){return}jMap.findIndex++;if(jMap.findIndex>=f.length){jMap.findIndex=0}var a=jMap.findIndex;var c=f[a].node;var b=c;while(!b.isRootNode()&&!b.folded){b=b.getParent();b.folded&&b.setFoldingExecute(false)}c.focus(true);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(c);jMap.layoutManager.layout(true);$("#form_search_results").html((jMap.findIndex+1)+"/"+jMap.foundNodes.length);screenFocusAction(c)};JinoController.prototype.prevFindNodeAction=function(){var f=jMap.foundNodes;if(f.length==0){return}jMap.findIndex--;if(jMap.findIndex<0){jMap.findIndex=f.length-1}var a=jMap.findIndex;var c=f[a].node;var b=c;while(!b.isRootNode()&&!b.folded){b=b.getParent();b.folded&&b.setFoldingExecute(false)}c.focus(true);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(c);jMap.layoutManager.layout(true);$("#form_search_results").html((jMap.findIndex+1)+"/"+jMap.foundNodes.length);screenFocusAction(c)};JinoController.prototype.foldingAction=function(a){if(!a){a=jMap.getSelecteds().getLastElement()}a.setFolding(!a.folded);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(a);jMap.layoutManager.layout(true)};JinoController.prototype.foldingAllAction=function(){if(this.map.cfg.lazyLoading){alert("this is not supported by lazyloading.");return}var a=jMap.getSelecteds().getLastElement();if(a){a.screenFocus()}else{jMap.getRootNode().screenFocus()}if(!a){a=this.map.getRootNode()}a.setFoldingAll(true);jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();jMap.layoutManager.layout(true)};JinoController.prototype.unfoldingAllAction=function(){if(this.map.cfg.lazyLoading){alert("this is not supported by lazyloading.");return}var a=jMap.getSelecteds().getLastElement();if(!a){a=this.map.getRootNode()}a.setFoldingAll(false);jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();jMap.layoutManager.layout(true)};JinoController.prototype.parentNodeFocusAction=function(a){a.getParent().focus(true)};JinoController.prototype.childNodeFocusAction=function(b){if(b.folded){b.setFolding(false);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(b);jMap.layoutManager.layout(true);return false}var a=b.getChildren();if(a.length>0){a[0].focus(true)}};JinoController.prototype.prevSiblingNodeFocusAction=function(c){var b=c.prevSibling(true);if(b){var a=b.getParent();if(a.folded){a.setFolding(false);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(a);jMap.layoutManager.layout(true)}b.focus(true)}};JinoController.prototype.nextSiblingNodefocusAction=function(c){var b=c.nextSibling(true);if(b){var a=b.getParent();if(a.folded){a.setFolding(false);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(a);jMap.layoutManager.layout(true)}b.focus(true)}};var insertAtCursor=function(f,c){if(document.selection){f.focus();sel=document.selection.createRange();sel.text=c}else{if(f.selectionStart||f.selectionStart=="0"){var b=f.selectionStart;var a=f.selectionEnd;restoreTop=f.scrollTop;f.value=f.value.substring(0,b)+c+f.value.substring(a,f.value.length);f.selectionStart=b+c.length;f.selectionEnd=b+c.length;if(restoreTop>0){f.scrollTop=restoreTop}}else{f.value+=c}}};var interceptTabs=function(a,b){key=a.keyCode?a.keyCode:a.which?a.which:a.charCode;if(key==9){insertAtCursor(b,"\t");return false}else{return key}};JinoController.prototype.nodeStructureToText=function(b){if(!b){b=jMap.getSelecteds().getLastElement()}var f=jMap.createTextFromNode(b,"\t");var c=$("#dialog_c");var a='<div class="dialog_content_xml"><br />'+i18n.msgStore.node_structure+'<br /><br /><center><textarea id="okm_node_structure_textarea"  onfocus= "this.select()" name="okm_node_structure_textarea" onkeydown="return interceptTabs(event, this);" cols="50" rows="10">'+f+"</textarea><button onclick=\"document.execCommand('copy');\">Copy to clipboard</button></center></div>";c.append(a);c.dialog({autoOpen:false,closeOnEscape:true,modal:true,resizable:false,close:function(g,k){$("#dialog_c .dialog_content_xml").remove();c.dialog("destroy")},});c.dialog("option","width","none");c.dialog("option","dialogClass","nodeStructureToText");c.dialog("option","title",i18n.msgStore.export_text);c.dialog("open");document.execCommand("copy")};JinoController.prototype.nodeStructureToXml=function(b){if(!b){b=jMap.getSelecteds().getLastElement()}var f="<okm>"+b.toXML()+"</okm>";var c=$("#dialog_c");var a='<div class="dialog_content_xml"><br />'+i18n.msgStore.node_structure+'<br /><br /><center><textarea id="okm_node_structure_textarea" onfocus= "this.select()" name="okm_node_structure_textarea" onkeydown="return interceptTabs(event, this);" cols="50" rows="10">'+f+"</textarea><button onclick=\"document.execCommand('copy');\">Copy to clipboard</button></center></div>";c.append(a);c.dialog({autoOpen:false,closeOnEscape:true,modal:true,resizable:false,close:function(g,k){$("#dialog_c .dialog_content_xml").remove();$("#dialog_c").dialog("destroy")},});c.dialog("option","width","none");c.dialog("option","dialogClass","nodeStructureToXml");c.dialog("option","title",i18n.msgStore.export_xml);c.dialog("open");document.execCommand("copy")};JinoController.prototype.nodeEdgeWidthAction=function(a){var b=jMap.getSelecteds().getLastElement();if(b==null||b==undefined){return false}if(!jMap.isAllowNodeEdit(b)){return false}b.setEdgeColor(null,a)};JinoController.prototype.nodeBranchColorAction=function(f){if(!f){f=jMap.getSelecteds().getLastElement()}if(f==null||f==undefined){return false}if(!jMap.isAllowNodeEdit(f)){return false}var k=jMap.getSelecteds();for(var b=0;b<k.length;b++){if(!jMap.isAllowNodeEdit(k[b])){return false}}var g=$("#dialog");var a='<div class="dialog_content"><form><input type="text" id="color" name="color" value="'+f.getBranchColor()+'" /></form><div id="colorpicker"></div><script type="text/javascript">var picker = $("#color").spectrum({allowEmpty:true,color: "'+f.getBranchColor()+'",showInput: true,containerClassName: "full-spectrum",showInitial: true,showAlpha: true,maxPaletteSize: 10,preferredFormat: "hex",showPalette: true,showSelectionPalette: true,showPaletteOnly: true,showButtons: false,flat: true,localStorageKey: "spectrum.mindmap",move: function (color) {	$("#color").val(color);},show: function () {},beforeShow: function () {},hide: function (color) {},palette: [["rgb(0, 0, 0)", "rgb(67, 67, 67)", "rgb(102, 102, 102)", /*"rgb(153, 153, 153)","rgb(183, 183, 183)",*/"rgb(204, 204, 204)", "rgb(217, 217, 217)", /*"rgb(239, 239, 239)", "rgb(243, 243, 243)",*/ "rgb(255, 255, 255)"],["rgb(152, 0, 0)", "rgb(255, 0, 0)", "rgb(255, 153, 0)", "rgb(255, 255, 0)", "rgb(0, 255, 0)","rgb(0, 255, 255)", "rgb(74, 134, 232)", "rgb(0, 0, 255)", "rgb(153, 0, 255)", "rgb(255, 0, 255)"],["rgb(230, 184, 175)", "rgb(244, 204, 204)", "rgb(252, 229, 205)", "rgb(255, 242, 204)", "rgb(217, 234, 211)","rgb(208, 224, 227)", "rgb(201, 218, 248)", "rgb(207, 226, 243)", "rgb(217, 210, 233)", "rgb(234, 209, 220)","rgb(221, 126, 107)", "rgb(234, 153, 153)", "rgb(249, 203, 156)", "rgb(255, 229, 153)", "rgb(182, 215, 168)","rgb(162, 196, 201)", "rgb(164, 194, 244)", "rgb(159, 197, 232)", "rgb(180, 167, 214)", "rgb(213, 166, 189)","rgb(204, 65, 37)", "rgb(224, 102, 102)", "rgb(246, 178, 107)", "rgb(255, 217, 102)", "rgb(147, 196, 125)","rgb(118, 165, 175)", "rgb(109, 158, 235)", "rgb(111, 168, 220)", "rgb(142, 124, 195)", "rgb(194, 123, 160)","rgb(166, 28, 0)", "rgb(204, 0, 0)", "rgb(230, 145, 56)", "rgb(241, 194, 50)", "rgb(106, 168, 79)","rgb(69, 129, 142)", "rgb(60, 120, 216)", "rgb(61, 133, 198)", "rgb(103, 78, 167)", "rgb(166, 77, 121)",/*"rgb(133, 32, 12)", "rgb(153, 0, 0)", "rgb(180, 95, 6)", "rgb(191, 144, 0)", "rgb(56, 118, 29)","rgb(19, 79, 92)", "rgb(17, 85, 204)", "rgb(11, 83, 148)", "rgb(53, 28, 117)", "rgb(116, 27, 71)",*/"rgb(91, 15, 0)", "rgb(102, 0, 0)", "rgb(120, 63, 4)", "rgb(127, 96, 0)", "rgb(39, 78, 19)","rgb(12, 52, 61)", "rgb(28, 69, 135)", "rgb(7, 55, 99)", "rgb(32, 18, 77)", "rgb(76, 17, 48)"]]});<\/script></div>';function c(l,n){if(l){for(var m=0;m<k.length;m++){k[m].setBranch(n.color,null,null)}}g.dialog("close");jMap.work.focus()}g.append(a);g.dialog({autoOpen:false,closeOnEscape:true,modal:true,resizable:false,close:function(l,m){$("#dialog .dialog_content").remove();g.dialog("destroy");jMap.work.focus()},});g.dialog("option","width","auto");g.dialog("option","buttons",[{text:i18n.msgStore.button_apply,click:function(){var l=parseCallbackParam($("#dialog form").serializeArray());c(true,l)}}]);g.dialog("option","dialogClass","nodeBackgroundColorAction");g.dialog("option","title","토픽 연결선 색상");g.dialog("open")};JinoController.prototype.nodeBranchWidthAction=function(a){var b=jMap.getSelecteds().getLastElement();if(b==null||b==undefined){return false}if(!jMap.isAllowNodeEdit(b)){return false}b.setBranch(null,a,null)};JinoController.prototype.nodeBranchStyleAction=function(a){var b=jMap.getSelecteds().getLastElement();if(b==null||b==undefined){return false}if(!jMap.isAllowNodeEdit(b)){return false}b.setBranch(null,null,a)};JinoController.prototype.deleteArrowlinkAction=function(c){if(!c){c=jMap.getSelecteds().getLastElement()}if(!jMap.isAllowNodeEdit(c)){return false}var b=c.arrowlinks.length;for(var a=b-1;a>=0;a--){c.removeArrowLink(c.arrowlinks[a])}};JinoController.prototype.screenFocusAction=function(a){if(!a){a=jMap.getSelecteds().getLastElement()}if(!a){a=jMap.getRootNode()}a.screenFocus()};JinoController.prototype.resetCoordinateAction=function(a){if(!a){a=jMap.getSelecteds().getLastElement()}if(!a){a=jMap.getRootNode()}if(!jMap.isAllowNodeEdit(a)){return false}jMap.resetCoordinate(a);jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap()};JinoController.prototype.qrCodeAction=function(){if(typeof jMap.cfg.QRCode=="undefined"){alert("Service Unavailable");return false}var f=$("#dialog");var b=jMap.work;var a='<from><div class="dialog_content_nod" align="center"><img src="'+jMap.cfg.QRCode+'"></div></from>';function c(g,k){if(g){}f.dialog("close");b.focus()}$("#dialog").append(a);$("#dialog").dialog({autoOpen:false,closeOnEscape:true,width:"400px",modal:true,resizable:false,close:function(g,k){$("#dialog .dialog_content").remove();f.dialog("destroy");b.focus()},});f.dialog("option","width","none");f.dialog("option","buttons",[{text:i18n.msgStore.button_apply,click:function(){var g=parseCallbackParam($("#dialog form").serializeArray());c(true,g)}}]);f.dialog("option","title",i18n.msgStore.qr_code);f.dialog("open")};JinoController.prototype.foreignObjRemoveAction=function(a){if(!a){a=jMap.getSelecteds().getLastElement()}a.setForeignObject("");a.setHyperlink("");jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(a);jMap.layoutManager.layout(true)};JinoController.prototype.insertIFrameAction=function(f){if(!f){f=jMap.getSelecteds().getLastElement()}if(!jMap.isAllowNodeEdit(f)){return false}var l=l||"http://";var q="";var p="";var m=0;var b=0;var o="no";var g=" checked";var c="";var a=100;if(f.foreignObjEl){var n=$(f.foreignObjEl.iframeEl).find("iframe")[0]}if(n!=undefined){var l=n.getAttribute("src");var q=f.foreignObjEl.getAttribute("width");var p=f.foreignObjEl.getAttribute("height");var o=n.getAttribute("scrolling");var a=n.getAttribute("zoom");var m=Math.abs(n.style.marginLeft.replace("px",""));var b=Math.abs(n.style.marginTop.replace("px",""));if(!a){a=100}}else{var q=parent.jMap.cfg.default_img_size;var p=parent.jMap.cfg.default_img_size}if(o=="Yes"){var g=" ";var c=" checked"}var k='<form><div class="dialog_content_nod"><br />'+i18n.msgStore.address+' : <input type="text" id="url" name="url" onfocus= "this.select()" value="'+l+'" style="width: 300px" /><br><br><table cellspacing="0" style="margin:0px;"><tr><td><div id="zoom_title">'+i18n.msgStore.zoom+': </div></td><td><div id="zoomSlider"></div></td><td><input type="text" id="zoom" name="zoom" value="'+a+'" style="width:50px" />%</td></tr><tr><td><div id="width_title">'+i18n.msgStore.width+': </div></td><td><div id="widthSlider"></div></td><td><input type="text" id="width" name="width" value="'+q+'" style="width:70px" /></td></tr><tr><td><div id="height_title">'+i18n.msgStore.height+': </div></td><td><div id="heightSlider"></div></td><td><input type="text" id="height" name="height" value="'+p+'" style="width:70px" /></td></tr><tr><td><div id="margin_left_title">'+i18n.msgStore.margin_left+': </div></td><td><div id="slider_margin_left"></div></td><td><input type="text" id="margin_left" name="margin_left" value="'+m+'" style="width:70px" /></td></tr><tr><td><div id="margin_top_title">'+i18n.msgStore.margin_top+': </div></td><td><div id="slider_margin_top"></div></td><td><input type="text" id="margin_top" name="margin_top" value="'+b+'" style="width:70px" /></td></tr><tr><td><div id=scroll>'+i18n.msgStore.scrolling+": </div></td><td>"+i18n.msgStore.yes+'<input type="radio" id="scrollYes" name="radioScroll" '+c+' value="Yes" style="width:10px" />&nbsp;&nbsp;&nbsp;'+i18n.msgStore.no+'<input type="radio" id="scrollNo" name="radioScroll" '+g+' value="No" style="width:10px" /></td></tr></table></div></form>';function s(C,z){if(C){var u=z.url;var B=parseInt(Math.abs(z.margin_left),10);var A=parseInt(Math.abs(z.margin_top),10);var E=parseInt(z.zoom,10)/100;var w=parseInt(z.width,10)/E+B;var D=parseInt(z.height,10)/E+A;var x="";if(u!=""){var t="-moz-transform: scale("+E+");-moz-transform-origin: 0 0;-o-transform: scale("+E+");-o-transform-origin: 0 0;-webkit-transform: scale("+E+");-webkit-transform-origin: 0 0;";f.setForeignObject('<iframe style="'+t+"border: none;margin-left:"+(-B)+"px;margin-top:"+(-A)+'px;" src="'+u+'" width="'+w+'" height="'+D+'" scrolling="'+z.radioScroll+'" zoom="'+z.zoom+'"></iframe>',z.width,z.height);f.setHyperlink(u);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(f);jMap.layoutManager.layout(true)}else{if(l=="http://"){}}}else{f=parent.jMap.getSelecteds().getLastElement();f.setForeignObject("");f.setHyperlink("");document.getElementById("url").value="";parent.jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(f);parent.jMap.layoutManager.layout(true)}}$("#dialog").append(k);var r=$("#dialog").dialog({autoOpen:false,closeOnEscape:true,modal:true,resizable:false,close:function(u,v){var t=parseCallbackParam($("#dialog form").serializeArray());$("#dialog .dialog_content_nod").remove();$("#dialog").dialog("destroy");jMap.work.focus()},});$("#dialog").dialog("option","width","none");$("#dialog").dialog("option","buttons",[{text:_cancel,click:function(){var t=parseCallbackParam($("#dialog form").serializeArray());$("#dialog .dialog_content_nod").remove();$("#dialog").dialog("destroy");jMap.work.focus()}},{text:_delete,click:function(){var t=parseCallbackParam($("#dialog form").serializeArray());s(false,t)}},{text:_apply,click:function(){var t=parseCallbackParam($("#dialog form").serializeArray());s(true,t)}}]);$("#dialog").dialog("option","dialogClass","insertIFrameAction");$("#dialog").dialog("option","title",i18n.msgStore.iframe);$("#dialog").dialog("open");$(r).ready(function(){$("#zoomSlider").slider({min:10,max:200,value:a,change:function(u,z){var D=parseCallbackParam($("#dialog form").serializeArray());var v=D.url;var A=parseInt(Math.abs(D.margin_left),10);var x=parseInt(Math.abs(D.margin_top),10);document.getElementById("zoom").value=z.value;var C=parseInt(z.value,10);if(C!=""){C=C/100;var w=parseInt(f.foreignObjEl.getAttribute("width"),10);var B=parseInt(f.foreignObjEl.getAttribute("height"),10);scrollAction=D.radioScroll;z.value=parseInt(z.value);var t="-moz-transform: scale("+C+");-moz-transform-origin: 0 0;-o-transform: scale("+C+");-o-transform-origin: 0 0;-webkit-transform: scale("+C+");-webkit-transform-origin: 0 0;";f.setForeignObjectExecute('<iframe style="'+t+"border: none;margin-left:"+(-A)+"px;margin-top:"+(-x)+'px;" src="'+v+'" width="'+(w/C+A)+'" height="'+(B/C+x)+'" scrolling="'+scrollAction+'" zoom="'+z.value+'"></iframe>',w,B)}}});$("#slider_margin_left").slider({min:0,max:1000,value:m,change:function(u,A){var E=parseCallbackParam($("#dialog form").serializeArray());var v=E.url;var B=parseInt(Math.abs(E.margin_left),10);var z=parseInt(Math.abs(E.margin_top),10);document.getElementById("margin_left").value=A.value;if(B!=""){var x=parseInt(f.foreignObjEl.getAttribute("width"),10);var D=parseInt(f.foreignObjEl.getAttribute("height"),10);if($("#scrollno").attr("checked")==null){var w="Yes"}else{var w="No"}A.value=parseInt(A.value);w=E.radioScroll;var C=parseInt(E.zoom,10);if(C==""){C=1}else{C=C/100}var t="-moz-transform: scale("+C+");-moz-transform-origin: 0 0;-o-transform: scale("+C+");-o-transform-origin: 0 0;-webkit-transform: scale("+C+");-webkit-transform-origin: 0 0;";f.setForeignObjectExecute('<iframe style="'+t+"border: none;margin-left:"+(-A.value)+"px;margin-top:"+(-z)+'px;" src="'+v+'" width="'+(x/C+A.value)+'" height="'+(D/C+z)+'" scrolling="'+w+'" zoom="'+E.zoom+'"></iframe>',x,D)}}});$("#slider_margin_top").slider({min:0,max:1000,value:b,change:function(u,A){var E=parseCallbackParam($("#dialog form").serializeArray());var v=E.url;var B=parseInt(Math.abs(E.margin_left),10);var z=parseInt(Math.abs(E.margin_top),10);document.getElementById("margin_top").value=A.value;if(z!=""){var x=parseInt(f.foreignObjEl.getAttribute("width"),10);var D=parseInt(f.foreignObjEl.getAttribute("height"),10);if($("#scrollno").attr("checked")==null){var w="yes"}else{var w="no"}A.value=parseInt(A.value);w=E.radioScroll;var C=parseInt(E.zoom,10);if(C==""){C=1}else{C=C/100}var t="-moz-transform: scale("+C+");-moz-transform-origin: 0 0;-o-transform: scale("+C+");-o-transform-origin: 0 0;-webkit-transform: scale("+C+");-webkit-transform-origin: 0 0;";f.setForeignObjectExecute('<iframe style="'+t+"border: none;margin-left:"+(-B)+"px;margin-top:"+(-A.value)+'px;" src="'+v+'" width="'+(x/C+B)+'" height="'+(D/C+A.value)+'" scrolling="'+w+'" zoom="'+E.zoom+'"></iframe>',x,D)}}});$("#widthSlider").slider({min:20,max:1000,value:q,change:function(u,A){var E=parseCallbackParam($("#dialog form").serializeArray());var v=E.url;var B=parseInt(Math.abs(E.margin_left),10);var z=parseInt(Math.abs(E.margin_top),10);var w=parseInt(E.width,10)+B;var C=parseInt(E.height,10);document.getElementById("width").value=A.value;if($("#scrollno").attr("checked")==null){var x="yes"}else{var x="no"}x=E.radioScroll;var D=parseInt(E.zoom,10);if(D==""){D=1}else{D=D/100}var t="-moz-transform: scale("+D+");-moz-transform-origin: 0 0;-o-transform: scale("+D+");-o-transform-origin: 0 0;-webkit-transform: scale("+D+");-webkit-transform-origin: 0 0;";if(f.foreignObjEl!=undefined){f.setForeignObjectExecute('<iframe style="'+t+"border: none;margin-left:"+(-B)+"px;margin-top:"+(-z)+'px;" src="'+v+'" width="'+(A.value/D+B)+'" height="'+(C/D+A.value+(z-A.value))+'" scrolling="'+x+'" zoom="'+E.zoom+'"></iframe>',A.value,C)}}});$("#heightSlider").slider({min:20,max:1000,value:p,change:function(u,A){var E=parseCallbackParam($("#dialog form").serializeArray());var v=E.url;var B=parseInt(Math.abs(E.margin_left),10);var z=parseInt(Math.abs(E.margin_top),10);var w=parseInt(E.width,10);var C=parseInt(E.height,10)+z;document.getElementById("height").value=A.value;if($("#scrollno").attr("checked")==null){var x="yes"}else{var x="no"}x=E.radioScroll;var D=parseInt(E.zoom,10);if(D==""){D=1}else{D=D/100}var t="-moz-transform: scale("+D+");-moz-transform-origin: 0 0;-o-transform: scale("+D+");-o-transform-origin: 0 0;-webkit-transform: scale("+D+");-webkit-transform-origin: 0 0;";if(f.foreignObjEl!=undefined){f.setForeignObjectExecute('<iframe style="'+t+"border: none;margin-left:"+(-B)+"px;margin-top:"+(-z)+'px;" src="'+v+'" width="'+(w/D+A.value+(B-A.value))+'" height="'+(A.value/D+z)+'" scrolling="'+x+'" zoom="'+E.zoom+'"></iframe>',w,A.value)}}})})};JinoController.prototype.undoAction=function(){jMap.historyManager&&jMap.historyManager.undo()};JinoController.prototype.redoAction=function(){jMap.historyManager&&jMap.historyManager.redo()};JinoController.prototype.nodeToNodeAction=function(){lastSelected=jMap.getSelecteds().getLastElement()};JinoController.prototype.getSelectedLink=function(f,a){if(f==null){return}if(a==null){return}var b=f.arrowlinks;for(var c=0;c<b.length;c++){if(b[c].destination==a.id){return b[c]}}return null};JinoController.prototype.createSelectedLink=function(f,a){if(f==null){return}if(a==null){return}var b=jMap.getSelecteds().getLastElement();if(lastSelected!=null&&lastSelected.getID()==b.getID()){return}if(f!=null){var c=null;switch(jMap.layoutManager.type){case"jMindMapLayout":c=new CurveArrowLink(a);break;case"jTreeLayout":c=new RightAngleArrowLink(a);break;default:c=new CurveArrowLink(a)}f.addArrowLink(c);jMap.layoutManager.layout(true);c.draw();return c}return null};JinoController.prototype.removeArrowLink=function(){if(jMap.getSelected()==undefined){return}var a=jMap.getSelected().arrowlinks;var b=jMap.getSelected();while(a.length>0){var a=jMap.getSelected().arrowlinks;b.removeArrowLink(a[0])}jMap.layoutManager.layout(true)};JinoController.prototype.removeArrowLinkId=function(f){if(jMap.getSelected()==undefined){return}var c=jMap.getSelected();if(lastSelected!=null){c=lastSelected}var a=c.arrowlinks;for(var b=0;b<a.length;b++){if(a[b].id==f){c.removeArrowLink(a[b]);break}}jMap.layoutManager.layout(true)};JinoController.prototype.settingArrowLink=function(b,f,c,g,a){if(jMap.getSelected()==undefined){return}if(lastSelected!=null){lastSelected.settingArrowLink(b,f,c,g,a);jMap.layoutManager.layout(true);lastSelected=null}jMap.getSelected().settingArrowLink(b,f,c,g,a);jMap.layoutManager.layout(true)};JinoController.prototype.settingArrowLinkText=function(b,a){if(jMap.getSelected()==undefined){return}if(lastSelected!=null){lastSelected.settingArrowLinkText(b,a);jMap.layoutManager.layout(true)}jMap.getSelected().settingArrowLinkText(b,a);jMap.layoutManager.layout(true)};JinoController.prototype.settingArrowLinkAttr=function(k,b,f,c,g,a){if(jMap.getSelected()==undefined){return}if(lastSelected!=null){lastSelected.settingArrowLinkAttr(k,b,f,c,g,a);jMap.layoutManager.layout(true)}jMap.getSelected().settingArrowLinkAttr(k,b,f,c,g,a);jMap.layoutManager.layout(true)};JinoController.prototype.doNodeToNodeAction=function(){var a=jMap.getSelecteds().getLastElement();if(lastSelected!=null&&lastSelected.getID()==a.getID()){return}if(lastSelected!=null){var b=null;switch(jMap.layoutManager.type){case"jMindMapLayout":b=new CurveArrowLink(a);break;case"jTreeLayout":b=new RightAngleArrowLink(a);break;default:b=new CurveArrowLink(a)}lastSelected.addArrowLink(b);jMap.layoutManager.layout(true);b.draw()}};JinoControllerGuest=function(a){this.map=a;this.nodeEditor=null;document.onkeydown=function(b){b=b||window.event;if(jMap.work.hasFocus()){return false}return true};$(this.map.work).on("vmousedown",{controller:this},this.mousedown);$(this.map.work).on("vmousemove",{controller:this},this.mousemove);$(this.map.work).on("vmouseup",{controller:this},this.mouseup);this.map.work.addEventListener("touchstart",this.touchstart,false);this.map.work.onkeydown=this.keyPress;this.map.work.ondragenter=function(b){b=b||window.event;if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}};this.map.work.ondragover=function(b){b=b||window.event;if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}};this.map.work.ondrop=function(b){b=b||window.event;if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}}};JinoControllerGuest.prototype.type="JinoControllerGuest";JinoControllerGuest.prototype.keyPress=function(a){if(STAT_NODEEDIT){return true}a=a||window.event;var k=null;if(a){k=a.ctrlKey}else{if(a&&document.getElementById){k=(Event.META_MASK||Event.CTRL_MASK)}else{if(a&&document.layers){k=(a.metaKey||a.ctrlKey)}}}var l=a.altKey;var g=a.keyCode;switch(g){case 37:var f=jMap.getSelecteds().getLastElement();if(f.isRootNode()){var c=f.getChildren();for(var b=0;b<c.length;b++){if(c[b].position=="left"){c[b].focus(true);break}}}else{if(f.isLeft&&f.isLeft()){if(f.folded){f.setFoldingExecute(false);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendants(f);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(f);jMap.layoutManager.layout(true);return false}var c=f.getChildren();if(c.length>0){c[0].focus(true)}}else{f.getParent().focus(true)}}break;case 38:var f=jMap.getSelecteds().getLastElement();if(f.isRootNode()){}else{var c=f.getParent().getChildren();if(f.getIndexPos()>0){c[f.getIndexPos()-1].focus(true)}}break;case 39:var f=jMap.getSelecteds().getLastElement();if(f.isRootNode()){var c=f.getChildren();for(var b=0;b<c.length;b++){if(c[b].position=="right"){c[b].focus(true);break}}}else{if(f.isLeft&&f.isLeft()){f.getParent().focus(true)}else{if(f.folded){f.setFoldingExecute(false);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendants(f);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(f);jMap.layoutManager.layout(true);return false}var c=f.getChildren();if(c.length>0){c[0].focus(true)}}}break;case 40:var f=jMap.getSelecteds().getLastElement();if(f.isRootNode()){}else{var c=f.getParent().getChildren();if(c.length>f.getIndexPos()+1){c[f.getIndexPos()+1].focus(true)}}break;case 70:if(k){jMap.controller.findNodeAction()}break;case 71:if(k){if(AL_GOOGLE_SEARCHER==null){SET_GOOGLE_SEARCHER(true)}else{SET_GOOGLE_SEARCHER(false)}}else{if(a.shiftKey){}else{}}break;case 78:if(a.ctrlKey){location.href="/mindmap/new.do"}break;case 79:if(a.ctrlKey){openMap()}break;case 32:var f=jMap.getSelecteds().getLastElement();f.setFoldingExecute(!f.folded);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendants(f);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(f);jMap.layoutManager.layout(true);break}return false};JinoControllerGuest.prototype.mousemove=function(f){var c;if(!f){var f=window.event}if(f.target){c=f.target}else{if(f.srcElement){c=f.srcElement}}if(c.nodeType==3){c=c.parentNode}if(c.id=="nodeEditor"){return true}var b=f.clientX-DRAG_POS.x;var a=f.clientY-DRAG_POS.y;DRAG_POS.x=f.clientX;DRAG_POS.y=f.clientY;if(jMap.DragPaper){this.scrollTop-=a;this.scrollLeft-=b}return false};JinoControllerGuest.prototype.touchstart=function(b){if(ISMOBILE&&supportsTouch&&b.touches&&b.touches.length==2){var a=jMap.getSelecteds().getLastElement();if(a){a.setFoldingExecute(!a.folded);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(node);jMap.layoutManager.layout(true)}}};JinoControllerGuest.prototype.mousedown=function(b){var a;if(!b){var b=window.event}if(b.target){a=b.target}else{if(b.srcElement){a=b.srcElement}}if(a.nodeType==3){a=a.parentNode}if(a.id=="nodeEditor"){return true}if(STAT_NODEEDIT){jMap.controller.stopNodeEdit(true)}DRAG_POS.x=b.clientX;DRAG_POS.y=b.clientY;if(a.id=="paper_mapview"){selectedMenu("global");jMap.DragPaper=true;if(!ISMOBILE){jMap.controller.blurAll()}}else{if(a.id=="jinomap"){if(a.offsetLeft<=b.clientX&&b.clientX<a.clientWidth+a.offsetLeft&&a.offsetTop<=b.clientY&&b.clientY<a.clientHeight+a.offsetTop){jMap.DragPaper=true}}}};JinoControllerGuest.prototype.mouseup=function(a){a=a||window.event;jMap.DragPaper=false;jMap.positionChangeNodes=false};JinoControllerGuest.prototype.blurAll=function(){var b=jMap.getSelecteds();for(var a=b.length-1;a>=0;a--){b[a].blur()}};var interceptTabs=function(a,b){key=a.keyCode?a.keyCode:a.which?a.which:a.charCode;if(key==9){insertAtCursor(b,"\t");return false}else{return key}};JinoControllerGuest.prototype.nodeStructureFromText=function(b){if(!b){b=jMap.getSelecteds().getLastElement()}var a='<form><div class="dialog_content_nod"><br />'+i18n.msgStore.create_node_text+'<br /><br /><center><textarea id="okm_node_structure_textarea" name="okm_node_structure_textarea" onkeydown="return interceptTabs(event, this);" cols="50" rows="10"></textarea></center></div></form>';function c(g,l){if(g){var k=l.okm_node_structure_textarea;b.folded&&b.setFoldingExecute(false);jMap.createNodeFromText(b,k);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(b);jMap.layoutManager.layout(true)}$("#dialog_c").dialog("close");jMap.work.focus()}$("#dialog_c").append(a);$("#dialog_c").dialog({autoOpen:false,width:"auto",closeOnEscape:true,modal:true,resizable:false,close:function(f,g){$("#dialog_c .dialog_content_nod").remove();$("#dialog_c").dialog("destroy");jMap.work.focus()},});$("#dialog_c").dialog("option","buttons",[{text:i18n.msgStore.button_apply,click:function(){var f=parseCallbackParam($("#dialog_c form").serializeArray());c(true,f)}}]);$("#dialog_c").dialog("option","dialogClass","nodeStructureFromText");$("#dialog_c").dialog("option","title",i18n.msgStore.import_text);$("#dialog_c").dialog("open")};JinoControllerGuest.prototype.nodeStructureToText=function(b){if(!b){b=jMap.getSelecteds().getLastElement()}var c=jMap.createTextFromNode(b,"\t");var a='<div class="dialog_content_xml"><br />'+i18n.msgStore.node_structure+'<br /><br /><center><textarea id="okm_node_structure_textarea"  onfocus= "this.select()" name="okm_node_structure_textarea" onkeydown="return interceptTabs(event, this);" cols="50" rows="10">'+c+"</textarea></center></div>";$("#dialog_c").append(a);$("#dialog_c").dialog({autoOpen:false,width:"auto",closeOnEscape:true,modal:true,resizable:false,close:function(f,g){$("#dialog_c .dialog_content_xml").remove();$("#dialog_c").dialog("destroy");jMap.work.focus()},});$("#dialog_c").dialog("option","dialogClass","nodeStructureToText");$("#dialog_c").dialog("option","title",i18n.msgStore.export_text);$("#dialog_c").dialog("open")};JinoControllerGuest.prototype.nodeStructureFromXml=function(b){if(!b){b=jMap.getSelecteds().getLastElement()}var a='<form><div class="dialog_content_nod"><br />'+i18n.msgStore.create_node_xml+'<br /><center><textarea id="okm_node_structure_textarea" name="okm_node_structure_textarea" onkeydown="return interceptTabs(event, this);" cols="50" rows="10"></textarea></center></div></from>';function c(g,n){if(g){if(!jMap.saveAction.isAlive()){return null}var o=n.okm_node_structure_textarea;o=o.replace(/&/g,"&amp;");var m=/(TEXT=")(.*)(" FOLDED=)/ig;o=o.replace(m,function(){var q=arguments[1];var f=convertCharStr2XML(arguments[2]);var r=arguments[3];return q+f+r});m=/(LINK=")([^"]*)/ig;o=o.replace(m,function(){var q=arguments[1];var f=convertCharStr2XML(arguments[2]);return q+f});o=o.replace(/ POSITION="[^"]*"/ig,"");var p=jMap.loadManager.pasteNode(b,o);var l=function(){for(var f=0;f<p.length;f++){jMap.saveAction.pasteAction(p[f])}jMap.fireActionListener(ACTIONS.ACTION_NODE_PASTE,b,o);jMap.initFolding(b);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(b);jMap.layoutManager.layout(true)};if(jMap.loadManager.imageLoading.length==0){l()}else{var k=jMap.addActionListener(ACTIONS.ACTION_NODE_IMAGELOADED,function(){l();jMap.removeActionListener(k)})}}jMap.work.focus()}$("#dialog_c").append(a);$("#dialog_c").dialog({autoOpen:false,width:"auto",closeOnEscape:true,modal:true,resizable:false,close:function(f,g){$("#dialog_c .dialog_content_nod").remove();$("#dialog_c").dialog("destroy");jMap.work.focus()},});$("#dialog_c").dialog("option","buttons",[{text:i18n.msgStore.button_apply,click:function(){var f=parseCallbackParam($("#dialog_c form").serializeArray());c(true,f)}}]);$("#dialog_c").dialog("option","dialogClass","nodeStructureFromXml");$("#dialog_c").dialog("option","title",i18n.msgStore.import_xml);$("#dialog_c").dialog("open")};JinoControllerGuest.prototype.nodeStructureToXml=function(b){if(!b){b=jMap.getSelecteds().getLastElement()}var c="<okm>"+b.toXML()+"</okm>";var a='<div class="dialog_content_xml"><br />'+i18n.msgStore.node_structure+'<br /><br /><center><textarea id="okm_node_structure_textarea" onfocus= "this.select()" name="okm_node_structure_textarea" onkeydown="return interceptTabs(event, this);" cols="50" rows="10">'+c+"</textarea></center></div>";$("#dialog_c").append(a);$("#dialog_c").dialog({autoOpen:false,width:"auto",closeOnEscape:true,modal:true,resizable:false,close:function(f,g){$("#dialog_c .dialog_content_xml").remove();$("#dialog_c").dialog("destroy");jMap.work.focus()},});$("#dialog_c").dialog("option","dialogClass","nodeStructureToXml");$("#dialog_c").dialog("option","title",i18n.msgStore.export_xml);$("#dialog_c").dialog("open")};JinoControllerGuest.prototype.findNodeAction=function(a,b){this.executeFindNodeAction(a,b)};JinoControllerGuest.prototype.executeFindNodeAction=function(a,b){jMap.foundNodes=jMap.findNode(a,b,jMap.getSelected());jMap.findIndex=0;if(jMap.foundNodes.length==0){$("#form_search_results").html("0/0")}else{$("#form_search_prev").removeClass("d-none");$("#form_search_next").removeClass("d-none");jMap.findIndex=-1;jMap.controller.nextFindNodeAction()}return false};JinoControllerGuest.prototype.nextFindNodeAction=function(){var f=jMap.foundNodes;if(f.length==0){return}jMap.findIndex++;if(jMap.findIndex>=f.length){jMap.findIndex=0}var a=jMap.findIndex;var c=f[a].node;var b=c;while(!b.isRootNode()&&!b.folded){b=b.getParent();b.folded&&b.setFoldingExecute(false)}c.focus(true);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(c);jMap.layoutManager.layout(true);$("#form_search_results").html((jMap.findIndex+1)+"/"+jMap.foundNodes.length);screenFocusAction(c)};JinoControllerGuest.prototype.prevFindNodeAction=function(){var f=jMap.foundNodes;if(f.length==0){return}jMap.findIndex--;if(jMap.findIndex<0){jMap.findIndex=f.length-1}var a=jMap.findIndex;var c=f[a].node;var b=c;while(!b.isRootNode()&&!b.folded){b=b.getParent();b.folded&&b.setFoldingExecute(false)}c.focus(true);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(c);jMap.layoutManager.layout(true);$("#form_search_results").html((jMap.findIndex+1)+"/"+jMap.foundNodes.length);screenFocusAction(c)};JinoControllerGuest.prototype.screenFocusAction=function(a){if(!a){a=jMap.getSelecteds().getLastElement()}if(!a){a=jMap.getRootNode()}a.screenFocus()};JinoControllerGuest.prototype.foldingAction=function(a){if(!a){a=jMap.getSelecteds().getLastElement()}a.setFoldingExecute(!a.folded);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(a);jMap.layoutManager.layout(true)};var HGAP=20;var VGAP=5;var TEXT_HGAP=10;var TEXT_VGAP=10;var FOLDER_RADIUS=4;var PERCEIVE_WIDTH=30;var NODE_CORNER_ROUND=5;var NODE_MOVING_IGNORE=5;if(window.console===undefined||console.log===undefined){console={log:function(){},info:function(){},warn:function(){},error:function(){}}}HTMLElement.prototype.click=function(){var a=this.ownerDocument.createEvent("MouseEvents");a.initMouseEvent("click",true,true,this.ownerDocument.defaultView,1,0,0,0,0,false,false,false,false,0,null);this.dispatchEvent(a)};var supportsTouch="createTouch" in document;var RAPHAEL=null;var STAT_NODEEDIT=false;var CLIPBOARD_DATA="";var DRAG_POS={x:0,y:0};var J_NODE_CREATING=false;var ACTIONS={ACTION_NEW_NODE:"action_NewNode",ACTION_NODE_REMOVE:"action_NodeRemove",ACTION_NODE_EDITED:"action_NodeEdited",ACTION_NODE_SELECTED:"action_NodeSelected",ACTION_NODE_UNSELECTED:"action_NodeUnSelected",ACTION_NODE_FOLDING:"action_NodeFolding",ACTION_NODE_MOVED:"action_NodeMoved",ACTION_NODE_COORDMOVED:"action_NodeCoordMoved",ACTION_NODE_HYPER:"action_NodeHyper",ACTION_NODE_FILE:"action_NodeFile",ACTION_NODE_NOTE:"action_NodeNote",ACTION_NODE_IMAGE:"action_NodeImage",ACTION_NODE_IMAGELOADED:"action_ImageLoaded",ACTION_NODE_PASTE:"action_NodePaste",ACTION_NODE_UNDO:"action_NodeUndo",ACTION_NODE_REDO:"action_NodeRedo",ACTION_NODE_FOREIGNOBJECT:"action_NodeForeignObject",ACTION_NODE_ATTRS:"action_NodeAttrs",ACTION_NODE_BRANCH_TEXT:"action_NodeBranchText",ACTION_NODE_ARROWLINK:"action_NodeArrowLink",ACTION_NODE_FONTSIZE:"action_NodeFontSize",ACTION_NODE_EDGECOLOR:"action_NodeEdgeColor",ACTION_NODE_BRANCH:"action_NodeBranch",ACTION_PRESENTATION_INSERT:"action_PresentaionInsert",ACTION_PRESENTATION_DELETE:"action_PresentaionDelete",ACTION_PRESENTATION_UPDATE:"action_PresentaionUpdate",ACTION_PRESENTATION_MOVE:"action_PresentaionMove",ACTION_CHAT_SEND_MESSAGE:"action_ChatSendMessage",ACTION_CHAT_ON_TYPING:"action_ChatOnTyping",ACTION_CHAT_OFF_TYPING:"action_ChatOffTyping",ACTION_MAP_RESTRICT_EDITING:"action_MapRestrictEditing",ACTION_ASYNCHRONOUS:"action_Asynchronous",};var ISMOBILE=((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPad/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/Android/i)));if(window.console===undefined){console={log:function(){}}}JinoMap=function(b,a,f,g,c){RAPHAEL=Raphael(b,a,f);RAPHAEL.canvas.id="paper_mapview";this.selectedNodes=new Array();this.DragPaper=false;this.positionChangeNodes=false;this.movingNode=false;this.isSavedFlag=true;this.indexColor=0;this.mouseRightClicked=false;this.scaleTimes=1;this._enableDragPaper=true;this.mode=g||0;this.canNodeAdd=true;this.Listeners=new Array();if(!c){c=this.cfg.contextPath}this.statusBar=null;this.nodeEditorHandle=$('<textarea id="nodeEditor" value="" style="position:absolute;top:0px;left:0px;width:100px;height:0px;overflow:hidden;display:none;line-height: 1.2;" />').appendTo($("#"+b));this.nodes=[];this.arrowlinks=[];this.work=$("#"+b)[0];$("#"+b).css("background-color",this.cfg.mapBackgroundColor);this.controller=this.mode?new JinoController(this):new JinoControllerGuest(this);this.loadManager=new jLoadManager(this);this.layoutManager=null;this.saveAction=new jSaveAction(this);this.clipboardManager=new jClipboardManager(this);this.nodeEditorHandle.textGrow({pad:25,min_limit:70,max_limit:1000});this.work.focused=false;this.work.hasFocus=function(){return this.focused};this.work.onfocus=function(){this.focused=true};this.work.onblur=function(){this.focused=false};if(Raphael.svg){this.groupEl=document.createElementNS("http://www.w3.org/2000/svg","g");this.groupEl.style.webkitTapHighlightColor="rgba(0,0,0,0)";RAPHAEL.canvas&&RAPHAEL.canvas.appendChild(this.groupEl)}};JinoMap.prototype.type="JinoMap";JinoMap.instance=null;JinoMap.prototype.deleteNodeById=function(a){delete this.nodes[a]};JinoMap.prototype.getNodeById=function(a){return this.nodes[a]};JinoMap.prototype.checkID=function(b){if(!b){return false}for(var a in this.nodes){if(a==b){return false}}return true};JinoMap.prototype.getRootNode=function(){return this.rootNode};JinoMap.prototype.setRootNode=function(a){this.rootNode=a};JinoMap.prototype.addActionListener=function(a,b){var c={name:a,f:b};this.Listeners.push(c);return c};JinoMap.prototype.removeActionListener=function(a){this.Listeners.remove(a)};JinoMap.prototype.fireActionListener=function(){if(arguments.length<1){return}var c=Array.prototype.slice.call(arguments,0,1)[0];var a=Array.prototype.slice.call(arguments,1);var f=this.Listeners,b=f.length;while(b--){if(!f[b]){continue}if(f[b].name==c){f[b].f.apply(this,a)}}};JinoMap.prototype.findNode=function(f,n,b,m){if(!m){m=[]}var c=b||this.rootNode;var k=false;$.each(f,function(p,q){if(q.identity==c.id){k=true}});if(k){m.push({node:c,match:k})}var l=false;if(c.folded){if(n){jMap.controller.foldingAction(c);l=true}else{l=false}}else{l=true}if(c.getChildren().length>0){if(l){var a=c.getChildren();var o=a.length;for(var g=0;g<o;g++){this.findNode(f,n,a[g],m)}}}return m};JinoMap.prototype.loadMap=function(a,b,c){this.clearMap();this.loadManager.loadMap(a,b,c)};JinoMap.prototype.loadMapFromXml=function(a){this.clearMap();var b=false;if(window.DOMParser){var c=new DOMParser();b=c.parseFromString(a,"text/xml")}else{b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a)}if(b){this.loadManager.parseMM(b)}};JinoMap.prototype.clearMap=function(){if(this.rootNode){RAPHAEL.clear()}if(this.groupEl){this.groupEl.remove;this.groupEl=null}};JinoMap.prototype.newMap=function(title){this.clearMap();if(!title){title="newMap"}var layout=this.cfg.mapLayout;var jsCode="this.layoutManager =  new "+layout+"(this);";eval(jsCode);var param={text:title};this.rootNode=this.createNodeWithCtrlExecute(param);this.rootNode.focus(true);this.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();return this.rootNode;JinoUtil.waitingDialogClose()};JinoMap.prototype.getSelecteds=function(){return this.selectedNodes};JinoMap.prototype.getSelected=function(){if(this.getSelecteds().length<1){return null}return this.getSelecteds().getLastElement()};JinoMap.prototype.isSaved=function(){return this.isSavedFlag};JinoMap.prototype.setSaved=function(a){this.isSavedFlag=a};JinoMap.prototype.setLayoutManager=function(a){this.layoutManager=a;if(a.type=="jTableLayout"){this.fixTextWidth(this.getRootNode())}$.ajax({type:"post",async:false,url:this.cfg.contextPath+"/mindmap/changeMap.do",data:{mapId:mapId,style:a.type},success:function(c,f,b){window.location.reload(true)},error:function(f,b,c){alert("setLayoutManager : "+b)}})};JinoMap.prototype.fixTextWidth=function(c){var n=c.getText();var m=n.length;var k=n.split("\n");if(m>20&&k.length<2){var a=function(t,p){var r=t.slice(0,20);p.push(r);var q=t.substring(20);if(q.length>20){a(q,p)}else{p.push(q)}};var l=new Array();a(n,l);var g=l.join("\n");c.setText(g)}if(c.getChildren().length>0){var b=c.getChildren();var o=b.length;for(var f=0;f<o;f++){this.fixTextWidth(b[f])}}};JinoMap.prototype.changeOfWholeMap=function(l){if(l.connection){l.connection.remove()}switch(this.layoutManager.type){case"jMindMapLayout":l.connection=l.parent&&new jLineBezier(l.parent,l);break;case"jTreeLayout":l.connection=l.parent&&new jLinePolygonal(l.parent,l);break;case"jTableLayout":break;case"jFishboneLayout":l.connection=l.parent&&new jLineBezier(l.parent,l);break;default:l.connection=l.parent&&new jLineBezier(l.parent,l);break}if(l.connection&&l.hided){l.connection.hide()}var k=new Array();var g=l.arrowlinks.length;for(var f=0;f<g;f++){k.push(l.arrowlinks[f].destinationNode);l.removeArrowLink(l.arrowlinks[f])}var b=k.length;for(var f=0;f<b;f++){var m=null;switch(jMap.layoutManager.type){case"jMindMapLayout":m=new CurveArrowLink(k[f]);break;case"jTreeLayout":m=new RightAngleArrowLink(k[f]);break;default:m=new CurveArrowLink(k[f])}l.addArrowLink(m)}if(l.isRootNode()){l.fontSize=this.cfg.nodeFontSizes[0]}else{if(l.getParent().isRootNode()){l.fontSize=this.cfg.nodeFontSizes[1]}else{l.fontSize=this.cfg.nodeFontSizes[2]}}l.text.attr({"font-size":l.fontSize});l.CalcBodySize();if(l.hided){l.hide()}if(l.getChildren().length>0){var c=l.getChildren();var a=c.length;for(var f=0;f<a;f++){this.changeOfWholeMap(c[f])}}};JinoMap.prototype.getLayoutManager=function(){return this.layoutManager};JinoMap.prototype.showAdminNotice=function(c){var a='<from><div class="dialog_content_nod" align="center"><div>'+c+"</div></div></from>";function b(g,k){if(g){}$("#dialog").dialog("close");jMap.work.focus()}$("#dialog").append(a);$("#dialog").dialog({autoOpen:false,closeOnEscape:true,width:350,modal:true,resizable:false,close:function(f,g){$("#dialog .dialog_content_nod").remove();$("#dialog").dialog("destroy")},});$("#dialog").dialog("option","width","none");$("#dialog").dialog("option","buttons",[{text:i18n.msgStore.notice_button_ok,click:function(){var f=parseCallbackParam($("#dialog form").serializeArray());b(true,f)}}]);$("#dialog").dialog("option","title",i18n.msgStore.notice_title);$("#dialog").dialog("open")};JinoMap.prototype.showBlinkStatusBar=function(a){if(!this.statusBar||this.statusBar.removed){this.statusBar=this.body=RAPHAEL.text();this.statusBar.attr({"font-size":12,"text-anchor":"start",fill:"#000",opacity:0})}this.statusBar.attr({text:a,x:this.work.scrollLeft+15,y:this.work.scrollTop+this.work.offsetHeight-30});this.statusBar.animate({opacity:1},500,function(){this.animate({opacity:0},500)});this.aaa=$('<div style="position:absolute" id="aaa">aaaa</div>').appendTo($("#jinomap"))};JinoMap.prototype.createNodeWithCtrl=function(l,g,f){if(!jMap.saveAction.isAlive()){return null}var k=this.historyManager;var a=null;var c=this.createNodeWithCtrlExecute(l,g);var b=k&&k.extractNode(c);k&&k.addToHistory(a,b);this.saveAction.newAction(c,f);this.fireActionListener(ACTIONS.ACTION_NEW_NODE,c,l,g);this.setSaved(false);return c};JinoMap.prototype.createNodeWithCtrlExecute=function(param,style){if(!style){style=this.cfg.nodeStyle}var jsCode="var newNode = new "+style+"(param);";eval(jsCode);var controller=this.mode?new jNodeController():new jNodeControllerGuest();newNode.addEventController(controller);return newNode};JinoMap.prototype.changePosition=function(k,c,a,b){if(!jMap.saveAction.isAlive()){return null}var l=this.changePositionExecute(k,c,a,b);var g=function(){var n=l.length;for(var m=0;m<n;m++){jMap.saveAction.moveAction(l[m],k,b)}for(var m=0;m<n;m++){jMap.saveAction.editAction(l[m])}jMap.fireActionListener(ACTIONS.ACTION_NODE_MOVED,k,l,a,b);jMap.setSaved(false)};if(this.loadManager.imageLoading.length==0){g()}else{var f=this.addActionListener(ACTIONS.ACTION_NODE_IMAGELOADED,function(){g();this.removeActionListener(f)})}return l};JinoMap.prototype.changePositionExecute=function(n,c,l,f){if(jMap.getSelected()){jMap.fireActionListener("action_NodeUnSelected",jMap.getSelected())}var k="<paste>";var b=c.length;for(var g=0;g<b;g++){k+=c[g].toXML();c[g].removeExecute()}k+="</paste>";var m=(f)?f.getIndexPos():null;var a=this.loadManager.pasteNode(n,k,m,l);return a};JinoMap.prototype.initFolding=function(f){if(this.cfg.lazyLoading){if(f.lazycomplete){if(f.folded){f.setFoldingExecute(f.folded)}}else{if(f.numofchildren>0){f.folderShape&&f.folderShape.show();f.folded=true}else{f.lazycomplete=new Date().valueOf()}}}else{if(f.folded){f.setFoldingExecute(f.folded)}}if(f.getChildren().length>0){var c=f.getChildren();var a=c.length;for(var b=0;b<a;b++){this.initFolding(c[b])}}};JinoMap.prototype.initFoldingAll=function(){this.initFolding(this.getRootNode())};JinoMap.prototype.toXML=function(){var a='<map version="0.9.0">\n';a+="<!-- To view this file, download free mind mapping software FreeMind from http://freemind.sourceforge.net -->\n";a+=this.rootNode.toXML()+"\n";a+="</map>";return a};JinoMap.prototype.resetCoordinate=function(f){f.hgap=0;f.vshift=0;this.saveAction.editAction(f,false);if(f.getChildren().length>0){var c=f.getChildren();var a=c.length;for(var b=0;b<a;b++){this.resetCoordinate(c[b])}}};JinoMap.prototype.createNodeFromText=function(f,q,m){var s=q.split("\n");var a=f;var l=f;var b=0;var r=m;var p=s.length;for(var g=0;g<p;g++){if(!m){r=(s[g].charAt(0)=="\t")?"\t":"    "}var n=s[g].split(r);var o=n.length;var k=n[o-1];if(o>b+1){o=b+1}while(true){if(b==o-1){var c={parent:l,text:k};l=this.createNodeWithCtrl(c);b=o;break}if(!l.getParent()){break}l=l.getParent();b=b-1}}};JinoMap.prototype.createTextFromNode=function(g,f,l,k){k=k?k:0;l=l?l:"";var m="";for(var c=0;c<k;c++){m=m+f}l=l+m+g.getText()+"\n";if(g.getChildren().length>0){var b=g.getChildren();k++;var a=b.length;for(var c=0;c<a;c++){l=this.createTextFromNode(b[c],f,l,k)}}return l};JinoMap.prototype.setWaterMark=function(){this.watermark=$('<div id="okm_wartermark" style="position:absolute;top:0px;left:0px;text-decoration:underline;"><a href="http://www.okmindmap.com" target="_blank">OKMindmap</a></div>');$(this.work).after(this.watermark);var a=function(){var c=$("#okm_wartermark");var f=$(window).width()-parseInt(c.css("width"))-15;var b=$(window).height()-parseInt(c.css("height"))-15;c.css("top",b);c.css("left",f)};a();$(window).resize(a)};JinoMap.prototype.setSessionTimeout=function(){if(!this.mode){return null}this.sessionTimeout=setTimeout(function(){if(ISMOBILE){alert("서비스 이용이 없어 자동 로그아웃 되었습니다.\n다시 로그인 하시기 바랍니다.");location.replace(jMap.cfg.contextPath+"/user/logout.do")}var b=function(c,k){if(c=="logout"){location.replace(jMap.cfg.contextPath+"/user/logout.do")}else{if(c=="extension"){var g=false;if(window.XMLHttpRequest&&!(window.ActiveXObject)){try{g=new XMLHttpRequest()}catch(l){g=false}}else{if(window.ActiveXObject){try{g=new ActiveXObject("Msxml2.XMLHTTP")}catch(l){try{g=new ActiveXObject("Microsoft.XMLHTTP")}catch(l){g=false}}}}if(g){g.onreadystatechange=function(){if(g.readyState==4){var f=false;if(g.status==200){console.log(g.responseText)}else{}}};g.open("GET","/okmindmap/",true);g.send(null)}$("#dialog").dialog("close");jMap.resetSessionTimeout()}}};var a='<center><font color="#ff0000">Timeout</font></center><br />서비스 이용이 없어 자동 로그아웃 되었습니다.<br />OK버튼을 눌러 다시 로그인 하시기 바랍니다.<br />';$("#dialog").append(a);$("#dialog").dialog({autoOpen:false,closeOnEscape:true,width:350,modal:true,resizable:false,close:function(c,f){$("#dialog .dialog_content").remove();$("#dialog").dialog("destroy")},});$("#dialog").dialog("option","width","none");$("#dialog").dialog("option","buttons",[{text:i18n.msgStore.notice_button_ok,click:function(){var c=parseCallbackParam($("#dialog form").serializeArray());b("logout",c)}}]);$("#dialog").dialog("option","title","");$("#dialog").dialog("open")},1500000)};JinoMap.prototype.resetSessionTimeout=function(){if(!this.mode){return null}clearTimeout(this.sessionTimeout);this.setSessionTimeout()};JinoMap.prototype.scale=function(a,p){if(a<0.2||a>2.5){return}if(Raphael.svg){if(!p){p=1}var l=this.getSelected();var c=this.getViewScale(this.scaleTimes);var g=this.getViewScale(a);var k=(g-c)/p;var f=c;var m=this.layoutManager.type;var n=this;var b=new TimeLine(30,p);b.onframe=function(){f=f+k;var q=RAPHAEL.getSize();var o=(1-f)*(q.width/2);var u=(1-f)*(q.height/2);if(m=="jCardLayout"){u=0}var r=q.width*f;var t=q.height*f;var s=o+" "+u+" "+r+" "+t;RAPHAEL.canvas.setAttribute("viewBox",s);n.cfg.scale=q.width/r};b.onstart=function(){};b.onstop=function(){};b.start();this.scaleTimes=a}};JinoMap.prototype.getViewScale=function(c){var b=Math.floor(c);var g=Math.floor((c*10)%10);var a=0;if(1<c){a=1/Math.pow(10,b-1)-(b+g-1)/Math.pow(10,b)}else{var f=function(k){var m=0;while(k<1){k=k*10;m=m+1}var l=Math.round(11-k-m)/10;return m+l};a=f(parseFloat(c))}return a};JinoMap.prototype.scaleFromTransform=function(k,g){if(Raphael.svg){if(!g){g=1}var b=this.scaleTimes;var l=k;var f=(l-b)/g;var a=b;var c=new TimeLine(30,g);c.onframe=function(){a=a+f;jMap.scaleApply(a,jMap.getSelecteds().getLastElement())};c.onstart=function(){};c.onstop=function(){};c.start();this.scaleTimes=l}};JinoMap.prototype.scaleApply=function(g,f){f.groupEl.setAttribute("transform","scale("+g+")");f.connection&&f.connection.line.node.setAttribute("transform","scale("+g+")");if(f.getChildren().length>0){var c=f.getChildren();var a=c.length;for(var b=0;b<a;b++){this.scaleApply(g,c[b])}}};JinoMap.prototype.enableDragPaper=function(a){this._enableDragPaper=a};JinoMap.prototype.setUserConfig=function(a){var b=this;$.ajax({type:"post",dataType:"json",async:false,url:b.cfg.contextPath+"/user/userconfig.do",data:{userid:a,returntype:"json"},success:function(c){var f=c[0];for(config in f){if(f[config].data!=null&&f[config].data!=""){b.cfg[config]=f[config].data}}},error:function(g,c,f){alert("userConfig : "+c)}})};JinoMap.prototype.travelNodes=function(f){if(f.getChildren().length>0){var c=f.getChildren();var a=c.length;for(var b=0;b<a;b++){this.travelNodes(c[b])}}};JinoMap.prototype.getArrowLinks=function(c){var b=[];var g=c.id;var f=this.arrowlinks.length;for(var a=0;a<f;a++){if(this.arrowlinks[a].destination==g){b[a]=this.arrowlinks[a]}}return b};JinoMap.prototype.addArrowLink=function(a){this.arrowlinks.push(a)};JinoMap.prototype.removeArrowLink=function(a){a.text.hide();this.arrowlinks.remove(a)};JinoMap.prototype.resolveRendering=function(){setTimeout(function(){var b="block";var a=$("svg").css("display");if(a=="block"){b="inline"}$("svg").css("display",b)},100)};JinoMap.prototype.getClientId=function(){return $.cookie("CLIENT_ID")};JinoMap.prototype.isAllowNodeEdit=function(a){if(!this.cfg.restrictEditing){return true}if(this.cfg.mapOwner){return true}if(a.creator==0){var b=this.getClientId();if(a.client_id==""||a.client_id==b){return true}}else{if(a.creator==this.cfg.userId){return true}}return false};jClipboardManager=function(a){this.clipboard="";this.map=a};jClipboardManager.prototype.type="jClipboardManager";jClipboardManager.prototype.toClipboard=function(c,a){this.clipboard="<clipboard>";if(this.map.cfg.lazyLoading){var b=c.length;for(var g=0;g<b;g++){var l=c[g].getID();var k=this;$.ajax({type:"post",async:false,url:jMap.cfg.contextPath+"/mindmap/childnodes.do",data:{map:mapId,node:l,alldescendant:true},beforeSend:function(){},success:function(n,p,m){var o=m.responseText;if(a){o=o.replace(/ID_[^"]*/g,"")}k.clipboard+=o},error:function(o,m,n){alert("editAction : "+m)},complete:function(){}})}}else{var b=c.length;for(var g=0;g<b;g++){var f=c[g].toXML();this.clipboard+=f}}this.clipboard+="</clipboard>"};jClipboardManager.prototype.getClipboardText=function(){return this.clipboard};JinoMap.prototype.loadUserInfo=function(){$.ajax({type:"post",async:false,url:jMap.cfg.contextPath+"/user/info.do",dataType:"json",success:function(b,c,a){jMap.cfg.portrait=b.portrait;jMap.cfg.userName=b.name;jMap.cfg.userNo=b.userNo;jMap.cfg.userId=b.userId},error:function(c,a,b){}})};JinoMap.prototype.setShare=function(a){$.ajax({type:"post",async:false,url:jMap.cfg.contextPath+"/mindmap/share.do",data:{share:a,mapId:jMap.cfg.mapId},success:function(c,f,b){jMap.cfg.share=a},error:function(f,b,c){alert("setShare : "+b)}})};JinoMap.prototype.setPermission=function(a){$.ajax({type:"post",async:false,url:jMap.cfg.contextPath+"/mindmap/permission.do",data:{permission:a,mapId:jMap.cfg.mapId},success:function(c,f,b){jMap.cfg.permission=a},error:function(f,b,c){alert("setPermission : "+b)}})};JinoMap.prototype.getUserClassGroup=function(){var a=null;$.ajax({type:"post",async:false,url:jMap.cfg.contextPath+"/mindmap/listMyClassGroup.do",dataType:"json",success:function(c,f,b){a=c.groups},error:function(f,b,c){alert("getUserClassGroup : "+b)}});return a};JinoMap.prototype.getUserMaps=function(b,g,f,a,k,c){var l=null;$.ajax({type:"post",async:false,url:jMap.cfg.contextPath+"/mindmap/listMyMap.do",data:{grpno:b,search:g,sort:f,mapId:a,page:k,pagelimit:c},dataType:"json",success:function(n,o,m){l=n},error:function(o,m,n){}});return l};JinoMap.prototype.importMap=function(b,a){var c=null;$.ajax({type:"post",async:false,url:jMap.cfg.contextPath+"/mindmap/import.do",data:{mapId:b,id:a},dataType:"json",success:function(g,k,f){document.location.href=jMap.cfg.contextPath+"/map/"+g.mapKey},error:function(k,f,g){}});return c};JinoMap.prototype.commonAlertAction=function(b,a){b=b.replace(/(?:\r\n|\r|\n)/g,"<br>");txt='<div class="dialog_content" ><div><span>'+b+"</span></div></div>";$("#dialog").append(txt);$("#dialog").dialog({autoOpen:false,closeOnEscape:true,modal:true,resizable:false,close:function(c,f){$("#dialog").dialog("close");$("#dialog .dialog_content").remove();$("#dialog").dialog("destroy");if(a!=undefined&&a!=""){document.location.href=a}}});$("#dialog").dialog("option","width","300px");$("#dialog").dialog("option","buttons",[{text:"확인",click:function(){$("#dialog").dialog("close");if(a!=undefined&&a!=""){document.location.href=a}}}]);$("#dialog").dialog("option","dialogClass","returnMapAction");$("#dialog").dialog("option","title","알림");$("#dialog").dialog("open")};JinoMap.prototype.cfg={contextPath:"",mapId:0,mapKey:"",mapName:"",share:0,permission:0,userId:0,userName:"",userPortrait:"",lazyLoading:false,realtimeSave:true,scale:1,nodeFontSizes:["30","18","12"],mapBackgroundColor:"#ffffff",nodeSelectedColor:"#E02405",nodeDropFocusColor:"#808080",nodeDefalutColor:"#F4F4F4",textDefalutColor:"#000000",edgeDefalutColor:"#CCCCCC",branchDefalutColor:"#CCCCCC",edgeDefalutWidth:"2",branchDefalutWidth:"2",nodeStyle:"jRect",mapLayout:"jMindMapLayout",default_img_size:200,default_video_size:200,default_node_size:60,default_rMaps_size:10,default_menu_opacity:false,restrictEditing:false,mapOwner:false,nodeMinFontSize:8,nodeMaxFontSize:100,presentationMode:false,colorSelectList:[],sessionCheckUrl:""};JinoUtil=(function(){function a(){}a.trimStr=function(k,c){if(!k){return""}var c=c||" \n\r\t\f";var g=k.length;for(var f=0;f<g;f++){if(c.indexOf(k.charAt(f))<0){break}}for(var b=g-1;b>=f;b--){if(c.indexOf(k.charAt(b))<0){break}}return k.substring(f,b+1)};a.waitingDialog=function(c,b){if($("#waitingDialog").hasClass("show")){return}var f="";switch(b){default:f+='<div class="d-block mx-auto my-3 default-loading-icon"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>';break}f+=(c||"잠시만 기다려주세요...");$("#waitingDialog").find(".modal-body").html(f);__$("#waitingDialog").modal("show")};a.waitingDialogClose=function(){__$("#waitingDialog").modal("hide")};a.showDialog=function(b){if(jMap.cfg.default_menu_opacity=="false"){__$(".jino-app").removeClass("menu-opacity-active")}if(__$("#iframeDialog").is(":visible")){this.closeDialog()}b=b||{};__$("#iframeDialog").find(".modal-body").removeClass("p-0");__$("#iframeDialog").find(".modal-dialog").attr("class","modal-dialog");__$("#iframeDialog").find(".modal-header").removeClass("bg-primary text-white");__$("#iframeDialog").find(".modal-title").html("");if(b.url){__$("#iframeDialog").find("iframe").data("src",b.url)}if(b.size){__$("#iframeDialog").find(".modal-dialog").addClass(b.size)}if(b.title){__$("#iframeDialog").find(".modal-header").addClass("bg-primary text-white");__$("#iframeDialog").find(".modal-title").html(b.title)}if(b.nopadding){__$("#iframeDialog").find(".modal-body").addClass("p-0")}__$("#iframeDialog").modal(b)};a.closeDialog=function(){if(jMap.cfg.default_menu_opacity=="false"){__$(".jino-app").removeClass("menu-opacity-active")}__$("#iframeDialog").modal("hide");var b=$.cookie("currentSessionMenu");selectedMenu(b);jMap.work.focus()};a.toast=function(f){f=f||{};var c=$("#toastWrap");var b=$('<div class="m-2 toast hide pointer-events-auto bg-'+(f.type||"dark")+" text-"+(f.type==undefined||f.type=="danger"?"white":"dark")+'" role="alert" aria-live="polite" aria-atomic="true" data-delay="5000"><div class="toast-header"><img src="'+(jMap.cfg.contextPath)+"/theme/dist/images/icons/toast-"+(f.type||"default")+'-icon.svg" class="mr-auto" width="20px"><button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="toast-body">'+f.text+"</div></div>").appendTo(c);__$(b).toast("show");__$(b).on("hidden.bs.toast",function(){$(b).remove()})};a.xml2Str=function(b){try{return(new XMLSerializer()).serializeToString(b)}catch(c){try{return b.xml}catch(c){alert("Xmlserializer not supported")}}return false};a.importJS=function(c){var b=document.createElement("script");b.setAttribute("src",c);b.setAttribute("type","text/javascript");document.getElementsByTagName("head")[0].appendChild(b)};a.importJSNoCache=function(f){var c=new Date().getTime().toString();var b="?"+c;a.importJS(f+b)};a.importCSS=function(c){var b=document.createElement("link");b.setAttribute("href",c);b.setAttribute("rel","stylesheet");document.getElementsByTagName("head")[0].appendChild(b)};a.importCSSNoCache=function(f){var c=new Date().getTime().toString();var b="?"+c;a.importCSS(f+b)};a.imgResizer=function(k){var g=parseFloat(k.img.attr().width);g=g.toFixed(0);var c=parseFloat(k.img.attr().height);c=c.toFixed(0);var b='<form><div class="dialog_content"><br />width:<br /><input type="text" id="resizer_input_width"name="resizer_input_width" value='+g+' /><br />height:<br /><input type="text" id="resizer_input_height"name="resizer_input_height" value='+c+" /></div></form>";function f(m,o){if(m){var l=o.resizer_input_width;var n=o.resizer_input_height;k.imageResize(l,n)}$("#dialog").dialog("close");jMap.work.focus()}$("#dialog").append(b);$("#dialog").dialog({autoOpen:false,closeOnEscape:true,width:350,modal:true,resizable:false,close:function(l,m){$("#dialog .dialog_content").remove();$("#dialog").dialog("destroy")},});$("#dialog").dialog("option","width","none");$("#dialog").dialog("option","buttons",[{text:i18n.msgStore.button_apply,click:function(){var l=parseCallbackParam($("#dialog form").serializeArray());f(true,l)}}]);$("#dialog").dialog("option","title","Image Resize");$("#dialog").dialog("open")};a.videoResizer=function(g){var f=parseFloat(g.foreignObjEl.getAttribute("width"));f=f.toFixed(0);var c=parseFloat(g.foreignObjEl.getAttribute("height"));c=c.toFixed(0);var b='<form><div class="dialog_content"><br />width:<br /><input type="text" id="resizer_input_width"name="resizer_input_width" value='+f+' /><br />height:<br /><input type="text" id="resizer_input_height"name="resizer_input_height" value='+c+" /></div></form>";function k(m,o){if(m){var l=o.resizer_input_width;var n=o.resizer_input_height;g.foreignObjectResize(l,n)}$("#dialog").dialog("close");jMap.work.focus()}$("#dialog").append(b);$("#dialog").dialog({autoOpen:false,closeOnEscape:true,width:350,modal:true,resizable:false,close:function(l,m){$("#dialog .dialog_content").remove();$("#dialog").dialog("destroy")},});$("#dialog").dialog("option","width","none");$("#dialog").dialog("option","buttons",[{text:i18n.msgStore.button_apply,click:function(){var l=parseCallbackParam($("#dialog form").serializeArray());k(true,l)}}]);$("#dialog").dialog("option","title","Video Resize");$("#dialog").dialog("open")};a.BookmarkCallback=function(b){var f=function(m,o){for(var l=0;l<o.length;l++){if(o[l].name!=null&&o[l].name!="^^"){var n={parent:m,text:convertHexNCR2Char(o[l].name)};var k=jMap.createNodeWithCtrl(n,null,true);if(o[l].location!=null&&o[l].location!="^^"){k.setHyperlink(convertHexNCR2Char(o[l].location))}else{if(o[l].children&&o[l].children.length>0){f(k,o[l].children)}}}}};if(b.length<30000){var g=JSON.parse(b);var c=jMap.selectedNodes.getLastElement();if(!c){c=jMap.getRootNode()}f(c,g.children||[]);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(c);jMap.layoutManager.layout(true)}else{alert("Out of memory: bookmark too long.");return}};a.connectionShadow=function(D,B,o,l){if(D.line&&D.from&&D.to){o=D;D=o.from;B=o.to}var w=B.edge_width?B.edge_width:1;w=w*2;var s=D.getBBox();var r=B.getBBox();var G=D.rotate();var E=B.rotate();var v=0;if(isFinite(D.getBBox().width)){v=s.width}var b=0;if(isFinite(B.getBBox().width)){b=r.width}var u=[{x:s.x+v/2,y:s.y-1},{x:s.x+v/2,y:s.y+s.height+1},{x:s.x-1,y:s.y+s.height/2},{x:s.x+v+1,y:s.y+s.height/2},{x:r.x+b/2,y:r.y-1},{x:r.x+b/2,y:r.y+r.height+1},{x:r.x-1,y:r.y+r.height/2},{x:r.x+b+1,y:r.y+r.height/2}];if(l){var J=[2,7]}else{var J=[3,6]}var F=u[J[0]].x,k=u[J[0]].y-w/2,z=u[J[1]].x,c=u[J[1]].y,q=Math.max(Math.abs(F-z)/2,10),n=Math.max(Math.abs(k-c)/2,10),C=[F,F,F-q,F+q][J[0]].toFixed(3),g=[k-n,k+n,k,k][J[0]].toFixed(3),A=[0,0,0,0,z,z,z-q,z+q][J[1]].toFixed(3),f=[0,0,0,0,k+n,k-n,c,c][J[1]].toFixed(3),m=k+w,H=[0,0,0,0,z,z,z-q,z+q][J[1]],I=[F,F,F-q,F+q][J[0]];if(l){if(k>c){H=H-w;I=I-w}else{H=H+w;I=I+w}}else{if(k>c){H=H+w;I=I+w}else{H=H-w;I=I-w}}H=H.toFixed(3);I=I.toFixed(3);var t=["M",F.toFixed(3),k.toFixed(3),"C",C,g,A,f,z.toFixed(3),c.toFixed(3),"C",A,f,I,g,F.toFixed(3),m.toFixed(3)].join(",");if(o&&o.line){o.line.attr({path:t})}else{var x=typeof o=="string"?o:"#000";return{line:RAPHAEL.path(t).attr({stroke:x,fill:"none"}),from:D,to:B}}};a.detectIframeOpener=function(b){var c=(parent!==window);var f=(document.referrer==="");if(c||f){window.open(b)}else{javascript:location.href=b}};a.closeEmbedDialog=function(){if(window.self!==window.top){JinoUtil.closeDialog()}};return a})();StringBuffer=function(){this.buffer=[]};StringBuffer.prototype.add=function(a){this.buffer[this.buffer.length]=a};StringBuffer.prototype.flush=function(){this.buffer.length=0};StringBuffer.prototype.getLength=function(){return this.buffer.join("").length};StringBuffer.prototype.toString=function(a){return this.buffer.join(a||"")};function copyPrototype(f,c){var g=c.toString();var b=g.match(/\s*function (.*)\(/);if(b!=null){f.prototype[b[1]]=c}for(var a in c.prototype){f.prototype[a]=c.prototype[a]}}function extend(a,c){function b(){}b.prototype=c.prototype;a.prototype=new b();a.prototype.constructor=a;a.superclass=c;a.superproto=c.prototype}var MAX_HISTORY_LENGTH=0;UndoRedoManager=function(){this.undoList=new Array();this.redoList=new Array()};UndoRedoManager.prototype.type="UndoRedoManager";UndoRedoManager.prototype.addToHistory=function(a,b){this.undoList.push({undo:a,redo:b});if(this.undoList.length>MAX_HISTORY_LENGTH){this.undoList.splice(0,1)}};UndoRedoManager.prototype.undo=function(){if(this.undoList.length==0){return false}var c=this.undoList.pop();var f=c.undo&&c.undo.id||c.redo.id;var a=jMap.getNodeById(f);this.redoList.push(c);var b=null;if(c.undo){b=this.recoveryNode(a,c.undo);b.setFoldingExecute(b.folded)}else{a.removeExecute()}jMap.fireActionListener(ACTIONS.ACTION_NODE_UNDO,f,c.undo);jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();return true};UndoRedoManager.prototype.redo=function(){if(this.redoList.length==0){return false}var c=this.redoList.pop();var f=c.redo&&c.redo.id||c.undo.id;var a=jMap.getNodeById(f);this.undoList.push(c);var b=null;if(c.redo){b=this.recoveryNode(a,c.redo);b.setFoldingExecute(b.folded)}else{a.removeExecute()}jMap.fireActionListener(ACTIONS.ACTION_NODE_REDO,f,c.redo);jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();return true};UndoRedoManager.prototype.extractNode=function(k,a){var l={};var m=k.body.attr();delete m.gradient;m.fill=k.background_color;m.stroke=k.edge.color;m["stroke-width"]=k.edge.width;m["stroke-dasharray"]=0;l.body=m;var b=k.text.attr();l.text=b;var g=k.folderShape.attr();l.folderShape=g;l.hyperlink=k.hyperlink&&k.hyperlink.attr().href;l.img=k.imgInfo.href&&k.imgInfo.href;l.note=k.note;l.background_color=k.background_color;l.color=k.color;l.folded=k.folded;l.id=k.id;l.plainText=k.plainText;l.link=k.link;l.position=k.position;l.style=k.style;l.created=k.created;l.modified=k.modified;l.hgap=k.hgap;l.vgap=k.vgap;l.vshift=k.vshift;l.SHIFT=k.SHIFT;l.relYPos=k.relYPos;l.treeWidth=k.treeWidth;l.treeHeight=k.treeHeight;l.leftTreeWidth=k.leftTreeWidth;l.rightTreeWidth=k.rightTreeWidth;l.upperChildShift=k.upperChildShift;l.edge=k.edge;l.branch=k.branch;l.fontSize=k.fontSize;if(k.foreignObjEl){l.foreignObject_plainHtml=k.foreignObjEl.plainHtml;l.foreignObject_width=k.foreignObjEl.getAttribute("width");l.foreignObject_height=k.foreignObjEl.getAttribute("height")}l.parentid=k.getParent()&&k.getParent().id;l.childPosition=k.getIndexPos();if(a){l.child=new Array;if(k.getChildren().length>0){var f=k.getChildren();for(var c=0;c<f.length;c++){l.child.push(this.extractNode(f[c],a))}}}return l};UndoRedoManager.prototype.recoveryNode=function(f,g){if(g.body.removed){return}if(!f){var a=jMap.getNodeById(g.parentid);var l=null;var b=null;if(g.id){l=g.id}b=g.childPosition;var k={parent:a,text:"",id:l,index:b};f=jMap.createNodeWithCtrlExecute(k);a.folded&&a.setFoldingExecute(a.folded);g.hyperlink&&f.setHyperlinkExecute(g.hyperlink);g.img&&f.setImageExecute(g.img)}f.body.attr(g.body);f.text.attr(g.text);f.folderShape.attr(g.folderShape);f.note=g.note;f.background_color=g.background_color;f.color=g.color;f.folded=g.folded;f.plainText=g.plainText;f.link=g.link;f.position=g.position;f.style=g.style;f.created=g.created;f.modified=g.modified;f.hgap=g.hgap;f.vgap=g.vgap;f.vshift=g.vshift;f.SHIFT=g.SHIFT;f.relYPos=g.relYPos;f.treeWidth=g.treeWidth;f.treeHeight=g.treeHeight;f.leftTreeWidth=g.leftTreeWidth;f.rightTreeWidth=g.rightTreeWidth;f.upperChildShift=g.upperChildShift;f.edge=g.edge;f.branch=g.branch;f.fontSize=g.fontSize;if(g.foreignObject_plainHtml){f.setForeignObjectExecute(g.foreignObject_plainHtml,g.foreignObject_width,g.foreignObject_height)}if(g.child&&g.child.length>0){for(var c=0;c<g.child.length;c++){this.recoveryNode(null,g.child[c])}}return f};var Utf8={encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var g=0;g<b.length;g++){var f=b.charCodeAt(g);if(f<128){a+=String.fromCharCode(f)}else{if((f>127)&&(f<2048)){a+=String.fromCharCode((f>>6)|192);a+=String.fromCharCode((f&63)|128)}else{a+=String.fromCharCode((f>>12)|224);a+=String.fromCharCode(((f>>6)&63)|128);a+=String.fromCharCode((f&63)|128)}}}return a},decode:function(a){var b="";var f=0;var g=c1=c2=0;while(f<a.length){g=a.charCodeAt(f);if(g<128){b+=String.fromCharCode(g);f++}else{if((g>191)&&(g<224)){c2=a.charCodeAt(f+1);b+=String.fromCharCode(((g&31)<<6)|(c2&63));f+=2}else{c2=a.charCodeAt(f+1);c3=a.charCodeAt(f+2);b+=String.fromCharCode(((g&15)<<12)|((c2&63)<<6)|(c3&63));f+=3}}}return b}};jLoadManager=function(a){this.map=a;this.loading=false;this.imageLoading=new Array()};jLoadManager.prototype.type="jLoadManager";jLoadManager.prototype.cfg={contextPath:"",mapId:-1,mapName:""};jLoadManager.prototype.loadMap=function(b,c,f){this.loading=true;this.cfg.contextPath=b;this.cfg.mapId=c;this.cfg.mapName=f;var a="";if(this.map.cfg.lazyLoading){a=b+"/map/lazy/"+c+"/"+f;this.lazyConfig()}else{a=b+"/map/"+c+"/"+f}var g=false;if(window.XMLHttpRequest&&!(window.ActiveXObject)){try{g=new XMLHttpRequest()}catch(k){g=false}}else{if(window.ActiveXObject){try{g=new ActiveXObject("Msxml2.XMLHTTP")}catch(k){try{g=new ActiveXObject("Microsoft.XMLHTTP")}catch(k){g=false}}}}if(g){g.onreadystatechange=function(){if(g.readyState==4){var l=false;if(g.status==200){var m=Utf8.encode(g.responseText);m=m.split('class="lazy-load"').join("");if(window.DOMParser){var n=new DOMParser();l=n.parseFromString(m,"text/xml")}else{l=new ActiveXObject("Microsoft.XMLDOM");l.async="false";l.loadXML(m)}}if(l){jMap.loadManager.parseMM(l)}jMap.setSaved(true)}};g.open("GET",a,true);g.send(null)}};jLoadManager.prototype.loadMapLocal=function(b){var a=false;a=this.loadMM(b);if(a){this.parseMM(a)}jMap.setSaved(true)};jLoadManager.prototype.loadMM=function(c){var a=null;if(BrowserDetect.browser=="Explorer"){a=new ActiveXObject("Microsoft.XMLDOM");a.async="false";a.load(c)}else{var b=new XMLHttpRequest();b.open("GET",c,false);b.send("");a=b.responseXML}return a};jLoadManager.prototype.parseMM=function(xml){var map=xml.childNodes.item(0);var childNodes=map.childNodes;var layout="";layout=map.getAttribute("mapstyle");if(layout==null||layout=="null"||layout==""){layout=this.map.cfg.mapLayout}var jsCode="this.map.layoutManager =  new "+layout+"(this.map);";eval(jsCode);var nodeLength=childNodes.length;for(var i=0;i<nodeLength;i++){if(childNodes.item(i).nodeType==1){var element=childNodes.item(i);var text=element.getAttribute("TEXT");var id=element.getAttribute("ID");var param={text:text,id:id};jMap.rootNode=jMap.createNodeWithCtrlExecute(param);jMap.rootNode.lazycomplete=new Date().valueOf();this.initNodeAttrs(jMap.rootNode,element);this.initChildNodes(jMap.rootNode,element)}}jMap.initFoldingAll();jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();this.loading=false;jMap.loaded&&jMap.loaded()};jLoadManager.prototype.initChildNodes=function(u,g){if(g.childNodes.length>0){var o=g.childNodes;var n=o.length;for(var F=0;F<n;F++){var p=o.item(F);if(p.nodeType==1){var w=p.nodeName;if(w=="node"){var x=p.getAttribute("TEXT");var A=p.getAttribute("ID");var r={parent:u,text:x,id:A};var f=jMap.createNodeWithCtrlExecute(r);this.initNodeAttrs(f,p);this.initChildNodes(f,p)}else{if(w=="edge"){this.initEdgeAttrs(u,p)}else{if(w=="branch"){this.initBranchAttrs(u,p)}else{if(w=="richcontent"){var x="";this.parserRichContent(u,p,x)}else{if(w=="foreignObject"){var E="";var B=p.getAttribute("WIDTH");var z=p.getAttribute("HEIGHT");var t=p.childNodes;var l=t.length;for(var K=0;K<l;K++){E+=JinoUtil.xml2Str(t.item(K))}E=E.replace("<![CDATA[","");E=E.replace("]]>","");var I=$(E);if(I&&I.prop("tagName")=="IFRAME"){B=I.attr("width");z=I.attr("height");var b=I.attr("zoom");if(!b){b=1}else{b=parseInt(b,10)/100}if((I.css("margin-left")!="")||(I.css("margin-top")!="")){B=parseInt(B,10)*b+parseInt(I.css("margin-left"),10);z=parseInt(z,10)*b+parseInt(I.css("margin-top"),10)}u.setForeignObjectExecute(E,Math.round(B),Math.round(z));var v=E.indexOf("src=")+5;var s=E.indexOf('"',v);var q=E.substring(v,s)}else{E=E.replace(/&amp;amp;/g,"&amp;");E=E.replace(/&amp;nbsp;/g,"&nbsp;");E=E.replace(/&amp;lt;/g,"&lt;");E=E.replace(/&amp;gt;/g,"&gt;");E=E.replace(/&amp;quot;/g,"&quot;");E=E.replace(/&amp;(.)acute;/g,"&$1acute;");E=E.replace(/&amp;(.)grave;/g,"&$1grave;");E=E.replace(/&amp;(.)tilde;/g,"&$1tilde;");u.setForeignObjectExecute(E,B,z)}}else{if(w=="arrowlink"){var c=this.createArrowLink(u,p);u.addArrowLinkExecute(c)}else{if(w=="info"){var D=p.attributes;var m=D.length;for(var J=0;J<m;J++){if(D[J].nodeName){u[D[J].nodeName.toLowerCase()]=D[J].nodeValue}}}else{if(w=="attribute"){if(!u.attributes){u.attributes={}}var C=p.getAttribute("NAME");var G=p.getAttribute("VALUE");u.attributes[C]=G;if(C=="iot"){var H=JSON.parse(decodeURI(G));if(u["set"+H.type+"Execute"]){u["set"+H.type+"Execute"](H)}}}else{if(w=="font"){var k=p.getAttribute("SIZE");u.setFontSizeExecute(k)}}}}}}}}}}}}if(!u.userportrait){u.userportrait=jMap.cfg.defaultUserPortrait}u.setCreator(u.userportrait,u.userfullname,u.created)};jLoadManager.prototype.createArrowLink=function(b,a){var c=null;switch(jMap.layoutManager.type){case"jMindMapLayout":c=new CurveArrowLink();break;case"jTreeLayout":c=new RightAngleArrowLink();break;default:c=new CurveArrowLink()}c.destination=a.getAttribute("DESTINATION");c.color=a.getAttribute("COLOR");c.endArrow=a.getAttribute("ENDARROW");c.endInclination=a.getAttribute("ENDINCLINATION");c.id=a.getAttribute("ID");c.startArrow=a.getAttribute("STARTARROW");c.startInclination=a.getAttribute("STARTINCLINATION");c.setText(a.getAttribute("TEXT"));c.setLineWidth(a.getAttribute("LINEWIDTH"));c.style=a.getAttribute("STYLE");console.log(a);return c};jLoadManager.prototype.parserRichContent=function(g,m,q){if(m.childNodes.length>0){var c=m.childNodes;var r=c.length;for(var n=0;n<r;n++){var b=c.item(n);if(b.nodeType==1){var f=b.nodeName;var k=b.childNodes;var o=k.length;if(f=="img"){var p=(b.getAttribute("width")=="undefined")?null:b.getAttribute("width");var a=(b.getAttribute("height")=="undefined")?null:b.getAttribute("height");g.setImageExecute(b.getAttribute("src"),p,a)}else{if(f=="p"){var l=JinoUtil.trimStr(g.getText());if(o>0){if(l!=null&&l!=""){l=l+"\n"+JinoUtil.trimStr(k.item(0).nodeValue)}else{l=JinoUtil.trimStr(k.item(0).nodeValue)}}l=convertXML2Char(l);g.setTextExecute(l)}else{var l=JinoUtil.trimStr(g.getText());if(o>0){if(l!=null&&l!=""){l=l+"\n"+JinoUtil.trimStr(k.item(0).nodeValue)}else{l=JinoUtil.trimStr(k.item(0).nodeValue)}}g.setTextExecute(l)}}}this.parserRichContent(g,b,q)}}};jLoadManager.prototype.initEdgeAttrs=function(b,k){var m=k.attributes;var g=null;var a=null;var f=m.length;for(var l=0;l<f;l++){var c=m[l];if(c.nodeName){var n=c.nodeName;if(n.toLowerCase()=="color"){g=c.nodeValue;continue}if(n.toLowerCase()=="width"){a=c.nodeValue;continue}b.edge[n.toLowerCase()]=c.nodeValue}}b.setEdgeColorExecute(g,a);b.setBranchExecute(g,null)};jLoadManager.prototype.initBranchAttrs=function(f,l){var n=l.attributes;var k=null;var b=null;var a=null;var g=n.length;for(var m=0;m<g;m++){var c=n[m];if(c.nodeName){var o=c.nodeName;if(o.toLowerCase()=="color"){k=c.nodeValue;continue}if(o.toLowerCase()=="width"){b=c.nodeValue;continue}if(o.toLowerCase()=="style"&&jMap.layoutManager.type=="jMindMapLayout"){a=jMap.layoutManager.defaultBranchStyle;continue}f.edge[o.toLowerCase()]=c.nodeValue}}f.setBranchExecute(k,b,a)};jLoadManager.prototype.initNodeAttrs=function(g,f){var a=f.attributes;for(var c=0;c<a.length;c++){var b=a[c];if(b.nodeName){var k=b.nodeName;if(k.toLowerCase()=="text"){continue}if(k.toLowerCase()=="id"){continue}if(k.toLowerCase()=="background_color"){g.setBackgroundColorExecute(b.nodeValue);continue}if(k.toLowerCase()=="color"){g.setTextColorExecute(b.nodeValue);continue}if(k.toLowerCase()=="link"){g.setHyperlinkExecute(b.nodeValue);continue}if(k.toLowerCase()=="file"){g.setFileExecute(b.nodeValue);continue}if(k.toLowerCase()=="note"){g.setNoteExecute(b.nodeValue);continue}if(k.toLowerCase()=="folded"){g.folded=(b.nodeValue=="true")?true:false;continue}if(k.toLowerCase()=="user_portrait"){g.userportrait=b.nodeValue;continue}if(k.toLowerCase()=="user_fullname"){g.userfullname=b.nodeValue;continue}g[k.toLowerCase()]=b.nodeValue}}};jLoadManager.prototype.pasteNode=function(l,r,t,s,m){if(!r){return false}r=r.replace(/<foreignObject([^>]*)\">/ig,'<foreignObject$1">\n<![CDATA[\n');r=r.replace(/<\/foreignObject>/ig,"\n]]>\n</foreignObject>");if(window.DOMParser){var b=new DOMParser();xmlDoc=b.parseFromString(r,"text/xml")}else{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(r)}var g=xmlDoc.firstChild;var f=g.tagName;while(g.nodeType!=1&&(f!="clipboard"||f!="paste"||f!="okm"||f!="node")){g=g.nextSibling;if(g==null){return false}}var v=g.childNodes;var o=[];var n=v.length;for(var q=0;q<n;q++){if(v.item(q).nodeType==1){var p=v.item(q);if(p.nodeName!="node"){continue}if(!m){p.removeAttribute("POSITION")}var u=p.getAttribute("TEXT");var c=p.getAttribute("ID");var k={parent:l,text:u,id:c,index:t,position:s};var a=jMap.createNodeWithCtrlExecute(k);this.initNodeAttrs(a,p);this.initChildNodes(a,p);if(l.folded||l.hided){l.hideChildren(l)}o.push(a)}}return o};jLoadManager.prototype.updateImageLoading=function(a){if(this.imageLoading.contains(a)){this.imageLoading.remove(a)}else{this.imageLoading.push(a)}if(this.imageLoading.length==0){jMap.fireActionListener(ACTIONS.ACTION_NODE_IMAGELOADED)}};jLoadManager.prototype.updateMoodleIconLoading=function(a){this.imageLoading.push(a)};jLoadManager.prototype.lazyLoading=function(a){if(a.lazycomplete){return}$.ajax({type:"post",async:false,url:jMap.cfg.contextPath+"/mindmap/childnodes.do",data:{map:this.cfg.mapId,node:a.getID()},beforeSend:function(){},success:function(k,l,g){var c=jMap.loadManager.pasteNode(a,g.responseText,null,null,true);a.lazycomplete=new Date().valueOf();a.numofchildren=c.length;var b=c.length;if(b>0){for(var f=0;f<b;f++){if(c[f].numofchildren>0){c[f].folderShape&&c[f].folderShape.show();c[f].folded=true}else{c[f].lazycomplete=new Date().valueOf()}}}},error:function(f,b,c){alert("editAction : "+b)},complete:function(){}})};jLoadManager.prototype.lazyConfig=function(){this.lazyListeners=[];this.lazyListeners.push(jMap.addActionListener(ACTIONS.ACTION_NODE_FOLDING,function(){var a=arguments[0];jMap.loadManager.lazyLoading(a);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(a);jMap.layoutManager.layout(true)}));this.lazyListeners.push(jMap.addActionListener(ACTIONS.ACTION_NODE_MOVED,function(){var a=arguments[0];var b=arguments[1]}));this.lazyListeners.push(jMap.addActionListener(ACTIONS.ACTION_NEW_NODE,function(){var a=arguments[0];a.lazycomplete=new Date().valueOf()}));this.lazyListeners.push(jMap.addActionListener("DWR_InsertNode",function(){var a=arguments[0];a.lazycomplete=new Date().valueOf()}))};jLoadManager.prototype.removelazyListener=function(){var a=null;while(a=this.lazyListeners.pop()){jMap.removeActionListener(a)}this.lazyListeners=[]};var removeGradient=function(a){bodyAttr=a.body.attr();delete bodyAttr.gradient;if(a.type=="jFishNode"){a.body.attr({fill:a.background_color,stroke:a.edge.color,opacity:0,"fill-opacity":0})}else{a.body.attr({fill:a.background_color,stroke:a.edge.color})}};jNodeController=function(){};jNodeController.prototype.type="jNodeController";jNodeController.prototype.contextmenu=function(a){this.node.focus(true);$(jMap.work).trigger("jinocontextmenu",[a]);jMap.mouseRightClicked=false;return false};jNodeController.prototype.mousedown=function(f){var b;var a;if(!f){var f=window.event}a=f.originalEvent.originalEvent||f.originalEvent||f;if(a.target){b=a.target}else{if(a.srcElement){b=a.srcElement}}if(b.nodeType==3){b=b.parentNode}if(!(ISMOBILE||supportsTouch)){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}}var l=jMap.getSelecteds();if(f.which==3||f.button==2){console.log("right click");return}if(f.shiftKey||f.ctrlKey){if(l.contains(this.node)){this.node.blur()}else{this.node.focus(false)}}else{if(!l.contains(this.node)){this.node.focus(true)}}var k=document;var c=k.documentElement.scrollTop||k.body.scrollTop;var g=k.documentElement.scrollLeft||k.body.scrollLeft;this._drag={};this._drag.x=f.clientX+g;this._drag.y=f.clientY+c;this._drag.id=f.identifier;jMap.dragEl=this};jNodeController.prototype.mouseup=function(C){var o;var G;if(!C){var C=window.event}G=C.originalEvent.originalEvent||C.originalEvent||C;if(G.target){o=G.target}else{if(G.srcElement){o=G.srcElement}}if(o.nodeType==3){o=o.parentNode}if(G.preventDefault){G.preventDefault()}else{G.returnValue=false}if(jMap.movingNode&&!jMap.movingNode.removed){var r=jMap.positionChangeNodes;var f=this.node;if(r&&!r.contains(f)){jMap.movingNode.connection&&jMap.movingNode.connection.line.remove();jMap.movingNode.remove();delete jMap.movingNode;var b=o.getBoundingClientRect();C.offsetX=C.clientX-b.left;var D=(C.offsetX)?C.offsetX:C.layerX-this.node.getLocation().x;var t=this.node.body.getBBox().width/2;var s=(D<t);var p=f;var w=function(){f.folded&&f.setFolding(false);var x=null;if(f.isRootNode()){x=s?"left":"right"}p=f;jMap.changePosition(f,r,x)};var q=function(){var x=null;if(f.getParent().isRootNode()){x=f.position}var H=f.nextSibling();p=f.getParent();jMap.changePosition(f.getParent(),r,x,f)};if(r){if(f.isRootNode()){w()}else{switch(jMap.layoutManager.type){case"jMindMapLayout":if(this.node.isLeft()){s?w():q()}else{s?q():w()}break;case"jTreeLayout":s?q():w();break;case"jHTreeLayout":s?q():w();break;case"jFishboneLayout":if(this.node.isLeft()){s?w():q()}else{s?q():w()}break;default:}}}removeGradient(f);if(p.isRootNode()){jMap.initFolding(p);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(p);var u=p.getChildren();if(u.length>0){for(var A=0;A<u.length;A++){if(u[A].folded){u[A].setFolding(false);u[A].setFolding(true)}else{u[A].setFolding(true);u[A].setFolding(false)}}}}else{if(p.folded){p.setFolding(false);p.setFolding(true)}else{jMap.initFolding(p);p.setFolding(true);p.setFolding(false)}}jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();jMap.layoutManager.layout(true);f.focus(true)}jMap.positionChangeNodes=false}var g=jMap.dragEl;if(jMap.movingNode&&!jMap.movingNode.removed){var l=C.clientX;var k=C.clientY;var F=document;var v=F.documentElement.scrollTop||F.body.scrollTop;var z=F.documentElement.scrollLeft||F.body.scrollLeft;l+=z;k+=v;var n=l-g._drag.x;var m=k-g._drag.y;jMap.movingNode.connection&&jMap.movingNode.connection.line.remove();jMap.movingNode.remove();delete jMap.movingNode;jMap.dragEl._drag=null;delete jMap.dragEl._drag;var c=n/jMap.cfg.scale;var a=m/jMap.cfg.scale;var E=(c>0)?c:-c;var B=(a>0)?a:-a;if(E>NODE_MOVING_IGNORE||B>NODE_MOVING_IGNORE){g.node.relativeCoordinate(c,a)}jMap.dragEl=null;delete jMap.dragEl}else{if(jMap.dragEl){jMap.dragEl._drag=null;delete jMap.dragEl._drag}jMap.dragEl=null;delete jMap.dragEl}selectedMenu("node");if(lastSelected!=null){doNodeToNodeAction()}if(jMap.getSelected().arrowlinks.length<1){$("#menusettingArrowLink").removeClass("show")}else{$("#menusettingArrowLink").addClass("show")}};jNodeController.prototype.mousemove=function(g){var b;var a;if(!g){var g=window.event}a=g.originalEvent.originalEvent||g.originalEvent||g;if(a.target){b=a.target}else{if(a.srcElement){b=a.srcElement}}if(b.nodeType==3){b=b.parentNode}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}var c=b.getBoundingClientRect();g.offsetX=g.clientX-c.left;g.offsetY=g.clientY-c.top;var k=document;if(!jMap.positionChangeNodes&&this.node.isFoldingHit(g)&&!this.node.isRootNode()&&!this.node.getChildren().isEmpty()){var f="";if(this.node.isLeft()){f=" 10 7"}else{f=" 0 7"}k.body.style.cursor="url('"+jMap.cfg.contextPath+"/images/folding_blue.png')"+f+",default"}else{k.body.style.cursor="auto"}};jNodeController.prototype.mouseover=function(m){var f;var b;if(!m){var m=window.event}b=m.originalEvent.originalEvent||m.originalEvent||m;if(b.target){f=b.target}else{if(b.srcElement){f=b.srcElement}}if(f.nodeType==3){f=f.parentNode}if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}if(jMap.positionChangeNodes&&!jMap.getSelecteds().contains(this.node)){if(jMap.movingNode&&!jMap.movingNode.removed){jMap.movingNode.hide();jMap.movingNode.connection&&jMap.movingNode.connection.line.hide()}var l=f.getBoundingClientRect();m.offsetX=m.clientX-l.left;var a=(m.offsetX)?m.offsetX:m.layerX-this.node.getLocation().x;var c=this.node.body.getBBox().width/2;if(jMap.positionChangeNodes){var k=0;var g=0;switch(jMap.layoutManager.type){case"jMindMapLayout":if(this.node.isRootNode()){k=0;g=180}else{k=(this.node.isLeft())?0:270;g=(this.node.isLeft())?270:180}break;case"jTreeLayout":if(this.node.isRootNode()){k=180;g=180}else{k=0;g=90}break;case"jHTreeLayout":if(this.node.isRootNode()){k=180;g=180}else{k=0;g=90}break;case"jFishboneLayout":if(this.node.isRootNode()){k=0;g=180}else{k=(this.node.isLeft())?0:270;g=(this.node.isLeft())?270:180}break;default:}if(a<c){this.node.body.attr({gradient:k+"-"+jMap.cfg.nodeDropFocusColor+"-#ffffff",stroke:jMap.cfg.nodeDropFocusColor})}else{this.node.body.attr({gradient:g+"-"+jMap.cfg.nodeDropFocusColor+"-#ffffff",stroke:jMap.cfg.nodeDropFocusColor})}}}if(jMap.mouseRightClicked){}};jNodeController.prototype.touchmove=function(a){};jNodeController.prototype.mouseout=function(c){var b;var a;if(!c){var c=window.event}a=c.originalEvent.originalEvent||c.originalEvent||c;if(a.target){b=a.target}else{if(a.srcElement){b=a.srcElement}}if(b.nodeType==3){b=b.parentNode}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}document.body.style.cursor="auto";if(jMap.movingNode&&!jMap.movingNode.removed){jMap.movingNode.show();jMap.movingNode.connection&&jMap.movingNode.connection.line.show()}if(jMap.positionChangeNodes&&!jMap.getSelecteds().contains(this.node)){removeGradient(this.node)}if(jMap.mouseRightClicked){if(jMap.mouseRightSelectedNode==this.node){return}this.node.blur()}};jNodeController.prototype.taphold=function(a){if(ISMOBILE&&supportsTouch&&this.node.hyperlink){window.open(this.node.hyperlink.attr().href)}};var touchtime=0;jNodeController.prototype.click=function(g){var b=false;if(touchtime==0){touchtime=new Date().getTime()}else{if(((new Date().getTime())-touchtime)<400){b=true;touchtime=0}else{touchtime=new Date().getTime()}}var c;var a;if(!g){var g=window.event}a=g.originalEvent.originalEvent||g.originalEvent||g;if(a.target){c=a.target}else{if(a.srcElement){c=a.srcElement}}if(c.nodeType==3){c=c.parentNode}var f=c.getBoundingClientRect();g.offsetX=g.clientX-f.left;g.offsetY=g.clientY-f.top;$("#nodePopupTipBox").css("top",f.left+f.height+10+"px");$("#nodePopupTipBox").css("left",f.left+"px");$("#nodePopupTipBox").css("display","inline-block");$("#nodePopupTipBox_div #nodeTip_w").css("display","block");if(this.node.isFoldingHit(g)&&!this.node.isRootNode()&&!this.node.getChildren().isEmpty()&&c.nodeName!="image"&&!(ISMOBILE||supportsTouch)){jMap.controller.foldingAction(this.node)}else{if(b){this.node.controller.dblclick(g)}}};jNodeController.prototype.dblclick=function(c){var b;var a;if(!c){var c=window.event}a=c.originalEvent.originalEvent||c.originalEvent||c;if(a.target){b=a.target}else{if(a.srcElement){b=a.srcElement}}if(b.nodeType==3){b=b.parentNode}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}$("#nodePopupTipBox").css("display","none");jMap.controller.startNodeEdit(jMap.getSelected())};jNodeController.prototype.dragstart=function(c){var b;var a;if(!c){var c=window.event}a=c.originalEvent.originalEvent||c.originalEvent||c;if(a.target){b=a.target}else{if(a.srcElement){b=a.srcElement}}if(b.nodeType==3){b=b.parentNode}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};jNodeController.prototype.dragenter=function(c){var b;var a;if(!c){var c=window.event}a=c.originalEvent.originalEvent||c.originalEvent||c;if(a.target){b=a.target}else{if(a.srcElement){b=a.srcElement}}if(b.nodeType==3){b=b.parentNode}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}this.node.focus(true)};jNodeController.prototype.dragexit=function(c){var b;var a;if(!c){var c=window.event}a=c.originalEvent.originalEvent||c.originalEvent||c;if(a.target){b=a.target}else{if(a.srcElement){b=a.srcElement}}if(b.nodeType==3){b=b.parentNode}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}this.node.blur()};jNodeController.prototype.drop=function(k){var g;var a;if(!k){var k=window.event}a=k.originalEvent.originalEvent||k.originalEvent||k;if(a.target){g=a.target}else{if(a.srcElement){g=a.srcElement}}if(g.nodeType==3){g=g.parentNode}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}var m=k.originalEvent.dataTransfer.getData("TEXT")||k.originalEvent.dataTransfer.getData("text/plain");var b=k.originalEvent.dataTransfer.getData("URL");var f=false;if(m.substr(0,7)=="http://"||m.substr(0,8)=="https://"){b=b||m;if(b){this.node.setFoldingExecute(false);var l={parent:this.node,text:b};var c=jMap.createNodeWithCtrl(l,null,false);c.setHyperlink(b);f=true}}else{jMap.createNodeFromText(this.node,m);f=true}if(f){jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(this.node);jMap.layoutManager.layout(true)}};jNodeControllerGuest=function(){};jNodeControllerGuest.prototype.type="jNodeControllerGuest";jNodeControllerGuest.prototype.mousedown=function(a){var b=jMap.getSelecteds();if(a.ctrlKey){this.node.focus(false)}else{if(!b.contains(this.node)){this.node.focus(true)}}};jNodeControllerGuest.prototype.mouseup=function(a){a=a||window.event;selectedMenu("node")};jNodeControllerGuest.prototype.mousemove=function(g){var b;var a;if(!g){var g=window.event}a=g.originalEvent.originalEvent||g.originalEvent||g;if(a.target){b=a.target}else{if(a.srcElement){b=a.srcElement}}if(b.nodeType==3){b=b.parentNode}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}var c=b.getBoundingClientRect();g.offsetX=g.clientX-c.left;g.offsetY=g.clientY-c.top;if(!jMap.positionChangeNodes&&this.node.isFoldingHit(g)&&!this.node.isRootNode()&&!this.node.getChildren().isEmpty()){var f="";if(this.node.isLeft()){f=" 10 7"}else{f=" 0 7"}document.body.style.cursor="url('"+jMap.cfg.contextPath+"/images/folding_blue.png')"+f+",default"}else{document.body.style.cursor="auto"}};jNodeControllerGuest.prototype.mouseover=function(a){a=a||window.event};jNodeControllerGuest.prototype.mouseout=function(a){document.body.style.cursor="auto"};jNodeControllerGuest.prototype.taphold=function(a){if(ISMOBILE&&supportsTouch&&this.node.hyperlink){window.open(this.node.hyperlink.attr().href)}};jNodeControllerGuest.prototype.click=function(f){var b;var a;if(!f){var f=window.event}a=f.originalEvent.originalEvent||f.originalEvent||f;if(a.target){b=a.target}else{if(a.srcElement){b=a.srcElement}}if(b.nodeType==3){b=b.parentNode}var c=b.getBoundingClientRect();f.offsetX=f.clientX-c.left;f.offsetY=f.clientY-c.top;if(this.node.isFoldingHit(f)&&!(ISMOBILE||supportsTouch)){this.node.setFoldingExecute(!this.node.folded);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendants(this.node);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(this.node);jMap.layoutManager.layout(true)}};jNodeControllerGuest.prototype.dblclick=function(a){};jNodeControllerGuest.prototype.dragstart=function(a){a=a||window.event;if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};jNodeControllerGuest.prototype.dragenter=function(a){a=a||window.event;if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};jNodeControllerGuest.prototype.dragexit=function(a){a=a||window.event;if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};jNodeControllerGuest.prototype.drop=function(a){a=a||window.event;if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};jNodeControllerGuest.prototype.dragger=function(){};jNodeControllerGuest.prototype.move=function(c,b,a,f){};jNodeControllerGuest.prototype.up=function(c,b,a,f){};jSaveAction=function(a){this.map=a;this.actionList=[];this.saveThumbnail=false;this.readyPost=true};jSaveAction.prototype.type="jSaveAction";jSaveAction.prototype.cfg={async:true,type:"post"};jSaveAction.prototype.newAction=function(k,f){if(hasTranslated){return}if(this.map.cfg.realtimeSave){var c=k.toXML();var a=' mapid="'+mapId+'"';var m="";if(k.getParent()){m=' parent="'+k.getParent().getID()+'"'}var b="";if(k.nextSibling()){b=' next="'+k.nextSibling().getID()+'"'}var l="<new"+a+m+b+">"+c+"</new>";l=Base64.encode(escape(l));if(f==null||f==undefined){f=this.cfg.async}var g=this;$.ajax({type:this.cfg.type,async:f,url:this.map.cfg.contextPath+"/mindmap/save.do",data:{action:l},dataType:"json",beforeSend:function(){},success:function(q,r,p){if(q.status==-1){if(J_NODE_CREATING){console.log("err");var o=null;var n=null;while(o=g.map.getSelecteds().pop()){n=o.getParent();o.remove()}J_NODE_CREATING.focus(true);g.map.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(n);g.map.layoutManager.layout(true)}g.map.controller.stopNodeEdit(false)}else{if(o&&(o.isRootNode()||o.getParent().isRootNode())){thumbnail()}}},error:function(p,n,o){console.log(o);jMap.fireActionListener(ACTIONS.ACTION_ASYNCHRONOUS)},complete:function(){}})}};jSaveAction.prototype.editAction=function(f,c,k){if(hasTranslated){return}if(this.map.cfg.realtimeSave){if(f.removed){return}var b=f.toXML(true);var a=' mapid="'+mapId+'"';var g="<edit"+a+">"+b+"</edit>";g=Base64.encode(escape(g));if(c==null||c==undefined){c=this.cfg.async}this.actionList.push(g);this.postAction(k);if(f.isRootNode()||f.getParent().isRootNode()){this.saveThumbnail=true}}};jSaveAction.prototype.postAction=function(b){if(hasTranslated){return}if((this.actionList.length>0&&this.readyPost)){this.readyPost=false;async=this.cfg.async;var a=JSON.stringify(this.actionList);this.actionList=[];$.ajax({type:this.cfg.type,async:async,url:this.map.cfg.contextPath+"/mindmap/save.do",data:{action:a,actionList:"hasList"},dataType:"json",success:function(c){jMap.saveAction.readyPost=true;if(this.actionList.length>0&&this.readyPost){this.postAction(b)}else{if(this.saveThumbnail){thumbnail();this.saveThumbnail=false}if((typeof b)=="function"){b()}}}.bind(this),error:function(g,c,f){jMap.fireActionListener(ACTIONS.ACTION_ASYNCHRONOUS)}})}};jSaveAction.prototype.deleteAction=function(f,c){if(hasTranslated){return}if(this.map.cfg.realtimeSave){if(f.removed){return}var b=f.toXML();var a=' mapid="'+mapId+'"';var g="<delete"+a+">"+b+"</delete>";g=Base64.encode(escape(g));if(c==null||c==undefined){c=this.cfg.async}$.ajax({type:this.cfg.type,async:c,url:this.map.cfg.contextPath+"/mindmap/save.do",data:{action:g},dataType:"json",success:function(k){if(k.status==1){if(f.isRootNode()||f.getParent().isRootNode()){thumbnail()}}},error:function(m,k,l){jMap.fireActionListener(ACTIONS.ACTION_ASYNCHRONOUS)}})}};jSaveAction.prototype.moveAction=function(a,m,g,b){if(hasTranslated){return}if(this.map.cfg.realtimeSave){var k=a.toXML(true);var l=' mapid="'+mapId+'"';var f=' parent="'+m.getID()+'"';var n=(g)?' next="'+g.getID()+'"':"";var c="<move"+l+f+n+">"+k+"</move>";c=Base64.encode(escape(c));if(b==null||b==undefined){b=this.cfg.async}$.ajax({type:this.cfg.type,async:b,url:this.map.cfg.contextPath+"/mindmap/save.do",data:{action:c},dataType:"json",success:function(o){if(o.status==1){if(a.isRootNode()||a.getParent().isRootNode()){thumbnail()}}},error:function(q,o,p){jMap.fireActionListener(ACTIONS.ACTION_ASYNCHRONOUS)}})}};jSaveAction.prototype.pasteAction=function(g,f){if(hasTranslated){return}if(this.map.cfg.realtimeSave){var c=g.toXML();var a=' mapid="'+mapId+'"';var l="";if(g.getParent()){l=' parent="'+g.getParent().getID()+'"'}var b="";var k="<new"+a+l+b+">"+c+"</new>";k=Base64.encode(escape(k));if(f==null||f==undefined){f=this.cfg.async}$.ajax({type:this.cfg.type,async:f,url:this.map.cfg.contextPath+"/mindmap/save.do",data:{action:k},dataType:"json",success:function(m){if(m.status==1){if(g.isRootNode()||g.getParent().isRootNode()){thumbnail()}}},error:function(o,m,n){jMap.fireActionListener(ACTIONS.ACTION_ASYNCHRONOUS)}})}};jSaveAction.prototype.isAlive=function(){return true};jBrainLayout=function(b){this.map=b;this.HGAP=30;this.VGAP=10;this.xSize=0;this.ySize=0;var a=this.map.work;a.scrollLeft=Math.round((a.scrollWidth-a.offsetWidth)/2);a.scrollTop=Math.round((a.scrollHeight-a.offsetHeight)/2);this.map.cfg.nodeFontSizes=["10","10","10"];this.map.cfg.nodeStyle="jBrainNode"};jBrainLayout.prototype.type="jBrainLayout";jBrainLayout.prototype.layoutNode=function(f){var a=0;var g=0;if(f.getDepth()==0){this.placeNode(f,a,g)}else{if(f.getDepth()==1){if(f.getIndexPos()==0){this.placeNode(f,a+39,g-43.5)}else{if(f.getIndexPos()==1){this.placeNode(f,a+135,g+57.5)}else{if(f.getIndexPos()==2){this.placeNode(f,a+193.5,g-66)}else{if(f.getIndexPos()==3){this.placeNode(f,a+90,g-163.5)}else{if(f.getIndexPos()==4){this.placeNode(f,a-75,g-75-62.5)}else{if(f.getIndexPos()==5){this.placeNode(f,a+195,g-145)}else{if(f.getIndexPos()==6){this.placeNode(f,a-20,g-210)}}}}}}}}else{if(f.getDepth()==2){}else{this.placeNode(f,a,g)}}}var c=f.getChildren();if(c!=null&&c.length>0){for(var b=0;b<c.length;b++){this.layoutNode(c[b])}}};jBrainLayout.prototype.layout=function(g){var f=this.map.selectedNodes.getLastElement();g=g&&(f!=null&&f!=undefined&&!f.removed&&f.getLocation().x!=null&&f.getLocation().x!=undefined&&f.getLocation().x!=0&&f.getLocation().y!=0);var c=this.getRoot();var b=c.getLocation().x;var a=c.getLocation().y;if(g){a=f.getLocation().y}this.resizeMap(c.treeWidth,c.treeHeight);this.layoutNode(this.getRoot())};jBrainLayout.prototype.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors=function(a){this.layout(false)};jBrainLayout.prototype.updateTreeHeightsAndRelativeYOfAncestors=function(a){this.layout(false)};jBrainLayout.prototype.updateTreeHeightsAndRelativeYOfWholeMap=function(){this.layout(false)};jBrainLayout.prototype.updateTreeHeightsAndRelativeYOfDescendants=function(a){this.layout(false)};jBrainLayout.prototype.updateRelativeYOfChildren=function(k,c){if(c==null||c.length==0){return}var o=k.vgap;var b=c[0];var a=0;var g=0;for(var l=0;l<c.length;l++){b=c[l];var f=this.getShiftUp(b);var m=this.getShiftDown(b);var n=b.getUpperChildShift();b.relYPos=parseInt(a)+parseInt(n)+parseInt(m);g+=parseInt(n)+parseInt(f);a+=parseInt(b.getTreeHeight())+parseInt(f)+parseInt(m)+parseInt(o)+this.VGAP}g+=parseInt(this.calcStandardTreeShift(k,c));for(var l=0;l<c.length;l++){b=c[l];b.relYPos-=g}};jBrainLayout.prototype.getShiftUp=function(b){var a=b.getShift();if(a<0){return -a}else{return 0}};jBrainLayout.prototype.getShiftDown=function(b){var a=b.getShift();if(a>0){return a}else{return 0}};jBrainLayout.prototype.updateTreeGeometry=function(c){if(c==null||c==undefined||c.removed){return false}if(c.isRootNode()){var f=this.getRoot().getLeftChildren();var m=this.getRoot().getRightChildren();var g=this.calcTreeWidth(c,f);var n=this.calcTreeWidth(c,m);this.getRoot().setRootTreeWidths(g,n);this.updateRelativeYOfChildren(c,f);this.updateRelativeYOfChildren(c,m);var p=this.calcUpperChildShift(c,f);var r=this.calcUpperChildShift(c,m);this.getRoot().setRootUpperChildShift(p,r);var q=this.calcTreeHeight(c,p,f);var b=this.calcTreeHeight(c,r,m);this.getRoot().setRootTreeHeights(q,b)}else{var a=c.getUnChildren();var k=this.calcTreeWidth(c,a);c.setTreeWidth(k);this.updateRelativeYOfChildren(c,a);var l=this.calcUpperChildShift(c,a);c.setUpperChildShift(l);var o=this.calcTreeHeight(c,l,a);c.setTreeHeight(o)}};jBrainLayout.prototype.calcTreeWidth=function(g,f){var k=0;if(f!=null&&f.length>0){for(var c=0;c<f.length;c++){var b=f[c];if(b!=null){var a=parseInt(b.getTreeWidth())+parseInt(b.hgap)+this.HGAP;if(a>k){k=a}}}}return g.getSize().width+k};jBrainLayout.prototype.calcTreeHeight=function(n,k,c){var l=n.getSize().height;try{var m=c[0];var b=c[c.length-1];var f=Math.min(m.relYPos-m.getUpperChildShift(),0);var a=Math.max(b.relYPos-b.getUpperChildShift()+b.getTreeHeight(),l);return a-f}catch(g){return l}};jBrainLayout.prototype.calcUpperChildShift=function(c,a){try{var g=a[0];var f=-g.relYPos+parseInt(g.getUpperChildShift());if(f>0){return f}else{return 0}}catch(b){return 0}};jBrainLayout.prototype.calcStandardTreeShift=function(g,f){var c=g.getSize().height;if(f.length==0){return 0}var a=0;var l=g.vgap;for(var b=0;b<f.length;b++){var k=f[b];if(k!=null){a+=parseInt(k.getSize().height)+parseInt(l)}}return Math.max(parseInt(a)-parseInt(l)-parseInt(c),0)/2};jBrainLayout.prototype.placeNode=function(f,c,b){if(f.isRootNode()){f.setLocation(this.getRootX(),this.getRootY())}else{var a=parseFloat(f.parent.getLocation().x)+parseFloat(c);var g=parseFloat(f.parent.getLocation().y)+parseFloat(b);f.setLocation(a,g)}};jBrainLayout.prototype.resizeMap=function(f,a){var g=false;var c=RAPHAEL.getSize().width;var m=RAPHAEL.getSize().height;var k=0;var b=0;var l=this.getRoot().getLocation();if(c<f*2){k=f*2;b=m;g=true}if(m<a*2){k=c;b=a*2;g=true;this.placeNode(this.getRoot())}if(g){RAPHAEL.setSize(k,b);this.placeNode(this.getRoot(),this.getRootX(),this.getRootY());this.map.work.scrollLeft+=(k-c)/2;this.map.work.scrollTop+=(b-m)/2}};jBrainLayout.prototype.getRootY=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.height)*0.5)-parseInt(this.getRoot().body.getBBox().height)/2};jBrainLayout.prototype.getRootX=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.width)*0.5)-parseInt(this.getRoot().body.getBBox().width)/2};jBrainLayout.prototype.getRoot=function(){return this.map.rootNode};jCardController=function(a){jCardController.superclass.call(this,a)};extend(jCardController,JinoController);jCardController.prototype.type="jCardController";jCardController.prototype.startNodeEdit=function(c){if(this.nodeEditor==undefined||this.nodeEditor==null||c.removed){return false}if(!jMap.isAllowNodeEdit(c)){return false}if(STAT_NODEEDIT){this.stopNodeEdit(true)}if(ISMOBILE){navbarMenusToggle(false)}STAT_NODEEDIT=true;this.nodeEditor.setAttribute("nodeID",c.id);var f=this.nodeEditor;var g=jMap.layoutManager.getCenterLocation();f.style.fontFamily=c.text.attr()["font-family"];f.style.fontSize=jMap.cfg.nodeFontSizes[2]*this.map.cfg.scale+"px";f.style.textAlign="left";var n=[];n.x=0;n.y=0;n.width=RAPHAEL.getSize().width;n.height=RAPHAEL.getSize().height;if(RAPHAEL.canvas.getAttribute("viewBox")){var k=RAPHAEL.canvas.getAttribute("viewBox").split(" ");n.x=k[0];n.y=k[1];n.width=k[2];n.height=k[3]}var a=c.body.getBBox().width*jMap.cfg.scale;var m=c.body.getBBox().height*this.map.cfg.scale;var b=(c.body.getBBox().x-n.x)*RAPHAEL.getSize().width/n.width+1;var l=(c.body.getBBox().y-n.y)*RAPHAEL.getSize().height/n.height+1;f.style.display="";f.style.minWidth=a+"px";f.style.height=m+"px";f.style.left=b+"px";f.style.top=l+"px";f.style.zIndex=999;f.value=c.getText();f.focus();return true};jCardController.prototype.foldingAction=function(a){};jCardController.prototype.resetCoordinateAction=function(a){};jCardController.prototype.foldingAllAction=function(){};jCardController.prototype.unfoldingAllAction=function(){};jCardController.prototype.pasteAction=function(c){if(!jMap.saveAction.isAlive()){return null}if(!c){c=jMap.getSelected()}var f=jMap.getSelecteds().getLastElement();if(!f){f=jMap.getRootNode()}var k=f.getDepth();if(k>1){alert("카드형 팝에서는 1단계 부모 토픽에서만 붙여넣기 할 수 있습니다.");return false}var g=jMap.loadManager.pasteNode(c,jMap.clipboardManager.getClipboardText());var b=function(){for(var o=0;o<g.length;o++){jMap.saveAction.pasteAction(g[o])}if(jMap.cfg.lazyLoading){for(var o=0;o<g.length;o++){var n=g[o].getChildren();for(var p=n.length-1;p>=0;p--){n[p].removeExecute()}}}var l="<clipboard>";for(var o=0;o<g.length;o++){var m=g[o].toXML();l+=m}l+="</clipboard>";jMap.fireActionListener(ACTIONS.ACTION_NODE_PASTE,c,l);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(c);jMap.layoutManager.layout(true)};if(jMap.loadManager.imageLoading.length==0){b()}else{var a=jMap.addActionListener(ACTIONS.ACTION_NODE_IMAGELOADED,function(){b();jMap.removeActionListener(a)})}};jCardController.prototype.deleteAction=function(){var k=jMap.getSelecteds();for(var c=0;c<k.length;c++){if(!jMap.isAllowNodeEdit(k[c])){return false}}var f=null;var a=null;var g=-1;while(f=jMap.getSelecteds().pop()){a=f.getParent();g=f.getIndexPos();if(f.getDepth()==1){columns=jMap.layoutManager.columns;var b=columns[c].indexOf(f);columns[f.column].remove(f);jMap.layoutManager.initColumns(this.columnCount);jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap()}f.remove()}if(a){jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(a);jMap.layoutManager.layout(true);if(g!=-1){if(a.getChildren().length<=0){a.focus()}else{if(a.getChildren().length>g){a.getChildren()[g].focus()}else{a.getChildren()[a.getChildren().length-1].focus()}}}}else{jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();jMap.getRootNode().screenFocus()}};jCardController.prototype.insertSiblingAction=function(){if(BrowserDetect.browser=="Firefox"){jMap.keyEnterHit=0}var g=jMap.getSelecteds().getLastElement();var f=g&&g.parent;if(f){J_NODE_CREATING=g;var b=g.getIndexPos()+1;var a=null;if(g.position&&g.getParent().isRootNode()){a=g.position}var k={parent:f,index:b,position:a,sibling:g};var c=jMap.createNodeWithCtrl(k);c.focus(true);jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();c.setTextExecute("");jMap.controller.startNodeEdit(c)}};jCardController.prototype.insertAction=function(){var b=jMap.getSelecteds().getLastElement();if(!b){b=jMap.getRootNode()}var f=b.getDepth();if(f>1){JinoUtil.waitingDialogClose();alert("카드형 팝에서는 2단계 하위 토픽까지만 추가, 조회할 수 있습니다.\n형제(상위) 토픽을 추가해주세요.");return false}if(b){J_NODE_CREATING=b;b.folded&&b.setFolding(false);var c={parent:b};if(b.children.length>0){c.sibling=b.children[b.children.length-1]}var a=jMap.createNodeWithCtrl(c);a.focus(true);jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();a.setTextExecute("");jMap.controller.startNodeEdit(a)}};jCardControllerGuest=function(a){jCardControllerGuest.superclass.call(this,a)};extend(jCardControllerGuest,JinoControllerGuest);jCardControllerGuest.prototype.type="jCardControllerGuest";jCardControllerGuest.prototype.foldingAction=function(a){};jCardControllerGuest.prototype.resetCoordinateAction=function(a){};jCardControllerGuest.prototype.foldingAllAction=function(){};jCardControllerGuest.prototype.unfoldingAllAction=function(){};jCardLayout=function(c){var b=this;c.controller=c.mode?new jCardController(c):new jCardControllerGuest(c);b.map=c;b.HGAP=20;b.VGAP=20;b.CHILD_VGAP=10;b.xSize=0;b.ySize=0;var a=b.map.work;a.scrollLeft=Math.round((a.scrollWidth-a.offsetWidth)/2);a.scrollTop=0;b.map.cfg.nodeFontSizes=["22","18","12","9"];b.map.cfg.nodeStyle="jCardNode";b.marginTop=150;b.width=a.offsetWidth-60;b.height=a.offsetHeight-200;b.padding=10;b.duration=800;b.columns=[];b.columnWidth=250;b.maxColumns=4;b.width=RAPHAEL.getSize().width;b.height=RAPHAEL.getSize().height;b.columnCount=b.calColumnCount();b.topic=null;$(window).resize(b.resizedWindow)};jCardLayout.prototype.type="jCardLayout";jCardLayout.prototype.resizedWindow=function(){if(jMap.layoutManager.type=="jCardLayout"){if(jMap.layoutManager.topic!=null){jMap.layoutManager.topic.CalcBodySize()}var b=jMap.layoutManager.calColumnCount();if(jMap.layoutManager.columnCount!=b){jMap.layoutManager.columnCount=b;jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();var a=jMap.layoutManager.map.work;a.scrollLeft=Math.round((a.scrollWidth-a.offsetWidth)/2)}}};jCardLayout.prototype.updateTreeHeightsAndRelativeYOfWholeMap=function(){this.initColumns(this.columnCount);for(var b=0;b<this.columns.length;b++){for(var a=0;a<this.columns[b].length;a++){this.updateTreeHeightsAndRelativeYOfDescendants(this.columns[b][a])}}this.layout(false)};jCardLayout.prototype.calColumnCount=function(){var a=$(window).width();var b=parseInt(a/(this.columnWidth+this.HGAP));return Math.min(this.maxColumns,Math.max(b,1))};jCardLayout.prototype.initColumns=function(g){this.columns=[];for(var c=0;c<g;c++){this.columns[c]=[]}var f=0;var a=this.getRoot();var b=a.getChildren();for(var c=0;c<b.length;c++){f=c%this.columns.length;b[c].column=f;if(this.columns[f]){this.columns[f].push(b[c])}}};jCardLayout.prototype.updateTreeHeightsAndRelativeYOfDescendants=function(c){if(c.getDepth()>2){return false}var b=c.getUnChildren();if(b!=null&&b.length>0){for(var a=0;a<b.length;a++){this.updateTreeHeightsAndRelativeYOfDescendants(b[a])}}this.updateTreeGeometry(c)};jCardLayout.prototype.updateTreeGeometry=function(b){if(b==null||b==undefined||b.removed){return false}var a=b.getUnChildren();var f=this.calcTreeWidth(b,a);b.setTreeWidth(f);var c=this.calcTreeHeight(b,a);b.setTreeHeight(c)};jCardLayout.prototype.calcTreeWidth=function(b,a){return this.columnWidth};jCardLayout.prototype.calcTreeHeight=function(c,b){if(b==null||b.length==0){return c.getLayoutSize().height}if(c.getDepth()==2){return c.getLayoutSize().height}var f=c.getLayoutSize().height;for(var a=0;a<b.length;a++){f+=this.calcTreeHeight(b[a],b[a].getUnChildren())+parseInt(this.CHILD_VGAP)}return f};jCardLayout.prototype.updateTreeHeightsAndRelativeYOfAncestors=function(a){this.updateTreeHeightsAndRelativeYOfDescendants(a)};jCardLayout.prototype.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors=function(a){this.updateTreeHeightsAndRelativeYOfDescendants(a)};jCardLayout.prototype.layoutNode=function(k){var g=jMap.layoutManager.getCenterLocation();var a=0;var l=0;if(k.getDepth()==1){a=g.x+k.column*this.columnWidth+k.column*this.HGAP;var b=this.getPrevNodeInColumn(k,k.column);if(b==null){l=g.y}else{l=b.getLocation().y+b.treeHeight+this.VGAP}}else{if(k.getDepth()==2){var b=this.getPrevSibling(k);if(b==null){a=k.parent.getLocation().x;l=k.parent.getLocation().y+k.parent.getLayoutSize().height+this.CHILD_VGAP}else{a=b.getLocation().x;l=b.getLocation().y+b.treeHeight+this.CHILD_VGAP}}else{a=-10000;l=-10000;k.hide();$(".jCard-"+k.getID()).hide()}}k.setLocation(a,l);if((k.folded=="false"||k.folded==false)){var f=k.getChildren();if(f!=null&&f.length>0){for(var c=0;c<f.length;c++){this.layoutNode(f[c])}}}if(l+k.treeHeight>this.height){this.height=l+k.treeHeight}};jCardLayout.prototype.layout=function(l){var k=this.map.selectedNodes.getLastElement();l=l&&(k!=null&&k!=undefined&&!k.removed&&k.getLocation().x!=null&&k.getLocation().x!=undefined&&k.getLocation().x!=0&&k.getLocation().y!=0);var c=this.getRoot();var b=c.getLocation().x;var a=c.getLocation().y;if(l){a=k.getLocation().y}var g=this.getRoot().getUnChildren();if(g!=null&&g.length>0){for(var f=0;f<g.length;f++){this.layoutNode(g[f])}}this.resizeMap(this.width,this.height);c.setLocation(-10000,-10000)};jCardLayout.prototype.getRoot=function(){return this.map.rootNode};jCardLayout.prototype.resizeMap=function(f,a){var g=false;a+=80;var c=RAPHAEL.getSize().width;var l=RAPHAEL.getSize().height;var k=0;var b=0;if(c<f){k=f*2;g=true}if(l<a){b=a*2;g=true}if(g){if(k==0){k=c}if(b==0){b=l}RAPHAEL.setSize(k,b)}};jCardLayout.prototype.getPrevSibling=function(b){if(b.isRootNode()){return null}var a=b.parent.children.indexOf(b);if(a<1){return null}return b.parent.children[a-1]};jCardLayout.prototype.getPrevNodeInColumn=function(c,b){if(b===undefined){return null}var a=this.columns[b].indexOf(c);if(a<1){return null}return this.columns[b][a-1]};jCardLayout.prototype.getRootY=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.height)*0.5)-parseInt(this.getRoot().body.getBBox().height)/2};jCardLayout.prototype.getRootX=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.width)*0.5)-parseInt(this.getRoot().body.getBBox().width)/2};jCardLayout.prototype.getCenterLocation=function(){return{x:(RAPHAEL.getSize().width/2)-(this.columns.length*this.columnWidth+(this.columns.length-1)*this.HGAP)/2,y:this.marginTop}};jFishboneLayout=function(b){this.map=b;this.HGAP=10;this.VGAP=10;this.xSize=0;this.ySize=0;this.angle=90;var a=this.map.work;a.scrollLeft=Math.round((a.scrollWidth-a.offsetWidth)/2);a.scrollTop=Math.round((a.scrollHeight-a.offsetHeight)/2);this.map.cfg.nodeFontSizes=["16","14","12"];this.map.cfg.nodeStyle="jFishNode"};jFishboneLayout.prototype.type="jFishboneLayout";jFishboneLayout.prototype.defaultBranchStyle="jLineFish";jFishboneLayout.prototype.layoutNode=function(f){var u=0;if(f.isRootNode()){u=0}else{var t=Math.tan(Math.PI*(90-this.angle)/180);if(f.isVertical()){var m=f.getIndexPos();var a=f.getParent().getUnChildren();if(f.getDepth()==1){u=this.getRoot().body.getBBox().width+parseInt(this.HGAP)+f.getSize().width+30;for(var p=m%2;p<m;p+=2){u+=parseFloat(a[p].getTreeWidth())+parseInt(this.HGAP)}var k=jMap.getRootNode().children[m-2];if(k!=null&&k!=undefined){var b=k.getParent();var r=k.getLocation().x-(b.getLocation().x+this.HGAP);if(u-r<30){u=r+30}}if(!f.isTopSide()){u+=f.body.getBBox().width*Math.sin(Math.PI*(90-this.angle)/180)}}else{var m=f.getIndexPos();var v=f.getParent();var a=v.getUnChildren();if(f.isTopSide()){u=v.getSize().width+f.getSize().width+this.HGAP;for(var p=0;p<m;p++){u+=parseFloat(a[p].getTreeWidth())+parseInt(this.HGAP)}}else{u=f.getSize().width+this.HGAP;u+=f.body.getBBox().width*Math.sin(Math.PI*(90-this.angle)/180);for(var p=0;p<m;p++){u+=parseFloat(a[p].getTreeWidth())+parseInt(this.HGAP)}}}}else{u=parseInt(this.HGAP);var m=f.getIndexPos();var v=f.getParent();var a=v.getUnChildren();if(f.isTopSide()){var q=-a[0].body.getBBox().height+this.VGAP;for(var p=0;p<=m;p++){q+=a[p].getTreeHeight()+this.VGAP}u+=(v.getTreeHeight()-q)*t+5}else{u+=(f.relYPos)*t}}}this.placeNode(f,u,f.relYPos);f.connectArrowLink();var s=jMap.getArrowLinks(f);for(var p=0;p<s.length;p++){s[p].draw()}var o=f.getDepth();if(!f.isRootNode()&&o%2==1){var c=(f.isTopSide())?f.getInputPort():f.getOutputPort();var n=c.x;var g=c.y;if(o==1){if(f.getIndexPos()%2==0){this.rotate(f,-this.angle,n,g)}else{this.rotate(f,180+this.angle,n,g)}}else{this.rotate(f,this.getParentAngle(f),n,g)}}if(f.folded=="false"||f.folded==false){var a=f.getChildren();if(a!=null&&a.length>0){for(var p=0;p<a.length;p++){this.layoutNode(a[p])}}}};jFishboneLayout.prototype.layout=function(g){var f=this.map.selectedNodes.getLastElement();g=g&&(f!=null&&f!=undefined&&!f.removed&&f.getLocation().x!=null&&f.getLocation().x!=undefined&&f.getLocation().x!=0&&f.getLocation().y!=0);var c=this.getRoot();var b=c.getLocation().x;var a=c.getLocation().y;if(g){a=f.getLocation().y}this.resizeMap(c.treeWidth,c.treeHeight);this.layoutNode(this.getRoot())};jFishboneLayout.prototype.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors=function(a){this.updateTreeHeightsAndRelativeYOfDescendants(a);if(!a.isRootNode()){this.updateTreeHeightsAndRelativeYOfAncestors(a.getParent())}};jFishboneLayout.prototype.updateTreeHeightsAndRelativeYOfAncestors=function(a){this.updateTreeGeometry(a);if(!a.isRootNode()){this.updateTreeHeightsAndRelativeYOfAncestors(a.getParent())}};jFishboneLayout.prototype.updateTreeHeightsAndRelativeYOfWholeMap=function(){this.updateTreeHeightsAndRelativeYOfDescendants(this.getRoot());this.layout(false)};jFishboneLayout.prototype.updateTreeHeightsAndRelativeYOfDescendants=function(c){var b=c.getUnChildren();if(b!=null&&b.length>0){for(var a=0;a<b.length;a++){this.updateTreeHeightsAndRelativeYOfDescendants(b[a])}}this.updateTreeGeometry(c)};jFishboneLayout.prototype.updateRelativeYOfChildren=function(g,c){if(c==null||c.length==0){return}if(g.isRootNode()){for(var b=0;b<c.length;b++){if(c[b].isTopSide()){c[b].relYPos=-this.VGAP+g.getSize().height/2-c[b].body.getBBox().height}else{c[b].relYPos=this.VGAP-c[b].body.getBBox().height+c[b].body.getBBox().width*Math.cos(Math.PI*(90-this.angle)/180)+g.body.getBBox().height/2}}}else{if(g.isVertical()){if(g.isTopSide()){var k=-g.getSize().height;var a=0;var f=0;if(c.length>1){c[0].relYPos=parseInt(k)-c[0].getSize().height+2*parseInt(this.VGAP);for(var b=1;b<c.length;b++){f=parseInt(c[b].getTreeHeight())+parseInt(this.VGAP);k+=f;c[b].relYPos=parseInt(k);a+=f}a=a-(g.getSize().height-2*this.VGAP);if(a>0){for(var b=0;b<c.length;b++){c[b].relYPos-=a}}}}else{var k=-g.getSize().height+c[0].body.getBBox().height+2*this.VGAP;for(var b=0;b<c.length;b++){c[b].relYPos=(k);k+=parseInt(c[b].getTreeHeight())+this.VGAP}var a=k-(parseInt(c[c.length-1].getTreeHeight())+this.VGAP);if(a<0){for(var b=0;b<c.length;b++){c[b].relYPos-=a}}}}else{if(g.isTopSide()){for(var b=0;b<c.length;b++){c[b].relYPos=-this.VGAP}}else{for(var b=0;b<c.length;b++){c[b].relYPos=c[b].getSize().height}}}}};jFishboneLayout.prototype.getShiftUp=function(b){var a=b.getShift();if(a<0){return -a}else{return 0}};jFishboneLayout.prototype.getShiftDown=function(b){var a=b.getShift();if(a>0){return a}else{return 0}};jFishboneLayout.prototype.updateTreeGeometry=function(b){if(b==null||b==undefined||b.removed){return false}var a=b.getUnChildren();var f=this.calcTreeWidth(b,a);b.setTreeWidth(f);var c=this.calcTreeHeight(b,a);b.setTreeHeight(c);this.updateRelativeYOfChildren(b,a)};jFishboneLayout.prototype.calcTreeWidth=function(f,c){if(c!=null&&c.length>0){if(f.isRootNode()){var k=f.getSize().width;var g=c[c.length-1];if(g.getLocation().x==0){this.layout(true)}k=Math.max(k,g.getLocation().x+g.getTreeWidth()-f.getLocation().x);g=g.prevSibling();if(g!=null){k=Math.max(k,g.getLocation().x+g.getTreeWidth()-f.getLocation().x)}return k}else{if(f.isVertical()){var k=0;for(var b=0;b<c.length;b++){var a=c[b];if(a!=null){k=Math.max(parseInt(a.getTreeWidth()),k)}}return f.getSize().width+k+this.HGAP}else{var k=0;for(var b=0;b<c.length;b++){var a=c[b];if(a!=null){k+=parseInt(a.getTreeWidth())+this.HGAP}}if(f.isTopSide()){return f.getSize().width+k}else{return Math.max(f.getSize().width,k)}}}}return f.getSize().width};jFishboneLayout.prototype.calcTreeHeight=function(f,c){if(c!=null&&c.length>0){if(f.isVertical()){if(f.isTopSide()){var g=2*this.VGAP;for(var b=1;b<c.length;b++){var a=c[b];if(a!=null){g+=(parseInt(a.getTreeHeight())+parseInt(this.VGAP))}}return Math.max(f.getSize().height,g)+parseInt(c[0].getTreeHeight())}else{var g=this.VGAP;for(var b=0;b<c.length;b++){var a=c[b];if(a!=null){g+=(parseInt(a.getTreeHeight())+parseInt(this.VGAP))}}return Math.max(f.getSize().height,g)}}else{if(f.isTopSide()){var g=f.getSize().height;for(var b=0;b<c.length;b++){var a=c[b];if(a!=null){g=Math.max(parseInt(a.getTreeHeight())+this.VGAP,g)}}return g}else{var g=0;for(var b=0;b<c.length;b++){var a=c[b];if(a!=null){g=Math.max(parseInt(a.getTreeHeight())+this.VGAP,g)}}return g+f.getSize().height}}}return f.getSize().height};jFishboneLayout.prototype.calcUpperChildShift=function(b,a){};jFishboneLayout.prototype.calcStandardTreeShift=function(b,a){};jFishboneLayout.prototype.placeNode=function(f,c,b){if(f.isRootNode()){f.setLocation(this.getRootX(),this.getRootY())}else{var a=parseFloat(f.parent.getLocation().x)+parseFloat(c);var g=parseFloat(f.parent.getLocation().y)+parseFloat(b);f.setLocation(a,g)}};jFishboneLayout.prototype.resizeMap=function(f,a){var g=false;a+=80;var c=RAPHAEL.getSize().width;var m=RAPHAEL.getSize().height;var k=0;var b=0;var l=this.getRoot().getLocation();if(c<f*2){k=f*2;b=m;g=true}if(m<a*2){k=c;b=a*2;g=true;this.placeNode(this.getRoot())}if(g){RAPHAEL.setSize(k,b);this.placeNode(this.getRoot(),this.getRootX(),this.getRootY());this.map.work.scrollLeft+=(k-c)/2;this.map.work.scrollTop+=(b-m)/2}};jFishboneLayout.prototype.getRootY=function(){var a=RAPHAEL.getSize();return parseInt(a.height*0.5)-parseInt(this.getRoot().body.getBBox().height)/2};jFishboneLayout.prototype.getRootX=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.width)*0.5)-parseInt(this.getRoot().body.getBBox().width)/2};jFishboneLayout.prototype.getRoot=function(){return this.map.rootNode};jFishboneLayout.prototype.getTransformations=function(g){var c={};var b="rotate matrix translate scale skewX skewY".split(" ");for(var f=0;f<b.length;f++){var k=new RegExp(b[f]+"[(]([^)]*)[)]","ig");var a=k.exec(g);c[b[f]]=a?a[1]:null}return c};jFishboneLayout.prototype.rotate=function(b,f,g,c){var a=f+","+g+","+c;var k=null;var n=[];var m=b.groupEl.getAttribute("transform");k=this.getTransformations(m);k.rotate=a;n=[];for(var l in k){if(k[l]){n.push(l+"("+k[l]+")")}}b.groupEl.setAttribute("transform",n.join(" "))};jFishboneLayout.prototype.getParentAngle=function(f){var c=f;while(c.getDepth()!=1){c=c.getParent()}var b=this.getTransformations(c.groupEl.getAttribute("transform"));var a=b.rotate.split(",");return a[0]};jHTreeLayout=function(b){this.map=b;this.HGAP=20;this.VGAP=10;this.xSize=0;this.ySize=0;var a=this.map.work;a.scrollLeft=Math.round((a.scrollWidth-a.offsetWidth)/2);a.scrollTop=Math.round((a.scrollHeight-a.offsetHeight)/2);this.map.cfg.nodeFontSizes=["22","18","12"];this.map.cfg.nodeStyle="jRect"};jHTreeLayout.prototype.type="jHTreeLayout";jHTreeLayout.prototype.defaultBranchStyle="jLinePolygonal2";jHTreeLayout.prototype.layoutNode=function(g){var k=0;var f=g.hgap;if(isNaN(f)){f=0}if(g.isRootNode()){k=0}else{k=parseFloat(f)}this.placeNode(g,g.vshift,k);g.connectArrowLink();var c=jMap.getArrowLinks(g);for(var b=0;b<c.length;b++){c[b].draw()}if(g.folded=="false"||g.folded==false){var a=g.getChildren();if(a!=null&&a.length>0){for(var b=0;b<a.length;b++){this.layoutNode(a[b])}}}};jHTreeLayout.prototype.layout=function(g){var f=this.map.selectedNodes.getLastElement();g=g&&(f!=null&&f!=undefined&&!f.removed&&f.getLocation().x!=null&&f.getLocation().x!=undefined&&f.getLocation().x!=0&&f.getLocation().y!=0);var c=this.getRoot();var b=c.getLocation().x;var a=c.getLocation().y;if(g){a=f.getLocation().y}this.resizeMap(c.treeWidth,c.treeHeight);this.layoutNode(this.getRoot())};jHTreeLayout.prototype.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors=function(a){this.updateTreeHeightsAndRelativeYOfDescendants(a);if(!a.isRootNode()){this.updateTreeHeightsAndRelativeYOfAncestors(a.getParent())}};jHTreeLayout.prototype.updateTreeHeightsAndRelativeYOfAncestors=function(a){this.updateTreeGeometry(a);if(!a.isRootNode()){this.updateTreeHeightsAndRelativeYOfAncestors(a.getParent())}};jHTreeLayout.prototype.updateTreeHeightsAndRelativeYOfWholeMap=function(){this.updateTreeHeightsAndRelativeYOfDescendants(this.getRoot());this.layout(false)};jHTreeLayout.prototype.updateTreeHeightsAndRelativeYOfDescendants=function(c){var b=c.getUnChildren();if(b!=null&&b.length>0){for(var a=0;a<b.length;a++){this.updateTreeHeightsAndRelativeYOfDescendants(b[a])}}this.updateTreeGeometry(c)};jHTreeLayout.prototype.updateTreeGeometry=function(b){if(b==null||b==undefined||b.removed){return false}var a=b.getUnChildren();var f=this.calcTreeWidth(b,a);b.setTreeWidth(f);var c=this.calcTreeHeight(b,a);b.setTreeHeight(c)};jHTreeLayout.prototype.calcTreeWidth=function(f,b){var c=f.getSize().width;if(b==null||b.length==0){return c}var k=null;var g=0;for(var a=0;a<b.length;a++){k=b[a];g+=parseInt(k.getTreeWidth())+parseInt(k.vshift)}g+=parseInt(this.HGAP)*parseInt(b.length-1);return Math.max(c,g)};jHTreeLayout.prototype.calcTreeHeight=function(c,b){if(b==null||b.length==0){return c.getLayoutSize().height}var f=c.getLayoutSize().height;for(var a=0;a<b.length;a++){f+=this.calcTreeHeight(b[a],b[a].getUnChildren())+parseInt(b[a].hgap)+parseInt(this.VGAP)}return f};jHTreeLayout.prototype.placeNode=function(l,k,f){if(l.isRootNode()){l.setLocation(this.getRootX(),this.getRootY())}else{var a=0;var m=0;var c=this.getPrevSibling(l);var g=l.getParent();a=parseInt(g.getLocation().x)+parseInt(g.getSize().width/2)+parseFloat(this.HGAP)+parseFloat(k);var b=0;if(c==null){b=(parseInt(l.parent.getLayoutSize().height)-parseInt(l.parent.getSize().height))/2;m=parseFloat(l.parent.getLocation().y-b)+parseFloat(l.parent.getLayoutSize().height)+parseFloat(f)+parseFloat(this.VGAP)}else{b=(parseInt(c.getLayoutSize().height)-parseInt(c.getSize().height))/2;m=parseInt(c.getLocation().y-b)+parseInt(c.getTreeHeight())+parseFloat(f)+parseInt(this.VGAP)}l.setLocation(a,m)}};jHTreeLayout.prototype.resizeMap=function(f,a){var g=false;a+=80;var c=RAPHAEL.getSize().width;var m=RAPHAEL.getSize().height;var k=0;var b=0;var l=this.getRoot().getLocation();if(c<f*2){k=f*2;b=m;g=true}if(m<a*2){k=c;b=a*2;g=true;this.placeNode(this.getRoot())}if(g){RAPHAEL.setSize(k,b);this.placeNode(this.getRoot(),this.getRootX(),this.getRootY());this.map.work.scrollLeft+=(k-c)/2;this.map.work.scrollTop+=(b-m)/2}};jHTreeLayout.prototype.getRootY=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.height)*0.5)-parseInt(this.getRoot().body.getBBox().height)/2};jHTreeLayout.prototype.getRootX=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.width)*0.5)-parseInt(this.getRoot().body.getBBox().width)/2};jHTreeLayout.prototype.getRoot=function(){return this.map.rootNode};jHTreeLayout.prototype.getPrevSibling=function(b){if(b.isRootNode()){return null}var a=b.parent.children.indexOf(b);if(a<1){return null}return b.parent.children[a-1]};var NEWACTIONASYNC=false;var STARTWAITASYNC=Date.now();var MUSTTORUN=false;var ASYNCACTION=false;jMindMapLayout=function(b){this.map=b;this.HGAP=30;this.VGAP=10;this.xSize=0;this.ySize=0;var a=this.map.work;a.scrollLeft=Math.round((a.scrollWidth-a.offsetWidth)/2);a.scrollTop=Math.round((a.scrollHeight-a.offsetHeight)/2);this.map.cfg.nodeFontSizes=["22","18","12"];this.map.cfg.nodeStyle="jRect"};jMindMapLayout.prototype.type="jMindMapLayout";jMindMapLayout.prototype.defaultBranchStyle="jLineBezier";jMindMapLayout.prototype.svgCompute=function(g){var a=0;var f=g.hgap;if(isNaN(f)){f=0}if(g.isRootNode()){a=0}else{if(g.isLeft()){a=-f-parseInt(g.body.getBBox().width)-parseInt(this.HGAP)}else{a=parseFloat(g.parent.body.getBBox().width)+parseFloat(f)+parseInt(this.HGAP)}}this.computeNode(g,a,g.relYPos);g.changedYPos=false;g.loadingNode=false;if(g.folded=="false"||g.folded==false){var c=g.getChildren();if(c!=null&&c.length>0){for(var b=0;b<c.length;b++){this.svgCompute(c[b])}}}};jMindMapLayout.prototype.svgRedraw=function(g){this.placeNode(g);if(g.folded=="false"||g.folded==false){var c=g.getChildren();if(c!=null&&c.length>0){for(var b=0;b<c.length;b++){if(NEWACTIONASYNC&&!MUSTTORUN){break}this.svgRedraw(c[b]);c[b].connectArrowLink();var f=jMap.getArrowLinks(c[b]);for(var a=0;a<f.length;a++){if(f[a]!=undefined){f[a].draw()}}}}}this.updateEditorPosition(g)};jMindMapLayout.prototype.updateEditorPosition=function(c){if($("#nodeEditor").css("display")=="none"){return}var b=this.map.selectedNodes.getLastElement();var l=$("#nodeEditor");if(b!=undefined&&l!=undefined&&c.body.getBBox()!=null){var k=[];k.x=0;k.y=0;k.width=RAPHAEL.getSize().width;k.height=RAPHAEL.getSize().height;if(RAPHAEL.canvas.getAttribute("viewBox")){var a=RAPHAEL.canvas.getAttribute("viewBox").split(" ");k.x=a[0];k.y=a[1];k.width=a[2];k.height=a[3]}var g=(b.body.getBBox().x-k.x)*RAPHAEL.getSize().width/k.width+1;if(c.isLeft()==b.isLeft()){var f=(b.body.getBBox().y-k.y)*RAPHAEL.getSize().height/k.height-1}else{var f=(b.body.getBBox().y-k.y)*RAPHAEL.getSize().height/k.height+1}$("#nodeEditor").css("left",g+"px");$("#nodeEditor").css("top",f+"px")}};jMindMapLayout.prototype.layoutNode=function(a){this.svgCompute(a);if(!ASYNCACTION){this.svgRedraw(a)}};jMindMapLayout.prototype.layout=function(k){var f=this.map.selectedNodes.getLastElement();k=k&&(f!=null&&f!=undefined&&!f.removed&&f.px!=null&&f.px!=undefined&&f.px!=0&&f.py!=0);var c=this.getRoot();var b=c.px;var a=c.py;if(k){a=f.py}this.resizeMap(c.treeWidth,c.treeHeight);var g=Date.now();if(g-STARTWAITASYNC>3000){MUSTTORUN=true;this.layoutNode(c);STARTWAITASYNC=Date.now();MUSTTORUN=false}else{this.layoutNode(c)}};jMindMapLayout.prototype.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors=function(b){var c=Date.now();this.updateTreeHeightsAndRelativeYOfDescendants(b);if(!b.isRootNode()){this.updateTreeHeightsAndRelativeYOfAncestors(b.getParent())}var a=Date.now()};jMindMapLayout.prototype.updateTreeHeightsAndRelativeYOfAncestors=function(a){this.updateTreeGeometry(a);if(!a.isRootNode()){this.updateTreeHeightsAndRelativeYOfAncestors(a.getParent())}};jMindMapLayout.prototype.updateTreeHeightsAndRelativeYOfWholeMap=function(){this.updateTreeHeightsAndRelativeYOfDescendants(this.getRoot());this.layout(false)};jMindMapLayout.prototype.updateTreeHeightsAndRelativeYOfDescendants=function(c){var b=c.getUnChildren();if(b!=null&&b.length>0){for(var a=0;a<b.length;a++){this.updateTreeHeightsAndRelativeYOfDescendants(b[a])}}this.updateTreeGeometry(c)};jMindMapLayout.prototype.updateRelativeYOfChildren=function(k,c){if(c==null||c.length==0){return}var p=k.vgap;var b=c[0];var a=0;var g=0;for(var l=0;l<c.length;l++){b=c[l];var f=this.getShiftUp(b);var m=this.getShiftDown(b);var n=b.getUpperChildShift();var o=parseInt(a)+parseInt(n)+parseInt(m);if(o!=b.relYPos||b.loadingNode||b.isRootNode()){b.relYPos=parseInt(a)+parseInt(n)+parseInt(m);b.changedYPos=true}g+=parseInt(n)+parseInt(f);a+=parseInt(b.getTreeHeight())+parseInt(f)+parseInt(m)+parseInt(p)+this.VGAP}g+=parseInt(this.calcStandardTreeShift(k,c));for(var l=0;l<c.length;l++){b=c[l];b.relYPos-=g;if(g!=0||b.loadingNode||b.isRootNode()){b.changedYPos=true}}};jMindMapLayout.prototype.getShiftUp=function(b){var a=b.getShift();if(a<0){return -a}else{return 0}};jMindMapLayout.prototype.getShiftDown=function(b){var a=b.getShift();if(a>0){return a}else{return 0}};jMindMapLayout.prototype.updateTreeGeometry=function(c){if(c==null||c==undefined||c.removed){return false}if(c.isRootNode()){var f=this.getRoot().getLeftChildren();var m=this.getRoot().getRightChildren();var g=this.calcTreeWidth(c,f);var n=this.calcTreeWidth(c,m);this.getRoot().setRootTreeWidths(g,n);this.updateRelativeYOfChildren(c,f);this.updateRelativeYOfChildren(c,m);var p=this.calcUpperChildShift(c,f);var r=this.calcUpperChildShift(c,m);this.getRoot().setRootUpperChildShift(p,r);var q=this.calcTreeHeight(c,p,f);var b=this.calcTreeHeight(c,r,m);this.getRoot().setRootTreeHeights(q,b)}else{var a=c.getUnChildren();var k=this.calcTreeWidth(c,a);c.setTreeWidth(k);this.updateRelativeYOfChildren(c,a);var l=this.calcUpperChildShift(c,a);c.setUpperChildShift(l);var o=this.calcTreeHeight(c,l,a);c.setTreeHeight(o)}};jMindMapLayout.prototype.calcTreeWidth=function(g,f){var k=0;if(f!=null&&f.length>0){for(var c=0;c<f.length;c++){var b=f[c];if(b!=null){var a=parseInt(b.getTreeWidth())+parseInt(b.hgap)+this.HGAP;if(a>k){k=a}}}}return g.getLayoutSize().width+k};jMindMapLayout.prototype.calcTreeHeight=function(n,k,c){var l=n.getLayoutSize().height;try{var m=c[0];var b=c[c.length-1];var f=Math.min(m.relYPos-m.getUpperChildShift(),0);var a=Math.max(b.relYPos-b.getUpperChildShift()+b.getTreeHeight(),l);return a-f}catch(g){return l}};jMindMapLayout.prototype.calcUpperChildShift=function(c,a){try{var g=a[0];var f=-g.relYPos+parseInt(g.getUpperChildShift());if(f>0){return f}else{return 0}}catch(b){return 0}};jMindMapLayout.prototype.calcStandardTreeShift=function(g,f){var c=g.getLayoutSize().height;if(f.length==0){return 0}var a=0;var l=g.vgap;for(var b=0;b<f.length;b++){var k=f[b];if(k!=null){a+=parseInt(k.getLayoutSize().height)+parseInt(l)}}return Math.max(parseInt(a)-parseInt(l)-parseInt(c),0)/2};jMindMapLayout.prototype.computeNode=function(c,b,a){if(c.isRootNode()){c.px=this.getRootX();c.py=this.getRootY()}else{c.px=parseFloat(c.parent.px)+parseFloat(b);c.py=parseFloat(c.parent.py)+parseFloat(a)}};jMindMapLayout.prototype.placeNode=function(a){a.setLocation(a.px,a.py)};jMindMapLayout.prototype.resizeMap=function(b,n){n+=80;var f=RAPHAEL.getSize().width;var a=RAPHAEL.getSize().height;var m=false;var c=false;var l=0;var g=0;var k=this.getRoot().getLocation();if(f<b*2){l=b*2;g=a;m=true}if(a<n*2){l=f;g=n*2;m=true;c=true;this.computeNode(this.getRoot())}if(m){RAPHAEL.setSize(l,g);this.computeNode(this.getRoot(),this.getRootX(),this.getRootY());this.map.work.scrollLeft+=(l-f)/2;this.map.work.scrollTop+=(g-a)/2}return c};jMindMapLayout.prototype.getRootY=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.height)*0.5)-parseInt(this.getRoot().body.getBBox().height)/2};jMindMapLayout.prototype.getRootX=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.width)*0.5)-parseInt(this.getRoot().body.getBBox().width)/2};jMindMapLayout.prototype.getRoot=function(){return this.map.rootNode};jPadletLayout=function(b){this.map=b;this.HGAP=30;this.VGAP=10;this.xSize=0;this.ySize=0;var a=this.map.work;a.scrollLeft=Math.round((a.scrollWidth-a.offsetWidth)/2);a.scrollTop=Math.round((a.scrollHeight-a.offsetHeight)/2);this.map.cfg.nodeFontSizes=["22","18","12"];this.map.cfg.nodeStyle="jPadletNode"};jPadletLayout.prototype.type="jPadletLayout";jPadletLayout.prototype.layoutNode=function(c){this.placeNode(c,parseFloat(c.attributes.padlet_x),parseFloat(c.attributes.padlet_y));if(c.folded=="false"||c.folded==false){var b=c.getChildren();if(b!=null&&b.length>0){for(var a=0;a<b.length;a++){this.layoutNode(b[a])}}}};jPadletLayout.prototype.layout=function(g){var f=this.map.selectedNodes.getLastElement();g=g&&(f!=null&&f!=undefined&&!f.removed&&f.getLocation().x!=null&&f.getLocation().x!=undefined&&f.getLocation().x!=0&&f.getLocation().y!=0);var c=this.getRoot();var b=c.getLocation().x;var a=c.getLocation().y;if(g){a=f.getLocation().y}this.layoutNode(this.getRoot())};jPadletLayout.prototype.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors=function(a){this.updateTreeHeightsAndRelativeYOfDescendants(a);if(!a.isRootNode()){this.updateTreeHeightsAndRelativeYOfAncestors(a.getParent())}};jPadletLayout.prototype.updateTreeHeightsAndRelativeYOfAncestors=function(a){this.updateTreeGeometry(a);if(!a.isRootNode()){this.updateTreeHeightsAndRelativeYOfAncestors(a.getParent())}};jPadletLayout.prototype.checkLocation=function(g,f){if(!g.isRootNode()&&(g.attributes.padlet_x==0||g.attributes.padlet_y==0)){if(f){var c={x:f.attributes.padlet_x,y:f.attributes.padlet_y};var k=f.getSize();g.attributes.padlet_x=""+(parseFloat(c.x)+0);g.attributes.padlet_y=""+(parseFloat(c.y)+parseFloat(k.height)+20);g.setLocation(g.attributes.padlet_x,g.attributes.padlet_y)}else{if(g.getParent()){var c={x:g.getParent().attributes.padlet_x,y:g.getParent().attributes.padlet_y};var k=g.getParent().getSize();if(g.getParent().isRootNode()){c={x:this.getRootX(),y:this.getRootY(),}}g.attributes.padlet_x=""+(parseFloat(c.x)+parseFloat(k.width)+20);g.attributes.padlet_y=""+(parseFloat(c.y)+0);g.setLocation(g.attributes.padlet_x,g.attributes.padlet_y)}}}if(g.folded=="false"||g.folded==false){var b=g.getChildren();if(b!=null&&b.length>0){for(var a=0;a<b.length;a++){this.checkLocation(b[a],a>0?b[a-1]:null)}}}};jPadletLayout.prototype.updateTreeHeightsAndRelativeYOfWholeMap=function(){var a=this.getRoot();a.setFoldingAll(false);this.checkLocation(a);this.layoutNode(a)};jPadletLayout.prototype.updateTreeHeightsAndRelativeYOfDescendants=function(a){this.layoutNode(a)};jPadletLayout.prototype.updateRelativeYOfChildren=function(b,a){this.layoutNode(b)};jPadletLayout.prototype.getShiftUp=function(b){var a=b.getShift();if(a<0){return -a}else{return 0}};jPadletLayout.prototype.getShiftDown=function(b){var a=b.getShift();if(a>0){return a}else{return 0}};jPadletLayout.prototype.updateTreeGeometry=function(a){};jPadletLayout.prototype.calcTreeWidth=function(g,f){var k=0;if(f!=null&&f.length>0){for(var c=0;c<f.length;c++){var b=f[c];if(b!=null){var a=parseInt(b.getTreeWidth())+parseInt(b.hgap)+this.HGAP;if(a>k){k=a}}}}return g.getSize().width+k};jPadletLayout.prototype.calcTreeHeight=function(n,k,c){var l=n.getSize().height;try{var m=c[0];var b=c[c.length-1];var f=Math.min(m.relYPos-m.getUpperChildShift(),0);var a=Math.max(b.relYPos-b.getUpperChildShift()+b.getTreeHeight(),l);return a-f}catch(g){return l}};jPadletLayout.prototype.calcUpperChildShift=function(c,a){try{var g=a[0];var f=-g.relYPos+parseInt(g.getUpperChildShift());if(f>0){return f}else{return 0}}catch(b){return 0}};jPadletLayout.prototype.calcStandardTreeShift=function(g,f){var c=g.getSize().height;if(f.length==0){return 0}var a=0;var l=g.vgap;for(var b=0;b<f.length;b++){var k=f[b];if(k!=null){a+=parseInt(k.getSize().height)+parseInt(l)}}return Math.max(parseInt(a)-parseInt(l)-parseInt(c),0)/2};jPadletLayout.prototype.placeNode=function(f,c,b){if(f.isRootNode()){f.setLocation(this.getRootX(),this.getRootY())}else{var a=parseFloat(f.parent.getLocation().x)+parseFloat(c);var g=parseFloat(f.parent.getLocation().y)+parseFloat(b);f.setLocation(c,b)}};jPadletLayout.prototype.resizeMap=function(f,a){var g=false;a+=80;var c=RAPHAEL.getSize().width;var m=RAPHAEL.getSize().height;var k=0;var b=0;var l=this.getRoot().getLocation();if(c<f*2){k=f*2;b=m;g=true}if(m<a*2){k=c;b=a*2;g=true;this.placeNode(this.getRoot())}if(g){RAPHAEL.setSize(k,b);this.placeNode(this.getRoot(),this.getRootX(),this.getRootY());this.map.work.scrollLeft+=(k-c)/2;this.map.work.scrollTop+=(b-m)/2}};jPadletLayout.prototype.getRootY=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.height)*0.5)-parseInt(this.getRoot().body.getBBox().height)/2};jPadletLayout.prototype.getRootX=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.width)*0.5)-parseInt(this.getRoot().body.getBBox().width)/2};jPadletLayout.prototype.getRoot=function(){return this.map.rootNode};jPartitionController=function(a){jPartitionController.superclass.call(this,a)};extend(jPartitionController,JinoController);jPartitionController.prototype.type="jPartitionController";jPartitionController.prototype.startNodeEdit=function(f){if(this.nodeEditor==undefined||this.nodeEditor==null||f.removed){return false}if(!jMap.isAllowNodeEdit(f)){return false}if(STAT_NODEEDIT){this.stopNodeEdit(true)}if(ISMOBILE){navbarMenusToggle(false)}STAT_NODEEDIT=true;this.nodeEditor.setAttribute("nodeID",f.id);var l=this.nodeEditor;var c=jMap.layoutManager.getCenterLocation();l.style.fontFamily=f.text.attr()["font-family"];l.style.fontSize=jMap.cfg.nodeFontSizes[2]*this.map.cfg.scale+"px";l.style.textAlign="left";var b=f.pWidth*jMap.cfg.scale;var a=f.pHeight*jMap.cfg.scale;var k=c.x+(jMap.layoutManager.x(f.y)*jMap.cfg.scale)+(jMap.layoutManager.width-jMap.layoutManager.width*jMap.cfg.scale)/2;var g=c.y+(jMap.layoutManager.y(f.x)*jMap.cfg.scale)-(jMap.layoutManager.marginTop-jMap.layoutManager.marginTop*jMap.cfg.scale)+(jMap.layoutManager.height-jMap.layoutManager.height*jMap.cfg.scale)/2;l.style.display="";l.style.minWidth=b+"px";l.style.maxWidth=b+"px";l.style.width=b+"px";l.style.height=a+"px";l.style.left=k+"px";l.style.top=g+"px";l.style.zIndex=999;l.value=f.getText();l.focus();return true};jPartitionController.prototype.foldingAction=function(a){if(jMap.jDebug){console.log("foldingAction")}};jPartitionController.prototype.resetCoordinateAction=function(a){if(jMap.jDebug){console.log("resetCoordinateAction")}};jPartitionController.prototype.foldingAllAction=function(){if(jMap.jDebug){console.log("foldingAllAction")}};jPartitionController.prototype.unfoldingAllAction=function(){if(jMap.jDebug){console.log("unfoldingAllAction")}};jPartitionController.prototype.pasteAction=function(c){if(!jMap.saveAction.isAlive()){return null}if(!c){c=jMap.getSelected()}var f=jMap.loadManager.pasteNode(c,jMap.clipboardManager.getClipboardText());var b=function(){for(var m=0;m<f.length;m++){jMap.saveAction.pasteAction(f[m])}if(jMap.cfg.lazyLoading){for(var m=0;m<f.length;m++){var l=f[m].getChildren();for(var n=l.length-1;n>=0;n--){l[n].removeExecute()}}}var g="<clipboard>";for(var m=0;m<f.length;m++){var k=f[m].toXML();g+=k}g+="</clipboard>";jMap.fireActionListener(ACTIONS.ACTION_NODE_PASTE,c,g);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(c);jMap.layoutManager.layout(true);jMap.arcTweenNode.zoomExecute(0)};if(jMap.loadManager.imageLoading.length==0){b()}else{var a=jMap.addActionListener(ACTIONS.ACTION_NODE_IMAGELOADED,function(){b();jMap.removeActionListener(a)})}};jPartitionController.prototype.deleteAction=function(){var g=jMap.getSelecteds();for(var b=0;b<g.length;b++){if(!jMap.isAllowNodeEdit(g[b])){return false}}var c=null;var a=null;var f=-1;while(c=g.pop()){a=c.getParent();f=c.getIndexPos();c.popover.container.remove();c.remove()}if(a){jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(a);jMap.layoutManager.layout(true);if(f!=-1){if(a.getChildren().length<=0){a.focus()}else{if(a.getChildren().length>f){a.getChildren()[f].focus()}else{a.getChildren()[a.getChildren().length-1].focus()}}}if(jMap.nodes[jMap.arcTweenNode.id]){jMap.arcTweenNode.zoomExecute()}else{jMap.getRootNode().screenFocus()}}else{jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();jMap.getRootNode().screenFocus()}};jPartitionController.prototype.insertAction=function(){var b=jMap.getSelecteds().getLastElement();if(b){J_NODE_CREATING=b;var c={parent:b};var a=jMap.createNodeWithCtrl(c);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(b);jMap.layoutManager.layout(true);jMap.arcTweenNode.zoomExecute(0).end(function(){JinoUtil.waitingDialogClose();a.focus(true);jMap.controller.startNodeEdit(a)})}};jPartitionController.prototype.insertSiblingAction=function(){if(BrowserDetect.browser=="Firefox"){jMap.keyEnterHit=0}var g=jMap.getSelecteds().getLastElement();var f=g&&g.parent;if(f){J_NODE_CREATING=g;var b=g.getIndexPos()+1;var a=null;if(g.position&&g.getParent().isRootNode()){a=g.position}var k={parent:f,index:b,position:a};var c=jMap.createNodeWithCtrl(k);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(c.parent);jMap.layoutManager.layout(true);jMap.arcTweenNode.zoomExecute(0).end(function(){JinoUtil.waitingDialogClose();c.focus(true);jMap.controller.startNodeEdit(c)})}};jPartitionControllerGuest=function(a){jPartitionControllerGuest.superclass.call(this,a)};extend(jPartitionControllerGuest,JinoControllerGuest);jPartitionControllerGuest.prototype.type="jPartitionControllerGuest";jPartitionControllerGuest.prototype.foldingAction=function(a){if(jMap.jDebug){console.log("foldingAction")}};jPartitionControllerGuest.prototype.resetCoordinateAction=function(a){if(jMap.jDebug){console.log("resetCoordinateAction")}};jPartitionControllerGuest.prototype.foldingAllAction=function(){if(jMap.jDebug){console.log("foldingAllAction")}};jPartitionControllerGuest.prototype.unfoldingAllAction=function(){if(jMap.jDebug){console.log("unfoldingAllAction")}};jPartitionLayout=function(c){var b=this;c.controller=c.mode?new jPartitionController(c):new jPartitionControllerGuest(c);b.map=c;b.HGAP=10;b.VGAP=20;b.xSize=0;b.ySize=0;var a=b.map.work;a.scrollLeft=Math.round((a.scrollWidth-a.offsetWidth)/2);a.scrollTop=Math.round((a.scrollHeight-a.offsetHeight)/2);b.map.cfg.nodeFontSizes=["22","18","12","9"];b.map.cfg.nodeStyle="jPartitionNode";b.map.jDebug=false;this.map.cfg.edgeDefalutColor="#ffffff";b.map.arcTweenNode=null;b.map.popoverContainer=$('<div class="jpopover-container" id="jsunburstlayout-popover-container"></div>').appendTo(document.body);b.marginTop=-10;b.width=a.offsetWidth-150;b.height=a.offsetHeight-180;b.x=d3.scale.linear().range([0,b.width]);b.y=d3.scale.linear().range([0,b.height]);b.padding=10;b.duration=800;b.partition=d3.layout.partition().value(function(f){return 1})};jPartitionLayout.prototype.type="jPartitionLayout";jPartitionLayout.prototype.updateTreeHeightsAndRelativeYOfWholeMap=function(){this.layoutPartition(this.getRoot());this.getRoot().zoomExecute(0)};jPartitionLayout.prototype.updateTreeHeightsAndRelativeYOfAncestors=function(a){this.layoutPartition(this.getRoot());jMap.arcTweenNode.zoomExecute(0)};jPartitionLayout.prototype.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors=function(a){this.layoutPartition(this.getRoot())};jPartitionLayout.prototype.layout=function(a){if(jMap.jDebug){console.log("layout")}};jPartitionLayout.prototype.getRoot=function(){return this.map.rootNode};jPartitionLayout.prototype.layoutPartition=function(f){var c=this;var b=jMap.layoutManager.getCenterLocation();var g=c.partition.nodes(f.getPartitionTreeData());var a=g[0].dy*(c.width/g[0].dx);g.forEach(function(l){jMap.nodes[l.id].depth=l.depth;jMap.nodes[l.id].dx=l.dx;jMap.nodes[l.id].dy=l.dy;jMap.nodes[l.id].x=l.x;jMap.nodes[l.id].y=l.y;jMap.nodes[l.id].value=l.value;jMap.nodes[l.id].pWidth=a;jMap.nodes[l.id].pHeight=l.dx*c.height;var k=d3.select('g[data-node-id="'+l.id+'"]').data([l]);k.attr("visibility","visible").attr("data-node-leaf",!l.children).attr("pointer-events","all").attr("transform","translate("+[b.x+c.x(l.y),b.y+c.y(l.x)]+")");k.select("rect").attr("visibility","visible").attr("pointer-events","all").attr("width",a).attr("height",l.dx*c.height).attr("fill-rule","evenodd");k.select("text").attr("visibility","visible").attr("text-anchor","start")})};jPartitionLayout.prototype.getCenterLocation=function(){return{x:(RAPHAEL.getSize().width/2)-(this.width/2),y:(RAPHAEL.getSize().height/2)-(this.height/2)+this.marginTop}};jPartitionLayout.prototype.hideAllPopover=function(){jMap.popoverContainer.children('div[data-popover-type="'+jMap.cfg.nodeStyle+'"]').removeClass("active")};jRotateLayout=function(b){this.map=b;this.HGAP=10;this.VGAP=120;this.xSize=0;this.ySize=0;var a=this.map.work;a.scrollLeft=Math.round((a.scrollWidth-a.offsetWidth)/2);a.scrollTop=Math.round((a.scrollHeight-a.offsetHeight)/2);this.map.cfg.nodeFontSizes=["22","18","12"]};jRotateLayout.prototype.type="jRotateLayout";jRotateLayout.prototype.layoutNode=function(f){var g=0;var c=f.hgap;if(isNaN(c)){c=0}if(f.isRootNode()){g=0}else{g=parseFloat(f.parent.body.getBBox().height)+parseFloat(c)+parseInt(this.HGAP)}this.placeNode(f,f.vshift,g);if(f.folded=="false"||f.folded==false){var b=f.getChildren();if(b!=null&&b.length>0){for(var a=0;a<b.length;a++){this.layoutNode(b[a])}}}};jRotateLayout.prototype.layout=function(g){var f=this.map.selectedNodes.getLastElement();g=g&&(f!=null&&f!=undefined&&!f.removed&&f.getLocation().x!=null&&f.getLocation().x!=undefined&&f.getLocation().x!=0&&f.getLocation().y!=0);var c=this.getRoot();var b=c.getLocation().x;var a=c.getLocation().y;if(g){a=f.getLocation().y}this.resizeMap(c.treeWidth,c.treeHeight);this.layoutNode(this.getRoot())};jRotateLayout.prototype.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors=function(a){this.updateTreeHeightsAndRelativeYOfDescendants(a);if(!a.isRootNode()){this.updateTreeHeightsAndRelativeYOfAncestors(a.getParent())}};jRotateLayout.prototype.updateTreeHeightsAndRelativeYOfAncestors=function(a){this.updateTreeGeometry(a);if(!a.isRootNode()){this.updateTreeHeightsAndRelativeYOfAncestors(a.getParent())}};jRotateLayout.prototype.updateTreeHeightsAndRelativeYOfWholeMap=function(){this.updateTreeHeightsAndRelativeYOfDescendants(this.getRoot());this.layout(false)};jRotateLayout.prototype.updateTreeHeightsAndRelativeYOfDescendants=function(c){var b=c.getUnChildren();if(b!=null&&b.length>0){for(var a=0;a<b.length;a++){this.updateTreeHeightsAndRelativeYOfDescendants(b[a])}}this.updateTreeGeometry(c)};jRotateLayout.prototype.updateTreeGeometry=function(f){if(f==null||f==undefined||f.removed){return false}var a=f.getUnChildren();var l=this.calcTreeWidth(f,a);f.setTreeWidth(l);var k=this.calcTreeHeight(f,a);f.setTreeHeight(k);var b=function(r,q,m){var p=r.body.getBBox().width;if(!q[m]){q[m]=0}q[m]=(p>q[m])?p:q[m];if(r.getChildren().length>0){var o=r.getChildren();m++;for(var n=0;n<o.length;n++){b(o[n],q,m)}}};var c=[];b(jMap.getRootNode(),c,0);if(f.isRootNode()){f.setSize(this.getRoot().getSize().width,this.getRoot().getSize().height)}else{var g=f.getDepth();f.setSize(c[g],f.getSize().height)}};jRotateLayout.prototype.calcTreeHeight=function(f,c){var b=f.getSize().height;if(c==null||c.length==0){return b}var k=null;var g=0;for(var a=0;a<c.length;a++){k=c[a];g+=parseInt(k.getTreeHeight())}return Math.max(b,g)};jRotateLayout.prototype.calcTreeWidth=function(c,b){if(b==null||b.length==0){return c.getSize().width}var f=0;for(var a=0;a<b.length;a++){f=Math.max(f,this.calcTreeWidth(b[a],b[a].getUnChildren()))}return f};jRotateLayout.prototype.wholePrevNode=function(k){var a=k.getIndexPos();var g=0;for(var c=0;c<a;c++){var f=k.getParent().getChildren();var b=f[c].getChildren();g+=this.calcTreeHeight(f[c],b)}return g};jRotateLayout.prototype.placeNode=function(b,o,n){var m=this.getRootX()+this.getRoot().getSize().width/2;var g=this.getRootY()+this.getRoot().getSize().height/2;var t=this.calcTreeHeight(this.getRoot(),this.getRoot().getChildren());var k=this.calcTreeHeight(b,b.getChildren());var l=function(z){var w={};var v="matrix translate scale skewX skewY".split(" ");for(var x=0;x<v.length;x++){var A=new RegExp(v[x]+"[(]([^)]*)[)]","ig");var u=A.exec(z);w[v[x]]=u?u[1]:null}return w};var s=function(w,z,A,x){var u=z+","+A+","+x;var D=null;var G=[];var F=w.groupEl.getAttribute("transform");D=l(F);D.rotate=u;G=[];for(var E in D){if(D[E]){G.push(E+"("+D[E]+")")}}w.groupEl.setAttribute("transform",G.join(" "));if(w.connection){var C=w.connection.line.node.getAttribute("transform");D=l(C);D.rotate=u;G=[];for(var E in D){if(D[E]){G.push(E+"("+D[E]+")")}}w.connection.line.node.setAttribute("transform",G.join(" "))}if(w.getChildren().length>0){var v=w.getChildren();for(var B=0;B<v.length;B++){s(v[B],z,A,x)}}};if(b.isRootNode()){b.setLocation(this.getRootX(),this.getRootY())}else{if(b.getParent().isRootNode()){var q=this.getRoot().getSize().width+this.getRootX()+this.VGAP;var p=this.getRoot().getSize().height/2+this.getRootY()-b.getSize().height/2;b.setLocation(q,p);var f=this.wholePrevNode(b);var c=(f/t)*360-(k/t)*180;s(b,c,m,g)}else{var q=0;var p=0;var a=this.getPrevSibling(b);if(a==null){var r=b.getParent();p=parseInt(r.getLocation().y)-parseInt(r.getTreeHeight()/2)-parseInt(r.getSize().height/2)-parseInt(this.HGAP)+parseInt(b.getTreeHeight()/2)-parseInt(b.getSize().height/2)+parseInt(n)}else{p=parseInt(a.getLocation().y)+parseInt(a.getTreeHeight()/2)+a.getSize().height/2+b.getTreeHeight()/2-b.getSize().height/2+parseInt(o)+parseInt(this.HGAP)}q=parseFloat(b.parent.getLocation().x)+parseFloat(o)+parseFloat(this.VGAP)+parseFloat(b.parent.getSize().width);b.setLocation(q,p)}}};jRotateLayout.prototype.resizeMap=function(f,a){var g=false;var c=RAPHAEL.getSize().width;var m=RAPHAEL.getSize().height;var k=0;var b=0;var l=this.getRoot().getLocation();if(c<f*2){k=f*2;b=m;g=true}if(m<a*2){k=c;b=a*2;g=true;this.placeNode(this.getRoot())}if(g){RAPHAEL.setSize(k,b);this.placeNode(this.getRoot(),this.getRootX(),this.getRootY());this.map.work.scrollLeft+=(k-c)/2;this.map.work.scrollTop+=(b-m)/2}};jRotateLayout.prototype.getRootY=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.height)*0.5)-parseInt(this.getRoot().body.getBBox().height)/2};jRotateLayout.prototype.getRootX=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.width)*0.5)-parseInt(this.getRoot().body.getBBox().width)/2};jRotateLayout.prototype.getRoot=function(){return this.map.rootNode};jRotateLayout.prototype.getPrevSibling=function(b){if(b.isRootNode()){return null}var a=b.parent.children.indexOf(b);if(a<1){return null}return b.parent.children[a-1]};jSunburstController=function(a){jSunburstController.superclass.call(this,a)};extend(jSunburstController,JinoController);jSunburstController.prototype.startNodeEdit=function(f){if(this.nodeEditor==undefined||this.nodeEditor==null||f.removed){return false}if(!jMap.isAllowNodeEdit(f)){return false}if(STAT_NODEEDIT){this.stopNodeEdit(true)}if(ISMOBILE){navbarMenusToggle(false)}STAT_NODEEDIT=true;this.nodeEditor.setAttribute("nodeID",f.id);var l=this.nodeEditor;l.style.fontFamily=f.text.attr()["font-family"];l.style.fontSize=jMap.cfg.nodeFontSizes[3]*this.map.cfg.scale+"px";l.style.textAlign="left";var b=f.popover.container.width()*jMap.cfg.scale;var n=f.popover.container.height()*jMap.cfg.scale;var c=RAPHAEL.getSize().width/2;var m=(RAPHAEL.getSize().height/2);var a=0;if(!f.isRootNode()){a=(f.outerRadius-f.innerRadius)/2}var k=(f.innerRadius+a)*jMap.cfg.scale;var g=f.angle;m+=(k*Math.sin(Math.PI*(g/180)));c+=(k*Math.cos(Math.PI*(g/180)));if(g>90){c-=b;l.style.textAlign="right"}else{l.style.textAlign="left"}l.style.display="";l.style.width=b+"px";l.style.height=n+"px";l.style.left=c+"px";l.style.top=m+"px";l.style.zIndex=999;l.value=f.getText();l.focus()};jSunburstController.prototype.foldingAction=function(a){if(jMap.jDebug){console.log("foldingAction")}};jSunburstController.prototype.resetCoordinateAction=function(a){if(jMap.jDebug){console.log("resetCoordinateAction")}};jSunburstController.prototype.foldingAllAction=function(){if(jMap.jDebug){console.log("foldingAllAction")}};jSunburstController.prototype.unfoldingAllAction=function(){if(jMap.jDebug){console.log("unfoldingAllAction")}};jSunburstController.prototype.pasteAction=function(c){if(!jMap.saveAction.isAlive()){return null}if(!c){c=jMap.getSelected()}var f=jMap.loadManager.pasteNode(c,jMap.clipboardManager.getClipboardText());var b=function(){for(var m=0;m<f.length;m++){jMap.saveAction.pasteAction(f[m])}if(jMap.cfg.lazyLoading){for(var m=0;m<f.length;m++){var l=f[m].getChildren();for(var n=l.length-1;n>=0;n--){l[n].removeExecute()}}}var g="<clipboard>";for(var m=0;m<f.length;m++){var k=f[m].toXML();g+=k}g+="</clipboard>";jMap.fireActionListener(ACTIONS.ACTION_NODE_PASTE,c,g);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(c);jMap.layoutManager.layout(true);jMap.arcTweenNode.zoomExecute()};if(jMap.loadManager.imageLoading.length==0){b()}else{var a=jMap.addActionListener(ACTIONS.ACTION_NODE_IMAGELOADED,function(){b();jMap.removeActionListener(a)})}};jSunburstController.prototype.deleteAction=function(){var g=jMap.getSelecteds();for(var b=0;b<g.length;b++){if(!jMap.isAllowNodeEdit(g[b])){return false}}var c=null;var a=null;var f=-1;while(c=g.pop()){a=c.getParent();f=c.getIndexPos();c.popover.container.remove();c.remove()}if(a){jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(a);jMap.layoutManager.layout(true);if(f!=-1){if(a.getChildren().length<=0){a.focus()}else{if(a.getChildren().length>f){a.getChildren()[f].focus()}else{a.getChildren()[a.getChildren().length-1].focus()}}}if(jMap.nodes[jMap.arcTweenNode.id]){jMap.arcTweenNode.zoomExecute()}else{jMap.getRootNode().screenFocus()}}else{jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();jMap.getRootNode().screenFocus()}};jSunburstController.prototype.insertAction=function(){var b=jMap.getSelecteds().getLastElement();if(b){J_NODE_CREATING=b;var c={parent:b};var a=jMap.createNodeWithCtrl(c);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(b);jMap.layoutManager.layout(true);jMap.arcTweenNode.zoomExecute(0).end(function(){JinoUtil.waitingDialogClose();a.focus(true);jMap.controller.startNodeEdit(a)})}};jSunburstController.prototype.insertSiblingAction=function(){if(BrowserDetect.browser=="Firefox"){jMap.keyEnterHit=0}var g=jMap.getSelecteds().getLastElement();var f=g&&g.parent;if(f){J_NODE_CREATING=g;var b=g.getIndexPos()+1;var a=null;if(g.position&&g.getParent().isRootNode()){a=g.position}var k={parent:f,index:b,position:a};var c=jMap.createNodeWithCtrl(k);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(c.parent);jMap.layoutManager.layout(true);jMap.arcTweenNode.zoomExecute(0).end(function(){JinoUtil.waitingDialogClose();c.focus(true);jMap.controller.startNodeEdit(c)})}};jSunburstControllerGuest=function(a){jSunburstControllerGuest.superclass.call(this,a)};extend(jSunburstControllerGuest,JinoControllerGuest);jSunburstControllerGuest.prototype.foldingAction=function(a){if(jMap.jDebug){console.log("foldingAction")}};jSunburstControllerGuest.prototype.resetCoordinateAction=function(a){if(jMap.jDebug){console.log("resetCoordinateAction")}};jSunburstControllerGuest.prototype.foldingAllAction=function(){if(jMap.jDebug){console.log("foldingAllAction")}};jSunburstControllerGuest.prototype.unfoldingAllAction=function(){if(jMap.jDebug){console.log("unfoldingAllAction")}};var STAT_NODEEDIT_POP=null;jSunburstLayout=function(c){var b=this;c.controller=c.mode?new jSunburstController(c):new jSunburstControllerGuest(c);b.map=c;b.HGAP=10;b.VGAP=20;b.xSize=0;b.ySize=0;var a=b.map.work;a.scrollLeft=Math.round((a.scrollWidth-a.offsetWidth)/2);a.scrollTop=Math.round((a.scrollHeight-a.offsetHeight)/2);b.map.cfg.nodeFontSizes=["22","18","12","9"];b.map.cfg.nodeStyle="jSunburstNode";b.map.jDebug=false;b.map.cfg.edgeDefalutColor="#8a7066";b.map.cfg.edgeDefalutWidth=0.5;b.map.arcTweenNode=null;b.map.popoverContainer=$('<div class="jpopover-container" id="jsunburstlayout-popover-container"></div>').appendTo(document.body);b.radius=(Math.min(a.offsetWidth/2,a.offsetHeight/2))-100;b.x=d3.scale.linear().range([0,2*Math.PI]);b.y=d3.scale.pow().exponent(1.3).domain([0,1]).range([0,b.radius]);b.padding=5;b.duration=800;b.partition=d3.layout.partition().sort(null).value(function(f){return 5.8-f.depth});b.arc=d3.svg.arc().padAngle(0.0001).startAngle(function(g){var f=Math.max(0,Math.min(2*Math.PI,b.x(g.x)));if(jMap.nodes[g.id]){jMap.nodes[g.id].startAngle=f}return f}).endAngle(function(g){var f=Math.max(0,Math.min(2*Math.PI,b.x(g.x+g.dx)));if(jMap.nodes[g.id]){jMap.nodes[g.id].endAngle=f}return f}).innerRadius(function(g){var f=Math.max(0,g.y?b.y(g.y):g.y);if(jMap.nodes[g.id]){jMap.nodes[g.id].innerRadius=f}return f}).outerRadius(function(g){var f=Math.max(0,b.y(g.y+g.dy));if(jMap.nodes[g.id]){jMap.nodes[g.id].outerRadius=f}return f})};jSunburstLayout.prototype.type="jSunburstLayout";jSunburstLayout.prototype.updateTreeHeightsAndRelativeYOfWholeMap=function(){jMap.arcTweenNode=this.getRoot();this.layoutPartition(jMap.arcTweenNode)};jSunburstLayout.prototype.updateTreeHeightsAndRelativeYOfAncestors=function(a){this.layoutPartition(this.getRoot())};jSunburstLayout.prototype.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors=function(a){this.layoutPartition(this.getRoot())};jSunburstLayout.prototype.layout=function(a){};jSunburstLayout.prototype.layoutPartition=function(b){var a=this;var c=a.partition.nodes(b.getPartitionTreeData());c.forEach(function(f){jMap.nodes[f.id].depth=f.depth;jMap.nodes[f.id].dx=f.dx;jMap.nodes[f.id].dy=f.dy;jMap.nodes[f.id].x=f.x;jMap.nodes[f.id].y=f.y;jMap.nodes[f.id].value=f.value;d3.select('g[data-node-id="'+f.id+'"] path').data([f]).attr("d",a.arc).attr("fill-rule","evenodd").attr("stroke-linejoin","round").attr("stroke-linecap","round");d3.select('g[data-node-id="'+f.id+'"] text').data([f]).attr("transform",function(m){var g=(jMap.nodes[m.id].plainText||"").split(" ").length>1,l=a.x(m.x+m.dx/2)*180/Math.PI-90,k=l+(g?-0.5:0);if(jMap.nodes[m.id]){jMap.nodes[m.id].angle=l;if(jMap.nodes[m.id].isRootNode()){return""}}return"rotate("+k+")translate("+(a.y(m.y)+a.padding)+")rotate("+(l>90?-180:0)+")"}).attr("text-anchor",function(k){var g="middle";if(jMap.nodes[k.id]){if(!jMap.nodes[k.id].isRootNode()){g=a.x(k.x+k.dx/2)>Math.PI?"end":"start"}jMap.nodes[k.id].computedTextExecute();d3.select(jMap.nodes[k.id].text.node).style({"text-anchor":g})}return g})})};jSunburstLayout.prototype.getRoot=function(){return this.map.rootNode};jSunburstLayout.prototype.arcTween=function(k){var a=jMap.layoutManager;var f=a.maxY(k),c=d3.interpolate(a.x.domain(),[k.x,k.x+k.dx]),g=d3.interpolate(a.y.domain(),[k.y,f]),b=d3.interpolate(a.y.range(),[k.y?20:0,a.radius]);return function(l){return function(m){a.x.domain(c(m));a.y.domain(g(m)).range(b(m));return a.arc(l)}}};jSunburstLayout.prototype.maxY=function(b){var a=jMap.layoutManager;return b.children?Math.max.apply(Math,b.children.map(a.maxY)):b.y+b.dy};jSunburstLayout.prototype.getCenterLocation=function(){return{x:RAPHAEL.getSize().width/2,y:(RAPHAEL.getSize().height/2)}};jTableLayout=function(b){this.map=b;this.HGAP=0;this.VGAP=0;this.xSize=0;this.ySize=0;var a=this.map.work;a.scrollLeft=Math.round((a.scrollWidth-a.offsetWidth)/2);a.scrollTop=Math.round((a.scrollHeight-a.offsetHeight)/2);this.map.cfg.nodeFontSizes=["14","14","14"]};jTableLayout.prototype.type="jTableLayout";jTableLayout.prototype.layoutNode=function(g){var a=0;var f=g.wgap;if(isNaN(f)){f=0}if(g.isRootNode()){y=0}else{y=parseFloat(g.parent.body.getBBox().width)}this.placeNode(g,a,g.vshift);if(g.folded=="false"||g.folded==false){var c=g.getChildren();if(c!=null&&c.length>0){for(var b=0;b<c.length;b++){this.layoutNode(c[b])}}}};jTableLayout.prototype.layout=function(g){var f=this.map.selectedNodes.getLastElement();g=g&&(f!=null&&f!=undefined&&!f.removed&&f.getLocation().x!=null&&f.getLocation().x!=undefined&&f.getLocation().x!=0&&f.getLocation().y!=0);var c=this.getRoot();var b=c.getLocation().x;var a=c.getLocation().y;if(g){b=f.getLocation().x}this.resizeMap(c.treeWidth,c.treeHeight);this.layoutNode(this.getRoot())};jTableLayout.prototype.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors=function(a){this.updateTreeHeightsAndRelativeYOfDescendants(this.getRoot());this.layout(false)};jTableLayout.prototype.updateTreeHeightsAndRelativeYOfAncestors=function(a){this.updateTreeHeightsAndRelativeYOfDescendants(this.getRoot());this.layout(false)};jTableLayout.prototype.updateTreeHeightsAndRelativeYOfWholeMap=function(){this.updateTreeHeightsAndRelativeYOfDescendants(this.getRoot());this.layout(false)};jTableLayout.prototype.updateTreeHeightsAndRelativeYOfDescendants=function(c){var b=c.getUnChildren();if(b!=null&&b.length>0){for(var a=0;a<b.length;a++){this.updateTreeHeightsAndRelativeYOfDescendants(b[a])}}this.updateTreeGeometry(c)};jTableLayout.prototype.maxDepth=function(c){var b=c.getUnChildren();if(b==null||b.length==0){return c.getDepth()}var f=0;for(var a=0;a<b.length;a++){f=Math.max(f,this.maxDepth(b[a]))}return f};jTableLayout.prototype.makeNode=function(c,g){var b=c.getUnChildren();if(b==null||b.length==0){if(c.getDepth()<g){var f={parent:c,text:""};this.map.createNodeWithCtrl(f)}}for(var a=0;a<b.length;a++){this.makeNode(b[a],g)}};jTableLayout.prototype.updateTreeGeometry=function(g){if(g==null||g==undefined||g.removed){return false}var b=g.getUnChildren();var k=g.getDepth();var m=this.calcTreeWidth(g,b);g.setTreeWidth(m);var l=this.calcTreeHeight(g,b);g.setTreeHeight(l);var c=function(s,r,n){var q=s.body.getBBox().width;if(!r[n]){r[n]=0}r[n]=(q>r[n])?q:r[n];if(s.getChildren().length>0){var p=s.getChildren();n++;for(var o=0;o<p.length;o++){c(p[o],r,n)}}};var f=[];c(jMap.getRootNode(),f,0);if(k==0){wholeTreeWidth=0;for(var a=1;a<f.length;a++){wholeTreeWidth+=f[a]}g.setSize(wholeTreeWidth,this.getRoot().getSize().height)}else{g.setSize(f[k],l)}};jTableLayout.prototype.calcTreeHeight=function(f,c){var b=f.getSize().height;if(c==null||c.length==0){return b}var k=null;var g=0;for(var a=0;a<c.length;a++){k=c[a];g+=parseInt(k.getTreeHeight())}g-=parseInt(c.length-1)*0.2;return Math.max(b,g)};jTableLayout.prototype.calcTreeWidth=function(c,b){if(b==null||b.length==0){return c.getSize().width}var f=0;for(var a=0;a<b.length;a++){f=Math.max(f,this.calcTreeWidth(b[a],b[a].getUnChildren()))}return f};jTableLayout.prototype.placeNode=function(k,g,c){if(k.isRootNode()){k.setLocation(this.getRootX(),this.getRootY())}else{var a=0;var l=0;var b=this.getPrevSibling(k);var f=k.getParent();if(f.isRootNode()){if(b==null){l=parseInt(f.getLocation().y)+this.getRoot().getSize().height}else{l=parseInt(b.getLocation().y)+parseInt(b.getSize().height)}a=parseFloat(k.parent.getLocation().x)}else{if(b==null){l=parseInt(f.getLocation().y)}else{l=parseInt(b.getLocation().y)+parseInt(b.getSize().height)}a=parseFloat(k.parent.getLocation().x)+parseFloat(k.parent.getSize().width)}k.setLocation(a,l)}};jTableLayout.prototype.resizeMap=function(f,a){var g=false;var c=RAPHAEL.getSize().width;var m=RAPHAEL.getSize().height;var k=0;var b=0;var l=this.getRoot().getLocation();if(c<f*2){k=f*2;b=m;g=true}if(m<a*2){k=c;b=a*2;g=true;this.placeNode(this.getRoot())}if(g){RAPHAEL.setSize(k,b);this.placeNode(this.getRoot(),this.getRootX(),this.getRootY());this.map.work.scrollLeft+=(k-c)/2;this.map.work.scrollTop+=(b-m)/2}};jTableLayout.prototype.getRootY=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.height)*0.5)-parseInt(this.getRoot().body.getBBox().height)/2};jTableLayout.prototype.getRootX=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.width)*0.5)-parseInt(this.getRoot().body.getBBox().width)/2};jTableLayout.prototype.getRoot=function(){return this.map.rootNode};jTableLayout.prototype.getPrevSibling=function(b){if(b.isRootNode()){return null}var a=b.parent.children.indexOf(b);if(a<1){return null}return b.parent.children[a-1]};jTreeLayout=function(b){this.map=b;this.HGAP=10;this.VGAP=20;this.xSize=0;this.ySize=0;var a=this.map.work;a.scrollLeft=Math.round((a.scrollWidth-a.offsetWidth)/2);a.scrollTop=Math.round((a.scrollHeight-a.offsetHeight)/2);this.map.cfg.nodeFontSizes=["22","18","12"];this.map.cfg.nodeStyle="jRect"};jTreeLayout.prototype.type="jTreeLayout";jTreeLayout.prototype.defaultBranchStyle="jLinePolygonal";jTreeLayout.prototype.layoutNode=function(f){var g=0;var c=f.hgap;if(isNaN(c)){c=0}if(f.isRootNode()){g=0}else{g=parseFloat(f.parent.body.getBBox().height)+parseFloat(c)+parseInt(this.HGAP)}this.placeNode(f,f.vshift,g);if(f.folded=="false"||f.folded==false){var b=f.getChildren();if(b!=null&&b.length>0){for(var a=0;a<b.length;a++){this.layoutNode(b[a])}}}};jTreeLayout.prototype.layout=function(g){var f=this.map.selectedNodes.getLastElement();g=g&&(f!=null&&f!=undefined&&!f.removed&&f.getLocation().x!=null&&f.getLocation().x!=undefined&&f.getLocation().x!=0&&f.getLocation().y!=0);var c=this.getRoot();var b=c.getLocation().x;var a=c.getLocation().y;if(g){a=f.getLocation().y}this.resizeMap(c.treeWidth,c.treeHeight);this.layoutNode(this.getRoot())};jTreeLayout.prototype.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors=function(a){this.updateTreeHeightsAndRelativeYOfDescendants(a);if(!a.isRootNode()){this.updateTreeHeightsAndRelativeYOfAncestors(a.getParent())}};jTreeLayout.prototype.updateTreeHeightsAndRelativeYOfAncestors=function(a){this.updateTreeGeometry(a);if(!a.isRootNode()){this.updateTreeHeightsAndRelativeYOfAncestors(a.getParent())}};jTreeLayout.prototype.updateTreeHeightsAndRelativeYOfWholeMap=function(){this.updateTreeHeightsAndRelativeYOfDescendants(this.getRoot());this.layout(false)};jTreeLayout.prototype.updateTreeHeightsAndRelativeYOfDescendants=function(c){var b=c.getUnChildren();if(b!=null&&b.length>0){for(var a=0;a<b.length;a++){this.updateTreeHeightsAndRelativeYOfDescendants(b[a])}}this.updateTreeGeometry(c)};jTreeLayout.prototype.updateTreeGeometry=function(b){if(b==null||b==undefined||b.removed){return false}var a=b.getUnChildren();var f=this.calcTreeWidth(b,a);b.setTreeWidth(f);var c=this.calcTreeHeight(b,a);b.setTreeHeight(c)};jTreeLayout.prototype.calcTreeWidth=function(f,b){var c=f.getSize().width;if(b==null||b.length==0){return c}var k=null;var g=0;for(var a=0;a<b.length;a++){k=b[a];g+=parseInt(k.getTreeWidth())+parseInt(k.vshift)}g+=parseInt(this.HGAP)*parseInt(b.length-1);return Math.max(c,g)};jTreeLayout.prototype.calcTreeHeight=function(c,b){if(b==null||b.length==0){return c.getSize().height}var f=0;for(var a=0;a<b.length;a++){f=Math.max(f,this.calcTreeHeight(b[a],b[a].getUnChildren())+b[a].vshift)}return f};jTreeLayout.prototype.placeNode=function(k,g,c){if(k.isRootNode()){k.setLocation(this.getRootX(),this.getRootY())}else{var a=0;var l=0;var b=this.getPrevSibling(k);if(b==null){var f=k.getParent();a=parseInt(f.getLocation().x)-parseInt(f.getTreeWidth()/2)+parseInt(f.getSize().width/2)+parseInt(k.getTreeWidth()/2)-parseInt(k.getSize().width/2)+parseInt(g)}else{a=parseInt(b.getLocation().x)+parseInt(b.getTreeWidth()/2)+b.getSize().width/2+k.getTreeWidth()/2-k.getSize().width/2+parseInt(g)+parseInt(this.HGAP)}l=parseFloat(k.parent.getLocation().y)+parseFloat(c)+parseFloat(this.VGAP);k.setLocation(a,l)}};jTreeLayout.prototype.resizeMap=function(f,a){var g=false;a+=80;var c=RAPHAEL.getSize().width;var m=RAPHAEL.getSize().height;var k=0;var b=0;var l=this.getRoot().getLocation();if(c<f*2){k=f*2;b=m;g=true}if(m<a*2){k=c;b=a*2;g=true;this.placeNode(this.getRoot())}if(g){RAPHAEL.setSize(k,b);this.placeNode(this.getRoot(),this.getRootX(),this.getRootY());this.map.work.scrollLeft+=(k-c)/2;this.map.work.scrollTop+=(b-m)/2}};jTreeLayout.prototype.getRootY=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.height)*0.5)-parseInt(this.getRoot().body.getBBox().height)/2};jTreeLayout.prototype.getRootX=function(){var a=RAPHAEL.getSize();return Math.round(parseInt(a.width)*0.5)-parseInt(this.getRoot().body.getBBox().width)/2};jTreeLayout.prototype.getRoot=function(){return this.map.rootNode};jTreeLayout.prototype.getPrevSibling=function(b){if(b.isRootNode()){return null}var a=b.parent.children.indexOf(b);if(a<1){return null}return b.parent.children[a-1]};jZoomableTreemapController=function(a){jZoomableTreemapController.superclass.call(this,a)};extend(jZoomableTreemapController,JinoController);jZoomableTreemapController.prototype.type="jZoomableTreemapController";jZoomableTreemapController.prototype.startNodeEdit=function(f){if(this.nodeEditor==undefined||this.nodeEditor==null||f.removed){return false}if(!jMap.isAllowNodeEdit(f)){return false}if(STAT_NODEEDIT){this.stopNodeEdit(true)}if(ISMOBILE){navbarMenusToggle(false)}STAT_NODEEDIT=true;this.nodeEditor.setAttribute("nodeID",f.id);var l=this.nodeEditor;var c=jMap.layoutManager.getCenterLocation();l.style.fontFamily=f.text.attr()["font-family"];l.style.fontSize=jMap.cfg.nodeFontSizes[2]*this.map.cfg.scale+"px";l.style.textAlign="left";var b=f.groupEl.getBBox().width*jMap.cfg.scale;var a=f.groupEl.getBBox().height*jMap.cfg.scale;var k=c.x+(jMap.layoutManager.x(f.x)*jMap.cfg.scale)+(jMap.layoutManager.width-jMap.layoutManager.width*jMap.cfg.scale)/2;var g=c.y+(jMap.layoutManager.y(f.y)*jMap.cfg.scale)-(jMap.layoutManager.marginTop-jMap.layoutManager.marginTop*jMap.cfg.scale)+(jMap.layoutManager.height-jMap.layoutManager.height*jMap.cfg.scale)/2;l.style.display="";l.style.minWidth=b+"px";l.style.height=a+"px";l.style.left=k+"px";l.style.top=g+"px";l.style.zIndex=999;l.value=f.getText();l.focus();return true};jZoomableTreemapController.prototype.foldingAction=function(a){if(jMap.jDebug){console.log("foldingAction")}};jZoomableTreemapController.prototype.resetCoordinateAction=function(a){if(jMap.jDebug){console.log("resetCoordinateAction")}};jZoomableTreemapController.prototype.foldingAllAction=function(){if(jMap.jDebug){console.log("foldingAllAction")}};jZoomableTreemapController.prototype.unfoldingAllAction=function(){if(jMap.jDebug){console.log("unfoldingAllAction")}};jZoomableTreemapController.prototype.pasteAction=function(c){if(!jMap.saveAction.isAlive()){return null}if(!c){c=jMap.getSelected()}var f=jMap.loadManager.pasteNode(c,jMap.clipboardManager.getClipboardText());var b=function(){for(var m=0;m<f.length;m++){jMap.saveAction.pasteAction(f[m])}if(jMap.cfg.lazyLoading){for(var m=0;m<f.length;m++){var l=f[m].getChildren();for(var n=l.length-1;n>=0;n--){l[n].removeExecute()}}}var g="<clipboard>";for(var m=0;m<f.length;m++){var k=f[m].toXML();g+=k}g+="</clipboard>";jMap.fireActionListener(ACTIONS.ACTION_NODE_PASTE,c,g);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(c);jMap.layoutManager.layout(true);jMap.arcTweenNode.zoomExecute(0)};if(jMap.loadManager.imageLoading.length==0){b()}else{var a=jMap.addActionListener(ACTIONS.ACTION_NODE_IMAGELOADED,function(){b();jMap.removeActionListener(a)})}};jZoomableTreemapController.prototype.deleteAction=function(){var g=jMap.getSelecteds();for(var b=0;b<g.length;b++){if(!jMap.isAllowNodeEdit(g[b])){return false}}var c=null;var a=null;var f=-1;while(c=g.pop()){a=c.getParent();f=c.getIndexPos();c.popover.container.remove();c.remove()}if(a){jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(a);jMap.layoutManager.layout(true);if(f!=-1){if(a.getChildren().length<=0){a.focus()}else{if(a.getChildren().length>f){a.getChildren()[f].focus()}else{a.getChildren()[a.getChildren().length-1].focus()}}}if(jMap.nodes[jMap.arcTweenNode.id]){jMap.arcTweenNode.zoomExecute()}else{jMap.getRootNode().screenFocus()}}else{jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();jMap.getRootNode().screenFocus()}};jZoomableTreemapController.prototype.insertAction=function(){var b=jMap.getSelecteds().getLastElement();if(b){J_NODE_CREATING=b;var c={parent:b};var a=jMap.createNodeWithCtrl(c);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(b);jMap.layoutManager.layout(true);jMap.arcTweenNode.zoomExecute(0).end(function(){JinoUtil.waitingDialogClose();a.focus(true);jMap.controller.startNodeEdit(a)})}};jZoomableTreemapController.prototype.insertSiblingAction=function(){if(BrowserDetect.browser=="Firefox"){jMap.keyEnterHit=0}var g=jMap.getSelecteds().getLastElement();var f=g&&g.parent;if(f){J_NODE_CREATING=g;var b=g.getIndexPos()+1;var a=null;if(g.position&&g.getParent().isRootNode()){a=g.position}var k={parent:f,index:b,position:a};var c=jMap.createNodeWithCtrl(k);jMap.layoutManager.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors(c.parent);jMap.layoutManager.layout(true);jMap.arcTweenNode.zoomExecute(0).end(function(){JinoUtil.waitingDialogClose();c.focus(true);jMap.controller.startNodeEdit(c)})}};jZoomableTreemapControllerGuest=function(a){jZoomableTreemapControllerGuest.superclass.call(this,a)};extend(jZoomableTreemapControllerGuest,JinoControllerGuest);jZoomableTreemapControllerGuest.prototype.type="jZoomableTreemapControllerGuest";jZoomableTreemapControllerGuest.prototype.foldingAction=function(a){if(jMap.jDebug){console.log("foldingAction")}};jZoomableTreemapControllerGuest.prototype.resetCoordinateAction=function(a){if(jMap.jDebug){console.log("resetCoordinateAction")}};jZoomableTreemapControllerGuest.prototype.foldingAllAction=function(){if(jMap.jDebug){console.log("foldingAllAction")}};jZoomableTreemapControllerGuest.prototype.unfoldingAllAction=function(){if(jMap.jDebug){console.log("unfoldingAllAction")}};jZoomableTreemapLayout=function(c){var b=this;c.controller=c.mode?new jZoomableTreemapController(c):new jZoomableTreemapControllerGuest(c);b.map=c;b.HGAP=10;b.VGAP=20;b.xSize=0;b.ySize=0;var a=b.map.work;a.scrollLeft=Math.round((a.scrollWidth-a.offsetWidth)/2);a.scrollTop=Math.round((a.scrollHeight-a.offsetHeight)/2);b.map.cfg.nodeFontSizes=["22","18","12","9"];b.map.cfg.nodeStyle="jZoomableTreemapNode";b.map.jDebug=false;this.map.cfg.edgeDefalutColor="#ffffff";b.map.arcTweenNode=null;b.map.popoverContainer=$('<div class="jpopover-container" id="jsunburstlayout-popover-container"></div>').appendTo(document.body);b.marginTop=-10;b.width=a.offsetWidth-150;b.height=a.offsetHeight-180;b.x=d3.scale.linear().range([0,b.width]);b.y=d3.scale.linear().range([0,b.height]);b.padding=10;b.duration=800;b.partition=d3.layout.treemap().round(false).size([b.width,b.height]).value(function(f){return 1})};jZoomableTreemapLayout.prototype.type="jZoomableTreemapLayout";jZoomableTreemapLayout.prototype.updateTreeHeightsAndRelativeYOfWholeMap=function(){this.layoutPartition(this.getRoot());this.getRoot().zoomExecute(0)};jZoomableTreemapLayout.prototype.updateTreeHeightsAndRelativeYOfAncestors=function(a){this.layoutPartition(this.getRoot());jMap.arcTweenNode.zoomExecute(0)};jZoomableTreemapLayout.prototype.updateTreeHeightsAndRelativeYOfDescendantsAndAncestors=function(a){this.layoutPartition(this.getRoot())};jZoomableTreemapLayout.prototype.layout=function(a){if(jMap.jDebug){console.log("layout")}};jZoomableTreemapLayout.prototype.getRoot=function(){return this.map.rootNode};jZoomableTreemapLayout.prototype.layoutPartition=function(c){var b=this;var a=jMap.layoutManager.getCenterLocation();var f=b.partition.nodes(c.getPartitionTreeData());f.forEach(function(k){jMap.nodes[k.id].area=k.area;jMap.nodes[k.id].depth=k.depth;jMap.nodes[k.id].dx=k.dx;jMap.nodes[k.id].dy=k.dy;jMap.nodes[k.id].x=k.x;jMap.nodes[k.id].y=k.y;jMap.nodes[k.id].z=k.z;jMap.nodes[k.id].value=k.value;var g=d3.select('g[data-node-id="'+k.id+'"]').data([k]);g.attr("visibility","hidden").attr("data-node-leaf",false).attr("pointer-events","none");g.select("rect").attr("visibility","hidden").attr("pointer-events","none");g.select("text").attr("visibility","hidden");if(!k.children){g.attr("visibility","visible").attr("data-node-leaf",true).attr("pointer-events","all").attr("transform","translate("+[a.x+k.x,a.y+k.y]+")");g.select("rect").attr("visibility","visible").attr("pointer-events","all").attr("width",k.dx-1).attr("height",k.dy-1).attr("fill-rule","evenodd");g.select("text").attr("visibility","visible").attr("text-anchor","middle")}})};jZoomableTreemapLayout.prototype.getCenterLocation=function(){return{x:(RAPHAEL.getSize().width/2)-(this.width/2),y:(RAPHAEL.getSize().height/2)-(this.height/2)+this.marginTop}};jZoomableTreemapLayout.prototype.hideAllPopover=function(){jMap.popoverContainer.children('div[data-popover-type="'+jMap.cfg.nodeStyle+'"]').removeClass("active")};jNode=function(a,b,c){this.groupEl=null;this.body=null;this.text=null;this.folderShape=null;this.img=null;this.hyperlink=null;this.file=null;this.note=null;this.noteText=null;this.moodleIcon=null;this.arrowlinks=new Array();this.note="";if(c&&c!=null&&c!=""&&c!="null"&&jMap.checkID(c)){this.id=c}else{this.id=this.CreateID()}this.plainText=b||"";this.folded=false;this.background_color="";this.color="";this.controller=null;this.layoutHeight=0;this.connection=null;this.children=new Array();this.parent=null;this.edge={};this.branch={};this.fontSize=10;this.hided=false;this.imgInfo={};this.numofchildren=0;this.client_id=jMap.getClientId();this.creator=jMap.cfg.userId;this.userfullname=jMap.cfg.userName;this.userportrait=jMap.cfg.portrait;this.created=0;this.createAbstract(a);this.score=RAPHAEL.text();this.scoreValue=-1;this.score.attr({text:""});this.procOne=RAPHAEL.rect();this.procTwo=RAPHAEL.rect();this.iotId=0};jNode.prototype.type="jNode";if(Raphael.vml){var createNode;var d=document;d.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!d.namespaces.rvml&&d.namespaces.add("rvml","urn:schemas-microsoft-com:vml");createNode=function(a){return d.createElement("<rvml:"+a+' class="rvml">')}}catch(e){createNode=function(a){return d.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}}jNode.prototype.connectArrowLink=function(){for(var a=0;a<this.arrowlinks.length;a++){this.arrowlinks[a].draw()}};jNode.prototype.addArrowLink=function(k){if(!jMap.saveAction.isAlive()){return null}var c=this.arrowlinks;for(var f=0;f<c.length;f++){if(this.arrowlinks[f].destination==k.destination){return}}var g=jMap.historyManager;var a=g&&g.extractNode(this);this.addArrowLinkExecute(k);var b=g&&g.extractNode(this);g&&g.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_ARROWLINK,this,k);jMap.setSaved(false)};jNode.prototype.addArrowLinkExecute=function(a){a.startNode=this;this.arrowlinks.push(a);jMap.addArrowLink(a)};jNode.prototype.removeArrowLink=function(f){if(!jMap.saveAction.isAlive()){return null}var c=jMap.historyManager;var a=c&&c.extractNode(this);this.removeArrowLinkExecute(f);var b=c&&c.extractNode(this);c&&c.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_EDITED,this);jMap.setSaved(false)};jNode.prototype.removeArrowLinkExecute=function(a){a.remove();this.arrowlinks.remove(a);jMap.removeArrowLink(a)};jNode.prototype.settingArrowLink=function(f,k,g,m,b){if(!jMap.saveAction.isAlive()){return null}var l=jMap.historyManager;var a=l&&l.extractNode(this);this.settingArrowLinkExecute(f,k,g,m,b);var c=l&&l.extractNode(this);l&&l.addToHistory(a,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_EDITED,this);jMap.setSaved(false)};jNode.prototype.settingArrowLinkText=function(g,f){if(!jMap.saveAction.isAlive()){return null}var c=jMap.historyManager;var a=c&&c.extractNode(this);this.settingArrowLinkTextExecute(g,f);var b=c&&c.extractNode(this);c&&c.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_EDITED,this);jMap.setSaved(false)};jNode.prototype.settingArrowLinkAttr=function(b,g,f,a,c,k){if(!jMap.saveAction.isAlive()){return null}var m=jMap.historyManager;var n=m&&m.extractNode(this);this.settingArrowLinkAttrExecute(b,g,f,a,c,k);var l=m&&m.extractNode(this);m&&m.addToHistory(n,l);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_EDITED,this);jMap.setSaved(false)};jNode.prototype.settingArrowLinkExecute=function(c,k,g,l,a){var b=this.arrowlinks;for(var f=0;f<b.length;f++){this.arrowlinks[f].setColor(c);this.arrowlinks[f].setLineWidth(k);this.arrowlinks[f].setStart(l);this.arrowlinks[f].setEnd(a);this.arrowlinks[f].setStyle(g)}};jNode.prototype.settingArrowLinkTextExecute=function(f,c){var a=this.arrowlinks;for(var b=0;b<a.length;b++){if(this.arrowlinks[b].id==f){this.arrowlinks[b].setText(c);break}}};jNode.prototype.settingArrowLinkAttrExecute=function(m,c,k,g,l,a){var b=this.arrowlinks;for(var f=0;f<b.length;f++){if(this.arrowlinks[f].id==m){this.arrowlinks[f].setColor(c);this.arrowlinks[f].setLineWidth(k);this.arrowlinks[f].setStart(l);this.arrowlinks[f].setEnd(a);this.arrowlinks[f].setStyle(g);break}}};jNode.prototype.CreateID=function(){var a="";while(!jMap.checkID(a)){a="ID_"+parseInt(Math.random()*2000000000)}return a};jNode.prototype.createAbstract=function(a){this.initElements();this.parent=a;jMap.nodes[this.id]=this;if(this.getParent()){if(this.index!=null){this.getParent().insertChild(this,this.index)}else{this.getParent().appendChild(this)}this.getParent().numofchildren=this.getParent().getChildren().length}this.initCreate();this.create()};jNode.prototype.wrapElements=function(){this.groupEl=null;var c=document;if(Raphael.svg){this.groupEl=c.createElementNS("http://www.w3.org/2000/svg","g");this.groupEl.style.webkitTapHighlightColor="rgba(0,0,0,0)";if(jMap.groupEl){jMap.groupEl.appendChild(this.groupEl)}else{RAPHAEL.canvas&&RAPHAEL.canvas.appendChild(this.groupEl)}var b=arguments.length;for(var a=0;a<b;a++){this.groupEl.appendChild(arguments[a].node)}}if(Raphael.vml){this.groupEl=createNode("group");if(jMap.groupEl){jMap.groupEl.appendChild(this.groupEl)}else{RAPHAEL.canvas.appendChild(this.groupEl)}var b=arguments.length;for(var a=0;a<b;a++){this.groupEl.appendChild(arguments[a].Group)}}this.groupEl.node=this};jNode.prototype.getID=function(){return this.id};jNode.prototype.appendChild=function(a){this.children.push(a)};jNode.prototype.insertChild=function(b,a){this.index=a;this.children.insert(a,b)};jNode.prototype.getIndexPos=function(){if(!this.parent){return -1}return this.parent.children.indexOf(this)};jNode.prototype.getParent=function(){return this.parent};jNode.prototype.setParent=function(a){this.parent=a};jNode.prototype.getChildren=function(){return this.children};jNode.prototype.getUnChildren=function(){if(this.folded==true||this.folded=="true"){return null}else{return this.getChildren()}};jNode.prototype.isRootNode=function(){return this.parent==null};jNode.prototype.getText=function(){return this.text.attr()?this.text.attr().text:""};jNode.prototype.setText=function(text){if(this.isRootNode()&&text.trim().length==0){JinoUtil.toast({type:"warning",text:"중심 토픽은 빈 텍스트를 입력할 수 없습니다."});return null}var pattern=eval("/[\uD800-\uF8FF]/");if(pattern.test(text)){JinoUtil.toast({type:"warning",text:"이모티콘은 등록할 수 없습니다."});text=text.replace(new RegExp(pattern,"g"),"")}var history=jMap.historyManager;var undo=history&&history.extractNode(this);this.setTextExecute(text);var redo=history&&history.extractNode(this);history&&history.addToHistory(undo,redo);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_EDITED,this);jMap.setSaved(false)};jNode.prototype.setTranslatedText=function(text){if(text==undefined){return null}if(this.isRootNode()&&text.trim().length==0){return null}else{text=text.trim()}var pattern=eval("/[\uD800-\uF8FF]/");if(pattern.test(text)){text=text.replace(new RegExp(pattern,"g"),"")}text=text.replace("&#39;","'");this.setTextExecute(text)};jNode.prototype.setTextExecute=function(a){this.plainText=a;this.text.attr({text:a});this.CalcBodySize();this.setScoreExecute()};jNode.prototype.setScore=function(a){this.scoreValue=a;this.setScoreExecute()};jNode.prototype.setScoreExecute=function(){if(this.scoreValue==-1){return}if(this.score==undefined){return}if(this.procOne==undefined){return}if(this.procTwo==undefined){return}this.score.attr({text:this.scoreValue});this.score.attr({"font-size":12});this.score.attr({font:12+"px "+this.text.attr("font-family")});this.score.attr({fill:"#000000"});this.procOne.attr({height:10});this.procTwo.attr({height:10});this.procTwo.attr({fill:"#000000"});var a=this.getSize().width;this.procOne.attr({width:a});if(this.isLeft()){var b=a/100*this.scoreValue;this.procTwo.attr({width:b>0?b:0})}else{var b=a/100*this.scoreValue;this.procTwo.attr({width:b>0?b:0})}};jNode.prototype.wrapText=function(g,f){var k="\n";var a=0;var c=g.length;for(var b=0;b<c;b++){if(g[b]==" "||g[b]==k){this.text.attr({text:g.substring(0,b)});if(this.text.getBBox().width>=f){if(a==0){return this.wrapTextForce(g,f)}return g.substring(0,a)+k+this.wrapText(g.substring(a+1),f)}a=b}}this.text.attr({text:g.substring(0,b)});if(this.text.getBBox().width>=f){return this.wrapTextForce(g,f)}return g};jNode.prototype.wrapTextForce=function(c,b){var f="\n";for(var a=0;a<c.length;a++){if(c[a]==f){return c.substring(0,a)+f+this.wrapText(c.substring(a+1),b)}this.text.attr({text:c.substring(0,a)});if(this.text.getBBox().width>=b){return c.substring(0,a)+f+this.wrapText(c.substring(a+1),b)}}return c};jNode.prototype.renderedTextSize=function(a){var f=Raphael(0,0,0,0);f.canvas.style.visibility="hidden";var c=f.text(0,0,a);c.attr({"font-family":this.text.attr("font-family"),"font-size":this.text.attr("font-size"),"font-weight":this.text.attr("font-weight"),"text-anchor":null});var b=c.getBBox();f.remove();return{width:b.width,height:b.height}};jNode.prototype.getFontSize=function(){return this.fontSize};jNode.prototype.setFontSize=function(c){if(!jMap.saveAction.isAlive()){return null}var f=jMap.historyManager;var a=f&&f.extractNode(this);this.setFontSizeExecute(c);var b=f&&f.extractNode(this);f&&f.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_FONTSIZE,this);jMap.setSaved(false)};jNode.prototype.setFontSizeExecute=function(a){this.fontSize=a;this.text.attr({"font-size":a});this.text.attr({font:a+"px "+this.text.attr("font-family")});this.CalcBodySize();jMap.resolveRendering()};jNode.prototype.setTextColor=function(c){if(!jMap.saveAction.isAlive()){return null}var f=jMap.historyManager;var a=f&&f.extractNode(this);this.setTextColorExecute(c);var b=f&&f.extractNode(this);f&&f.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_ATTRS,this);jMap.setSaved(false)};jNode.prototype.setTextColorExecute=function(a){this.color=a;this.text.attr({fill:a})};jNode.prototype.getTextColor=function(){return this.color};jNode.prototype.setBackgroundColor=function(c){if(!jMap.saveAction.isAlive()){return null}var f=jMap.historyManager;var a=f&&f.extractNode(this);this.setBackgroundColorExecute(c);var b=f&&f.extractNode(this);f&&f.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_ATTRS,this);jMap.setSaved(false)};jNode.prototype.setBackgroundColorExecute=function(a){if(a){this.background_color=a;this.body.attr({fill:a});this.folderShape&&this.folderShape.attr({fill:a})}};jNode.prototype.getBackgroundColor=function(){return this.background_color};jNode.prototype.setEdgeColor=function(c,f){if(!jMap.saveAction.isAlive()){return null}var g=jMap.historyManager;var a=g&&g.extractNode(this);this.setEdgeColorExecute(c,f);var b=g&&g.extractNode(this);g&&g.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_EDGECOLOR,this);jMap.setSaved(false)};jNode.prototype.setEdgeColorExecute=function(a,b){if(a){this.edge.color=a;this.body.attr({stroke:a});this.folderShape&&this.folderShape.attr({stroke:a})}if(b){this.edge.width=b;this.body.attr({"stroke-width":b})}};jNode.prototype.getEdgeColor=function(){return this.edge.color};jNode.prototype.setBranch=function(c,g,f){if(!jMap.saveAction.isAlive()){return null}var k=jMap.historyManager;var a=k&&k.extractNode(this);this.setBranchExecute(c,g,f);var b=k&&k.extractNode(this);k&&k.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_BRANCH,this);jMap.setSaved(false)};jNode.prototype.setBranchExecute=function(color,width,style){if(!this.connection){return false}if(style==null||style=="undefined"||style.trim()==""){if(this.branch.style!=null&&this.branch.style!="undefined"&&this.branch.style.trim()!=""){style=this.branch.style}else{style=jMap.layoutManager.defaultBranchStyle}}this.branch.style=style;this.connection.remove();var jsCode="this.connection = this.parent && new "+style+"(this.parent, this)";eval(jsCode);if(this.branch.color==null||this.branch.color=="undefined"||this.branch.color==""){this.branch.color=this.edge.color}if(this.branch.width==null||this.branch.width=="undefined"||this.branch.width==""){this.branch.width=""+this.edge.width}this.connection&&this.connection.line.attr({stroke:this.branch.color,fill:this.branch.color});this.connection&&this.connection.line.attr({"stroke-width":this.branch.width});if(color!=null&&color!="undefined"&&color!=""){this.branch.color=color;this.connection&&this.connection.line.attr({stroke:color,fill:color});if(jMap.layoutManager.type=="jTreeLayout"){this.connection&&this.connection.line.attr({stroke:color,fill:"none"})}}if(width!=null&&width!="undefined"&&width!=""){this.branch.width=width;this.connection&&this.connection.line.attr({"stroke-width":width})}};jNode.prototype.getBranchColor=function(){return this.branch.color};jNode.prototype.getPathToRoot=function(c){var a=new Array();var b=this;a.push(b.getText());while(b=b.parent){if(c!=null&&c--==0){break}a.push(b.getText())}return a};jNode.prototype.getPathToRootText=function(c,b){var a=this.getPathToRoot(c);return a.join(b)};jNode.prototype.getDepth=function(){var b=0;var a=this;while(a=a.parent){b++}return b};jNode.prototype.focus=function(b,f){var g=jMap.getSelecteds();if(b){var a=g.length-1;for(var c=a;c>=0;c--){g[c].CalcBodySize();g[c].blur()}}if(!g.contains(this)){this.CalcBodySize();g.push(this);this.body.animate({stroke:jMap.cfg.nodeSelectedColor,"stroke-width":3},300)}if(f==null||f==undefined){f=true}if(f){jMap.fireActionListener(ACTIONS.ACTION_NODE_SELECTED,this)}jMap.work.focus()};jNode.prototype.blur=function(){var a=jMap.getSelecteds();if(a.contains(this)){a.remove(this);this.body.animate({fill:this.background_color,stroke:this.edge.color,"stroke-width":this.edge.width},300)}jMap.fireActionListener(ACTIONS.ACTION_NODE_UNSELECTED,this)};jNode.prototype.screenFocus=function(){var a=jMap.work;a.scrollLeft=Math.round(this.getLocation().x-a.offsetWidth/2+this.getSize().width/2);a.scrollTop=Math.round(this.getLocation().y-a.offsetHeight/2+this.getSize().height/2)};jNode.prototype.setNote=function(a){this.note=a};jNode.prototype.setFolding=function(g){if(!jMap.saveAction.isAlive()){return null}var b=(this.numofchildren>0||this.getChildren().length>0);if(!b||this.isRootNode()){return}var f=jMap.historyManager;var a=f&&f.extractNode(this);this.setFoldingExecute(g);var c=f&&f.extractNode(this);f&&f.addToHistory(a,c);jMap.saveAction.editAction(this);jMap.setSaved(false)};jNode.prototype.setFoldingExecute=function(b){var a=(this.numofchildren>0||this.getChildren().length>0);if(!a||this.isRootNode()){return}jMap.fireActionListener(ACTIONS.ACTION_NODE_FOLDING,this);this.numofchildren=this.getChildren().length;if(this.numofchildren>0){if(b){this.hideChildren(this);this.folderShape&&this.folderShape.show();this.folded=true}else{this.showChildren(this);this.folderShape&&this.folderShape.hide();this.folded=false}}jMap.resolveRendering()};jNode.prototype.setFoldingAll=function(f){this.__FoldingAll(f,this);if(this.isRootNode()){var c=this.getChildren();var a=c.length;for(var b=0;b<a;b++){c[b].setFoldingExecute(f)}}else{this.setFoldingExecute(f)}};jNode.prototype.__FoldingAll=function(g,f){if(!f.getChildren().isEmpty()&&!f.isRootNode()){f.folded=g}if(f.getChildren().length>0){var c=f.getChildren();var a=c.length;for(var b=0;b<a;b++){this.__FoldingAll(g,c[b])}}};jNode.prototype.isFoldingHit=function(c){var g=false;switch(jMap.layoutManager.type){case"jMindMapLayout":var a=(c.offsetX)?c.offsetX:c.layerX-this.getLocation().x;g=(this.isLeft())?(a<PERCEIVE_WIDTH):(a>this.body.getBBox().width-PERCEIVE_WIDTH);break;case"jTreeLayout":var f=(c.offsetY)?c.offsetY:c.layerY-this.getLocation().y;g=(f>this.body.getBBox().height-PERCEIVE_WIDTH/2);break;case"jHTreeLayout":var f=(c.offsetY)?c.offsetY:c.layerY-this.getLocation().y;g=(f>this.body.getBBox().height-PERCEIVE_WIDTH/2);break;case"jFishboneLayout":var b=jMap.layoutManager.getTransformations(this.groupEl.getAttribute("transform")).rotate;if(b==null){var f=(c.offsetY)?c.offsetY:c.layerY-this.getLocation().y;g=(f>this.body.getBBox().height-PERCEIVE_WIDTH/2)}else{var a=(c.offsetX)?c.offsetX:c.layerX-this.getLocation().x;g=(a>this.body.getBBox().height-PERCEIVE_WIDTH/2)}break;default:}return g};jNode.prototype.hideChildren=function(f){if(f.getChildren().length>0){var c=f.getChildren();var a=c.length;for(var b=0;b<a;b++){this.hideChildren(c[b]);c[b].hide()}}};jNode.prototype.hide=function(){this.body.hide();this.text.hide();this.folderShape&&this.folderShape.hide();this.img&&this.img.hide();this.hyperlink&&this.hyperlink.hide();this.file&&this.file.hide();this.note&&this.note.hide();this.connection&&this.connection.hide();this.moodleIcon&&this.moodleIcon.hide();this.score.hide();if(this.foreignObjEl&&this.foreignObjEl.style){this.foreignObjEl.style.display="none"}for(var a=0;a<this.arrowlinks.length;a++){this.arrowlinks[a].hide()}var b=jMap.getArrowLinks(this);for(var a=0;a<b.length;a++){if(b[a]!=undefined){b[a].text.hide();b[a].hide()}}this.hided=true};jNode.prototype.showChildren=function(c){if(c.numofchildren>0){var b=c.getChildren();for(var a=0;a<b.length;a++){b[a].show();if(!b[a].folded){this.showChildren(b[a])}}}};jNode.prototype.show=function(){this.body.show();this.text.show();this.folded&&this.folderShape.show();this.img&&this.img.show();this.hyperlink&&this.hyperlink.show();this.file&&this.file.show();this.note&&this.note.show();this.connection&&this.connection.show();this.moodleIcon&&this.moodleIcon.show();this.score.show();if(this.foreignObjEl&&this.foreignObjEl.style){this.foreignObjEl.style.display="block"}var b=jMap.getArrowLinks(this);for(var a=0;a<b.length;a++){if(b[a]!=undefined){b[a].text.show();b[a].show()}}this.hided=false};jNode.prototype.hadChildren=function(c){if(this.getChildren().length>0){var b=this.getChildren();for(var a=0;a<b.length;a++){if(c==b[a]){return true}if(b[a].hadChildren(c)){return true}}}return false};jNode.prototype.remove=function(c){if(!jMap.saveAction.isAlive()){return null}if(this.removed){return false}if(!c&&this.isRootNode()){return false}if(this.attributes&&(this.attributes.moodleModule||this.attributes.moodleCourseSection)&&!confirm("This node is connected to Moodle. This action will also delete the Moodle activity. Are you sure you want to continue?")){return null}saveMap(true,true);jMap.saveAction.deleteAction(this);var f=jMap.historyManager;var a=f&&f.extractNode(this,true);this.removeExecute(c);var b=null;f&&f.addToHistory(a,b);jMap.fireActionListener(ACTIONS.ACTION_NODE_REMOVE,this);jMap.setSaved(false)};jNode.prototype.removeExecute=function(f){if(this.removed){return false}if(!f&&this.isRootNode()){return false}if(!this.getChildren().isEmpty()){var b=this.getChildren();for(var a=b.length-1;a>=0;a--){b[a].removeExecute()}}jMap.deleteNodeById(this.id);this.connection&&this.connection.remove();while(this.arrowlinks.length!=0){this.removeArrowLink(this.arrowlinks[0])}var c=jMap.getArrowLinks(this);for(var a=0;a<c.length;a++){this.removeArrowLink(c[a])}for(e in this){if(this[e]&&this[e].toString){if(this[e].toString()=="Rapha\xebl\u2019s object"){this[e].remove()}}}this.groupEl.parentNode.removeChild(this.groupEl);this.parent&&this.parent.getChildren().remove(this);this.removed=true;var g=jMap.getSelecteds();if(g.contains(this)){g.remove(this)}this.parent.numofchildren=this.parent.getChildren().length;return true};jNode.prototype.nextSibling=function(g){if(this.isRootNode()){return null}var b=this.getIndexPos();var f=this.getParent().getChildren();var l=f.length-1;if(jMap.layoutManager.type=="jMindMapLayout"){if(this.getParent().isRootNode()){var a=this.position;for(var c=b;c<l;c++){if(f[c+1].position==a){return f[c+1]}}return null}}if(g&&b==l&&this.getParent().nextSibling(g)){var k=this.getParent().nextSibling(g).getChildren();if(k.length>0){return k[0]}}if(b<l){return f[b+1]}return null};jNode.prototype.prevSibling=function(g){if(this.isRootNode()){return null}var b=this.getIndexPos();var f=this.getParent().getChildren();if(jMap.layoutManager.type=="jMindMapLayout"){if(this.getParent().isRootNode()){var a=this.position;for(var c=b;c>0;c--){if(f[c-1].position==a){return f[c-1]}}return null}}if(g&&b==0&&this.getParent().prevSibling(g)){var k=this.getParent().prevSibling(g).getChildren();if(k.length>0){return k[k.length-1]}}if(b>0){return f[b-1]}return null};jNode.prototype.addEventController=function(a){this.controller=a;$(this.groupEl).on("vmousedown",a.mousedown);$(this.groupEl).on("vmousemove",a.mousemove);$(this.groupEl).on("vmouseup",a.mouseup);$(this.groupEl).on("vmouseover",a.mouseover);$(this.groupEl).on("vmouseout",a.mouseout);$(this.groupEl).on("taphold",a.taphold);$(this.groupEl).on("vclick",a.click);$(this.groupEl).on("dragenter",a.dragenter);$(this.groupEl).on("dragleave",a.dragexit);$(this.groupEl).on("drop",a.drop)};jNode.prototype.removeEventController=function(a){this.controller=null};jNode.prototype.toString=function(){return"jNode"};jNode.prototype.getLayoutSize=function(){return this.getSize()};jNode.prototype.initCreate=function(){};jNode.prototype.initElements=function(){};jNode.prototype.create=function(){};jNode.prototype.translate=function(a,b){};jNode.prototype.getSize=function(){};jNode.prototype.setSize=function(b,a){};jNode.prototype.getLocation=function(){};jNode.prototype.setLocation=function(a,b){};jNode.prototype.CalcBodySize=function(){};jNode.prototype.updateNodeShapesPos=function(){};jNode.prototype.getInputPort=function(){};jNode.prototype.getOutputPort=function(){};jNode.prototype.toXML=function(a){};jNode.prototype.setCreator=function(c,a,b){if(b==0){b=Math.floor(new Date().getTime()/1000)}else{b=parseInt(b/1000)}this.userfullname=a;this.userportrait=c;this.created=b};jMindMapNode=function(b,f,g,c,a){this.index=c;this.position=(a)?a:"";this.link="";this.style="";this.created=0;this.modified=0;this.hgap=0;this.vgap=0;this.vshift=0;this.SHIFT=-2;this.relYPos=0;this.treeWidth=0;this.treeHeight=0;this.leftTreeWidth=0;this.rightTreeWidth=0;this.upperChildShift=0;this.px=0;this.py=0;this.changedYPos=true;this.loadingNode=true;this.attributes={};jMindMapNode.superclass.call(this,b,f,g);this.folderShape&&this.folderShape.hide()};extend(jMindMapNode,jNode);jMindMapNode.prototype.type="jMindMapNode";jMindMapNode.prototype.initCreate=function(){if(this.getParent()){if(this.getParent().isRootNode()&&this.position){this.position=this.position}else{if(this.getParent().isRootNode()){var c=this.getParent().getChildren();var f=0;var g=0;var a=c.length;for(var b=0;b<a;b++){(c[b].position=="left")&&f++;(c[b].position=="right")&&g++}if(f<g){this.position="left"}else{this.position="right"}}else{this.position=""}}}};jMindMapNode.prototype.translate=function(a,b){this.body.translate(a,b);this.text.translate(a,b);this.folderShape&&this.folderShape.translate(a,b);this.img&&this.img.translate(a,b);this.hyperlink&&this.hyperlink.translate(a,b);this.file&&this.file.translate(a,b);this.note&&this.note.translate(a,b);this.moodleIcon&&this.moodleIcon.translate(a,b);this.score.translate(a,b);this.connection&&this.connection.updateLine()};jMindMapNode.prototype.relativeCoordinate=function(f,b){if(!jMap.saveAction.isAlive()){return null}var g=jMap.historyManager;var a=g&&g.extractNode(this);this.relativeCoordinateExecute(f,b);var c=g&&g.extractNode(this);g&&g.addToHistory(a,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_COORDMOVED,this,f,b);jMap.setSaved(false)};jMindMapNode.prototype.relativeCoordinateExecute=function(b,a){switch(jMap.layoutManager.type){case"jMindMapLayout":if(this.isLeft()){b=-b}this.hgap=parseInt(this.hgap)+b;this.vshift=parseInt(this.vshift)+a;break;case"jTreeLayout":this.hgap=parseInt(this.hgap)+a;this.vshift=parseInt(this.vshift)+b;break;case"jFishboneLayout":if(this.isLeft()){b=-b}this.hgap=parseInt(this.hgap)+b;this.vshift=parseInt(this.vshift)+a;break;default:this.hgap=parseInt(this.hgap)+a;this.vshift=parseInt(this.vshift)+b;break}if(isNaN(this.hgap)){this.hgap=0}if(isNaN(this.vshift)){this.vshift=0}jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(this);jMap.layoutManager.layout(true)};jMindMapNode.prototype.isLeft=function(){if(jMap.layoutManager.type=="jTableLayout"||jMap.layoutManager.type=="jTreeLayout"||jMap.layoutManager.type=="jHTreeLayout"){return false}if(this.position&&this.position!=""){return(this.position=="left")?true:false}else{if((this.position==null||this.position=="")&&this.parent!=null){return this.parent.isLeft()}else{return false}}};jMindMapNode.prototype.setAttribute=function(c,f){if(!jMap.saveAction.isAlive()){return null}var g=jMap.historyManager;var a=g&&g.extractNode(this);this.setAttributeExecute(c,f);var b=g&&g.extractNode(this);g&&g.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_ATTRS,this);jMap.setSaved(false)};jMindMapNode.prototype.setAttributeExecute=function(a,b){if(b==null||b==""||b==undefined){delete this.attributes[a]}else{this.attributes[a]=b}jMap.resolveRendering()};jMindMapNode.prototype.setFile=function(c){if(!jMap.saveAction.isAlive()){return null}var f=jMap.historyManager;var a=f&&f.extractNode(this);this.setFileExecute(c);var b=f&&f.extractNode(this);f&&f.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_FILE,this);jMap.setSaved(false)};jMindMapNode.prototype.setFileExecute=function(b){if(b==null||b==""){if(this.file){var a=this.file.node.parentNode;var c=this.file.node.parentNode.parentNode;c.removeChild(a);this.file=null;this.CalcBodySize()}return}if(!this.file){this.file=RAPHAEL.image(jMap.cfg.contextPath+"/menu/icons/icon_file.png",0,0,24,24);if(Raphael.svg){this.groupEl.appendChild(this.file.node)}if(Raphael.vml){this.groupEl.appendChild(this.file.Group)}this.file.attr({cursor:"pointer"})}this.file.attr({href:b,target:"blank"});this.CalcBodySize();jMap.resolveRendering()};jMindMapNode.prototype.setNote=function(a){if(!jMap.saveAction.isAlive()){return null}var f=jMap.historyManager;var b=f&&f.extractNode(this);this.setNoteExecute(a);var c=f&&f.extractNode(this);f&&f.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_NOTE,this);jMap.setSaved(false)};jMindMapNode.prototype.setNoteExecute=function(a){if(a==null||a==""){if(this.note){var b=this.note.node.parentNode;var c=this.note.node.parentNode.parentNode;c.removeChild(b);this.note=null;this.noteText=null;this.CalcBodySize()}return}if(!this.note){this.note=RAPHAEL.image(jMap.cfg.contextPath+"/menu/icons/icon_note.png",0,0,24,24);if(Raphael.svg){this.groupEl.appendChild(this.note.node)}if(Raphael.vml){this.groupEl.appendChild(this.note.Group)}this.note.attr({cursor:"pointer"})}this.noteText=a;this.note.attr({href:"javascript:showNoteAction();"});this.CalcBodySize();jMap.resolveRendering()};jMindMapNode.prototype.setHyperlink=function(c){var f=jMap.historyManager;var a=f&&f.extractNode(this);this.setHyperlinkExecute(c);var b=f&&f.extractNode(this);f&&f.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_HYPER,this);jMap.setSaved(false)};jMindMapNode.prototype.setHyperlinkExecute=function(b){if(b==null||b==""){if(this.hyperlink){var a=this.hyperlink.node.parentNode;var c=this.hyperlink.node.parentNode.parentNode;c.removeChild(a);this.hyperlink=null;this.CalcBodySize()}return}if(!this.hyperlink){this.hyperlink=RAPHAEL.image(jMap.cfg.contextPath+"/images/hyperlink.png",0,0,11,11);if(Raphael.svg){this.groupEl.appendChild(this.hyperlink.node)}if(Raphael.vml){this.groupEl.appendChild(this.hyperlink.Group)}this.hyperlink.attr({cursor:"pointer"})}this.hyperlink.attr({href:b,target:"blank"});this.CalcBodySize();jMap.resolveRendering()};jMindMapNode.prototype.setImage=function(c,f,a){if(!jMap.saveAction.isAlive()){return null}var g=jMap.historyManager;var b=g&&g.extractNode(this);this.setImageExecute(c,f,a,function(){var k=g&&g.extractNode(this);g&&g.addToHistory(b,k);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_IMAGE,this.id,c,f,a);jMap.setSaved(false)})};jMindMapNode.prototype.setImageExecute=function(c,g,b,a){if(c==null||c==""){if(this.img){this.img.remove();this.img=null;this.imgInfo={};this.CalcBodySize();a&&a.call(this)}return false}var k=this;var f=$("<img />").attr("src",c).load(function(){var m=jMap.cfg.default_img_size;var l={width:0,height:0};if(this.width>m){l.width=m;l.height=(this.height*m)/this.width}else{l.width=this.width;l.height=this.height}if(g){l.width=g}if(b){l.height=b}l.width=parseInt(l.width);l.height=parseInt(l.height);if(k.img){k.img.attr({src:this.src,width:l.width,height:l.height});k.imgInfo.href=this.src;k.imgInfo.width=l.width;k.imgInfo.height=l.height}else{k.img=RAPHAEL.image(this.src,0,0,l.width,l.height);k.imgInfo.href=this.src;k.imgInfo.width=l.width;k.imgInfo.height=l.height;if(Raphael.svg){k.groupEl.appendChild(k.img.node)}if(Raphael.vml){k.groupEl.appendChild(k.img.Group)}}k.getParent()&&k.getParent().folded&&k.img.hide();k.CalcBodySize();jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();jMap.loadManager.updateImageLoading(this);a&&a.call(k);return true}).error(function(){if(k.img){k.img.attr({src:jMap.cfg.contextPath+"/images/image_broken.png",width:64,height:64});k.imgInfo.href=c;k.imgInfo.width=g&&g;k.imgInfo.height=b&&b}else{k.img=RAPHAEL.image(jMap.cfg.contextPath+"/images/image_broken.png",0,0,64,64);k.imgInfo.href=c;k.imgInfo.width=g&&g;k.imgInfo.height=b&&b;if(Raphael.svg){k.groupEl.appendChild(k.img.node)}if(Raphael.vml){k.groupEl.appendChild(k.img.Group)}}k.getParent()&&k.getParent().folded&&k.img.hide();k.CalcBodySize();jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();jMap.loadManager.updateImageLoading(this);a&&a.call(k)});jMap.loadManager.updateImageLoading(f[0])};jMindMapNode.prototype.setHasMoodleExecute=function(){this.moodleIcon=RAPHAEL.image(jMap.cfg.contextPath+"/menu/icons/moodle2.png",0,0,18,18);if(Raphael.svg){this.groupEl.appendChild(this.moodleIcon.node)}if(Raphael.vml){this.groupEl.appendChild(this.moodleIcon.Group)}};jMindMapNode.prototype.setScoreLisExecute=function(a){};jMindMapNode.prototype.imageResize=function(f,a){if(!jMap.saveAction.isAlive()){return null}var g=jMap.historyManager;var b=g&&g.extractNode(this);this.imageResizeExecute(f,a);var c=g&&g.extractNode(this);g&&g.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_IMAGE,this.id,null,f,a);jMap.setSaved(false)};jMindMapNode.prototype.imageResizeExecute=function(b,a){this.img&&this.img.attr({width:b,height:a});this.imgInfo.width=b;this.imgInfo.height=a;this.CalcBodySize();jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(this);jMap.layoutManager.layout(true)};jMindMapNode.prototype.setForeignObject=function(f,g,a){if(!jMap.saveAction.isAlive()){return null}var k=jMap.historyManager;var b=k&&k.extractNode(this);this.setForeignObjectExecute(f,g,a);var c=k&&k.extractNode(this);k&&k.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_FOREIGNOBJECT,this,f,g,a);jMap.setSaved(false)};jMindMapNode.prototype.setForeignObjectExecute=function(b,c,a){if(!Raphael.svg){return false}if(b==null||b==""){if(this.foreignObjEl){this.groupEl.removeChild(this.foreignObjEl)}this.foreignObjEl=null;this.CalcBodySize();return false}b=convertXML2Char(b);if(!this.foreignObjEl){this.foreignObjEl=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");this.foreignObjEl.bodyEl=document.createElementNS("http://www.w3.org/1999/xhtml","body");this.foreignObjEl.appendChild(this.foreignObjEl.bodyEl);this.groupEl.appendChild(this.foreignObjEl);this.foreignObjEl.setAttribute("x",this.body.getBBox().x);this.foreignObjEl.setAttribute("y",this.body.getBBox().y)}c=c||150;a=a||150;this.foreignObjEl.setAttribute("width",c);this.foreignObjEl.setAttribute("height",a);this.foreignObjEl.bodyEl.innerHTML=b;this.foreignObjEl.plainHtml=b;if(BrowserDetect.browser=="MSIE"){var f=b.search(/youtube\.com/);if(f!=-1){this.foreignObjEl.bodyEl.innerHTML='<img src="'+jMap.cfg.contextPath+'/images/video_not_support.png" width="300" height="300"/>'}}this.CalcBodySize()};jMindMapNode.prototype.foreignObjectResize=function(f,a){if(!jMap.saveAction.isAlive()){return null}var g=jMap.historyManager;var b=g&&g.extractNode(this);this.foreignObjectResizeExecute(f,a);var c=g&&g.extractNode(this);g&&g.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_FOREIGNOBJECT,this,null,f,a);jMap.setSaved(false)};jMindMapNode.prototype.foreignObjectResizeExecute=function(c,a){c&&this.foreignObjEl.setAttribute("width",c);a&&this.foreignObjEl.setAttribute("height",a);var b=this.foreignObjEl.plainHtml;b=b.replace(/(width=")([^"]*)/ig,"$1"+c);b=b.replace(/(height=")([^"]*)/ig,"$1"+a);this.foreignObjEl.bodyEl.innerHTML=b;this.foreignObjEl.plainHtml=b;this.CalcBodySize();jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(this);jMap.layoutManager.layout(true)};jMindMapNode.prototype.fix_flash=function(f){var a=f.getElementsByTagName("embed");var k=a.length;for(i=0;i<k;i++){embed=a[i];var o;if(embed.outerHTML){var m=embed.outerHTML;if(m.match(/wmode\s*=\s*('|")[a-zA-Z]+('|")/i)){o=m.replace(/wmode\s*=\s*('|")window('|")/i,"wmode='transparent'")}else{o=m.replace(/<embed\s/i,"<embed wmode='transparent' ")}embed.insertAdjacentHTML("beforeBegin",o);embed.parentNode.removeChild(embed)}else{o=embed.cloneNode(true);if(!o.getAttribute("wmode")||o.getAttribute("wmode").toLowerCase()=="window"){o.setAttribute("wmode","transparent")}embed.parentNode.replaceChild(o,embed)}}var p=f.getElementsByTagName("object");var b=p.length;for(i=0;i<b;i++){object=p[i];var l;if(object.outerHTML){var m=object.outerHTML;if(m.match(/<param\s+name\s*=\s*('|")wmode('|")\s+value\s*=\s*('|")[a-zA-Z]+('|")\s*\/?\>/i)){l=m.replace(/<param\s+name\s*=\s*('|")wmode('|")\s+value\s*=\s*('|")window('|")\s*\/?\>/i,"<param name='wmode' value='transparent' />")}else{l=m.replace(/<\/object\>/i,"<param name='wmode' value='transparent' />\n</object>")}var c=object.childNodes;for(j=0;j<c.length;j++){try{if(c[j]!=null){var n=c[j].getAttribute("name");if(n!=null&&n.match(/flashvars/i)){l=l.replace(/<param\s+name\s*=\s*('|")flashvars('|")\s+value\s*=\s*('|")[^'"]*('|")\s*\/?\>/i,"<param name='flashvars' value='"+c[j].getAttribute("value")+"' />")}}}catch(g){}}object.insertAdjacentHTML("beforeBegin",l);object.parentNode.removeChild(object)}}};jMindMapNode.prototype.setEmbedVideo=function(f){var g=/width?=?["']([^"']*)/gi;var c=g.exec(f)[1];var b=/height?=?["']([^"']*)/gi;var a=b.exec(f)[1];this.setForeignObject(f,c,a)};jMindMapNode.prototype.setVideo=function(g,c,a){var f=jMap.cfg.default_video_size;var b='<embed src="'+g+'" width="'+c+'"  height="'+a+'"></embed>';this.setForeignObject(b,c,a)};jMindMapNode.prototype.setYoutubeVideo=function(m,k,a){var l=jMap.cfg.default_video_size;if(k==null){k=l}if(a==null){a=l}var g=/v[=\/]([^&]*)/ig;var c=g.exec(m);if(c){var b="https://www.youtube.com/embed/"+c[1];var f='<iframe src="'+b+'" frameborder="0" allowtransparency="true" width="'+k+'"  height="'+a+'" scrolling="no"></iframe>';this.setHyperlink(m);this.setForeignObject(f,k,a)}};jMindMapNode.prototype.getShift=function(){try{if(this.getParent().getChildren().length==0){var a=parseInt(this.vshift)+parseInt(this.SHIFT);if(isNaN(a)){a=0}return a}else{return this.vshift}}catch(b){return 0}};jMindMapNode.prototype.getLeftChildren=function(){var c=this.getChildren();var g=new Array();var b=c.length;for(var a=0;a<b;a++){var f=c[a];if(f==null){continue}if(f.isLeft()){g.push(f)}}return g};jMindMapNode.prototype.getRightChildren=function(){var f=this.getChildren();var c=new Array();var b=f.length;for(var a=0;a<b;a++){var g=f[a];if(g==null){continue}if(!g.isLeft()){c.push(g)}}return c};jMindMapNode.prototype.setRootTreeWidths=function(b,a){this.leftTreeWidth=b-this.getSize().width;this.rightTreeWidth=a;this.setTreeWidth(this.leftTreeWidth+this.rightTreeWidth)};jMindMapNode.prototype.setTreeWidth=function(a){this.treeWidth=a};jMindMapNode.prototype.getTreeWidth=function(){return this.treeWidth};jMindMapNode.prototype.setRootTreeHeights=function(b,a){if(b>a){this.setTreeHeight(b)}else{this.setTreeHeight(a)}};jMindMapNode.prototype.setTreeHeight=function(a){this.treeHeight=a};jMindMapNode.prototype.getTreeHeight=function(){return this.treeHeight};jMindMapNode.prototype.getUpperChildShift=function(){return this.upperChildShift};jMindMapNode.prototype.setRootUpperChildShift=function(b,a){this.setUpperChildShift(Math.max(b,a))};jMindMapNode.prototype.setUpperChildShift=function(a){this.upperChildShift=a};jMindMapNode.prototype.toXML=function(q){var k=new StringBuffer();var m=false;if(this.img!=null||(this.text.attrs.text!=null&&this.text.attrs.text.indexOf("\n")!=-1)){m=true}var g=new StringBuffer();g.add("<node");g.add('CREATED="'+this.created+'"');g.add('ID="'+this.id+'"');g.add('MODIFIED="'+this.modified+'"');g.add('CREATOR="'+this.creator+'"');g.add('CLIENT_ID="'+this.client_id+'"');if(!m){g.add('TEXT="'+convertCharStr2SelectiveCPs(convertCharStr2XML(this.text.attrs.text,true,true),"ascii",true,"&#x",";","hex")+'"')}g.add('FOLDED="'+this.folded+'"');if(this.background_color!=""){g.add('BACKGROUND_COLOR="'+this.background_color+'"')}if(this.color!=""){g.add('COLOR="'+this.color+'"')}if(this.hyperlink!=null){g.add('LINK="'+convertCharStr2XML(this.hyperlink.attr().href)+'"')}if(this.file!=null){g.add('FILE="'+convertCharStr2XML(this.file.attr().href)+'"')}if(this.noteText!=null){g.add('NOTE="'+convertCharStr2XML(this.noteText)+'"')}if(this.position!=""&&this.position!="undefined"){g.add('POSITION="'+this.position+'"')}if(this.style!=""){g.add('STYLE="'+this.style+'"')}if(this.hgap!=0){g.add('HGAP="'+this.hgap+'"')}if(this.vgap!=0){g.add('VGAP="'+this.vgap+'"')}if(this.vshift!=0){g.add('VSHIFT="'+this.vshift+'"')}if(this.numofchildren!=null){g.add('NUMOFCHILDREN="'+this.numofchildren+'"')}if(this.userNo!=null){g.add('USERNO="'+this.userNo+'"')}if(this.userfullname!=null){g.add('USERFULLNAME="'+this.userfullname+'"')}if(this.userportrait!=null){g.add('USERPORTRAIT="'+this.userportrait+'"')}g.add(">");k.add(g.toString(" "));var u=this.getFontSize();if(u!=null){k.add('<font size="'+this.getFontSize()+'"/>')}if(this.edge){k.add('<edge color="'+this.edge.color+'" width="'+this.edge.width+'"/>')}if(this.branch){if(!this.branch.style){if(this.connection!=null){this.branch.style=this.connection.type}else{this.branch.style=""}}k.add('<branch color="'+this.branch.color+'" width="'+this.branch.width+'" style="'+this.branch.style+'" />')}if(m){var a=new StringBuffer();a.add('<richcontent TYPE="NODE"><html>\n');a.add("  <head>\n");a.add("\n");a.add("  </head>\n");a.add("  <body>\n");if(this.img!=null){a.add("    <p>\n");a.add('      <img src="'+this.imgInfo.href+'" width="'+this.imgInfo.width+'" height="'+this.imgInfo.height+'" />\n');a.add("    </p>\n")}if(this.text.attrs.text!=null){var o=JinoUtil.trimStr(this.text.attrs.text).split("\n");var n=o.length;for(var l=0;l<n;l++){a.add("<p>"+convertCharStr2SelectiveCPs(convertCharStr2XML(o[l],true,true),"ascii",true,"&#x",";","hex")+"</p>\n")}}a.add("  </body>\n");a.add("</html>\n");a.add("</richcontent>");k.add(a.toString(" "))}if(this.arrowlinks.length>0){var p=this.arrowlinks.length;for(var l=0;l<p;l++){k.add(this.arrowlinks[l].toXML())}}if(this.foreignObjEl){var b=new StringBuffer();b.add('<foreignObject WIDTH="'+this.foreignObjEl.getAttribute("width")+'" HEIGHT="'+this.foreignObjEl.getAttribute("height")+'">');var s=this.foreignObjEl.plainHtml;s=s.split('class="lazy-load"').join("");s=s.replace(" data-src="," src=");b.add(convertCharStr2SelectiveCPs(s,"ascii",true,"&#x",";","hex"));b.add("</foreignObject>");k.add(b.toString(" "))}for(var t in this.attributes){k.add("<attribute NAME='"+t+"' VALUE='"+convertCharStr2SelectiveCPs(convertCharStr2XML(""+this.attributes[t],true,true),"ascii",true,"&#x",";","hex")+"'/>")}var c=new StringBuffer();c.add("<info");if(this.lazycomplete){c.add('LAZYCOMPLETE="'+this.lazycomplete+'"')}c.add("/>");k.add(c.toString(" "));var f=this.getChildren();if(f.length>0&&q==null){var r=f.length;for(var l=0;l<r;l++){k.add(f[l].toXML())}}k.add("</node>");return k.toString("\n")};jMindMapNode.prototype.toString=function(){return"jMindMapNode"};jMindMapNode.prototype.initElements=function(){};jMindMapNode.prototype.create=function(){};jMindMapNode.prototype.getSize=function(){};jMindMapNode.prototype.setSize=function(b,a){};jMindMapNode.prototype.getLocation=function(){};jMindMapNode.prototype.setLocation=function(a,b){};jMindMapNode.prototype.CalcBodySize=function(){};jMindMapNode.prototype.updateNodeShapesPos=function(){};jMindMapNode.prototype.getInputPort=function(){};jMindMapNode.prototype.getOutputPort=function(){};jNode.prototype.setCreator=function(c,a,b){};if(jQuery){jQuery.fn.onPositionChanged=function(a){var g=$(this[0]);if(g.length<1){return g}var f=null;var c=null;var b=function(){if(g==null||g.length<1){return g}if(f==null){f=g.position()}if(c==null){c=g.offset()}var l=g.position();var k=g.offset();if(f.top!=l.top||f.left!=l.left){$(this).trigger("onPositionChanged",{lastPos:f,newPos:l});if(typeof(a)=="function"){a(f,l)}f=g.position()}if(c.top!=k.top||c.left!=k.left){$(this).trigger("onOffsetChanged",{lastOff:c,newOff:k});if(typeof(a)=="function"){a(c,k)}c=g.offset()}window.requestAnimationFrame(b)};window.requestAnimationFrame(b);return g}}jRect=function(g){var b=g.parent;var f=g.text;var k=g.id;var c=g.index;var a=g.position;jRect.superclass.call(this,b,f,k,c,a)};extend(jRect,jMindMapNode);jRect.prototype.type="jRect";jRect.prototype.initElements=function(){this.body=RAPHAEL.rect();this.text=RAPHAEL.text();this.folderShape=RAPHAEL.circle(0,0,FOLDER_RADIUS);this.wrapElements(this.body,this.text,this.folderShape)};jRect.prototype.create=function(){var style=null;switch(jMap.layoutManager.type){case"jMindMapLayout":if(this.parent&&!this.parent.isRootNode()){style=this.parent.branch.style}if(style==null||style==undefined){style="jLineBezier"}break;case"jTreeLayout":style="jLinePolygonal";break;case"jHTreeLayout":style="jLinePolygonal2";break;case"jTableLayout":break;case"jFishboneLayout":break;default:style="jLineBezier";break}this.connection=null;if(style!=null&&style!=undefined){var jsCode="this.connection = this.parent && new "+style+"(this.parent, this)";eval(jsCode)}var body=this.body;var text=this.text;var folderShape=this.folderShape;body.attr({r:NODE_CORNER_ROUND,rx:NODE_CORNER_ROUND,ry:NODE_CORNER_ROUND});if(this.getParent()){var pl=this.getParent().getLocation();this.setLocation(pl.x,pl.y)}this.setBackgroundColorExecute(jMap.cfg.nodeDefalutColor);this.setTextColorExecute(jMap.cfg.textDefalutColor);this.setEdgeColorExecute(jMap.cfg.edgeDefalutColor,jMap.cfg.edgeDefalutWidth);var branchWidth=jMap.cfg.branchDefalutWidth;if(this.getDepth()==1){branchWidth=8}this.setBranchExecute(jMap.cfg.branchDefalutColor,branchWidth,null);if(typeof NodeColorMix!=="undefined"){NodeColorMix.rawDressColor(this)}var fontWeight=400;var fontFamily="Malgun Gothic, 맑은고딕, Gulim, 굴림, Arial, sans-serif";if(!this.getParent()){this.fontSize=jMap.cfg.nodeFontSizes[0];fontWeight="700"}else{if(this.getParent()&&this.getParent().isRootNode()){this.fontSize=jMap.cfg.nodeFontSizes[1];fontWeight="700"}else{this.fontSize=jMap.cfg.nodeFontSizes[2];fontWeight="400"}}if(this.isRootNode()){text.attr({"font-family":fontFamily,"font-size":this.fontSize,"font-weight":fontWeight});text.attr({font:this.fontSize+"px "+fontFamily})}else{text.attr({"font-family":fontFamily,"font-size":this.fontSize,"font-weight":fontWeight,"text-anchor":"start"});text.attr({font:this.fontSize+"px "+fontFamily})}this.setTextExecute(this.plainText)};jRect.prototype.getSize=function(){return{width:this.body.getBBox().width,height:this.body.getBBox().height}};jRect.prototype.setSize=function(b,a){this.body.attr({width:b,height:a})};jRect.prototype.getLayoutSize=function(){var a=this.getSize();return a};jRect.prototype.getLocation=function(){return{x:this.body.getBBox().x,y:this.body.getBBox().y}};jRect.prototype.setLocation=function(b,c){var a=this.body;if(b&&!c){a.attr({x:b})}else{if(!b&&c){a.attr({y:c})}else{a.attr({x:b,y:c})}}this.updateNodeShapesPos()};jRect.prototype.CalcBodySize=function(){if(jMap.getNodeById(this.id)==undefined||this.text.getBBox()==undefined){return true}this.updateNodeShapesPos();var g=0;var a=0;var b=TEXT_HGAP;var f=TEXT_VGAP;if(this.getText()!=""){g+=this.text.getBBox().width;a+=this.text.getBBox().height}if(this.img){g=(g<this.img.getBBox().width)?this.img.getBBox().width:g;a+=this.img.getBBox().height}if(this.foreignObjEl){var c=parseInt(this.foreignObjEl.getAttribute("width"));var k=parseInt(this.foreignObjEl.getAttribute("height"));g=(g<c)?c:g;a+=k}if(this.hyperlink){g+=this.hyperlink.getBBox().width+b/2}if(this.file){g+=this.file.getBBox().width+b/2}if(this.note){g+=this.note.getBBox().width+b/2}if(g==0||a==0){this.text.attr({text:"_"});g+=this.text.getBBox().width;a+=this.text.getBBox().height;this.text.attr({text:""})}if(g<parseInt(jMap.cfg.default_node_size)){g=parseInt(jMap.cfg.default_node_size)}this.setSize(g+b,a+f);this.updateNodeShapesPos()};jRect.prototype.updateNodeShapesPos=function(){if(jMap.getNodeById(this.id)==undefined){return true}var o=TEXT_HGAP;var t=TEXT_VGAP;var p=0;var s=this.body;var z=this.text;var k=this.folderShape;var L=this.img;var l=this.hyperlink;var c=this.note;var H=this.file;var g=this.foreignObjEl;var B=this.moodleIcon;var E=this.score;if(s.getBBox()==undefined){return true}var r=s.getBBox().x;var q=s.getBBox().y;var f=0;var b=0;switch(jMap.layoutManager.type){case"jMindMapLayout":if(this.parent&&!this.parent.isRootNode()&&this.position!=this.parent.position){this.position=this.parent.position}f=this.isLeft()?r:r+s.getBBox().width;b=q+s.getBBox().height/2;break;case"jTreeLayout":f=r+s.getBBox().width/2;b=q+s.getBBox().height;break;case"jHTreeLayout":f=r+s.getBBox().width/2;b=q+s.getBBox().height;break;case"jFishboneLayout":f=this.isLeft()?r:r+s.getBBox().width;b=q+s.getBBox().height/2;break;default:f=r;b=q;break}this.folderShape.attr({cx:f,cy:b});if(L){var F=r+o/2;var D=q+t/2;if(this.isRootNode()){F+=(s.getBBox().width/2)-(L.getBBox().width/2)-o/2}L.attr({x:F,y:D});p+=L.getBBox().height}if(g){var w=r+o/2;var u=q+p+t/2;p+=parseInt(g.getAttribute("height"));g.setAttribute("x",w);g.setAttribute("y",u)}if(z){var n=r+o/2;var m=q+(t+z.getBBox().height)/2;if(this.isRootNode()){n+=s.getBBox().width/2-o/2}m+=p;z.attr({x:n,y:m})}var a=this.getLocation().x+this.getSize().width;if(c){a=a-c.getBBox().width-3;var G=this.getLocation().y+(this.getSize().height-c.getBBox().height)/2;c&&c.attr({x:a,y:G})}if(H){a=a-H.getBBox().width-3;var K=this.getLocation().y+(this.getSize().height-H.getBBox().height)/2;H&&H.attr({x:a,y:K})}if(l){a=a-l.getBBox().width-3;var C=this.getLocation().y+(this.getSize().height-l.getBBox().height)/2;l&&l.attr({x:a,y:C})}if(B){var J=this.getLocation().x-6;var I=this.getLocation().y-12;B&&B.attr({x:J,y:I})}if(E){var v=this.getLocation().y+10;v+=this.getSize().height;if(this.isLeft()){var A=this.getLocation().x;E&&E.attr({x:A-20,y:v});E&&this.procOne.attr({x:A,y:v-5});E&&this.procTwo.attr({x:A,y:v-5})}else{var A=this.getLocation().x;E&&E.attr({x:A+this.getSize().width+20,y:v});E&&this.procOne.attr({x:A,y:v-5});E&&this.procTwo.attr({x:A,y:v-5})}}this.connection&&this.connection.updateLine()};jRect.prototype.getInputPort=function(){var a=this.body.getBBox();var b=0;var c=0;if(isFinite(a.width)&&!isNaN(a.width)){b=a.width}if(isFinite(a.height)&&!isNaN(a.height)){c=a.height}switch(jMap.layoutManager.type){case"jMindMapLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft&&this.isLeft()){return{x:a.x+b+1,y:a.y+c/2}}else{return{x:a.x-1,y:a.y+c/2}}break;case"jTreeLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c}}return{x:a.x+b/2,y:a.y};break;case"jHTreeLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c}}return{x:a.x,y:a.y+c/2};break;case"jRotateLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft&&this.isLeft()){return{x:a.x-1,y:a.y+c/2}}else{return{x:a.x-1,y:a.y+c/2}}break;case"jTableLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c}}return{x:a.x+b/2,y:a.y};break;case"jFishboneLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft&&this.isLeft()){return{x:a.x+b+1,y:a.y+c/2}}else{return{x:a.x-1,y:a.y+c/2}}break;default:return{x:a.x,y:a.y};break}};jRect.prototype.getOutputPort=function(){var a=this.body.getBBox();var b=0;var c=0;if(isFinite(a.width)&&!isNaN(a.width)){b=a.width}if(isFinite(a.height)&&!isNaN(a.height)){c=a.height}switch(jMap.layoutManager.type){case"jMindMapLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft()){return{x:a.x-1,y:a.y+c/2}}else{return{x:a.x+b+1,y:a.y+c/2}}break;case"jTreeLayout":return{x:a.x+b/2,y:a.y+c};break;case"jHTreeLayout":return{x:a.x+b/2,y:a.y+c};break;case"jRotateLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft&&this.isLeft()){return{x:a.x+b+1,y:a.y+c/2}}else{return{x:a.x+b+1,y:a.y+c/2}}break;case"jTableLayout":return{x:a.x+b/2,y:a.y+c};break;case"jFishboneLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft()){return{x:a.x-1,y:a.y+c/2}}else{return{x:a.x+b+1,y:a.y+c/2}}break;default:return{x:a.x,y:a.y};break}};jRect.prototype.toString=function(){return"jRect"};jRect.prototype.setForeignObjectExecute=function(g,a,o){if(!Raphael.svg){return false}if(g==null||g==""){if(this.foreignObjEl&&this.foreignObjEl.iframeEl){this.foreignObjEl.iframeEl.remove();delete this.foreignObjEl.iframeEl}if(this.foreignObjEl){this.groupEl.removeChild(this.foreignObjEl)}this.foreignObjEl=null;this.CalcBodySize();return false}g=convertXML2Char(g);if(!this.foreignObjEl){var k=document;this.foreignObjEl=k.createElementNS("http://www.w3.org/2000/svg","foreignObject");this.foreignObjEl.bodyEl=k.createElementNS("http://www.w3.org/1999/xhtml","body");this.foreignObjEl.appendChild(this.foreignObjEl.bodyEl);this.groupEl.appendChild(this.foreignObjEl);this.foreignObjEl.setAttribute("x",this.body.getBBox().x);this.foreignObjEl.setAttribute("y",this.body.getBBox().y)}a=a||150;o=o||150;this.foreignObjEl.setAttribute("width",a);this.foreignObjEl.setAttribute("height",o);var f=(g||"").indexOf("<iframe")>=0;if(this.foreignObjEl.iframeEl){if(f){this.foreignObjEl.bodyEl.innerHTML="";this.foreignObjEl.iframeEl=$('<div class="jRect-foreignObjEl jRect-'+this.id+'" style="position: absolute;z-index: 0;outline: none; margin-left: 5px; margin-top: 5px; transform-origin: top left;"></div>').appendTo("body")}else{this.foreignObjEl.iframeEl.remove();delete this.foreignObjEl.iframeEl}}var b=this;var c=false;var n=function(){if(!b.foreignObjEl||!b.foreignObjEl.iframeEl){return true}var r=$(b.body.node).offset();var q=0;if(b.img!=null){q=jMap.cfg.scale*b.img.getBBox().height}var p=b.foreignObjEl.iframeEl;$(p).css("top",r.top+q);$(p).css("left",r.left);$(p).css("margin-left",5*jMap.cfg.scale);$(p).css("margin-top",5*jMap.cfg.scale);$(p).css("transform","scale("+jMap.cfg.scale+")");$(p).css("-webkit-transform","scale("+jMap.cfg.scale+")");$(p).css("-ms-transform","scale("+jMap.cfg.scale+")");$(p).css("-moz-transform","scale("+jMap.cfg.scale+")")};if(f){var m=this.foreignObjEl.iframeEl;$(m).html(g);$(m).css("width",a);$(m).css("height",o);setTimeout(function(){n()});$(window).on("load",n);$(this.groupEl).onPositionChanged(n)}else{this.foreignObjEl.bodyEl.innerHTML=g}this.foreignObjEl.bodyEl.innerHTML=g;this.foreignObjEl.plainHtml=g;if(BrowserDetect.browser=="MSIE"){var l=g.search(/youtube\.com/);if(l!=-1){this.foreignObjEl.bodyEl.innerHTML='<img src="'+jMap.cfg.contextPath+'/images/video_not_support.png" width="300" height="300"/>'}}this.CalcBodySize()};jRect.prototype.foreignObjectResizeExecute=function(f,a){if(!this.foreignObjEl){return}f&&this.foreignObjEl.setAttribute("width",f);a&&this.foreignObjEl.setAttribute("height",a);var b=this.foreignObjEl.plainHtml;b=b.replace(/(width=")([^"]*)/ig,"$1"+f);b=b.replace(/(height=")([^"]*)/ig,"$1"+a);if(this.foreignObjEl.iframeEl){var c=this.foreignObjEl.iframeEl;$(c).html(b);$(c).css("width",f);$(c).css("height",a)}else{this.foreignObjEl.bodyEl.innerHTML=b}this.foreignObjEl.plainHtml=b;this.CalcBodySize();jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(this);jMap.layoutManager.layout(true)};jRect.prototype.removeExecute=function(k){if(this.removed){return false}if(!k&&this.isRootNode()){return false}if(!this.getChildren().isEmpty()){var c=this.getChildren();var g=c.length-1;for(var b=g;b>=0;b--){c[b].removeExecute()}}if(this.foreignObjEl&&this.foreignObjEl.iframeEl){this.foreignObjEl.iframeEl.remove()}jMap.deleteNodeById(this.id);this.connection&&this.connection.remove();while(this.arrowlinks.length!=0){this.removeArrowLink(this.arrowlinks[0])}var f=jMap.getArrowLinks(this);var a=f.length;for(var b=0;b<a;b++){this.removeArrowLink(f[b])}for(e in this){if(this[e]&&this[e].toString){if(this[e].toString()=="Rapha\xebl\u2019s object"){this[e].remove()}}}this.groupEl.parentNode.removeChild(this.groupEl);this.parent&&this.parent.getChildren().remove(this);this.removed=true;this.parent.numofchildren=this.parent.getChildren().length;return true};jRect.prototype.setDHTEmitter=function(a){if(jMap.cfg.realtimeSave){var g=jMap.saveAction.isAlive();if(!g){return null}}var k=jMap.historyManager;var b=k&&k.extractNode(this);var f=this;f.attributes.iot=encodeURI(JSON.stringify(a));this.setDHTEmitterExecute(a);var c=k&&k.extractNode(this);k&&k.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_ATTRS,this);jMap.setSaved(false)};jRect.prototype.setDHTEmitterExecute=function(l){var a=l.id;var f=this;var b=200;var m=80;var n=0;var k=0;var c=function(q,r,o){if(!jMap.getNodeById(f.id)||jMap.getNodeById(f.id).attributes.iot==undefined){mindmapIO.removeListener(a);return true}n=q;k=r;var p='<svg style="width: 200px; background-color: white;" id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 80"><path d="M22.84,61.26a3,3,0,1,1-3-2.92A3,3,0,0,1,22.84,61.26Zm1.52-3.86a5.71,5.71,0,0,1,1.52,3.86,6,6,0,0,1-6.08,5.85h0a6,6,0,0,1-6-5.88,5.68,5.68,0,0,1,1.51-3.83V48.1a4.56,4.56,0,0,1,9.12,0Zm-.76,3.86a4.2,4.2,0,0,0-1.52-3V48.1a2.28,2.28,0,0,0-4.56,0V58.22a4.23,4.23,0,0,0-1.52,3,3.75,3.75,0,0,0,3.77,3.68h0A3.73,3.73,0,0,0,23.6,61.26Z" fill="#727374"/><circle cx="9.19" cy="6.57" r="3.98" fill="'+(o?"#6EC5A4":"#F26D6D")+'"/><text transform="translate(31.19 67.11)" font-size="40" fill="#333" font-family="ArialMT, Arial">'+n+'</text><text transform="translate(75.68 51.12) scale(0.58)" font-size="30" fill="#333" font-family="ArialMT, Arial">°C</text><text transform="translate(20.62 25.39)" font-size="11" fill="#727373" font-family="ArialMT, Arial"><tspan x="5.5" y="0">Temperature</tspan></text><text transform="translate(15.53 9.55)" font-size="8" fill="'+(o?"#6EC5A4":"#F26D6D")+'" font-family="ArialMT, Arial">'+(o?"Online":"Offline")+'</text><text transform="translate(131.26 66.77)" font-size="40" fill="#333" font-family="ArialMT, Arial">'+k+'</text><text transform="translate(175.75 50.78) scale(0.58)" font-size="30" fill="#333" font-family="ArialMT, Arial">%</text><text transform="translate(130.18 25.05)" font-size="11" fill="#727373" font-family="ArialMT, Arial">Humidity</text><path d="M127.37,55.26c0-2.1-3-5.6-3.65-6.28a.8.8,0,0,0-1.12,0l0,0a25.81,25.81,0,0,0-2.85,3.88c-.49-.61-.88-1-1-1.19a.78.78,0,0,0-1.11,0l0,0a39.14,39.14,0,0,0-2.91,3.75c-.35-.6-.69-1.1-.88-1.37a.76.76,0,0,0-1.06-.19.73.73,0,0,0-.2.19c-.46.7-2,3.07-2,4.28A2.69,2.69,0,0,0,112.91,61a5.37,5.37,0,0,0,10.62-1.16,2.53,2.53,0,0,0,0-.38A4.22,4.22,0,0,0,127.37,55.26Zm-14.21,4.22A1.15,1.15,0,0,1,112,58.33a8,8,0,0,1,1.15-2.43,7.85,7.85,0,0,1,1.16,2.43A1.15,1.15,0,0,1,113.16,59.48Zm5,4.22a3.86,3.86,0,0,1-3.74-3,2.68,2.68,0,0,0,1.44-2.38,3.6,3.6,0,0,0-.32-1.25,1.16,1.16,0,0,1,.2-.47,34.66,34.66,0,0,1,2.42-3.25c1.69,2,3.84,5,3.84,6.5A3.84,3.84,0,0,1,118.15,63.7Zm5-5.75h-.1a19.19,19.19,0,0,0-2.27-3.76.75.75,0,0,1,.06-.13,19.42,19.42,0,0,1,2.31-3.38c1.25,1.54,2.68,3.62,2.68,4.58A2.69,2.69,0,0,1,123.15,58Z" fill="#727374"/><path d="M125.13,54.38l0-.05-.2-.41a.39.39,0,0,0-.53-.12.37.37,0,0,0-.14.49c.06.12.12.24.17.36a.38.38,0,0,0,.5.22A.37.37,0,0,0,125.13,54.38Z" fill="#727374"/><path d="M124.42,53.12c-.32-.47-.66-.9-.89-1.18a.38.38,0,0,0-.53-.08.4.4,0,0,0-.09.54l0,0c.22.27.54.68.84,1.12a.38.38,0,0,0,.53.11A.4.4,0,0,0,124.42,53.12Z" fill="#727374"/><path d="M119.29,62.33a.39.39,0,0,0-.48-.26,2.07,2.07,0,0,1-.66.1.38.38,0,0,0-.38.38.39.39,0,0,0,.38.39,3.23,3.23,0,0,0,.88-.13A.38.38,0,0,0,119.29,62.33Z" fill="#727374"/><path d="M121.11,59a.38.38,0,1,0-.73.22,2.32,2.32,0,0,1-.56,2.27.38.38,0,0,0,0,.54.36.36,0,0,0,.25.11.38.38,0,0,0,.28-.12A3.06,3.06,0,0,0,121.11,59Z" fill="#727374"/></svg>';f.setForeignObjectExecute(p,b,m)};if(a==null||a==""){f.setForeignObjectExecute(null);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(f);jMap.layoutManager.layout(true)}else{var g=false;if(mindmapIO){g=mindmapIO.connected;mindmapIO.on(a,function(o){c(o.t,o.h,true)});mindmapIO.on("disconnect",function(){c(n,k,false)})}c(n,k,g);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(f);jMap.layoutManager.layout(true)}};jRect.prototype.setCameraEmitter=function(a){if(jMap.cfg.realtimeSave){var g=jMap.saveAction.isAlive();if(!g){return null}}var k=jMap.historyManager;var b=k&&k.extractNode(this);var f=this;f.attributes.iot=encodeURI(JSON.stringify(a));this.setCameraEmitterExecute(a);var c=k&&k.extractNode(this);k&&k.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_ATTRS,this);jMap.setSaved(false)};jRect.prototype.setCameraEmitterExecute=function(b){var g=this;var f=320;var a=240;var c='<iframe src="'+b.url+'" frameborder="0" allowtransparency="true" width="'+f+'"  height="'+a+'" scrolling="no"></iframe>';g.setHyperlink(b.url);g.setForeignObject(c,f,a);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(g);jMap.layoutManager.layout(true)};jRect.prototype.setSwitchListener=function(a){if(jMap.cfg.realtimeSave){var g=jMap.saveAction.isAlive();if(!g){return null}}var k=jMap.historyManager;var b=k&&k.extractNode(this);var f=this;f.attributes.iot=encodeURI(JSON.stringify(a));this.setSwitchListenerExecute(a,null);var c=k&&k.extractNode(this);k&&k.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_ATTRS,this);jMap.setSaved(false)};jRect.prototype.setSwitchListenerExecute=function(b,c,m){m=m||b.id;var k=this;var g=100;var a=80;var l=function(p){var n="<svg onclick=\"jMap.getSelected().setSwitchListenerExecute(null, true, '"+m+'\')" style="width: 100px;" id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 80"><title>switch-off</title><path d="M69.83,18.31H30.17a23.44,23.44,0,0,0,0,46.88H69.83a23.44,23.44,0,0,0,0-46.88Z" fill="#cfd8dc"/><circle cx="30.6" cy="41.75" r="15.88" fill="#ef4438"/><path d="M55.29,50.57A5.29,5.29,0,0,1,50,45.28V38.22a5.29,5.29,0,0,1,10.58,0v7.06A5.29,5.29,0,0,1,55.29,50.57Zm0-14.11a1.76,1.76,0,0,0-1.76,1.76v7.06a1.77,1.77,0,0,0,3.53,0V38.22A1.76,1.76,0,0,0,55.29,36.46Z" fill="#455b64"/><path d="M65.88,50.57a1.77,1.77,0,0,1-1.77-1.77V34.69a1.76,1.76,0,0,1,1.77-1.76h5.29a1.77,1.77,0,0,1,0,3.53H67.64V48.81A1.76,1.76,0,0,1,65.88,50.57Z" fill="#455b64"/><path d="M69.4,43.51H65.88a1.77,1.77,0,1,1,0-3.53H69.4a1.77,1.77,0,1,1,0,3.53Z" fill="#455b64"/><path d="M76.46,50.57A1.76,1.76,0,0,1,74.7,48.8V34.69a1.76,1.76,0,0,1,1.76-1.76h5.29a1.77,1.77,0,1,1,0,3.53H78.22V48.81A1.76,1.76,0,0,1,76.46,50.57Z" fill="#455b64"/><path d="M80,43.51H76.46a1.77,1.77,0,0,1,0-3.53H80a1.77,1.77,0,0,1,0,3.53Z" fill="#455b64"/></svg>';var o="<svg onclick=\"jMap.getSelected().setSwitchListenerExecute(null, false, '"+m+'\')" style="width: 100px;" id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 80"><title>switch-on</title><path d="M69.83,18.31H30.17a23.44,23.44,0,0,0,0,46.88H69.83a23.44,23.44,0,0,0,0-46.88Z" fill="#cfd8dc"/><circle cx="69.83" cy="41.75" r="16.23" fill="#4daf4e"/><path d="M26.56,50.76a5.41,5.41,0,0,1-5.41-5.41V38.14a5.41,5.41,0,0,1,10.82,0v7.21A5.41,5.41,0,0,1,26.56,50.76Zm0-14.42a1.81,1.81,0,0,0-1.8,1.8v7.21a1.8,1.8,0,1,0,3.6,0V38.14A1.8,1.8,0,0,0,26.56,36.34Z" fill="#455b64"/><path d="M44.59,50.76a1.79,1.79,0,0,1-1.61-1l-3.8-7.6V49a1.8,1.8,0,1,1-3.6,0V34.54A1.81,1.81,0,0,1,37,32.78a1.79,1.79,0,0,1,2,.95l3.8,7.59V34.54a1.8,1.8,0,1,1,3.6,0V49A1.79,1.79,0,0,1,45,50.71,1.51,1.51,0,0,1,44.59,50.76Z" fill="#455b64"/></svg>';k.setForeignObjectExecute(p==true?o:n,g,a)};var f=function(o){var q=jMap.getNodeById(k.id);if(q&&q.attributes.iot){var p=JSON.parse(decodeURI(q.attributes.iot));p.status=o;q.attributes.iot=encodeURI(JSON.stringify(p));parent.jMap.saveAction.editAction(q);parent.jMap.setSaved(false)}};if(m==null||m==""){k.setForeignObjectExecute(null);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(k);jMap.layoutManager.layout(true)}else{switch(c){case true:l(true);$.get(jMap.cfg.contextPath+"/iot/ctrl.do",{id:m,params:encodeURI(JSON.stringify(1))},function(n){f(true)});break;case false:l(false);$.get(jMap.cfg.contextPath+"/iot/ctrl.do",{id:m,params:encodeURI(JSON.stringify(0))},function(n){f(false)});break;default:if(mindmapIO){mindmapIO.on(m,function(n){if(!jMap.getNodeById(k.id)||jMap.getNodeById(k.id).attributes.iot==undefined){mindmapIO.removeListener(m);return true}else{l(n==1)}})}l(b.status);jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(k);jMap.layoutManager.layout(true);break}}};jEllipse=function(b,f,g,c,a){jEllipse.superclass.call(this,b,f,g,c,a)};extend(jEllipse,jMindMapNode);jEllipse.prototype.type="jEllipse";jEllipse.prototype.initElements=function(){this.body=RAPHAEL.ellipse();this.text=RAPHAEL.text();this.folderShape=RAPHAEL.circle(0,0,FOLDER_RADIUS);this.wrapElements(this.body,this.text,this.folderShape)};jEllipse.prototype.create=function(){this.connection=this.parent&&new jLineBezier(this.parent,this);var b=this.body;var k=this.text;var g=this.folderShape;this.setBackgroundColorExecute(jMap.cfg.nodeDefalutColor);this.setEdgeColorExecute(jMap.cfg.edgeDefalutColor,1);var c=400;var a="Malgun Gothic, 맑은고딕, Gulim, 굴림, Arial, sans-serif";var f="#000";if(!this.getParent()){this.fontSize=jMap.cfg.nodeFontSizes[0];c="bold"}else{if(this.getParent()&&this.getParent().isRootNode()){this.fontSize=jMap.cfg.nodeFontSizes[1];c="bold"}else{this.fontSize=jMap.cfg.nodeFontSizes[2];c="normal"}}if(this.isRootNode()){k.attr({"font-family":a,"font-size":this.fontSize,"font-weight":c,fill:f})}else{k.attr({"font-family":a,"font-size":this.fontSize,"font-weight":c,"text-anchor":"start",fill:f})}this.setTextExecute(this.plainText)};jEllipse.prototype.getSize=function(){return{width:this.body.getBBox().width,height:this.body.getBBox().height}};jEllipse.prototype.setSize=function(b,a){this.body.attr({rx:b/2,ry:a/2})};jEllipse.prototype.getLocation=function(){return{x:this.body.getBBox().x,y:this.body.getBBox().y}};jEllipse.prototype.setLocation=function(b,c){var a=this.body;a.attr({cx:b+this.body.getBBox().width/2,cy:c+this.body.getBBox().height/2});this.updateNodeShapesPos()};jEllipse.prototype.CalcBodySize=function(){this.updateNodeShapesPos();var b=0;var a=0;var c=false;if(this.getText()==""){this.text.attr({text:"_"});var c=true}b+=this.text.getBBox().width;a+=this.text.getBBox().height;if(c){this.text.attr({text:""})}if(this.img){b=(b<this.img.getBBox().width)?this.img.getBBox().width:b;a+=this.img.getBBox().height}if(this.hyperlink){b+=this.hyperlink.getBBox().width+TEXT_HGAP/2}this.setSize(b+TEXT_HGAP,a+TEXT_VGAP)};jEllipse.prototype.updateNodeShapesPos=function(){var g=this.body;var q=this.text;var t=this.folderShape;var c=this.img;var n=this.hyperlink;var m=g.getBBox().x;var l=g.getBBox().y;var s=this.isLeft()?m:m+this.body.getBBox().width;var p=l+this.body.getBBox().height/2;this.folderShape.attr({cx:s,cy:p});var k=m+TEXT_HGAP/2;var f=l+TEXT_VGAP/2;c&&c.attr({x:k,y:f});var b=m+TEXT_HGAP/2;if(this.isRootNode()){b+=q.getBBox().width/2}var a=l+(q.getBBox().height+TEXT_VGAP)/2;a+=c&&c.getBBox().height;q.attr({x:b,y:a});var r=m+TEXT_HGAP;if(c){r+=(q.getBBox().width>c.getBBox().width)?q.getBBox().width:c.getBBox().width}else{r+=q.getBBox().width}var o=l+q.getBBox().height/2;o+=c&&c.getBBox().height/2;n&&n.attr({x:r,y:o});this.connection&&this.connection.updateLine()};jEllipse.prototype.getInputPort=function(){var a=this.body.getBBox();var b=0;var c=0;if(isFinite(a.width)&&!isNaN(a.width)){b=a.width}if(isFinite(a.height)&&!isNaN(a.height)){c=a.width}if(this.isLeft&&this.isLeft()){return{x:a.x+b+1,y:a.y+c/2}}else{return{x:a.x-1,y:a.y+c/2}}};jEllipse.prototype.getOutputPort=function(){var a=this.body.getBBox();var b=0;var c=0;if(isFinite(a.width)&&!isNaN(a.width)){b=a.width}if(isFinite(a.height)&&!isNaN(a.height)){c=a.width}if(this.isLeft&&this.isLeft()){return{x:a.x-1,y:a.y+c/2}}else{return{x:a.x+b+1,y:a.y+c/2}}};jEllipse.prototype.toString=function(){return"jEllipse"};jCustom=function(b,f,g,c,a){jCustom.superclass.call(this,b,f,g,c,a)};extend(jCustom,jNode);jCustom.prototype.type="jCustom";jCustom.prototype.initElements=function(){this.body=RAPHAEL.path();this.text=RAPHAEL.text();this.folderShape=RAPHAEL.circle(0,0,FOLDER_RADIUS);this.wrapElements(this.body,this.text,this.folderShape)};jCustom.prototype.create=function(){this.connection=null;switch(jMap.layoutManager.type){case"jMindMapLayout":break;case"jTreeLayout":break;case"jTableLayout":break;default:break}var b=this.body;var l=this.text;var k=this.folderShape;this.width=0;this.height=0;this.x=0;this.y=0;if(this.getParent()){var f=this.getParent().getLocation();this.setLocation(f.x,f.y)}this.setBackgroundColorExecute(jMap.cfg.nodeDefalutColor);this.setEdgeColorExecute(jMap.cfg.edgeDefalutColor,1);var c=400;var a="Malgun Gothic, 맑은고딕, Gulim, 굴림, Arial, sans-serif";var g="#000";if(!this.getParent()){this.fontSize=jMap.cfg.nodeFontSizes[0];c="700"}else{if(this.getParent()&&this.getParent().isRootNode()){this.fontSize=jMap.cfg.nodeFontSizes[1];c="700"}else{this.fontSize=jMap.cfg.nodeFontSizes[2];c="400"}}if(this.isRootNode()){l.attr({"font-family":a,"font-size":this.fontSize,"font-weight":c,fill:g})}else{l.attr({"font-family":a,"font-size":this.fontSize,"font-weight":c,"text-anchor":"start",fill:g})}this.setTextExecute(this.plainText)};jCustom.prototype.getSize=function(){return{width:this.width,height:this.height}};jCustom.prototype.setSize=function(b,a){this.width=b;this.height=a};jCustom.prototype.getLocation=function(){return{x:this.x,y:this.y}};jCustom.prototype.setLocation=function(a,b){if(a&&!b){this.x=a}else{if(!a&&b){this.y=b}else{this.x=a;this.y=b}}this.updateNodeShapesPos()};jCustom.prototype.CalcBodySize=function(){this.updateNodeShapesPos();var g=0;var a=0;var b=TEXT_HGAP;var f=TEXT_VGAP;var l=false;if(this.getText()==""){this.text.attr({text:"_"});var l=true}g+=this.text.getBBox().width;a+=this.text.getBBox().height;if(l){this.text.attr({text:""})}if(this.img){g=(g<this.img.getBBox().width)?this.img.getBBox().width:g;a+=this.img.getBBox().height}if(this.foreignObjEl){var c=parseInt(this.foreignObjEl.getAttribute("width"));var k=parseInt(this.foreignObjEl.getAttribute("height"));g=(g<c)?c:g;a+=k}if(this.hyperlink){g+=this.hyperlink.getBBox().width+b/2}this.setSize(g+b,a+f)};jCustom.prototype.updateNodeShapesPos=function(){var n=TEXT_HGAP;var s=TEXT_VGAP;var o=0;var r=this.body;var v=this.text;var g=this.folderShape;var E=this.img;var k=this.hyperlink;var c=this.foreignObjEl;var q=this.x;var p=this.y;var A=this.width;var w=this.height;var b=0;var a=0;switch(jMap.layoutManager.type){case"jMindMapLayout":b=this.isLeft()?q:q+A;a=p+w/2;break;case"jTreeLayout":b=q+A/2;a=p+w;break;default:}this.folderShape.attr({cx:b,cy:a});if(E){var D=q+n/2;var C=p+s/2;if(this.isRootNode()){D+=(A/2)-(E.getBBox().width/2)-n/2}E.attr({x:D,y:C});o+=E.getBBox().height}if(c){var u=q+n/2;var t=p+o+s/2;o+=parseInt(c.getAttribute("height"));c.setAttribute("x",u);c.setAttribute("y",t)}if(v){var m=q+n/2;var l=p+(s+v.getBBox().height)/2;if(this.isRootNode()){m+=A/2-n/2}l+=o;v.attr({x:m,y:l})}if(k){var B=q+n;var f=v.getBBox().width;if(E){B+=(f>E.getBBox().width)?f:E.getBBox().width}else{B+=f}var z=p+v.getBBox().height/2;z+=E&&E.getBBox().height/2;k&&k.attr({x:B,y:z})}this.connection&&this.connection.updateLine();this.updateBody()};jCustom.prototype.getInputPort=function(){var a=this.body.getBBox();var b=0;var c=0;if(isFinite(a.width)&&!isNaN(a.width)){b=a.width}if(isFinite(a.height)&&!isNaN(a.height)){c=a.height}switch(jMap.layoutManager.type){case"jMindMapLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft()){return{x:a.x+b+1,y:a.y+c/2}}else{return{x:a.x-1,y:a.y+c/2}}break;case"jTreeLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c}}return{x:a.x+b/2,y:a.y};break;case"jRotateLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft()){return{x:a.x-1,y:a.y+c/2}}else{return{x:a.x-1,y:a.y+c/2}}break;case"jTableLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c}}return{x:a.x+b/2,y:a.y};break;default:}};jCustom.prototype.getOutputPort=function(){var a=this.body.getBBox();var b=0;var c=0;if(isFinite(a.width)&&!isNaN(a.width)){b=a.width}if(isFinite(a.height)&&!isNaN(a.height)){c=a.height}switch(jMap.layoutManager.type){case"jMindMapLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft()){return{x:a.x-1,y:a.y+c/2}}else{return{x:a.x+b+1,y:a.y+c/2}}break;case"jTreeLayout":return{x:a.x+b/2,y:a.y+c};break;case"jRotateLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft()){return{x:a.x+b+1,y:a.y+c/2}}else{return{x:a.x+b+1,y:a.y+c/2}}break;case"jTableLayout":return{x:a.x+b/2,y:a.y+c};break;default:}};jCustom.prototype.toString=function(){return"jCustom"};jCustom.prototype.updateBody=function(){};jFishNode=function(g){var b=g.parent;var f=g.text;var k=g.id;var c=g.index;var a=g.position;jFishNode.superclass.call(this,b,f,k,c,a)};extend(jFishNode,jMindMapNode);jFishNode.prototype.type="jFishNode";jFishNode.prototype.initElements=function(){this.body=RAPHAEL.rect();this.text=RAPHAEL.text();this.folderShape=RAPHAEL.circle(0,0,FOLDER_RADIUS);this.head=RAPHAEL.path();this.vertebra=RAPHAEL.path();this.tail=RAPHAEL.path();this.angle=90;this.wrapElements(this.body,this.text,this.folderShape,this.head,this.vertebra,this.tail)};jFishNode.prototype.create=function(){this.connection=this.parent&&new jLineFish(this.parent,this);var b=this.body;var k=this.text;var g=this.folderShape;if(this.getParent()){var f=this.getParent().getLocation();this.setLocation(f.x,f.y)}b.attr({opacity:0});this.setEdgeColorExecute(jMap.cfg.edgeDefalutColor,1);this.head.attr({stroke:jMap.cfg.edgeDefalutColor});this.vertebra.attr({stroke:jMap.cfg.edgeDefalutColor});this.tail.attr({stroke:jMap.cfg.edgeDefalutColor});if(typeof NodeColorMix!=="undefined"){NodeColorMix.rawDressColor(this)}var c=400;var a="Arial, Gulim, 굴림";if(!this.getParent()){this.fontSize=jMap.cfg.nodeFontSizes[0];c="700"}else{if(this.getParent()&&this.getParent().isRootNode()){this.fontSize=jMap.cfg.nodeFontSizes[1];c="700"}else{this.fontSize=jMap.cfg.nodeFontSizes[2];c="400"}}if(this.isRootNode()){k.attr({"font-family":a,"font-size":this.fontSize,"font-weight":c})}else{k.attr({"font-family":a,"font-size":this.fontSize,"font-weight":c,"text-anchor":"start"})}this.setTextExecute(this.plainText)};jFishNode.prototype.getSize=function(){var b=this.body.getBBox().height;var a=this.body.getBBox().width;if(this.isVertical()){return{width:b*Math.abs(Math.sin(Math.PI*this.angle/180))+a*Math.abs(Math.cos(Math.PI*this.angle/180)),height:a*Math.abs(Math.sin(Math.PI*this.angle/180))+b*Math.abs(Math.cos(Math.PI*this.angle/180))}}else{return{width:this.body.getBBox().width,height:this.body.getBBox().height}}};jFishNode.prototype.setSize=function(b,a){this.body.attr({width:b,height:a})};jFishNode.prototype.getLocation=function(){return{x:this.body.getBBox().x,y:this.body.getBBox().y}};jFishNode.prototype.setLocation=function(b,c){var a=this.body;if(b&&!c){a.attr({x:b})}else{if(!b&&c){a.attr({y:c})}else{a.attr({x:b,y:c})}}this.updateNodeShapesPos()};jFishNode.prototype.CalcBodySize=function(){this.updateNodeShapesPos();var g=0;var a=0;var b=TEXT_HGAP;var f=TEXT_VGAP;var l=false;if(this.getText()==""){this.text.attr({text:"_"});var l=true}g+=this.text.getBBox().width;a+=this.text.getBBox().height;if(l){this.text.attr({text:""})}if(this.img){g=(g<this.img.getBBox().width)?this.img.getBBox().width:g;a+=this.img.getBBox().height}if(this.foreignObjEl){var c=parseInt(this.foreignObjEl.getAttribute("width"));var k=parseInt(this.foreignObjEl.getAttribute("height"));g=(g<c)?c:g;a+=k}if(this.hyperlink){g+=this.hyperlink.getBBox().width+b/2}if(this.file){g+=this.file.getBBox().width+b/2}if(this.note){g+=this.note.getBBox().width+b/2}this.setSize(g+b,a+f);this.updateNodeShapesPos()};jFishNode.prototype.updateNodeShapesPos=function(){var r=TEXT_HGAP;var B=TEXT_VGAP;var s=0;var A=this.body;var E=this.text;var n=this.folderShape;var O=this.img;var o=this.hyperlink;var g=this.note;var L=this.file;var m=this.foreignObjEl;var v=A.getBBox().x;var u=A.getBBox().y;var k=this.getOutputPort();var l=k.x;var f=k.y;this.folderShape.attr({cx:l,cy:f});if(O){var J=v+r/2;var H=u+B/2;if(this.isRootNode()){J+=(A.getBBox().width/2)-(O.getBBox().width/2)-r/2}O.attr({x:J,y:H});s+=O.getBBox().height}if(m){var D=v+r/2;var C=u+s+B/2;s+=parseInt(m.getAttribute("height"));m.setAttribute("x",D);m.setAttribute("y",C)}if(E){var q=v+r/2;var p=u+(B+E.getBBox().height)/2;if(this.isRootNode()){q+=A.getBBox().width/2-r/2}p+=s;E.attr({x:q,y:p})}if(this.isVertical()){var c=this.getLocation().x+this.getSize().height;if(g){c=c-g.getBBox().width-3;var K=this.getLocation().y+(this.getSize().width-g.getBBox().height)/2;g&&g.attr({x:c,y:K})}if(L){c=c-L.getBBox().width-3;var M=this.getLocation().y+(this.getSize().width-L.getBBox().height)/2;L&&L.attr({x:c,y:M})}if(o){c=c-o.getBBox().width-3;var G=this.getLocation().y+(this.getSize().width-o.getBBox().height)/2;o&&o.attr({x:c,y:G})}}else{var c=this.getLocation().x+this.getSize().width;if(g){c=c-g.getBBox().width-3;var K=this.getLocation().y+(this.getSize().height-g.getBBox().height)/2;g&&g.attr({x:c,y:K})}if(L){c=c-L.getBBox().width-3;var M=this.getLocation().y+(this.getSize().height-L.getBBox().height)/2;L&&L.attr({x:c,y:M})}if(o){c=c-o.getBBox().width-3;var G=this.getLocation().y+(this.getSize().height-o.getBBox().height)/2;o&&o.attr({x:c,y:G})}}if(this.isRootNode()){var t=this.getOutputPort();var z=this.getSize().width;var I=this.getSize().height;var F=["M",t.x,t.y,"L",t.x,t.y-I,"A",z*1.25,I*1.5,0,0,0,t.x-z-z/4,t.y,"A",z*1.25,I*1.5,0,0,0,t.x,t.y+I,"Z"].join(",");this.head.attr({path:F});var N=t.x+this.getTreeWidth()-this.getSize().width+30;var b=["M",t.x,t.y,"L",N,t.y,"Z"].join(",");this.vertebra.attr({path:b});var a=["M",N,t.y,"L",N+I,t.y-I*1.5,"A",I*2,I*3,0,0,0,N+I,t.y+I*1.5,"Z"].join(",");this.tail.attr({path:a});this.tail.attr({"stroke-width":1})}this.connection&&this.connection.updateLine()};jFishNode.prototype.getInputPort=function(){var a=this.body.getBBox();var b=0;var c=0;if(isFinite(a.width)&&!isNaN(a.width)){b=a.width}if(isFinite(a.height)&&!isNaN(a.height)){c=a.height}if(this.isRootNode()){return{x:a.x+b,y:a.y+c/2}}else{if(this.isVertical()&&!this.isTopSide()){return{x:a.x+b+1,y:a.y+c}}else{return{x:a.x-1,y:a.y+c}}}};jFishNode.prototype.getOutputPort=function(){var a=this.body.getBBox();var b=0;var c=0;if(isFinite(a.width)&&!isNaN(a.width)){b=a.width}if(isFinite(a.height)&&!isNaN(a.height)){c=a.height}if(this.isRootNode()){return{x:a.x+b,y:a.y+c/2}}else{if(this.isVertical()&&!this.isTopSide()){return{x:a.x,y:a.y+c}}else{return{x:a.x+b,y:a.y+c}}}};jFishNode.prototype.isTopSide=function(){if(this.isRootNode()){return false}var a=this.getDepth();if(a==1){return this.getIndexPos()%2==0}else{return this.getParent().isTopSide()}};jFishNode.prototype.isVertical=function(){var a=this.getDepth();return a%2==1};jFishNode.prototype.focus=function(a){var c=jMap.getSelecteds();if(a){for(var b=c.length-1;b>=0;b--){c[b].blur()}}if(!c.contains(this)){c.push(this);this.connection&&this.connection.line.animate({stroke:jMap.cfg.nodeSelectedColor,"stroke-width":3},300)}jMap.fireActionListener(ACTIONS.ACTION_NODE_SELECTED,this);jMap.work.focus()};jFishNode.prototype.blur=function(){var a=jMap.getSelecteds();if(a.contains(this)){a.remove(this);this.connection&&this.connection.line.animate({fill:this.background_color,stroke:this.branch.color||"#000000","stroke-width":this.branch.width||"1"},300)}jMap.fireActionListener(ACTIONS.ACTION_NODE_UNSELECTED,this)};jFishNode.prototype.toString=function(){return"jFishNode"};jBrainNode=function(g){var b=g.parent;var f=g.text;var k=g.id;var c=g.index;var a=g.position;jBrainNode.superclass.call(this,b,f,k,c,a)};extend(jBrainNode,jCustom);jBrainNode.prototype.type="jBrainNode";jBrainNode.prototype.updateBody=function(){var b=this.x;var l=this.y;var c=this.width;var a=this.height;var k="";if(this.getDepth()==0){k=["M",b-38,l+220,"Q",b-35,l+131,b-130,l+158,"Q",b-155,l+160,b-160,l+135,"Q",b-150,l+90,b-175,l+93,"Q",b-188,l+84,b-178,l+70,"Q",b-188,l+60,b-180,l+48,"Q",b-170,l+35,b-190,l+29,"Q",b-220,l+15,b-190,l-1,"Q",b-150,l-25,b-149,l-110,"Q",b-150,l-120,b-140,l-135,"Q",b-133,l-149,b-120,l-160,"Q",b-29,l-247,b+80,l-220,"Q",b+130,l-210,b+150,l-195,"Q",b+205,l-165,b+225,l-125,"Q",b+290,l,b+150,l+100,"Q",b+100,l+135,b+150,l+180,].join(",")}else{if(this.getDepth()==1){if(this.getIndexPos()==0){var g=b-39;var f=l+43.5;k=["M",g,f,"C",g-5,f+10,g+17,f+10,g+15,f+2,"C",g+10,f+12,g+33,f+13,g+30,f+3,"C",g+28,f+13,g+48,f+15,g+45,f+5,"C",g+41,f+15,g+75,f+17,g+70,f+7,"C",g+70,f+17,g+100,f+7,g+95,f-3,"C",g+95,f+7,g+115,f,g+110,f-10,"C",g+110,f,g+123,f-9,g+115,f-15,"C",g+123,f-5,g+125,f-37,g+118,f-30,"C",g+123,f-30,g+120,f-65,g+112,f-60,"C",g+122,f-58,g+118,f-82,g+108,f-70,"C",g+115,f-72,g+113,f-85,g+105,f-78,"C",g+115,f-88,g+80,f-93,g+82,f-83,"C",g+87,f-93,g+64,f-93,g+68,f-86,"C",g+70,f-96,g+54,f-97,g+56,f-90,"C",g+60,f-97,g+37,f-99,g+40,f-93,"C",g+43,f-99,g+33,f-100,g+34,f-94,"C",g+31,f-102,g-3,f-103,g+4,f-90,"C",g+3,f-100,g-24,f-90,g-20,f-85,"C",g-18,f-92,g-35,f-88,g-30,f-80,"C",g-40,f-95,g-63,f-55,g-50,f-55,"C",g-60,f-60,g-60,f-30,g-48,f-35,"C",g-60,f-36,g-50,f-15,g-40,f-20,"C",g-45,f-5,g+2,f+15,g,f,].join(",")}else{if(this.getIndexPos()==1){var g=b-135;var f=l-57.5;k=["M",g+135,f+100,"C",g+140,f+108,g+165,f+88,g+155,f+85,"C",g+161,f+90,g+167,f+80,g+162,f+78,"C",g+167,f+82,g+172,f+72,g+167,f+72,"C",g+178,f+82,g+190,f+60,g+182,f+58,"C",g+189,f+62,g+190,f+35,g+185,f+35,"C",g+188,f+26,g+175,f+20,g+174,f+23,"C",g+180,f+16,g+160,f+7,g+160,f+13,"C",g+163,f+8,g+150,f+3,g+150,f+8,"C",g+155,f+3,g+138,f-3,g+135,f+6,"C",g+140,f,g+116,f-4,g+118,f+5,"C",g+120,f-1,g+105,f-1,g+110,f+8,"C",g+100,f+3,g+85,f+25,g+95,f+22,"C",g+85,f+20,g+75,f+45,g+86,f+45,"C",g+79,f+40,g+75,f+55,g+85,f+55,"C",g+80,f+52,g+77,f+72,g+86,f+70,"C",g+80,f+65,g+85,f+90,g+92,f+85,"C",g+90,f+93,g+103,f+101,g+105,f+95,"C",g+100,f+100,g+145,f+105,g+135,f+100].join(",")}else{if(this.getIndexPos()==2){var g=b-193.5;var f=l+66;k=["M",g+130,f-10,"C",g+125,f,g+152,f,g+150,f-6,"C",g+145,f+2,g+171,f+13,g+170,f+5,"C",g+165,f+13,g+181,f+18,g+180,f+12,"C",g+175,f+18,g+190,f+28,g+190,f+18,"C",g+185,f+28,g+225,f+22,g+215,f+12,"C",g+225,f+17,g+235,f-2,g+225,f-2,"C",g+235,f+2,g+235,f-10,g+227,f-7,"C",g+240,f-7,g+240,f-22,g+233,f-20,"C",g+242,f-15,g+244,f-55,g+233,f-50,"C",g+243,f-45,g+240,f-95,g+228,f-90,"C",g+235,f-90,g+233,f-100,g+226,f-95,"C",g+233,f-95,g+230,f-115,g+221,f-110,"C",g+226,f-108,g+220,f-123,g+216,f-120,"C",g+222,f-120,g+214,f-136,g+211,f-135,"C",g+215,f-140,g+192,f-140,g+197,f-132,"C",g+200,f-135,g+178,f-135,g+180,f-127,"C",g+183,f-132,g+150,f-130,g+155,f-117,"C",g+158,f-126,g+102,f-120,g+110,f-100,"C",g+105,f-103,g+96,f-87,g+106,f-90,"C",g+108,f-93,g+113,f-76,g+120,f-80,"C",g+118,f-82,g+120,f-56,g+130,f-60,"C",g+125,f-65,g+130,f-35,g+135,f-40,"C",g+125,f-43,g+125,f-7,g+130,f-10].join(",")}else{if(this.getIndexPos()==3){var g=b-90;var f=l+163.5;k=["M",g+90,f-110,"C",g+87,f-100,g+112,f-100,g+105,f-115,"C",g+100,f-105,g+145,f-120,g+135,f-135,"C",g+135,f-125,g+170,f-130,g+160,f-140,"C",g+158,f-130,g+190,f-135,g+180,f-145,"C",g+188,f-140,g+190,f-165,g+182,f-160,"C",g+188,f-170,g+155,f-180,g+160,f-170,"C",g+165,f-180,g+128,f-205,g+130,f-192,"C",g+135,f-200,g+105,f-210,g+110,f-202,"C",g+115,f-210,g+98,f-213,g+100,f-206,"C",g+105,f-213,g+80,f-215,g+85,f-210,"C",g+90,f-223,g+43,f-223,g+50,f-215,"C",g+55,f-225,g+35,f-225,g+40,f-217,"C",g+45,f-225,g+20,f-220,g+25,f-215,"C",g+30,f-222,g-5,f-217,g,f-210,"C",g-9,f-215,g-20,f-198,g-10,f-200,"C",g-20,f-205,g-13,f-175,g-8,f-180,"C",g-15,f-185,g-10,f-145,g-2,f-150,"C",g-12,f-155,g-8,f-130,g+2,f-135,"C",g-8,f-137,g-5,f-105,g+5,f-110,"C",g,f-105,g+23,f-108,g+20,f-112,"C",g+15,f-102,g+50,f-104,g+45,f-114,"C",g+40,f-104,g+95,f-100,g+90,f-110,].join(",")}else{if(this.getIndexPos()==4){var g=b+75;var f=l+75+62.5;k=["M",g-30,f-110,"C",g-23,f-105,g-16,f-130,g-25,f-125,"C",g-20,f-120,g-6,f-150,g-15,f-145,"C",g-9,f-142,g-10,f-164,g-17,f-160,"C",g-11,f-155,g-14,f-195,g-22,f-190,"C",g-17,f-200,g-45,f-205,g-40,f-200,"C",g-40,f-205,g-55,f-202,g-50,f-197,"C",g-50,f-200,g-73,f-198,g-70,f-190,"C",g-68,f-195,g-88,f-187,g-85,f-180,"C",g-82,f-187,g-115,f-168,g-110,f-160,"C",g-110,f-165,g-130,f-145,g-125,f-140,"C",g-130,f-145,g-138,f-120,g-132,f-125,"C",g-138,f-123,g-138,f-112,g-132,f-115,"C",g-138,f-118,g-140,f-97,g-135,f-100,"C",g-140,f-103,g-142,f-72,g-130,f-75,"C",g-132,f-68,g-102,f-73,g-105,f-78,"C",g-108,f-73,g-92,f-75,g-95,f-80,"C",g-98,f-75,g-76,f-80,g-80,f-85,"C",g-85,f-80,g-55,f-85,g-60,f-93,"C",g-65,f-85,g-25,f-105,g-30,f-110,].join(",")}else{if(this.getIndexPos()==5){k=["M",b,l,"A",1,1,0,1,1,b+0.5,l+0.5,"Z","M",b+4,l-2,"L",b+6,l-10,"L",b+13,l+2,"Z","M",b+10,l-4,"Q",b+15,l-45,b+45,l-30,"T",b+70,l-50,].join(",")}else{if(this.getIndexPos()==6){k=["M",b,l,"A",1,1,0,1,1,b+0.5,l+0.5,"Z","M",b-2,l-4,"L",b-5,l-15,"L",b-15,l-2,"Z","M",b-10,l-10,"Q",b-30,l,b-40,l-30,"T",b-70,l-60,].join(",")}}}}}}}}else{if(this.getDepth()==2){if(this.getIndexPos()==0){k=["M",b,l,"A",8,8,0,1,1,b-10.5,l-79,"Z","M",b-20,l-140,"A",11,11,0,1,1,b-20.5,l-139,"Z","M",b-30,l-220,"A",16,16,0,1,1,b-30.5,l-219,"Z","M",b-40,l-300,"A",c+5+(a/c),a+(c/a),0,1,1,b-40.5,l-299,"Z",].join(",")}else{if(this.getIndexPos()==1){k=["M",b+40,l-78,"A",8,8,0,1,1,b+40.5,l-77.9,"Z","M",b+50,l-140,"A",11,11,0,1,1,b+50.5,l-139,"Z","M",b+65,l-218,"A",16,16,0,1,1,b+65.5,l-217,"Z","M",b+80,l-300,"A",c+5+(a/c),a+(c/a),0,1,1,b+80.5,l-299,"Z",].join(",")}}}}}this.branch.width=2;this.body.attr({path:k})};jSunburstNodeController=function(){jSunburstNodeController.superclass.call(this)};extend(jSunburstNodeController,jNodeController);jSunburstNodeController.prototype.type="jSunburstNodeController";jSunburstNodeController.prototype.dblclick=function(b){var a;if(!b){var b=window.event}a=b.originalEvent.originalEvent||b.originalEvent||b;if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}if(jMap.getSelected()){jMap.getSelected().zoomExecute()}};jSunburstNodeController.prototype.mouseenter=function(a){this.node.showPopover()};jSunburstNodeController.prototype.mouseleave=function(b){var c="data-popover-id";var a=b.toElement||b.relatedTarget;if($(a).closest(".jpopover").parent().attr(c)!=this.node.popover.container.attr(c)){this.node.hidePopover();changeNodeGifFormat(this.node,false)}};jSunburstNodeController.prototype.popoverMouseleave=function(a){var b=$(this).parent().attr("data-popover-id");if(jMap.nodes[b]){jMap.nodes[b].hidePopover()}};jSunburstNodeControllerGuest=function(){jSunburstNodeControllerGuest.superclass.call(this)};extend(jSunburstNodeControllerGuest,jNodeControllerGuest);jSunburstNodeControllerGuest.prototype.type="jSunburstNodeControllerGuest";jSunburstNodeControllerGuest.prototype.dblclick=function(b){var a;if(!b){var b=window.event}a=b.originalEvent.originalEvent||b.originalEvent||b;if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}if(jMap.getSelected()){jMap.getSelected().zoomExecute()}};jSunburstNodeControllerGuest.prototype.mouseenter=function(a){this.node.showPopover()};jSunburstNodeControllerGuest.prototype.mouseleave=function(b){var c="data-popover-id";var a=b.toElement||b.relatedTarget;if($(a).closest(".jpopover").parent().attr(c)!=this.node.popover.container.attr(c)){this.node.hidePopover()}};jSunburstNodeControllerGuest.prototype.popoverMouseleave=function(a){var b=$(this).parent().attr("data-popover-id");if(jMap.nodes[b]){jMap.nodes[b].hidePopover()}};jSunburstNode=function(g){var b=g.parent;var f=g.text;var k=g.id;var c=g.index;var a=g.position;this.popover={container:null,body:null,text:null,img:null,hyperlink:null,foreignObjEl:null};jSunburstNode.superclass.call(this,b,f,k,c,a)};extend(jSunburstNode,jNode);jSunburstNode.prototype.type="jSunburstNode";jSunburstNode.prototype.initElements=function(){this.body=RAPHAEL.path();this.text=RAPHAEL.text();this.wrapElements(this.body,this.text);this.popover.container=$('<div data-popover-type="'+this.type+'" data-popover-id="'+this.id+'"><div class="jpopover"></div></div>').appendTo(jMap.popoverContainer);this.popover.body=$('<div class="jpopover-body"></div>').appendTo(this.popover.container.children(".jpopover"));this.popover.text=$('<div class="jpopover-text"></div>').appendTo(this.popover.container.children(".jpopover"));this.popover.iconMenus=$('<div class="jpopover-menu"></div>').appendTo(this.popover.container.children(".jpopover"))};var custom_sunburst_touchtime=0;jSunburstNode.prototype.addEventController=function(a){a=jMap.mode?new jSunburstNodeController():new jSunburstNodeControllerGuest();this.controller=a;$(this.groupEl).on("vmousedown",a.mousedown);$(this.groupEl).on("vmousemove",a.mousemove);$(this.groupEl).on("vmouseup",a.mouseup);$(this.groupEl).on("mouseover",a.mouseenter);$(this.groupEl).on("mouseout",a.mouseleave);this.popover.container.children(".jpopover").on("mouseleave",a.popoverMouseleave);$(this.groupEl).on("taphold",a.taphold);$(this.groupEl).on("vclick",a.click);$(this.groupEl).on("dblclick",a.dblclick)};jSunburstNode.prototype.create=function(){var c=jMap.layoutManager.getCenterLocation();this.position=this.position||((this.parent&&this.parent.position)?this.parent.position:"left");this.groupEl.setAttribute("data-node-type",this.type);this.groupEl.setAttribute("data-node-id",this.id);this.groupEl.setAttribute("transform","translate("+[c.x,c.y]+")");this.groupEl.setAttribute("pointer-events","all");this.body.node.setAttribute("pointer-events","all");this.setBackgroundColorExecute(jMap.cfg.nodeDefalutColor);this.setTextColorExecute(jMap.cfg.textDefalutColor);this.setEdgeColorExecute(jMap.cfg.edgeDefalutColor,jMap.cfg.edgeDefalutWidth);if(typeof NodeColorMix!=="undefined"){NodeColorMix.rawDressColor(this)}var b=400;var a="Malgun Gothic, 맑은고딕, Gulim, 굴림, Arial, sans-serif";this.fontSize=jMap.cfg.nodeFontSizes[3];if(!this.getParent()){b="700";this.fontSize=jMap.cfg.nodeFontSizes[1]}else{if(this.getParent()&&this.getParent().isRootNode()){b="600";this.fontSize=jMap.cfg.nodeFontSizes[2]}else{b="400"}}this.text.attr({"font-family":a,"font-size":this.fontSize,"font-weight":b,"text-anchor":null});$(this.text.node).css("pointer-events","none");this.setTextExecute(this.plainText)};jSunburstNode.prototype.setTextExecute=function(a){this.plainText=a;this.text.attr({text:a});this.CalcBodySize();if(a.indexOf("\n")){a=a.split("\n").join("<br>")}this.popover.text.html(a)};jSunburstNode.prototype.setFile=function(c){if(!jMap.saveAction.isAlive()){return null}var f=jMap.historyManager;var a=f&&f.extractNode(this);this.setFileExecute(c);var b=f&&f.extractNode(this);f&&f.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_FILE,this);jMap.setSaved(false)};jSunburstNode.prototype.setFileExecute=function(a){if(a==null||a==""){if(this.file){this.file=null;this.popover.file.remove();this.popover.file=null;this.popover.container.removeAttr("data-has-file");this.CalcBodySize()}return}if(!this.file){this.file=RAPHAEL.image(jMap.cfg.contextPath+"/menu/icons/icon_file.png",0,0,24,24);this.popover.file=$("<a></a>").attr("class","jpopover-file").appendTo(this.popover.iconMenus);$("<img />").attr("src",jMap.cfg.contextPath+"/menu/icons/icon_file.png").width(24).height(24).appendTo(this.popover.file);this.popover.container.attr("data-has-file",true)}this.file.attr({href:a,target:"blank"});this.popover.file.attr("href",a).attr("target","_blank");this.CalcBodySize();jMap.resolveRendering()};jSunburstNode.prototype.setNote=function(a){if(!jMap.saveAction.isAlive()){return null}var f=jMap.historyManager;var b=f&&f.extractNode(this);this.setNoteExecute(a);var c=f&&f.extractNode(this);f&&f.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_NOTE,this);jMap.setSaved(false)};jSunburstNode.prototype.setNoteExecute=function(a){if(a==null||a==""){if(this.note){this.note=null;this.popover.note.remove();this.popover.note=null;this.popover.container.removeAttr("data-has-note");this.CalcBodySize()}return}if(!this.note){this.note=RAPHAEL.image(jMap.cfg.contextPath+"/menu/icons/icon_note.png",0,0,24,24);this.popover.note=$("<a></a>").attr("class","jpopover-note").appendTo(this.popover.iconMenus);$("<img />").attr("src",jMap.cfg.contextPath+"/menu/icons/icon_note.png").width(24).height(24).appendTo(this.popover.note);this.popover.container.attr("data-has-note",true)}this.noteText=a;this.popover.note.attr({href:"javascript:showNoteAction('"+this.id+"');"});this.CalcBodySize();jMap.resolveRendering()};jSunburstNode.prototype.setHyperlink=function(c){if(!jMap.saveAction.isAlive()){return null}var f=jMap.historyManager;var a=f&&f.extractNode(this);this.setHyperlinkExecute(c);var b=f&&f.extractNode(this);f&&f.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_HYPER,this);jMap.setSaved(false)};jSunburstNode.prototype.setHyperlinkExecute=function(a){if(a==null||a==""){if(this.hyperlink){this.hyperlink=null;this.popover.hyperlink.remove();this.popover.hyperlink=null;this.popover.container.removeAttr("data-has-hyperlink");this.CalcBodySize()}return}if(!this.hyperlink){this.hyperlink=RAPHAEL.image(jMap.cfg.contextPath+"/images/hyperlink.png",0,0,11,11);this.hyperlink.attr({cursor:"pointer"});this.popover.hyperlink=$("<a></a>").attr("class","jpopover-hyperlink").appendTo(this.popover.body);$("<img />").attr("src",jMap.cfg.contextPath+"/images/hyperlink.png").width(11).height(11).appendTo(this.popover.hyperlink);this.popover.container.attr("data-has-hyperlink",true)}this.hyperlink.attr({href:a,target:"blank"});this.popover.hyperlink.attr("href",a).attr("target","_blank");this.CalcBodySize();jMap.resolveRendering()};jSunburstNode.prototype.setImage=function(c,f,a){if(!jMap.saveAction.isAlive()){return null}var g=jMap.historyManager;var b=g&&g.extractNode(this);this.setImageExecute(c,f,a,function(){var k=g&&g.extractNode(this);g&&g.addToHistory(b,k);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_IMAGE,this.id,c,f,a);jMap.setSaved(false)})};jSunburstNode.prototype.setImageExecute=function(c,g,b,a){if(c==null||c==""){if(this.img){this.img=null;this.imgInfo={};this.popover.img.remove();this.popover.img=null;this.CalcBodySize();a&&a.call(this)}return false}var k=this;checkGifNotiStatus(c);var f=$("<img />").attr("src",c).load(function(){var m=jMap.cfg.default_img_size;var l={width:0,height:0};if(this.width>m){l.width=m;l.height=(this.height*m)/this.width}else{l.width=this.width;l.height=this.height}if(g){l.width=g}if(b){l.height=b}l.width=parseInt(l.width);l.height=parseInt(l.height);if(k.img){k.img.attr({src:this.src,width:l.width,height:l.height});k.imgInfo.href=this.src;k.imgInfo.width=l.width;k.imgInfo.height=l.height;k.popover.img.attr("src",this.src).attr("onclick","changeNodeGifFormat(null, true, this)").width(l.width).height(l.height)}else{k.img=RAPHAEL.image(this.src,0,0,l.width,l.height);k.imgInfo.href=this.src;k.imgInfo.width=l.width;k.imgInfo.height=l.height;k.popover.img=$("<img />").attr("class","jpopover-img").attr("src",this.src).attr("onclick","changeNodeGifFormat(null, true, this)").width(l.width).height(l.height).appendTo(k.popover.body)}jMap.loadManager.updateImageLoading(this);a&&a.call(k);return true}).error(function(){var l=jMap.cfg.contextPath+"/images/image_broken.png";if(k.img){k.img.attr({src:l,width:64,height:64});k.imgInfo.href=c;k.imgInfo.width=g&&g;k.imgInfo.height=b&&b;k.popover.img.attr("src",l).width(64).height(64)}else{k.img=RAPHAEL.image(jMap.cfg.contextPath+"/images/image_broken.png",0,0,64,64);k.imgInfo.href=c;k.imgInfo.width=g&&g;k.imgInfo.height=b&&b;k.popover.img=$("<img />").attr("class","jpopover-img").attr("src",l).width(64).height(64).appendTo(k.popover.body)}jMap.loadManager.updateImageLoading(this);a&&a.call(k)});jMap.loadManager.updateImageLoading(f[0])};jSunburstNode.prototype.imageResize=function(f,a){if(!jMap.saveAction.isAlive()){return null}var g=jMap.historyManager;var b=g&&g.extractNode(this);this.imageResizeExecute(f,a);var c=g&&g.extractNode(this);g&&g.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_IMAGE,this.id,null,f,a);jMap.setSaved(false)};jSunburstNode.prototype.imageResizeExecute=function(b,a){this.img&&this.img.attr({width:b,height:a});this.imgInfo.width=b;this.imgInfo.height=a;this.popover.img.width(b).height(a)};jSunburstNode.prototype.setForeignObject=function(f,g,a){if(!jMap.saveAction.isAlive()){return null}var k=jMap.historyManager;var b=k&&k.extractNode(this);this.setForeignObjectExecute(f,g,a);var c=k&&k.extractNode(this);k&&k.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_FOREIGNOBJECT,this,f,g,a);jMap.setSaved(false)};jSunburstNode.prototype.setForeignObjectExecute=function(c,f,a){if(!Raphael.svg){return false}if(c==null||c==""){this.foreignObjEl=null;if(this.popover.foreignObjEl){this.popover.foreignObjEl.remove()}this.popover.foreignObjEl=null;this.CalcBodySize();return false}c=convertXML2Char(c);if(!this.foreignObjEl){this.foreignObjEl=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");this.foreignObjEl.bodyEl=document.createElementNS("http://www.w3.org/1999/xhtml","body");this.foreignObjEl.appendChild(this.foreignObjEl.bodyEl);this.popover.foreignObjEl=$("<div></div>").attr("class","jpopover-foreignObjEl").appendTo(this.popover.body)}f=f||150;a=a||150;this.foreignObjEl.setAttribute("width",f);this.foreignObjEl.setAttribute("height",a);this.popover.foreignObjEl.width(f);this.popover.foreignObjEl.height(a);this.foreignObjEl.bodyEl.innerHTML=c;this.foreignObjEl.plainHtml=c;this.popover.foreignObjEl.html(c);if(BrowserDetect.browser=="MSIE"){var g=c.search(/youtube\.com/);if(g!=-1){var b='<img src="'+jMap.cfg.contextPath+'/images/video_not_support.png" width="300" height="300"/>';this.foreignObjEl.bodyEl.innerHTML=b;this.popover.foreignObjEl.html(b)}}this.CalcBodySize()};jSunburstNode.prototype.foreignObjectResize=function(f,a){if(!jMap.saveAction.isAlive()){return null}var g=jMap.historyManager;var b=g&&g.extractNode(this);this.foreignObjectResizeExecute(f,a);var c=g&&g.extractNode(this);g&&g.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_FOREIGNOBJECT,this,null,f,a);jMap.setSaved(false)};jSunburstNode.prototype.foreignObjectResizeExecute=function(c,a){c&&this.foreignObjEl.setAttribute("width",c);a&&this.foreignObjEl.setAttribute("height",a);c&&this.popover.foreignObjEl.width(c);a&&this.popover.foreignObjEl.height(a);var b=this.foreignObjEl.plainHtml;b=b.replace(/(width=")([^"]*)/ig,"$1"+c);b=b.replace(/(height=")([^"]*)/ig,"$1"+a);this.foreignObjEl.bodyEl.innerHTML=b;this.foreignObjEl.plainHtml=b;this.popover.foreignObjEl.html(b);this.CalcBodySize();jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(this);jMap.layoutManager.layout(true)};jSunburstNode.prototype.setEmbedVideo=function(f){var g=/width?=?["']([^"']*)/gi;var c=g.exec(f)[1];var b=/height?=?["']([^"']*)/gi;var a=b.exec(f)[1];this.setForeignObject(f,c,a)};jSunburstNode.prototype.setVideo=function(g,c,a){var f=jMap.cfg.default_video_size;var b='<embed src="'+g+'" width="'+c+'"  height="'+a+'"></embed>';this.setHyperlink(g);this.setForeignObject(b,c,a)};jSunburstNode.prototype.setYoutubeVideo=function(m,k,a){var l=jMap.cfg.default_video_size;if(k==null){k=l}if(a==null){a=l}var g=/v[=\/]([^&]*)/ig;var c=g.exec(m);if(c){var b="https://www.youtube.com/embed/"+c[1];var f='<iframe src="'+b+'" frameborder="0" allowtransparency="true" width="'+k+'"  height="'+a+'" scrolling="no"></iframe>';this.setHyperlink(m);this.setForeignObject(f,k,a)}};jSunburstNode.prototype.zoomExecute=function(c){var b=jMap.layoutManager;var a=this;c=(c==undefined?b.duration:c);a.hidePopover();jMap.arcTweenNode=a;d3.selectAll('g[data-node-type="'+jMap.cfg.nodeStyle+'"] path').transition().duration(c).attrTween("d",b.arcTween(a.getPartitionTreeData()));d3.selectAll('g[data-node-type="'+jMap.cfg.nodeStyle+'"] text').style("visibility",function(f){return a.isParentOf(f)?null:d3.select(this).style("visibility")}).transition().duration(c).attrTween("text-anchor",function(f){return function(){var g="middle";if(jMap.nodes[f.id]){if(!jMap.nodes[f.id].isRootNode()){g=b.x(f.x+f.dx/2)>Math.PI?"end":"start"}d3.select(jMap.nodes[f.id].text.node).style({"text-anchor":g})}return g}}).attrTween("transform",function(g){var f=(jMap.nodes[g.id].plainText||"").split(" ").length>1;return function(){var l=b.x(g.x+g.dx/2)*180/Math.PI-90,k=l+(f?-0.5:0);if(jMap.nodes[g.id]){jMap.nodes[g.id].angle=l;if(jMap.nodes[g.id].isRootNode()){return""}}return"rotate("+k+")translate("+(b.y(g.y)+b.padding)+")rotate("+(l>90?-180:0)+")"}}).style("fill-opacity",function(f){return a.isParentOf(f)?1:0.000001}).each("end",function(f){d3.select(this).style("visibility",function(){if(a.isParentOf(f)){if(jMap.nodes[f.id]){jMap.nodes[f.id].computedTextExecute()}return null}return"hidden"})});return{end:function(f){setTimeout(function(){f()},c)}}};jSunburstNode.prototype.isParentOf=function(a){if(this.id===a.id){return true}if(this.children){return this.children.some(function(b){return b.isParentOf(a)})}return false};jSunburstNode.prototype.getChildren=function(){return this.children||[]};jSunburstNode.prototype.screenFocus=function(){this.zoomExecute()};jSunburstNode.prototype.showPopover=function(){if(STAT_NODEEDIT){return}var a=this.getPopoverLocation();this.popover.container.attr("style","top: "+(a.top)+"px; left: "+(a.left)+"px;");this.popover.container.addClass("active");this.popover.container.attr("data-placement",this.angle>90?"left":"right")};jSunburstNode.prototype.getPopoverLocation=function(){var l=jMap.arcTweenNode.groupEl.getBBox();l.offset=$(jMap.arcTweenNode.groupEl).offset();var g={top:l.offset.top+((l.height*jMap.cfg.scale)/2),left:l.offset.left+((l.width*jMap.cfg.scale)/2)};var a=0;if(!this.isRootNode()){a=(this.outerRadius-this.innerRadius)/2}var m=(this.innerRadius+a)*jMap.cfg.scale;var c=this.angle;g.top+=(m*Math.sin(Math.PI*(c/180)));g.left+=(m*Math.cos(Math.PI*(c/180)));var k=$("#ribbon").height()+10;var b=this.popover.container.width();var o=this.popover.container.height();var f=$(window).width();var p=$(window).height();var n=5;if(g.top<k+n){g.top=k+n}else{if(g.top+o>p-n){g.top=p-o-n}}if(this.angle>90){if(g.left-b<n){g.left=n+b}}else{if(g.left<n){g.left=n}else{if(g.left+b>f-n){g.left=f-n-b}}}return g};jSunburstNode.prototype.hidePopover=function(){this.popover.container.removeClass("active")};jSunburstNode.prototype.toXML=function(o){var k=new StringBuffer();var l=false;if(this.img!=null||(this.text.attrs.text!=null&&this.text.attrs.text.indexOf("\n")!=-1)){l=true}var g=new StringBuffer();g.add("<node");g.add('CREATED="'+this.created+'"');g.add('ID="'+this.id+'"');g.add('MODIFIED="'+this.modified+'"');g.add('CREATOR="'+this.creator+'"');g.add('CLIENT_ID="'+this.client_id+'"');if(!l){g.add('TEXT="'+convertCharStr2SelectiveCPs(convertCharStr2XML(this.plainText,true,true),"ascii",true,"&#x",";","hex")+'"')}g.add('FOLDED="'+this.folded+'"');if(this.background_color!=""){g.add('BACKGROUND_COLOR="'+this.background_color+'"')}if(this.color!=""){g.add('COLOR="'+this.color+'"')}if(this.hyperlink!=null){g.add('LINK="'+convertCharStr2XML(this.hyperlink.attr().href)+'"')}if(this.file!=null){g.add('FILE="'+convertCharStr2XML(this.file.attr().href)+'"')}if(this.noteText!=null){g.add('NOTE="'+convertCharStr2XML(this.noteText)+'"')}if(this.position!=""&&this.position!="undefined"){g.add('POSITION="'+this.position+'"')}if(this.style!=""){g.add('STYLE="'+this.style+'"')}if(this.hgap){g.add('HGAP="'+this.hgap+'"')}if(this.vgap){g.add('VGAP="'+this.vgap+'"')}if(this.vshift){g.add('VSHIFT="'+this.vshift+'"')}if(this.numofchildren!=null){g.add('NUMOFCHILDREN="'+this.numofchildren+'"')}g.add(">");k.add(g.toString(" "));if(l){var a=new StringBuffer();a.add('<richcontent TYPE="NODE"><html>\n');a.add("  <head>\n");a.add("\n");a.add("  </head>\n");a.add("  <body>\n");if(this.img!=null){a.add("    <p>\n");a.add('      <img src="'+this.imgInfo.href+'" width="'+this.imgInfo.width+'" height="'+this.imgInfo.height+'" />\n');a.add("    </p>\n")}if(this.text.attrs.text!=null){var n=JinoUtil.trimStr(this.text.attrs.text).split("\n");for(var m=0;m<n.length;m++){a.add("<p>"+convertCharStr2SelectiveCPs(convertCharStr2XML(n[m],true,true),"ascii",true,"&#x",";","hex")+"</p>\n")}}a.add("  </body>\n");a.add("</html>\n");a.add("</richcontent>");k.add(a.toString(" "))}if(this.arrowlinks.length>0){for(var m=0;m<this.arrowlinks.length;m++){k.add(this.arrowlinks[m].toXML())}}if(this.foreignObjEl){var b=new StringBuffer();b.add('<foreignObject WIDTH="'+this.foreignObjEl.getAttribute("width")+'" HEIGHT="'+this.foreignObjEl.getAttribute("height")+'">');var p=this.foreignObjEl.plainHtml;p=p.split('class="lazy-load"').join("");p=p.replace(" data-src="," src=");b.add(convertCharStr2SelectiveCPs(p,"ascii",true,"&#x",";","hex"));b.add("</foreignObject>");k.add(b.toString(" "))}for(var q in this.attributes){k.add("<attribute NAME='"+q+"' VALUE='"+convertCharStr2SelectiveCPs(convertCharStr2XML(String(this.attributes[q]),true,true),"ascii",true,"&#x",";","hex")+"'/>")}var c=new StringBuffer();c.add("<info");if(this.lazycomplete){c.add('LAZYCOMPLETE="'+this.lazycomplete+'"')}c.add("/>");k.add(c.toString(" "));var f=this.getChildren();if(f.length>0&&o==null){for(var m=0;m<f.length;m++){k.add(f[m].toXML())}}k.add("</node>");return k.toString("\n")};jSunburstNode.prototype.getPartitionTreeData=function(){var a={};a.id=this.id;a.dx=this.dx;a.dy=this.dy;a.x=this.x;a.y=this.y;if(this.children.length){a.children=[];this.children.forEach(function(b){a.children.push(b.getPartitionTreeData())})}return a};jSunburstNode.prototype.getText=function(){return this.plainText};jSunburstNode.prototype.computedTextExecute=function(){var c=this;var b=c.outerRadius*2;if(!c.isRootNode()){b=c.outerRadius-c.innerRadius}var f=c.fontSize;var a=Math.floor((b-2*jMap.layoutManager.padding)/(f*0.6));a=Math.max(0,a);if(c.plainText.length>a){var g=c.plainText.slice(0,Math.max(0,a-3));this.text.attr({text:g+"..."})}else{this.text.attr({text:this.plainText})}};jSunburstNode.prototype.setFolding=function(a){if(jMap.jDebug){console.log("setFolding")}};jSunburstNode.prototype.hideChildren=function(a){if(jMap.jDebug){console.log("hideChildren")}};jSunburstNode.prototype.relativeCoordinate=function(b,a){if(jMap.jDebug){console.log("relativeCoordinate")}};jSunburstNode.prototype.relativeCoordinateExecute=function(b,a){if(jMap.jDebug){console.log("relativeCoordinateExecute")}};jSunburstNode.prototype.getLocation=function(){var b=this.getPopoverLocation();var a=jMap.getLayoutManager().getCenterLocation();return{x:a.x-b.top,y:a.y-b.left}};jSunburstNode.prototype.setFontSizeExecute=function(a){};jSunburstNode.prototype.setEdgeColorExecute=function(a,b){if(a){this.edge.color=a;this.body.attr({stroke:a});this.folderShape&&this.folderShape.attr({stroke:a})}if(b){}};jZoomableTreemapNodeController=function(){jZoomableTreemapNodeController.superclass.call(this)};extend(jZoomableTreemapNodeController,jNodeController);jZoomableTreemapNodeController.prototype.type="jZoomableTreemapNodeController";jZoomableTreemapNodeController.prototype.dblclick=function(c){var b=jMap.getSelected();var a;if(!c){var c=window.event}a=c.originalEvent.originalEvent||c.originalEvent||c;if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}if(jMap.arcTweenNode.id==b.parent.id){jMap.getRootNode().zoomExecute()}else{b.parent.zoomExecute()}};jZoomableTreemapNodeController.prototype.mouseenter=function(a){this.node.showPopover()};jZoomableTreemapNodeController.prototype.mouseleave=function(b){var c="data-popover-id";var a=b.toElement||b.relatedTarget;if($(a).closest(".jpopover").parent().attr(c)!=this.node.popover.container.attr(c)){this.node.hidePopover()}};jZoomableTreemapNodeController.prototype.popoverMouseleave=function(a){var b=$(this).parent().attr("data-popover-id");if(jMap.nodes[b]){jMap.nodes[b].hidePopover()}};jZoomableTreemapNodeControllerGuest=function(){jZoomableTreemapNodeControllerGuest.superclass.call(this)};extend(jZoomableTreemapNodeControllerGuest,jNodeControllerGuest);jZoomableTreemapNodeControllerGuest.prototype.type="jZoomableTreemapNodeControllerGuest";jZoomableTreemapNodeControllerGuest.prototype.dblclick=function(b){var a;if(!b){var b=window.event}a=b.originalEvent.originalEvent||b.originalEvent||b;if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}if(jMap.arcTweenNode.id==this.node.parent.id){jMap.getRootNode().zoomExecute()}else{this.node.parent.zoomExecute()}};jZoomableTreemapNodeControllerGuest.prototype.mouseenter=function(a){this.node.showPopover()};jZoomableTreemapNodeControllerGuest.prototype.mouseleave=function(b){var c="data-popover-id";var a=b.toElement||b.relatedTarget;if($(a).closest(".jpopover").parent().attr(c)!=this.node.popover.container.attr(c)){this.node.hidePopover()}};jZoomableTreemapNodeControllerGuest.prototype.popoverMouseleave=function(a){var b=$(this).parent().attr("data-popover-id");if(jMap.nodes[b]){jMap.nodes[b].hidePopover()}};jZoomableTreemapNode=function(g){var b=g.parent;var f=g.text;var k=g.id;var c=g.index;var a=g.position;this.popover={container:null,body:null,text:null,img:null,hyperlink:null,foreignObjEl:null};jZoomableTreemapNode.superclass.call(this,b,f,k,c,a)};extend(jZoomableTreemapNode,jNode);jZoomableTreemapNode.prototype.type="jZoomableTreemapNode";jZoomableTreemapNode.prototype.initElements=function(){this.body=RAPHAEL.rect();this.text=RAPHAEL.text();this.wrapElements(this.body,this.text);this.popover.container=$('<div data-popover-type="'+this.type+'" data-popover-id="'+this.id+'"><div class="jpopover"></div></div>').appendTo(jMap.popoverContainer);this.popover.body=$('<div class="jpopover-body"></div>').appendTo(this.popover.container.children(".jpopover"));this.popover.text=$('<div class="jpopover-text"></div>').appendTo(this.popover.container.children(".jpopover"));this.popover.iconMenus=$('<div class="jpopover-menu"></div>').appendTo(this.popover.container.children(".jpopover"))};jZoomableTreemapNode.prototype.create=function(){var c=jMap.layoutManager.getCenterLocation();this.position=this.position||((this.parent&&this.parent.position)?this.parent.position:"left");this.groupEl.setAttribute("data-node-type",this.type);this.groupEl.setAttribute("data-node-id",this.id);this.groupEl.setAttribute("pointer-events","all");this.body.node.setAttribute("pointer-events","all");this.setBackgroundColorExecute(jMap.cfg.nodeDefalutColor);this.setTextColorExecute(jMap.cfg.textDefalutColor);if(typeof NodeColorMix!=="undefined"){NodeColorMix.rawDressColor(this)}this.setEdgeColorExecute(jMap.cfg.edgeDefalutColor,jMap.cfg.edgeDefalutWidth);var b=400;var a="Malgun Gothic, 맑은고딕, Gulim, 굴림, Arial, sans-serif";this.fontSize=jMap.cfg.nodeFontSizes[3];if(!this.getParent()){b="400"}else{if(this.getParent()&&this.getParent().isRootNode()){b="400"}else{b="400"}}this.text.attr({"font-family":a,"font-size":this.fontSize,"font-weight":b,"text-anchor":null});$(this.text.node).css("pointer-events","none");this.setTextExecute(this.plainText)};var custom_zoomable_treemap_touchtime=0;jZoomableTreemapNode.prototype.addEventController=function(b){b=jMap.mode?new jZoomableTreemapNodeController():new jZoomableTreemapNodeControllerGuest();this.controller=b;$(this.groupEl).on("vmousedown",b.mousedown);$(this.groupEl).on("vmousemove",b.mousemove);$(this.groupEl).on("vmouseup",b.mouseup);$(this.groupEl).on("mouseover",b.mouseenter);$(this.groupEl).on("mouseout",b.mouseleave);this.popover.container.children(".jpopover").on("mouseleave",b.popoverMouseleave);var a=this;this.popover.container.children(".jpopover").on("vclick",function(){if(custom_zoomable_treemap_touchtime==0){custom_zoomable_treemap_touchtime=new Date().getTime()}else{if(((new Date().getTime())-custom_zoomable_treemap_touchtime)<400){custom_zoomable_treemap_touchtime=0;if(!jMap.cfg.isShrdGuest){jMap.controller.startNodeEdit(a)}}else{custom_zoomable_treemap_touchtime=new Date().getTime()}}});$(this.groupEl).on("taphold",b.taphold);$(this.groupEl).on("vclick",b.click)};jZoomableTreemapNode.prototype.setTextExecute=function(a){this.plainText=a;this.text.attr({text:a.split("\n")[0]});this.CalcBodySize();if(a.indexOf("\n")){a=a.split("\n").join("<br>")}this.popover.text.html(a)};jZoomableTreemapNode.prototype.setHyperlink=function(c){if(!jMap.saveAction.isAlive()){return null}var f=jMap.historyManager;var a=f&&f.extractNode(this);this.setHyperlinkExecute(c);var b=f&&f.extractNode(this);f&&f.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_HYPER,this);jMap.setSaved(false)};jZoomableTreemapNode.prototype.setHyperlinkExecute=function(a){if(a==null||a==""){if(this.hyperlink){this.hyperlink=null;this.popover.hyperlink.remove();this.popover.hyperlink=null;this.popover.container.removeAttr("data-has-hyperlink");this.CalcBodySize()}return}if(!this.hyperlink){this.hyperlink=RAPHAEL.image(jMap.cfg.contextPath+"/images/hyperlink.png",0,0,11,11);this.hyperlink.attr({cursor:"pointer"});this.popover.hyperlink=$("<a></a>").attr("class","jpopover-hyperlink").appendTo(this.popover.body);$("<img />").attr("src",jMap.cfg.contextPath+"/images/hyperlink.png").width(11).height(11).appendTo(this.popover.hyperlink);this.popover.container.attr("data-has-hyperlink",true)}this.hyperlink.attr({href:a,target:"blank"});this.popover.hyperlink.attr("href",a).attr("target","_blank");this.CalcBodySize();jMap.resolveRendering()};jZoomableTreemapNode.prototype.setFile=function(c){if(!jMap.saveAction.isAlive()){return null}var f=jMap.historyManager;var a=f&&f.extractNode(this);this.setFileExecute(c);var b=f&&f.extractNode(this);f&&f.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_FILE,this);jMap.setSaved(false)};jZoomableTreemapNode.prototype.setFileExecute=function(a){if(a==null||a==""){if(this.file){this.file=null;this.popover.file.remove();this.popover.file=null;this.popover.container.removeAttr("data-has-file");this.CalcBodySize()}return}if(!this.file){this.file=RAPHAEL.image(jMap.cfg.contextPath+"/menu/icons/icon_file.png",0,0,24,24);this.popover.file=$("<a></a>").attr("class","jpopover-file").appendTo(this.popover.iconMenus);$("<img />").attr("src",jMap.cfg.contextPath+"/menu/icons/icon_file.png").width(24).height(24).appendTo(this.popover.file);this.popover.container.attr("data-has-file",true)}this.file.attr({href:a,target:"blank"});this.popover.file.attr("href",a).attr("target","_blank");this.CalcBodySize();jMap.resolveRendering()};jZoomableTreemapNode.prototype.setNote=function(a){if(!jMap.saveAction.isAlive()){return null}var f=jMap.historyManager;var b=f&&f.extractNode(this);this.setNoteExecute(a);var c=f&&f.extractNode(this);f&&f.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_NOTE,this);jMap.setSaved(false)};jZoomableTreemapNode.prototype.setNoteExecute=function(a){if(a==null||a==""){if(this.note){this.note=null;this.popover.note.remove();this.popover.note=null;this.popover.container.removeAttr("data-has-note");this.CalcBodySize()}return}if(!this.note){this.note=RAPHAEL.image(jMap.cfg.contextPath+"/menu/icons/icon_note.png",0,0,24,24);this.popover.note=$("<a></a>").attr("class","jpopover-note").appendTo(this.popover.iconMenus);$("<img />").attr("src",jMap.cfg.contextPath+"/menu/icons/icon_note.png").width(24).height(24).appendTo(this.popover.note);this.popover.container.attr("data-has-note",true)}this.noteText=a;this.popover.note.attr({href:"javascript:showNoteAction('"+this.id+"');"});this.CalcBodySize();jMap.resolveRendering()};jZoomableTreemapNode.prototype.setImage=function(c,f,a){if(!jMap.saveAction.isAlive()){return null}var g=jMap.historyManager;var b=g&&g.extractNode(this);this.setImageExecute(c,f,a,function(){var k=g&&g.extractNode(this);g&&g.addToHistory(b,k);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_IMAGE,this.id,c,f,a);jMap.setSaved(false)})};jZoomableTreemapNode.prototype.setImageExecute=function(c,g,b,a){if(c==null||c==""){if(this.img){this.img=null;this.imgInfo={};this.popover.img.remove();this.popover.img=null;this.CalcBodySize();a&&a.call(this)}return false}var k=this;checkGifNotiStatus(c);var f=$("<img />").attr("src",c).load(function(){var m=jMap.cfg.default_img_size;var l={width:0,height:0};if(this.width>m){l.width=m;l.height=(this.height*m)/this.width}else{l.width=this.width;l.height=this.height}if(g){l.width=g}if(b){l.height=b}l.width=parseInt(l.width);l.height=parseInt(l.height);if(k.img){k.img.attr({src:this.src,width:l.width,height:l.height});k.imgInfo.href=this.src;k.imgInfo.width=l.width;k.imgInfo.height=l.height;k.popover.img.attr("src",this.src).width(l.width).height(l.height)}else{k.img=RAPHAEL.image(this.src,0,0,l.width,l.height);k.imgInfo.href=this.src;k.imgInfo.width=l.width;k.imgInfo.height=l.height;k.popover.img=$("<img />").attr("class","jpopover-img").attr("src",this.src).width(l.width).height(l.height).appendTo(k.popover.body)}jMap.loadManager.updateImageLoading(this);a&&a.call(k);return true}).error(function(){var l=jMap.cfg.contextPath+"/images/image_broken.png";if(k.img){k.img.attr({src:l,width:64,height:64});k.imgInfo.href=c;k.imgInfo.width=g&&g;k.imgInfo.height=b&&b;k.popover.img.attr("src",l).width(64).height(64)}else{k.img=RAPHAEL.image(jMap.cfg.contextPath+"/images/image_broken.png",0,0,64,64);k.imgInfo.href=c;k.imgInfo.width=g&&g;k.imgInfo.height=b&&b;k.popover.img=$("<img />").attr("class","jpopover-img").attr("src",l).width(64).height(64).appendTo(k.popover.body)}jMap.loadManager.updateImageLoading(this);a&&a.call(k)});jMap.loadManager.updateImageLoading(f[0])};jZoomableTreemapNode.prototype.imageResize=function(f,a){if(!jMap.saveAction.isAlive()){return null}var g=jMap.historyManager;var b=g&&g.extractNode(this);this.imageResizeExecute(f,a);var c=g&&g.extractNode(this);g&&g.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_IMAGE,this.id,null,f,a);jMap.setSaved(false)};jZoomableTreemapNode.prototype.imageResizeExecute=function(b,a){this.img&&this.img.attr({width:b,height:a});this.imgInfo.width=b;this.imgInfo.height=a;this.popover.img.width(b).height(a)};jZoomableTreemapNode.prototype.setForeignObject=function(f,g,a){if(!jMap.saveAction.isAlive()){return null}var k=jMap.historyManager;var b=k&&k.extractNode(this);this.setForeignObjectExecute(f,g,a);var c=k&&k.extractNode(this);k&&k.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_FOREIGNOBJECT,this,f,g,a);jMap.setSaved(false)};jZoomableTreemapNode.prototype.setForeignObjectExecute=function(c,f,a){if(!Raphael.svg){return false}if(c==null||c==""){this.foreignObjEl=null;if(this.popover.foreignObjEl){this.popover.foreignObjEl.remove()}this.popover.foreignObjEl=null;this.CalcBodySize();return false}c=convertXML2Char(c);if(!this.foreignObjEl){this.foreignObjEl=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");this.foreignObjEl.bodyEl=document.createElementNS("http://www.w3.org/1999/xhtml","body");this.foreignObjEl.appendChild(this.foreignObjEl.bodyEl);this.popover.foreignObjEl=$("<div></div>").attr("class","jpopover-foreignObjEl").appendTo(this.popover.body)}f=f||150;a=a||150;this.foreignObjEl.setAttribute("width",f);this.foreignObjEl.setAttribute("height",a);this.popover.foreignObjEl.width(f);this.popover.foreignObjEl.height(a);this.foreignObjEl.bodyEl.innerHTML=c;this.foreignObjEl.plainHtml=c;this.popover.foreignObjEl.html(c);if(BrowserDetect.browser=="MSIE"){var g=c.search(/youtube\.com/);if(g!=-1){var b='<img src="'+jMap.cfg.contextPath+'/images/video_not_support.png" width="300" height="300"/>';this.foreignObjEl.bodyEl.innerHTML=b;this.popover.foreignObjEl.html(b)}}this.CalcBodySize()};jZoomableTreemapNode.prototype.foreignObjectResize=function(f,a){if(!jMap.saveAction.isAlive()){return null}var g=jMap.historyManager;var b=g&&g.extractNode(this);this.foreignObjectResizeExecute(f,a);var c=g&&g.extractNode(this);g&&g.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_FOREIGNOBJECT,this,null,f,a);jMap.setSaved(false)};jZoomableTreemapNode.prototype.foreignObjectResizeExecute=function(c,a){c&&this.foreignObjEl.setAttribute("width",c);a&&this.foreignObjEl.setAttribute("height",a);c&&this.popover.foreignObjEl.width(c);a&&this.popover.foreignObjEl.height(a);var b=this.foreignObjEl.plainHtml;b=b.replace(/(width=")([^"]*)/ig,"$1"+c);b=b.replace(/(height=")([^"]*)/ig,"$1"+a);this.foreignObjEl.bodyEl.innerHTML=b;this.foreignObjEl.plainHtml=b;this.popover.foreignObjEl.html(b);this.CalcBodySize();jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(this);jMap.layoutManager.layout(true)};jZoomableTreemapNode.prototype.setEmbedVideo=function(f){var g=/width?=?["']([^"']*)/gi;var c=g.exec(f)[1];var b=/height?=?["']([^"']*)/gi;var a=b.exec(f)[1];this.setForeignObject(f,c,a)};jZoomableTreemapNode.prototype.setVideo=function(g,c,a){var f=jMap.cfg.default_video_size;var b='<embed src="'+g+'" width="'+c+'"  height="'+a+'"></embed>';this.setHyperlink(g);this.setForeignObject(b,c,a)};jZoomableTreemapNode.prototype.setYoutubeVideo=function(m,k,a){var l=jMap.cfg.default_video_size;if(k==null){k=l}if(a==null){a=l}var g=/v[=\/]([^&]*)/ig;var c=g.exec(m);if(c){var b="https://www.youtube.com/embed/"+c[1];var f='<iframe src="'+b+'" frameborder="0" allowtransparency="true" width="'+k+'"  height="'+a+'" scrolling="no"></iframe>';this.setHyperlink(m);this.setForeignObject(f,k,a)}};jZoomableTreemapNode.prototype.zoomExecute=function(l){var k=jMap.layoutManager;var g=k.getCenterLocation();var f=this;l=(l==undefined?k.duration:l);k.hideAllPopover();jMap.arcTweenNode=f;var c=k.width/f.dx,b=k.height/f.dy;k.x.domain([f.x,f.x+f.dx]);k.y.domain([f.y,f.y+f.dy]);var a=d3.selectAll('g[data-node-type="'+jMap.cfg.nodeStyle+'"][data-node-leaf="true"]').transition().duration(l).attr("transform",function(m){return"translate("+[g.x+k.x(m.x),g.y+k.y(m.y)]+")"});a.select("rect").attr("width",function(m){return c*m.dx-1}).attr("height",function(m){jMap.nodes[m.id].pWidth=c*m.dx-1;jMap.nodes[m.id].pHeight=b*m.dy-1;return b*m.dy-1});a.select("text").style("opacity",function(n){var m=jMap.nodes[n.id].plainText.split(/\r\n|\n|\r/);return(b*n.dy-1)<(m.length*jMap.cfg.nodeFontSizes[1])?0:1}).attr("transform",function(m){setTimeout(function(){jMap.nodes[m.id].computedTextExecute()},l);return"translate("+(c*m.dx/2)+","+(b*m.dy/2)+")"});return{end:function(m){setTimeout(function(){m()},l)}}};jZoomableTreemapNode.prototype.getChildren=function(){return this.children||[]};jZoomableTreemapNode.prototype.screenFocus=function(){this.zoomExecute()};jZoomableTreemapNode.prototype.showPopover=function(){var a=this.getPopoverLocation();this.popover.container.attr("style","top: "+(a.top)+"px; left: "+(a.left)+"px;");this.popover.container.addClass("active");this.popover.container.attr("data-placement","right")};jZoomableTreemapNode.prototype.hidePopover=function(){this.popover.container.removeClass("active")};jZoomableTreemapNode.prototype.getPopoverLocation=function(){var m=this.groupEl.getBBox();var l=$(this.groupEl).offset();l.top+=(m.height/2)*jMap.cfg.scale;l.left+=(m.width/2)*jMap.cfg.scale;var b=$("#ribbon").height()+10;var k=this.popover.container.width();var a=this.popover.container.height();var c=$(window).width();var g=$(window).height();var f=5;if(l.top<b+f){l.top=b+f}else{if(l.top+a>g-f){l.top=g-a-f}}if(this.angle>90){if(l.left-k<f){l.left=f+k}}else{if(l.left<f){l.left=f}else{if(l.left+k>c-f){l.left=c-f-k}}}return l};jSunburstNode.prototype.hidePopover=function(){this.popover.container.removeClass("active")};jZoomableTreemapNode.prototype.getPartitionTreeData=function(){var a={};a.id=this.id;if(this.children.length){a.children=[];this.children.forEach(function(b){a.children.push(b.getPartitionTreeData())})}return a};jZoomableTreemapNode.prototype.getText=function(){return this.plainText};jZoomableTreemapNode.prototype.computedTextExecute=function(){var f=this;var c=f.pWidth;var b=Math.floor((c-2*jMap.layoutManager.padding)/(parseFloat(jMap.cfg.nodeFontSizes[1])/2))-4;var a={text:f.plainText};if(f.plainText.length>b){var g=f.plainText.slice(0,b);a.text=g==""?"":g+"..."}this.text.attr(a)};jZoomableTreemapNode.prototype.toXML=function(o){var k=new StringBuffer();var l=false;if(this.img!=null||(this.text.attrs.text!=null&&this.text.attrs.text.indexOf("\n")!=-1)){l=true}var g=new StringBuffer();g.add("<node");g.add('CREATED="'+this.created+'"');g.add('ID="'+this.id+'"');g.add('MODIFIED="'+this.modified+'"');g.add('CREATOR="'+this.creator+'"');g.add('CLIENT_ID="'+this.client_id+'"');if(!l){g.add('TEXT="'+convertCharStr2SelectiveCPs(convertCharStr2XML(this.plainText,true,true),"ascii",true,"&#x",";","hex")+'"')}g.add('FOLDED="'+this.folded+'"');if(this.background_color!=""){g.add('BACKGROUND_COLOR="'+this.background_color+'"')}if(this.color!=""){g.add('COLOR="'+this.color+'"')}if(this.hyperlink!=null){g.add('LINK="'+convertCharStr2XML(this.hyperlink.attr().href)+'"')}if(this.file!=null){g.add('FILE="'+convertCharStr2XML(this.file.attr().href)+'"')}if(this.noteText!=null){g.add('NOTE="'+convertCharStr2XML(this.noteText)+'"')}if(this.position!=""&&this.position!="undefined"){g.add('POSITION="'+this.position+'"')}if(this.style!=""){g.add('STYLE="'+this.style+'"')}if(this.hgap){g.add('HGAP="'+this.hgap+'"')}if(this.vgap){g.add('VGAP="'+this.vgap+'"')}if(this.vshift){g.add('VSHIFT="'+this.vshift+'"')}if(this.numofchildren!=null){g.add('NUMOFCHILDREN="'+this.numofchildren+'"')}g.add(">");k.add(g.toString(" "));if(l){var a=new StringBuffer();a.add('<richcontent TYPE="NODE"><html>\n');a.add("  <head>\n");a.add("\n");a.add("  </head>\n");a.add("  <body>\n");if(this.img!=null){a.add("    <p>\n");a.add('      <img src="'+this.imgInfo.href+'" width="'+this.imgInfo.width+'" height="'+this.imgInfo.height+'" />\n');a.add("    </p>\n")}if(this.text.attrs.text!=null){var n=JinoUtil.trimStr(this.text.attrs.text).split("\n");for(var m=0;m<n.length;m++){a.add("<p>"+convertCharStr2SelectiveCPs(convertCharStr2XML(n[m],true,true),"ascii",true,"&#x",";","hex")+"</p>\n")}}a.add("  </body>\n");a.add("</html>\n");a.add("</richcontent>");k.add(a.toString(" "))}if(this.arrowlinks.length>0){for(var m=0;m<this.arrowlinks.length;m++){k.add(this.arrowlinks[m].toXML())}}if(this.foreignObjEl){var b=new StringBuffer();b.add('<foreignObject WIDTH="'+this.foreignObjEl.getAttribute("width")+'" HEIGHT="'+this.foreignObjEl.getAttribute("height")+'">');var p=this.foreignObjEl.plainHtml;p=p.split('class="lazy-load"').join("");p=p.replace(" data-src="," src=");b.add(convertCharStr2SelectiveCPs(p,"ascii",true,"&#x",";","hex"));b.add("</foreignObject>");k.add(b.toString(" "))}for(var q in this.attributes){k.add("<attribute NAME='"+q+"' VALUE='"+convertCharStr2SelectiveCPs(convertCharStr2XML(String(this.attributes[q]),true,true),"ascii",true,"&#x",";","hex")+"'/>")}var c=new StringBuffer();c.add("<info");if(this.lazycomplete){c.add('LAZYCOMPLETE="'+this.lazycomplete+'"')}c.add("/>");k.add(c.toString(" "));var f=this.getChildren();if(f.length>0&&o==null){for(var m=0;m<f.length;m++){k.add(f[m].toXML())}}k.add("</node>");return k.toString("\n")};jZoomableTreemapNode.prototype.setFolding=function(a){if(jMap.jDebug){console.log("setFolding")}};jZoomableTreemapNode.prototype.hideChildren=function(a){if(jMap.jDebug){console.log("hideChildren")}};jZoomableTreemapNode.prototype.relativeCoordinate=function(b,a){if(jMap.jDebug){console.log("relativeCoordinate")}};jZoomableTreemapNode.prototype.relativeCoordinateExecute=function(b,a){if(jMap.jDebug){console.log("relativeCoordinateExecute")}};jZoomableTreemapNode.prototype.getLocation=function(){var a=this.getPopoverLocation();return{x:a.top,y:a.left}};jZoomableTreemapNode.prototype.setFontSizeExecute=function(a){};jZoomableTreemapNode.prototype.setEdgeColorExecute=function(a,b){if(a){this.edge.color=a;this.body.attr({stroke:a});this.folderShape&&this.folderShape.attr({stroke:a})}if(b){}};jPadletNode=function(g){var b=g.parent;var f=g.text;var k=g.id;var c=g.index;var a=g.position;this.sibling=g.sibling;jPadletNode.superclass.call(this,b,f,k,c,a);if(!this.attributes){this.attributes={}}};extend(jPadletNode,jMindMapNode);jPadletNode.prototype.type="jPadletNode";jPadletNode.prototype.initElements=function(){this.body=RAPHAEL.rect();this.text=RAPHAEL.text();this.folderShape=RAPHAEL.circle(0,0,FOLDER_RADIUS);this.wrapElements(this.body,this.text,this.folderShape)};jPadletNode.prototype.create=function(){this.connection=null;var b=this.body;var m=this.text;var k=this.folderShape;b.attr({r:NODE_CORNER_ROUND,rx:NODE_CORNER_ROUND,ry:NODE_CORNER_ROUND});if(this.sibling){var g=this.sibling.getLocation();var l=this.sibling.getSize();this.attributes.padlet_x=""+(parseFloat(g.x)+0);this.attributes.padlet_y=""+(parseFloat(g.y)+parseFloat(l.height)+20);this.setLocation(this.attributes.padlet_x,this.attributes.padlet_y)}else{if(this.getParent()){var g=this.getParent().getLocation();var l=this.getParent().getSize();this.attributes.padlet_x=""+(parseFloat(g.x)+parseFloat(l.width)+20);this.attributes.padlet_y=""+(parseFloat(g.y)+0);this.setLocation(this.attributes.padlet_x,this.attributes.padlet_y)}}this.setBackgroundColorExecute(jMap.cfg.nodeDefalutColor);this.setTextColorExecute(jMap.cfg.textDefalutColor);this.setEdgeColorExecute(jMap.cfg.edgeDefalutColor,jMap.cfg.edgeDefalutWidth);var f=jMap.cfg.branchDefalutWidth;if(this.getDepth()==1){f=8}this.setBranchExecute(jMap.cfg.branchDefalutColor,f,null);if(typeof NodeColorMix!=="undefined"){NodeColorMix.rawDressColor(this)}var c=400;var a="Malgun Gothic, 맑은고딕, Gulim, 굴림, Arial, sans-serif";if(!this.getParent()){this.fontSize=jMap.cfg.nodeFontSizes[0];c="700"}else{if(this.getParent()&&this.getParent().isRootNode()){this.fontSize=jMap.cfg.nodeFontSizes[1];c="700"}else{this.fontSize=jMap.cfg.nodeFontSizes[2];c="400"}}if(this.isRootNode()){m.attr({"font-family":a,"font-size":this.fontSize,"font-weight":c})}else{m.attr({"font-family":a,"font-size":this.fontSize,"font-weight":c,"text-anchor":"start"})}this.setTextExecute(this.plainText)};jPadletNode.prototype.getSize=function(){return{width:this.body.getBBox().width,height:this.body.getBBox().height}};jPadletNode.prototype.setSize=function(b,a){this.body.attr({width:b,height:a})};jPadletNode.prototype.getLocation=function(){return{x:this.body.getBBox().x,y:this.body.getBBox().y}};jPadletNode.prototype.setLocation=function(b,c){var a=this.body;if(b&&!c){a.attr({x:b})}else{if(!b&&c){a.attr({y:c})}else{a.attr({x:b,y:c})}}this.updateNodeShapesPos()};jPadletNode.prototype.CalcBodySize=function(){var g=0;var a=0;var b=TEXT_HGAP;var f=TEXT_VGAP;if(this.getText()!=""){g+=this.text.getBBox().width;a+=this.text.getBBox().height}if(this.img){g=(g<this.img.getBBox().width)?this.img.getBBox().width:g;a+=this.img.getBBox().height}if(this.foreignObjEl){var c=parseInt(this.foreignObjEl.getAttribute("width"));var k=parseInt(this.foreignObjEl.getAttribute("height"));g=(g<c)?c:g;a+=k}if(this.hyperlink){g+=this.hyperlink.getBBox().width+b/2}if(this.file){g+=this.file.getBBox().width+b/2}if(this.note){g+=this.note.getBBox().width+b/2}if(g==0||a==0){this.text.attr({text:"_"});g+=this.text.getBBox().width;a+=this.text.getBBox().height;this.text.attr({text:""})}if(g<parseInt(jMap.cfg.default_node_size)){g=parseInt(jMap.cfg.default_node_size)}this.setSize(g+b,a+f)};jPadletNode.prototype.updateNodeShapesPos=function(){var o=TEXT_HGAP;var t=TEXT_VGAP;var p=0;var s=this.body;var w=this.text;var k=this.folderShape;var F=this.img;var l=this.hyperlink;var c=this.note;var D=this.file;var g=this.foreignObjEl;var r=s.getBBox().x;var q=s.getBBox().y;var f=0;var b=0;switch(jMap.layoutManager.type){case"jMindMapLayout":f=this.isLeft()?r:r+this.body.getBBox().width;b=q+this.body.getBBox().height/2;break;case"jTreeLayout":f=r+this.body.getBBox().width/2;b=q+this.body.getBBox().height;break;case"jFishboneLayout":f=this.isLeft()?r:r+this.body.getBBox().width;b=q+this.body.getBBox().height/2;break;default:f=r;b=q;break}this.folderShape.attr({cx:f,cy:b});if(F){var B=r+o/2;var A=q+t/2;if(this.isRootNode()){B+=(s.getBBox().width/2)-(F.getBBox().width/2)-o/2}F.attr({x:B,y:A});p+=F.getBBox().height}if(g){var v=r+o/2;var u=q+p+t/2;p+=parseInt(g.getAttribute("height"));g.setAttribute("x",v);g.setAttribute("y",u)}if(w){var n=r+o/2;var m=q+(t+w.getBBox().height)/2;if(this.isRootNode()){n+=s.getBBox().width/2-o/2}m+=p;w.attr({x:n,y:m})}var a=this.getLocation().x+this.getSize().width;if(c){a=a-c.getBBox().width-3;var C=this.getLocation().y+(this.getSize().height-c.getBBox().height)/2;c&&c.attr({x:a,y:C})}if(D){a=a-D.getBBox().width-3;var E=this.getLocation().y+(this.getSize().height-D.getBBox().height)/2;D&&D.attr({x:a,y:E})}if(l){a=a-l.getBBox().width-3;var z=this.getLocation().y+(this.getSize().height-l.getBBox().height)/2;l&&l.attr({x:a,y:z})}this.connection&&this.connection.updateLine()};jPadletNode.prototype.getInputPort=function(){var a=this.body.getBBox();var b=0;var c=0;if(isFinite(a.width)&&!isNaN(a.width)){b=a.width}if(isFinite(a.height)&&!isNaN(a.height)){c=a.height}switch(jMap.layoutManager.type){case"jMindMapLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft&&this.isLeft()){return{x:a.x+b+1,y:a.y+c/2}}else{return{x:a.x-1,y:a.y+c/2}}break;case"jTreeLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c}}return{x:a.x+b/2,y:a.y};break;case"jRotateLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft&&this.isLeft()){return{x:a.x-1,y:a.y+c/2}}else{return{x:a.x-1,y:a.y+c/2}}break;case"jTableLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c}}return{x:a.x+b/2,y:a.y};break;case"jFishboneLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft&&this.isLeft()){return{x:a.x+b+1,y:a.y+c/2}}else{return{x:a.x-1,y:a.y+c/2}}break;default:return{x:a.x,y:a.y};break}};jPadletNode.prototype.getOutputPort=function(){var a=this.body.getBBox();var b=0;var c=0;if(isFinite(a.width)&&!isNaN(a.width)){b=a.width}if(isFinite(a.height)&&!isNaN(a.height)){c=a.height}switch(jMap.layoutManager.type){case"jMindMapLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft()){return{x:a.x-1,y:a.y+c/2}}else{return{x:a.x+b+1,y:a.y+c/2}}break;case"jTreeLayout":return{x:a.x+b/2,y:a.y+c};break;case"jRotateLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft&&this.isLeft()){return{x:a.x+b+1,y:a.y+c/2}}else{return{x:a.x+b+1,y:a.y+c/2}}break;case"jTableLayout":return{x:a.x+b/2,y:a.y+c};break;case"jFishboneLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft()){return{x:a.x-1,y:a.y+c/2}}else{return{x:a.x+b+1,y:a.y+c/2}}break;default:return{x:a.x,y:a.y};break}};jPadletNode.prototype.toString=function(){return"jPadletNode"};jPadletNode.prototype.relativeCoordinateExecute=function(b,a){this.attributes.padlet_x=parseFloat(""+this.attributes.padlet_x)+b;this.attributes.padlet_y=parseFloat(""+this.attributes.padlet_y)+a;jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(this);jMap.layoutManager.layout(true)};jPartitionNodeController=function(){jPartitionNodeController.superclass.call(this)};extend(jPartitionNodeController,jNodeController);jPartitionNodeController.prototype.type="jPartitionNodeController";jPartitionNodeController.prototype.dblclick=function(c){var b=jMap.getSelected();var a;if(!c){var c=window.event}a=c.originalEvent.originalEvent||c.originalEvent||c;if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}if(b.children.length&&jMap.arcTweenNode.id!=b.id){b.zoomExecute()}else{jMap.getRootNode().zoomExecute()}};jPartitionNodeController.prototype.mouseenter=function(a){this.node.showPopover()};jPartitionNodeController.prototype.mouseleave=function(b){var c="data-popover-id";var a=b.toElement||b.relatedTarget;if($(a).closest(".jpopover").parent().attr(c)!=this.node.popover.container.attr(c)){this.node.hidePopover()}};jPartitionNodeController.prototype.popoverMouseleave=function(a){var b=$(this).parent().attr("data-popover-id");if(jMap.nodes[b]){jMap.nodes[b].hidePopover()}};jPartitionNodeControllerGuest=function(){jPartitionNodeControllerGuest.superclass.call(this)};extend(jPartitionNodeControllerGuest,jNodeControllerGuest);jPartitionNodeControllerGuest.prototype.type="jPartitionNodeControllerGuest";jPartitionNodeControllerGuest.prototype.dblclick=function(b){var a;if(!b){var b=window.event}a=b.originalEvent.originalEvent||b.originalEvent||b;if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}if(this.node.children.length&&jMap.arcTweenNode.id!=this.node.id){this.node.zoomExecute()}else{jMap.getRootNode().zoomExecute()}};jPartitionNodeControllerGuest.prototype.mouseenter=function(a){this.node.showPopover()};jPartitionNodeControllerGuest.prototype.mouseleave=function(b){var c="data-popover-id";var a=b.toElement||b.relatedTarget;if($(a).closest(".jpopover").parent().attr(c)!=this.node.popover.container.attr(c)){this.node.hidePopover()}};jPartitionNodeControllerGuest.prototype.popoverMouseleave=function(a){var b=$(this).parent().attr("data-popover-id");if(jMap.nodes[b]){jMap.nodes[b].hidePopover()}};jPartitionNode=function(g){var b=g.parent;var f=g.text;var k=g.id;var c=g.index;var a=g.position;this.popover={container:null,body:null,text:null,img:null,hyperlink:null,foreignObjEl:null};jPartitionNode.superclass.call(this,b,f,k,c,a)};extend(jPartitionNode,jNode);jPartitionNode.prototype.type="jPartitionNode";jPartitionNode.prototype.initElements=function(){this.body=RAPHAEL.rect();this.text=RAPHAEL.text();this.wrapElements(this.body,this.text);this.popover.container=$('<div data-popover-type="'+this.type+'" data-popover-id="'+this.id+'"><div class="jpopover"></div></div>').appendTo(jMap.popoverContainer);this.popover.body=$('<div class="jpopover-body"></div>').appendTo(this.popover.container.children(".jpopover"));this.popover.text=$('<div class="jpopover-text"></div>').appendTo(this.popover.container.children(".jpopover"));this.popover.iconMenus=$('<div class="jpopover-menu"></div>').appendTo(this.popover.container.children(".jpopover"))};jPartitionNode.prototype.create=function(){var c=jMap.layoutManager.getCenterLocation();this.position=this.position||((this.parent&&this.parent.position)?this.parent.position:"left");this.groupEl.setAttribute("data-node-type",this.type);this.groupEl.setAttribute("data-node-id",this.id);this.groupEl.setAttribute("pointer-events","all");this.body.node.setAttribute("pointer-events","all");this.setBackgroundColorExecute(jMap.cfg.nodeDefalutColor);this.setTextColorExecute(jMap.cfg.textDefalutColor);if(typeof NodeColorMix!=="undefined"){NodeColorMix.rawDressColor(this)}this.setEdgeColorExecute(jMap.cfg.edgeDefalutColor,jMap.cfg.edgeDefalutWidth);var b=400;var a="Malgun Gothic, 맑은고딕, Gulim, 굴림, Arial, sans-serif";this.fontSize=jMap.cfg.nodeFontSizes[3];if(!this.getParent()){b="700";this.fontSize=jMap.cfg.nodeFontSizes[1]}else{if(this.getParent()&&this.getParent().isRootNode()){b="600";this.fontSize=jMap.cfg.nodeFontSizes[2]}else{b="400"}}this.text.attr({"font-family":a,"font-size":this.fontSize,"font-weight":b,"text-anchor":null});$(this.text.node).css("pointer-events","none");this.setTextExecute(this.plainText)};var custom_partition_touchtime=0;jPartitionNode.prototype.addEventController=function(b){b=jMap.mode?new jPartitionNodeController():new jPartitionNodeControllerGuest();this.controller=b;$(this.groupEl).on("vmousedown",b.mousedown);$(this.groupEl).on("vmousemove",b.mousemove);$(this.groupEl).on("vmouseup",b.mouseup);$(this.groupEl).on("mouseover",b.mouseenter);$(this.groupEl).on("mouseout",b.mouseleave);this.popover.container.children(".jpopover").on("mouseleave",b.popoverMouseleave);var a=this;this.popover.container.children(".jpopover").on("vclick",function(){if(custom_partition_touchtime==0){custom_partition_touchtime=new Date().getTime()}else{if(((new Date().getTime())-custom_partition_touchtime)<400){custom_partition_touchtime=0;if(!jMap.cfg.isShrdGuest){jMap.controller.startNodeEdit(a)}}else{custom_partition_touchtime=new Date().getTime()}}});$(this.groupEl).on("taphold",b.taphold);$(this.groupEl).on("vclick",b.click)};jPartitionNode.prototype.setTextExecute=function(a){this.plainText=a;this.text.attr({text:a.split("\n")[0]});this.CalcBodySize();if(a.indexOf("\n")){a=a.split("\n").join("<br>")}this.popover.text.html(a)};jPartitionNode.prototype.setHyperlink=function(c){if(!jMap.saveAction.isAlive()){return null}var f=jMap.historyManager;var a=f&&f.extractNode(this);this.setHyperlinkExecute(c);var b=f&&f.extractNode(this);f&&f.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_HYPER,this);jMap.setSaved(false)};jPartitionNode.prototype.setHyperlinkExecute=function(a){if(a==null||a==""){if(this.hyperlink){this.hyperlink=null;this.popover.hyperlink.remove();this.popover.hyperlink=null;this.popover.container.removeAttr("data-has-hyperlink");this.CalcBodySize()}return}if(!this.hyperlink){this.hyperlink=RAPHAEL.image(jMap.cfg.contextPath+"/images/hyperlink.png",0,0,11,11);this.hyperlink.attr({cursor:"pointer"});this.popover.hyperlink=$("<a></a>").attr("class","jpopover-hyperlink").appendTo(this.popover.body);$("<img />").attr("src",jMap.cfg.contextPath+"/images/hyperlink.png").width(11).height(11).appendTo(this.popover.hyperlink);this.popover.container.attr("data-has-hyperlink",true)}this.hyperlink.attr({href:a,target:"blank"});this.popover.hyperlink.attr("href",a).attr("target","_blank");this.CalcBodySize();jMap.resolveRendering()};jPartitionNode.prototype.setFile=function(c){if(!jMap.saveAction.isAlive()){return null}var f=jMap.historyManager;var a=f&&f.extractNode(this);this.setFileExecute(c);var b=f&&f.extractNode(this);f&&f.addToHistory(a,b);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_FILE,this);jMap.setSaved(false)};jPartitionNode.prototype.setFileExecute=function(a){if(a==null||a==""){if(this.file){this.file=null;this.popover.file.remove();this.popover.file=null;this.popover.container.removeAttr("data-has-file");this.CalcBodySize()}return}if(!this.file){this.file=RAPHAEL.image(jMap.cfg.contextPath+"/menu/icons/icon_file.png",0,0,24,24);this.popover.file=$("<a></a>").attr("class","jpopover-file").appendTo(this.popover.iconMenus);$("<img />").attr("src",jMap.cfg.contextPath+"/menu/icons/icon_file.png").width(24).height(24).appendTo(this.popover.file);this.popover.container.attr("data-has-file",true)}this.file.attr({href:a,target:"blank"});this.popover.file.attr("href",a).attr("target","_blank");this.CalcBodySize();jMap.resolveRendering()};jPartitionNode.prototype.setNote=function(a){if(!jMap.saveAction.isAlive()){return null}var f=jMap.historyManager;var b=f&&f.extractNode(this);this.setNoteExecute(a);var c=f&&f.extractNode(this);f&&f.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_NOTE,this);jMap.setSaved(false)};jPartitionNode.prototype.setNoteExecute=function(a){if(a==null||a==""){if(this.note){this.note=null;this.popover.note.remove();this.popover.note=null;this.popover.container.removeAttr("data-has-note");this.CalcBodySize()}return}if(!this.note){this.note=RAPHAEL.image(jMap.cfg.contextPath+"/menu/icons/icon_note.png",0,0,24,24);this.popover.note=$("<a></a>").attr("class","jpopover-note").appendTo(this.popover.iconMenus);$("<img />").attr("src",jMap.cfg.contextPath+"/menu/icons/icon_note.png").width(24).height(24).appendTo(this.popover.note);this.popover.container.attr("data-has-note",true)}this.noteText=a;this.popover.note.attr({href:"javascript:showNoteAction('"+this.id+"');"});this.CalcBodySize();jMap.resolveRendering()};jPartitionNode.prototype.setImage=function(c,f,a){if(!jMap.saveAction.isAlive()){return null}var g=jMap.historyManager;var b=g&&g.extractNode(this);this.setImageExecute(c,f,a,function(){var k=g&&g.extractNode(this);g&&g.addToHistory(b,k);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_IMAGE,this.id,c,f,a);jMap.setSaved(false)})};jPartitionNode.prototype.setImageExecute=function(c,g,b,a){if(c==null||c==""){if(this.img){this.img=null;this.imgInfo={};this.popover.img.remove();this.popover.img=null;this.CalcBodySize();a&&a.call(this)}return false}var k=this;checkGifNotiStatus(c);var f=$("<img />").attr("src",c).load(function(){var m=jMap.cfg.default_img_size;var l={width:0,height:0};if(this.width>m){l.width=m;l.height=(this.height*m)/this.width}else{l.width=this.width;l.height=this.height}if(g){l.width=g}if(b){l.height=b}l.width=parseInt(l.width);l.height=parseInt(l.height);if(k.img){k.img.attr({src:this.src,width:l.width,height:l.height});k.imgInfo.href=this.src;k.imgInfo.width=l.width;k.imgInfo.height=l.height;k.popover.img.attr("src",this.src).width(l.width).height(l.height)}else{k.img=RAPHAEL.image(this.src,0,0,l.width,l.height);k.imgInfo.href=this.src;k.imgInfo.width=l.width;k.imgInfo.height=l.height;k.popover.img=$("<img />").attr("class","jpopover-img").attr("src",this.src).width(l.width).height(l.height).appendTo(k.popover.body)}jMap.loadManager.updateImageLoading(this);a&&a.call(k);return true}).error(function(){var l=jMap.cfg.contextPath+"/images/image_broken.png";if(k.img){k.img.attr({src:l,width:64,height:64});k.imgInfo.href=c;k.imgInfo.width=g&&g;k.imgInfo.height=b&&b;k.popover.img.attr("src",l).width(64).height(64)}else{k.img=RAPHAEL.image(jMap.cfg.contextPath+"/images/image_broken.png",0,0,64,64);k.imgInfo.href=c;k.imgInfo.width=g&&g;k.imgInfo.height=b&&b;k.popover.img=$("<img />").attr("class","jpopover-img").attr("src",l).width(64).height(64).appendTo(k.popover.body)}jMap.loadManager.updateImageLoading(this);a&&a.call(k)});jMap.loadManager.updateImageLoading(f[0])};jPartitionNode.prototype.imageResize=function(f,a){if(!jMap.saveAction.isAlive()){return null}var g=jMap.historyManager;var b=g&&g.extractNode(this);this.imageResizeExecute(f,a);var c=g&&g.extractNode(this);g&&g.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_IMAGE,this.id,null,f,a);jMap.setSaved(false)};jPartitionNode.prototype.imageResizeExecute=function(b,a){this.img&&this.img.attr({width:b,height:a});this.imgInfo.width=b;this.imgInfo.height=a;this.popover.img.width(b).height(a)};jPartitionNode.prototype.setForeignObject=function(f,g,a){if(!jMap.saveAction.isAlive()){return null}var k=jMap.historyManager;var b=k&&k.extractNode(this);this.setForeignObjectExecute(f,g,a);var c=k&&k.extractNode(this);k&&k.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_FOREIGNOBJECT,this,f,g,a);jMap.setSaved(false)};jPartitionNode.prototype.setForeignObjectExecute=function(c,f,a){if(!Raphael.svg){return false}if(c==null||c==""){this.foreignObjEl=null;if(this.popover.foreignObjEl){this.popover.foreignObjEl.remove()}this.popover.foreignObjEl=null;this.CalcBodySize();return false}c=convertXML2Char(c);if(!this.foreignObjEl){this.foreignObjEl=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");this.foreignObjEl.bodyEl=document.createElementNS("http://www.w3.org/1999/xhtml","body");this.foreignObjEl.appendChild(this.foreignObjEl.bodyEl);this.popover.foreignObjEl=$("<div></div>").attr("class","jpopover-foreignObjEl").appendTo(this.popover.body)}f=f||150;a=a||150;this.foreignObjEl.setAttribute("width",f);this.foreignObjEl.setAttribute("height",a);this.popover.foreignObjEl.width(f);this.popover.foreignObjEl.height(a);this.foreignObjEl.bodyEl.innerHTML=c;this.foreignObjEl.plainHtml=c;this.popover.foreignObjEl.html(c);if(BrowserDetect.browser=="MSIE"){var g=c.search(/youtube\.com/);if(g!=-1){var b='<img src="'+jMap.cfg.contextPath+'/images/video_not_support.png" width="300" height="300"/>';this.foreignObjEl.bodyEl.innerHTML=b;this.popover.foreignObjEl.html(b)}}this.CalcBodySize()};jPartitionNode.prototype.foreignObjectResize=function(f,a){if(!jMap.saveAction.isAlive()){return null}var g=jMap.historyManager;var b=g&&g.extractNode(this);this.foreignObjectResizeExecute(f,a);var c=g&&g.extractNode(this);g&&g.addToHistory(b,c);jMap.saveAction.editAction(this);jMap.fireActionListener(ACTIONS.ACTION_NODE_FOREIGNOBJECT,this,null,f,a);jMap.setSaved(false)};jPartitionNode.prototype.foreignObjectResizeExecute=function(c,a){c&&this.foreignObjEl.setAttribute("width",c);a&&this.foreignObjEl.setAttribute("height",a);c&&this.popover.foreignObjEl.width(c);a&&this.popover.foreignObjEl.height(a);var b=this.foreignObjEl.plainHtml;b=b.replace(/(width=")([^"]*)/ig,"$1"+c);b=b.replace(/(height=")([^"]*)/ig,"$1"+a);this.foreignObjEl.bodyEl.innerHTML=b;this.foreignObjEl.plainHtml=b;this.popover.foreignObjEl.html(b);this.CalcBodySize();jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(this);jMap.layoutManager.layout(true)};jPartitionNode.prototype.setEmbedVideo=function(f){var g=/width?=?["']([^"']*)/gi;var c=g.exec(f)[1];var b=/height?=?["']([^"']*)/gi;var a=b.exec(f)[1];this.setForeignObject(f,c,a)};jPartitionNode.prototype.setVideo=function(g,c,a){var f=jMap.cfg.default_video_size;var b='<embed src="'+g+'" width="'+c+'"  height="'+a+'"></embed>';this.setHyperlink(g);this.setForeignObject(b,c,a)};jPartitionNode.prototype.setYoutubeVideo=function(m,k,a){var l=jMap.cfg.default_video_size;if(k==null){k=l}if(a==null){a=l}var g=/v[=\/]([^&]*)/ig;var c=g.exec(m);if(c){var b="https://www.youtube.com/embed/"+c[1];var f='<iframe src="'+b+'" frameborder="0" allowtransparency="true" width="'+k+'"  height="'+a+'" scrolling="no"></iframe>';this.setHyperlink(m);this.setForeignObject(f,k,a)}};jPartitionNode.prototype.zoomExecute=function(l){var k=jMap.layoutManager;var g=k.getCenterLocation();var f=this;l=(l==undefined?k.duration:l);k.hideAllPopover();jMap.arcTweenNode=f;var c=(f.y?k.width-40:k.width)/(1-f.y);var b=k.height/f.dx;k.x.domain([f.y,1]).range([f.y?40:0,k.width]);k.y.domain([f.x,f.x+f.dx]);var a=d3.selectAll('g[data-node-type="'+jMap.cfg.nodeStyle+'"]').transition().duration(l).attr("transform",function(m){if(!m){return null}return"translate("+(g.x+k.x(m.y))+","+(g.y+k.y(m.x))+")"});a.select("rect").attr("width",f.dy*c).attr("height",function(m){if(!m){return null}jMap.nodes[m.id].pWidth=m.dy*c;jMap.nodes[m.id].pHeight=m.dx*b;return m.dx*b});a.select("text").style("opacity",function(n){if(!n){return null}var m=jMap.nodes[n.id].plainText.split(/\r\n|\n|\r/);return(n.dx*b)<(m.length*jMap.cfg.nodeFontSizes[1])?0:1}).attr("transform",function(m){if(!m){return null}setTimeout(function(){jMap.nodes[m.id].computedTextExecute()},l);return"translate("+k.padding+","+(m.dx*b)/2+")"});return{end:function(m){setTimeout(function(){m()},l)}}};jPartitionNode.prototype.getChildren=function(){return this.children||[]};jPartitionNode.prototype.screenFocus=function(){this.zoomExecute()};jPartitionNode.prototype.showPopover=function(){var a=this.getPopoverLocation();this.popover.container.attr("style","top: "+(a.top)+"px; left: "+(a.left)+"px;");this.popover.container.addClass("active");this.popover.container.attr("data-placement","right")};jPartitionNode.prototype.hidePopover=function(){this.popover.container.removeClass("active")};jPartitionNode.prototype.getPopoverLocation=function(){var m=this.groupEl.getBBox();var l=$(this.groupEl).offset();l.top+=(m.height/2)*jMap.cfg.scale;l.left+=(m.width/2)*jMap.cfg.scale;var b=$("#ribbon").height()+10;var k=this.popover.container.width();var a=this.popover.container.height();var c=$(window).width();var g=$(window).height();var f=5;if(l.top<b+f){l.top=b+f}else{if(l.top+a>g-f){l.top=g-a-f}}if(this.angle>90){if(l.left-k<f){l.left=f+k}}else{if(l.left<f){l.left=f}else{if(l.left+k>c-f){l.left=c-f-k}}}return l};jSunburstNode.prototype.hidePopover=function(){this.popover.container.removeClass("active")};jPartitionNode.prototype.getPartitionTreeData=function(){var a={};a.id=this.id;if(this.children.length){a.children=[];this.children.forEach(function(b){a.children.push(b.getPartitionTreeData())})}return a};jPartitionNode.prototype.getText=function(){return this.plainText};jPartitionNode.prototype.computedTextExecute=function(){var f=this;var c=f.pWidth;var b=Math.floor((c-2*jMap.layoutManager.padding)/(parseFloat(jMap.cfg.nodeFontSizes[1])/2))-4;var a={text:f.plainText};if(f.plainText.length>b){var g=f.plainText.slice(0,b);a.text=g==""?"":g+"..."}this.text.attr(a)};jPartitionNode.prototype.toXML=function(o){var k=new StringBuffer();var l=false;if(this.img!=null||(this.text.attrs.text!=null&&this.text.attrs.text.indexOf("\n")!=-1)){l=true}var g=new StringBuffer();g.add("<node");g.add('CREATED="'+this.created+'"');g.add('ID="'+this.id+'"');g.add('MODIFIED="'+this.modified+'"');g.add('CREATOR="'+this.creator+'"');g.add('CLIENT_ID="'+this.client_id+'"');if(!l){g.add('TEXT="'+convertCharStr2SelectiveCPs(convertCharStr2XML(this.plainText,true,true),"ascii",true,"&#x",";","hex")+'"')}g.add('FOLDED="'+this.folded+'"');if(this.background_color!=""){g.add('BACKGROUND_COLOR="'+this.background_color+'"')}if(this.color!=""){g.add('COLOR="'+this.color+'"')}if(this.hyperlink!=null){g.add('LINK="'+convertCharStr2XML(this.hyperlink.attr().href)+'"')}if(this.file!=null){g.add('FILE="'+convertCharStr2XML(this.file.attr().href)+'"')}if(this.noteText!=null){g.add('NOTE="'+convertCharStr2XML(this.noteText)+'"')}if(this.position!=""&&this.position!="undefined"){g.add('POSITION="'+this.position+'"')}if(this.style!=""){g.add('STYLE="'+this.style+'"')}if(this.hgap){g.add('HGAP="'+this.hgap+'"')}if(this.vgap){g.add('VGAP="'+this.vgap+'"')}if(this.vshift){g.add('VSHIFT="'+this.vshift+'"')}if(this.numofchildren!=null){g.add('NUMOFCHILDREN="'+this.numofchildren+'"')}g.add(">");k.add(g.toString(" "));if(l){var a=new StringBuffer();a.add('<richcontent TYPE="NODE"><html>\n');a.add("  <head>\n");a.add("\n");a.add("  </head>\n");a.add("  <body>\n");if(this.img!=null){a.add("    <p>\n");a.add('      <img src="'+this.imgInfo.href+'" width="'+this.imgInfo.width+'" height="'+this.imgInfo.height+'" />\n');a.add("    </p>\n")}if(this.text.attrs.text!=null){var n=JinoUtil.trimStr(this.text.attrs.text).split("\n");for(var m=0;m<n.length;m++){a.add("<p>"+convertCharStr2SelectiveCPs(convertCharStr2XML(n[m],true,true),"ascii",true,"&#x",";","hex")+"</p>\n")}}a.add("  </body>\n");a.add("</html>\n");a.add("</richcontent>");k.add(a.toString(" "))}if(this.arrowlinks.length>0){for(var m=0;m<this.arrowlinks.length;m++){k.add(this.arrowlinks[m].toXML())}}if(this.foreignObjEl){var b=new StringBuffer();b.add('<foreignObject WIDTH="'+this.foreignObjEl.getAttribute("width")+'" HEIGHT="'+this.foreignObjEl.getAttribute("height")+'">');var p=this.foreignObjEl.plainHtml;p=p.split('class="lazy-load"').join("");p=p.replace(" data-src="," src=");b.add(convertCharStr2SelectiveCPs(p,"ascii",true,"&#x",";","hex"));b.add("</foreignObject>");k.add(b.toString(" "))}for(var q in this.attributes){k.add("<attribute NAME='"+q+"' VALUE='"+convertCharStr2SelectiveCPs(convertCharStr2XML(String(this.attributes[q]),true,true),"ascii",true,"&#x",";","hex")+"'/>")}var c=new StringBuffer();c.add("<info");if(this.lazycomplete){c.add('LAZYCOMPLETE="'+this.lazycomplete+'"')}c.add("/>");k.add(c.toString(" "));var f=this.getChildren();if(f.length>0&&o==null){for(var m=0;m<f.length;m++){k.add(f[m].toXML())}}k.add("</node>");return k.toString("\n")};jPartitionNode.prototype.setFolding=function(a){if(jMap.jDebug){console.log("setFolding")}};jPartitionNode.prototype.hideChildren=function(a){if(jMap.jDebug){console.log("hideChildren")}};jPartitionNode.prototype.relativeCoordinate=function(b,a){if(jMap.jDebug){console.log("relativeCoordinate")}};jPartitionNode.prototype.relativeCoordinateExecute=function(b,a){if(jMap.jDebug){console.log("relativeCoordinateExecute")}};jPartitionNode.prototype.getLocation=function(){var a=this.getPopoverLocation();return{x:a.top,y:a.left}};jPartitionNode.prototype.setFontSizeExecute=function(a){};jPartitionNode.prototype.setEdgeColorExecute=function(a,b){if(a){this.edge.color=a;this.body.attr({stroke:a});this.folderShape&&this.folderShape.attr({stroke:a})}if(b){}};jCardNodeController=function(){jCardNodeController.superclass.call(this)};extend(jCardNodeController,jNodeController);jCardNodeController.prototype.type="jCardNodeController";jCardNodeController.prototype.dblclick=function(c){var b;var a;if(!c){var c=window.event}a=c.originalEvent.originalEvent||c.originalEvent||c;if(a.target){b=a.target}else{if(a.srcElement){b=a.srcElement}}if(b.nodeType==3){b=b.parentNode}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}jMap.controller.startNodeEdit(jMap.getSelected())};jCardNodeController.prototype.mouseenter=function(a){};jCardNodeController.prototype.mouseleave=function(a){};jCardNodeController.prototype.mouseup=function(a){};jCardNodeController.prototype.mousedown=function(f){var b;var a;if(!f){var f=window.event}a=f.originalEvent.originalEvent||f.originalEvent||f;if(a.target){b=a.target}else{if(a.srcElement){b=a.srcElement}}if(b.nodeType==3){b=b.parentNode}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}var k=jMap.getSelecteds();if(f.button==2){return}if(f.shiftKey||f.ctrlKey){if(k.contains(this.node)){this.node.blur()}else{this.node.focus(false)}}else{if(!k.contains(this.node)){this.node.focus(true)}}var c=document.documentElement.scrollTop||document.body.scrollTop;var g=document.documentElement.scrollLeft||document.body.scrollLeft;this._drag={};this._drag.x=f.clientX+g;this._drag.y=f.clientY+c;this._drag.id=f.identifier;jMap.dragEl=this};jCardNodeController.prototype.mousemove=function(a){};jCardNodeController.prototype.mouseover=function(a){};jCardNodeController.prototype.mouseout=function(a){};jCardNodeController.prototype.dragstart=function(a){};jCardNodeController.prototype.dragenter=function(a){};jCardNodeController.prototype.dragexit=function(a){};jCardNodeController.prototype.drop=function(a){};jCardNodeControllerGuest=function(){jCardNodeControllerGuest.superclass.call(this)};extend(jCardNodeControllerGuest,jNodeControllerGuest);jCardNodeControllerGuest.prototype.type="jCardNodeControllerGuest";jCardNodeControllerGuest.prototype.mouseenter=function(a){};jCardNodeControllerGuest.prototype.mouseleave=function(a){};jCardNode=function(g){var b=g.parent;var f=g.text;var k=g.id;var c=g.index;var a=g.position;this.portrait=null;this.nodeCreator=null;this.nodeCreated=null;this.portraitRadius=12;jCardNode.superclass.call(this,b,f,k,c,a)};extend(jCardNode,jMindMapNode);jCardNode.prototype.type="jCardNode";jCardNode.prototype.initElements=function(){if(this.isRootNode()&&jMap.layoutManager.topic==null){jMap.layoutManager.topic=new jCardTopic()}this.body=RAPHAEL.rect();this.text=RAPHAEL.text();this.folderShape=RAPHAEL.circle(0,0,FOLDER_RADIUS);this.nodeCreator=RAPHAEL.text();this.nodeCreated=RAPHAEL.text();this.wrapElements(this.body,this.text,this.folderShape,this.nodeCreator,this.nodeCreated)};jCardNode.prototype.create=function(){var b=this.body;var k=this.text;var g=this.folderShape;if(this.getParent()){var f=this.getParent().getLocation();this.setLocation(f.x,f.y)}this.setBackgroundColorExecute(jMap.cfg.nodeDefalutColor);this.setTextColorExecute(jMap.cfg.textDefalutColor);this.setEdgeColorExecute(jMap.cfg.edgeDefalutColor,1);if(typeof NodeColorMix!=="undefined"){NodeColorMix.rawDressColor(this)}var c=400;var a="Malgun Gothic, 맑은고딕, Gulim, 굴림, Arial, sans-serif";this.fontSize=jMap.cfg.nodeFontSizes[2];k.attr({"font-family":a,"font-size":this.fontSize,"font-weight":c,"text-anchor":"start"});this.nodeCreator.attr({"font-family":a,"font-size":this.fontSize,"font-weight":c,"text-anchor":"start"});this.nodeCreated.attr({"font-family":a,"font-size":this.fontSize,"font-weight":c,"text-anchor":"start"});this.setTextExecute(this.plainText);this.setCreator(jMap.cfg.portrait,jMap.cfg.userName,0)};jCardNode.prototype.setEdgeColorExecute=function(a,b){if(a){this.edge.color=a;this.body.attr({stroke:a});this.folderShape&&this.folderShape.attr({stroke:a})}this.edge.width=1;this.body.attr({"stroke-width":1})};jCardNode.prototype.getSize=function(){return{width:this.body.getBBox().width,height:this.body.getBBox().height}};jCardNode.prototype.setSize=function(b,a){this.body.attr({width:b,height:a})};jCardNode.prototype.getLayoutSize=function(){var a=this.getSize();return a};jCardNode.prototype.getLocation=function(){return{x:this.body.getBBox().x,y:this.body.getBBox().y}};jCardNode.prototype.setLocation=function(b,c){var a=this.body;if(b&&!c){a.attr({x:b})}else{if(!b&&c){a.attr({y:c})}else{a.attr({x:b,y:c})}}this.updateNodeShapesPos()};jCardNode.prototype.CalcBodySize=function(){if(this.text.getBBox()==undefined){return}this.updateNodeShapesPos();var g=0;var a=0;var b=TEXT_HGAP;var f=TEXT_VGAP;if(this.portrait){a+=40}if(this.getText()!=""){g+=this.text.getBBox().width;a+=this.text.getBBox().height}if(this.img){g=(g<this.img.getBBox().width)?this.img.getBBox().width:g;a+=this.img.getBBox().height}if(this.foreignObjEl){var c=parseInt(this.foreignObjEl.getAttribute("width"));var m=parseInt(this.foreignObjEl.getAttribute("height"));g=(g<c)?c:g;a+=m}if(g==0||a==0){this.text.attr({text:"_"});g+=this.text.getBBox().width;a+=this.text.getBBox().height;this.text.attr({text:""})}if(this.hyperlink){var k=this.body.getBBox().y+a;var l=this.hyperlink.getBBox().y+this.hyperlink.getBBox().height;if(k<l){a=this.hyperlink.getBBox().y+this.hyperlink.getBBox().height-this.body.getBBox().y}}if(this.file){var k=this.body.getBBox().y+a;var l=this.file.getBBox().y+this.file.getBBox().height;if(k<l){a=this.file.getBBox().y+this.file.getBBox().height-this.body.getBBox().y}}if(this.note){var k=this.body.getBBox().y+a;var l=this.note.getBBox().y+this.note.getBBox().height;if(k<l){a=this.note.getBBox().y+this.note.getBBox().height-this.body.getBBox().y}}this.setSize(jMap.layoutManager.columnWidth,a+f)};jCardNode.prototype.updateNodeShapesPos=function(){var p=TEXT_HGAP;var u=TEXT_VGAP;var q=0;var t=this.body;var z=this.text;var l=this.folderShape;var D=this.img;var m=this.hyperlink;var f=this.note;var C=this.file;var k=this.foreignObjEl;var s=t.getBBox().x;var r=t.getBBox().y;var g=0;var c=0;switch(jMap.layoutManager.type){case"jMindMapLayout":g=this.isLeft()?s:s+this.body.getBBox().width;c=r+this.body.getBBox().height/2;break;case"jTreeLayout":g=s+this.body.getBBox().width/2;c=r+this.body.getBBox().height;break;case"jHTreeLayout":g=s+this.body.getBBox().width/2;c=r+this.body.getBBox().height;break;case"jFishboneLayout":g=this.isLeft()?s:s+this.body.getBBox().width;c=r+this.body.getBBox().height/2;break;default:g=s;c=r;break}this.folderShape.attr({cx:g,cy:c});if(this.portrait){this.portrait.attr({cx:s+this.portraitRadius+p/2,cy:r+this.portraitRadius+u/2});if(this.nodeCreator){this.nodeCreator.attr({x:this.portrait.getBBox().x+this.portrait.getBBox().width+p,y:r+this.portraitRadius+(this.portraitRadius*2-this.nodeCreator.getBBox().height)/2})}if(this.nodeCreated){this.nodeCreated.attr({x:this.nodeCreator.getBBox().x+this.nodeCreator.getBBox().width+p,y:r+this.portraitRadius+(this.portraitRadius*2-this.nodeCreated.getBBox().height)/2})}q+=this.portraitRadius*2+u}if(D){var B=s+1;var A=r+q+1;if(this.isRootNode()){B+=(t.getBBox().width/2)-(D.getBBox().width/2)-p/2}D.attr({x:B,y:A});q+=parseInt(D.getBBox().height)}if(k){var w=s+1;var v=r+q+1;k.setAttribute("x",w);k.setAttribute("y",v);q+=parseInt(k.getAttribute("height"))}if(z){var o=s+p/2;var n=r+(u+z.getBBox().height)/2;if(this.isRootNode()){o+=t.getBBox().width/2-p/2}n+=q;z.attr({x:o,y:n})}var a=r+q+z.getBBox().height+10;var b=s+p/2;if(m){if((b+m.getBBox().width)>s+(t.getBBox().width)){b=z.getBBox().x;a+=parseFloat(z.node.childNodes[indexOfLastLine].getAttribute("dy"))+5}m&&m.attr({x:b,y:a+6});b=b+m.getBBox().width+3}if(C){if((b+C.getBBox().width)>s+(t.getBBox().width)){b=z.getBBox().x;a+=parseFloat(z.node.childNodes[indexOfLastLine].getAttribute("dy"))+5}C&&C.attr({x:b,y:a});b=b+C.getBBox().width+3}if(f){if((b+f.getBBox().width)>s+(t.getBBox().width)){b=z.getBBox().x;a+=parseFloat(z.node.childNodes[indexOfLastLine].getAttribute("dy"))+5}f&&f.attr({x:b,y:a});b=b+f.getBBox().width+3}};jCardNode.prototype.setCreator=function(b,a,k){if(k==0){this.created=new Date().getTime();k=Math.floor(this.created/1000)}else{k=parseInt(k/1000)}this.userfullname=a;this.userportrait=b;var f=this;if(b){var g=$("<img />").attr("src",b).load(function(){if(f.portrait){f.portrait.remove();f.portrait=null}f.setPortrait(b,f.portraitRadius);if(Raphael.svg){f.groupEl.appendChild(f.portrait.node)}if(Raphael.vml){f.groupEl.appendChild(f.portrait.Group)}f.getParent()&&f.getParent().folded&&f.portrait.hide();f.CalcBodySize();jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();jMap.loadManager.updateImageLoading(this)});jMap.loadManager.updateImageLoading(g[0])}f.nodeCreator.attr({text:a});var c=f.formatCreated(new Date(k*1000),"yyyy.MM.dd HH:mm:ss");f.nodeCreated.attr({text:c})};jCardNode.prototype.setPortrait=function(c,a){var b=a*2;var g=a*2;this.portrait=RAPHAEL.circle(0,0,a);var f=Raphael.createUUID();var k=document.createElementNS("http://www.w3.org/2000/svg","pattern");var l=RAPHAEL.image(c,0,0,b,g);k.setAttribute("id",f);k.setAttribute("x",0);k.setAttribute("y",0);k.setAttribute("height",b);k.setAttribute("width",g);$(l.node).appendTo(k);$(k).appendTo(RAPHAEL.defs);$(this.portrait.node).attr("fill","url(#"+k.id+")");this.portrait.attr({"stroke-width":0})};jCardNode.prototype.formatCreated=function(b,f){var a=["일요일","월요일","화요일","수요일","목요일","금요일","토요일"];var c=this;return f.replace(/(yyyy|yy|MM|M|dd|d|E|HH|H|hh|h|mm|m|ss|s|a\/p)/gi,function(g){switch(g){case"yyyy":return b.getFullYear();case"yy":return c.padZero(b.getFullYear()%1000,2);case"MM":return c.padZero(b.getMonth()+1,2);case"M":return b.getMonth()+1;case"dd":return c.padZero(b.getDate(),2);case"d":return b.getDate();case"E":return a[b.getDay()];case"HH":return c.padZero(b.getHours(),2);case"H":return b.getHours();case"hh":return c.padZero((h=b.getHours()%12)?h:12,2);case"h":return(h=b.getHours()%12)?h:12;case"mm":return c.padZero(b.getMinutes(),2);case"m":return b.getMinutes();case"ss":return c.padZero(b.getSeconds(),2);case"s":return b.getSeconds();case"a/p":return b.getHours()<12?"오전":"오후";default:return g}})};jCardNode.prototype.padZero=function(g,f){var a="";g=g.toString();var c=f-g.length;for(var b=0;b<c;b++){a+="0"}return a+g};jCardNode.prototype.setTextExecute=function(b){this.plainText=b;var a=this.fontSize;this.text.attr({text:b,"font-size":a});if(this.text.getBBox().width>jMap.layoutManager.columnWidth-TEXT_HGAP){this.plainText=this.wrapText(b,jMap.layoutManager.columnWidth-TEXT_HGAP*2);this.text.attr({text:this.plainText})}this.CalcBodySize()};jCardNode.prototype.wrapText=function(g,c){var b=function(q,p){var n="\n";var m=".{1,"+p+"}";var o=new RegExp(m,"g");var l=q.match(o)||[];var k=l.map(function(r){if(r.slice(-1)==="\n"){r=r.slice(0,r.length-1)}return r}).join(n);return k};var a=g.replace(/\r?\n|\r/g,"");var f=this.parent&&this.parent.isRootNode()&&parseInt(this.fontSize)==parseInt(jMap.cfg.nodeFontSizes[2])?jMap.cfg.nodeFontSizes[1]:this.fontSize;return b(g,Math.floor(((c-jMap.layoutManager.padding*1.5)*a.length)/(a.length*0.75*f)))};jCardNode.prototype.setImageExecute=function(c,g,b,a){if(c==null||c==""){if(this.img){this.img.remove();this.img=null;this.imgInfo={};this.CalcBodySize();a&&a.call(this)}return false}var k=this;checkGifNotiStatus(c);var f=$("<img />").attr("src",c).load(function(){var n=jMap.layoutManager.columnWidth-2;var m={width:0,height:0};m.width=n;var l=this.width/n;if(g){l=g/n}if(b){m.height=b/l}else{m.height=this.height/l}m.width=parseInt(m.width);m.height=parseInt(m.height);if(k.img){k.img.attr({src:this.src,width:m.width,height:m.height});k.imgInfo.href=this.src;k.imgInfo.width=m.width;k.imgInfo.height=m.height}else{k.img=RAPHAEL.image(this.src,0,0,m.width,m.height);k.imgInfo.href=this.src;k.imgInfo.width=m.width;k.imgInfo.height=m.height;if(Raphael.svg){k.groupEl.appendChild(k.img.node)}if(Raphael.vml){k.groupEl.appendChild(k.img.Group)}}k.getParent()&&k.getParent().folded&&k.img.hide();k.CalcBodySize();jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();jMap.loadManager.updateImageLoading(this);a&&a.call(k);return true}).error(function(){if(k.img){k.img.attr({src:jMap.cfg.contextPath+"/images/image_broken.png",width:64,height:64});k.imgInfo.href=c;k.imgInfo.width=g&&g;k.imgInfo.height=b&&b}else{k.img=RAPHAEL.image(jMap.cfg.contextPath+"/images/image_broken.png",0,0,64,64);k.imgInfo.href=c;k.imgInfo.width=g&&g;k.imgInfo.height=b&&b;if(Raphael.svg){k.groupEl.appendChild(k.img.node)}if(Raphael.vml){k.groupEl.appendChild(k.img.Group)}}k.getParent()&&k.getParent().folded&&k.img.hide();k.CalcBodySize();jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap();jMap.loadManager.updateImageLoading(this);a&&a.call(k)});jMap.loadManager.updateImageLoading(f[0])};jCardNode.prototype.setForeignObjectExecute=function(f,a,m){if(!Raphael.svg){return false}if(f==null||f==""){if(this.foreignObjEl&&this.foreignObjEl.iframeEl){this.foreignObjEl.iframeEl.remove();delete this.foreignObjEl.iframeEl}if(this.foreignObjEl){this.groupEl.removeChild(this.foreignObjEl)}this.foreignObjEl=null;this.CalcBodySize();return false}f=convertXML2Char(f);if(!this.foreignObjEl){this.foreignObjEl=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");this.foreignObjEl.bodyEl=document.createElementNS("http://www.w3.org/1999/xhtml","body");this.foreignObjEl.appendChild(this.foreignObjEl.bodyEl);this.groupEl.appendChild(this.foreignObjEl);this.foreignObjEl.setAttribute("x",this.body.getBBox().x);this.foreignObjEl.setAttribute("y",this.body.getBBox().y)}a=a||150;m=m||150;var n=jMap.layoutManager.columnWidth-2;var g=1;if(a){g=n/a;a=n}if(m){m=parseInt(m*g)}this.foreignObjEl.setAttribute("width",a);this.foreignObjEl.setAttribute("height",m);var c=(f||"").indexOf("<iframe")>=0;if(this.foreignObjEl.iframeEl){if(!c){this.foreignObjEl.iframeEl.remove();delete this.foreignObjEl.iframeEl}}else{if(c){this.foreignObjEl.bodyEl.innerHTML="";this.foreignObjEl.iframeEl=$('<div class="jCard-foreignObjEl jCard-'+this.id+'" style="position: absolute;z-index: 1;outline: none; margin-left: 0px; margin-top: 0px; transform-origin: top left;"></div>').appendTo("body")}}var b=this;var l=function(){if(!b.foreignObjEl||!b.foreignObjEl.iframeEl){return true}var p=$(b.body.node).offset();var o=0;$(b.foreignObjEl.iframeEl).css("top",p.top+o);$(b.foreignObjEl.iframeEl).css("left",p.left+1);$(b.foreignObjEl.iframeEl).css("margin-top",5*jMap.cfg.scale);$(b.foreignObjEl.iframeEl).css("transform","scale("+jMap.cfg.scale+")");$(b.foreignObjEl.iframeEl).css("-webkit-transform","scale("+jMap.cfg.scale+")");$(b.foreignObjEl.iframeEl).css("-ms-transform","scale("+jMap.cfg.scale+")");$(b.foreignObjEl.iframeEl).css("-moz-transform","scale("+jMap.cfg.scale+")")};if(c){$(this.foreignObjEl.iframeEl).html(f);$(this.foreignObjEl.iframeEl).css("width",a);$(this.foreignObjEl.iframeEl).css("height",m);$(this.foreignObjEl.iframeEl).find("iframe").attr("width",a);$(this.foreignObjEl.iframeEl).find("iframe").attr("height",m);setTimeout(function(){l()});$(window).on("load",l);$(this.groupEl).onPositionChanged(l)}else{this.foreignObjEl.bodyEl.innerHTML=f}this.foreignObjEl.plainHtml=f;if(BrowserDetect.browser=="MSIE"){var k=f.search(/youtube\.com/);if(k!=-1){this.foreignObjEl.bodyEl.innerHTML='<img src="'+jMap.cfg.contextPath+'/images/video_not_support.png" width="300" height="300"/>'}}this.CalcBodySize()};jCardNode.prototype.foreignObjectResizeExecute=function(f,a){var g=jMap.layoutManager.columnWidth-2;var c=1;if(f){c=g/f;f=g}if(a){a=parseInt(a*c)}f&&this.foreignObjEl.setAttribute("width",f);a&&this.foreignObjEl.setAttribute("height",a);var b=this.foreignObjEl.plainHtml;b=b.replace(/(width=")([^"]*)/ig,"$1"+f);b=b.replace(/(height=")([^"]*)/ig,"$1"+a);if(this.foreignObjEl.iframeEl){$(this.foreignObjEl.iframeEl).html(b);$(this.foreignObjEl.iframeEl).css("width",f);$(this.foreignObjEl.iframeEl).css("height",a)}else{this.foreignObjEl.bodyEl.innerHTML=b}this.foreignObjEl.plainHtml=b;this.CalcBodySize();jMap.layoutManager.updateTreeHeightsAndRelativeYOfAncestors(this);jMap.layoutManager.layout(true)};jCardNode.prototype.removeExecute=function(f){if(this.removed){return false}if(!f&&this.isRootNode()){return false}if(!this.getChildren().isEmpty()){var b=this.getChildren();for(var a=b.length-1;a>=0;a--){b[a].removeExecute()}}if(this.foreignObjEl&&this.foreignObjEl.iframeEl){this.foreignObjEl.iframeEl.remove()}jMap.deleteNodeById(this.id);this.connection&&this.connection.remove();while(this.arrowlinks.length!=0){this.removeArrowLink(this.arrowlinks[0])}var c=jMap.getArrowLinks(this);for(var a=0;a<c.length;a++){this.removeArrowLink(c[a])}for(e in this){if(this[e]&&this[e].toString){if(this[e].toString()=="Rapha\xebl\u2019s object"){this[e].remove()}}}this.groupEl.parentNode.removeChild(this.groupEl);this.parent&&this.parent.getChildren().remove(this);this.removed=true;this.parent.numofchildren=this.parent.getChildren().length;return true};jCardNode.prototype.getInputPort=function(){var a=this.body.getBBox();var b=0;var c=0;if(isFinite(a.width)&&!isNaN(a.width)){b=a.width}if(isFinite(a.height)&&!isNaN(a.height)){c=a.height}switch(jMap.layoutManager.type){case"jMindMapLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft&&this.isLeft()){return{x:a.x+b+1,y:a.y+c/2}}else{return{x:a.x-1,y:a.y+c/2}}break;case"jTreeLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c}}return{x:a.x+b/2,y:a.y};break;case"jHTreeLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c}}return{x:a.x,y:a.y+c/2};break;case"jRotateLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft&&this.isLeft()){return{x:a.x-1,y:a.y+c/2}}else{return{x:a.x-1,y:a.y+c/2}}break;case"jTableLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c}}return{x:a.x+b/2,y:a.y};break;case"jFishboneLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft&&this.isLeft()){return{x:a.x+b+1,y:a.y+c/2}}else{return{x:a.x-1,y:a.y+c/2}}break;default:return{x:a.x,y:a.y};break}};jCardNode.prototype.getOutputPort=function(){var a=this.body.getBBox();var b=0;var c=0;if(isFinite(a.width)&&!isNaN(a.width)){b=a.width}if(isFinite(a.height)&&!isNaN(a.height)){c=a.height}switch(jMap.layoutManager.type){case"jMindMapLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft()){return{x:a.x-1,y:a.y+c/2}}else{return{x:a.x+b+1,y:a.y+c/2}}break;case"jTreeLayout":return{x:a.x+b/2,y:a.y+c};break;case"jHTreeLayout":return{x:a.x+b/2,y:a.y+c};break;case"jRotateLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft&&this.isLeft()){return{x:a.x+b+1,y:a.y+c/2}}else{return{x:a.x+b+1,y:a.y+c/2}}break;case"jTableLayout":return{x:a.x+b/2,y:a.y+c};break;case"jFishboneLayout":if(this.isRootNode()){return{x:a.x+b/2,y:a.y+c/2}}if(this.isLeft()){return{x:a.x-1,y:a.y+c/2}}else{return{x:a.x+b+1,y:a.y+c/2}}break;default:return{x:a.x,y:a.y};break}};jCardNode.prototype.toString=function(){return"jCardNode"};jCardNode.prototype.addEventController=function(a){a=jMap.mode?new jCardNodeController():new jCardNodeControllerGuest();this.controller=a;$(this.groupEl).on("vmousedown",a.mousedown);$(this.groupEl).on("vmousemove",a.mousemove);$(this.groupEl).on("vmouseup",a.mouseup);$(this.groupEl).on("taphold",a.taphold);$(this.groupEl).on("vclick",a.click)};jCardTopic=function(){jCardTopic.superclass.call(this,null,jMap.cfg.mapName)};extend(jCardTopic,jNode);jCardTopic.prototype.type="jCardTopic";jCardTopic.prototype.initElements=function(){this.body=RAPHAEL.rect();this.text=RAPHAEL.text();this.wrapElements(this.body,this.text)};jCardTopic.prototype.create=function(){var b=this.body;var g=this.text;this.setBackgroundColorExecute("#ffffff");this.setTextColorExecute(jMap.cfg.textDefalutColor);this.setEdgeColorExecute(jMap.cfg.edgeDefalutColor,1);var c=700;var a="Malgun Gothic, 맑은고딕, Gulim, 굴림, Arial, sans-serif";var f=$("<textarea />").html(this.plainText).text();this.fontSize=jMap.cfg.nodeFontSizes[0];g.attr({"font-family":a,"font-size":this.fontSize,"font-weight":c,"text-anchor":"start"});this.setTextExecute(f)};jCardTopic.prototype.getCenterLocation=function(){return{x:(RAPHAEL.getSize().width/2)-(jMap.layoutManager.columns.length*jMap.layoutManager.columnWidth+(jMap.layoutManager.columns.length-1)*jMap.layoutManager.HGAP)/2,y:70}};jCardTopic.prototype.CalcBodySize=function(){var l=10;var o=this.text;var g=this.body;var a=this.getCenterLocation();var m=a.x;var k=a.y;var b=$("#main-menu").width()+10;var n=0;var c=$(window).width()-b;if($(window).width()<1024){k+=n;c=$(window).width()}var f=$("<textarea />").html(this.plainText).text();o.attr({text:f});if(o.getBBox().width+l*2>c){this.text.attr({text:this.wrapText(f,c-l*2)})}o.attr({x:m,y:k});o.node.firstChild.setAttribute("dy",this.fontSize*0.9);g.attr({x:m,y:k,width:c-l*2,height:o.getBBox().height});jMap.layoutManager.marginTop=k+o.getBBox().height+45;if(jMap.layoutManager.topic!=null){jMap.layoutManager.updateTreeHeightsAndRelativeYOfWholeMap()}this.updateNodeShapesPos()};jCardTopic.prototype.updateNodeShapesPos=function(){var g=10;var k=this.text;var b=this.body;var a=b.getBBox().x+g;var l=b.getBBox().y;var c=$("#main-menu").width()+10;var f=0;if($(window).width()<1024){a-=$(this.groupEl).offset().left;this.body.attr({x:a,y:l,height:b.getBBox().height+g})}else{a+=$("#main-menu").width()+10-$(this.groupEl).offset().left;this.body.attr({x:a,y:l,width:Math.min(b.getBBox().width,k.getBBox().width+g*4),height:b.getBBox().height+g})}this.text.attr({x:a+(b.getBBox().width-k.getBBox().width)/2,y:l});k.node.firstChild.setAttribute("dy",this.fontSize*0.9+g/2)};jCardTopic.prototype.wrapText=function(f,c){var b=function(p,o){var m="\n";var l=".{1,"+o+"}";var n=new RegExp(l,"g");var k=p.match(n)||[];var g=k.map(function(q){if(q.slice(-1)==="\n"){q=q.slice(0,q.length-1)}return q}).join(m);return g};var a=f.replace(/\r?\n|\r/g,"");this.text.attr({text:a});return b(f,Math.floor((c*a.length)/this.text.getBBox().width))};jCardTopic.prototype.toString=function(){return"jCardTopic"};jLine=function(c,a){this.node1=c;this.node2=a;var b="#000";this.line=RAPHAEL.path().attr({stroke:b,fill:b});this.text_line=RAPHAEL.path().attr({stroke:"transparent",fill:"transparent"});this.text_line.node.id="line_"+a.id;this.text=RAPHAEL.text();if(jMap.groupEl){jMap.groupEl.appendChild(this.line.node)}this.line.toBack();this.draw()};jLine.prototype.type="jLine";jLine.prototype.updateLine=function(){this.draw()};jLine.prototype.getWidth=function(){var a=parseInt(this.node2.branch.width);if(isNaN(a)){a=0}return a};jLine.prototype.getColor=function(){return this.node2.edge.color};jLine.prototype.setColor=function(a){this.line.attr({stroke:a,fill:a})};jLine.prototype.show=function(){this.line.show();this.text_line.show();this.text.show()};jLine.prototype.hide=function(){this.line.hide();this.text_line.hide();this.text.hide()};jLine.prototype.remove=function(){this.line.remove();this.text_line.remove();this.text.remove()};jLine.prototype.draw=function(){};jLineBezier=function(b,a){jLineBezier.superclass.call(this,b,a)};extend(jLineBezier,jLine);jLineBezier.prototype.type="jLineBezier";jLineBezier.prototype.draw=function(){var z=this.getWidth();if(!z){z=1}var m=this.node2.isLeft();var v=this.node1.body.getBBox();var u=this.node2.body.getBBox();var x=0;if(isFinite(v.width)){x=v.width}var a=0;if(isFinite(u.width)){a=u.width}var E=this.node2.getInputPort();var t=this.node1.getOutputPort();if(m){var H=[2,7];if(this.node1.isRootNode()){t=this.node1.getInputPort()}}else{var H=[3,6]}var k=10-this.node1.getDepth()*2;var D=t.x,l=t.y-z/2-k/2,A=E.x,b=E.y,s=Math.max(Math.abs(D-A)/2,10),r=Math.max(Math.abs(l-b)/2,10),C=[D,D,D-s,D+s][H[0]].toFixed(3),g=[l-r,l+r,l,l][H[0]].toFixed(3),B=[0,0,0,0,A,A,A-s,A+s][H[1]].toFixed(3),c=[0,0,0,0,l+r,l-r,b,b][H[1]].toFixed(3),p=l+z+(k>0?k:0),F=[0,0,0,0,A,A,A-s,A+s][H[1]],G=[D,D,D-s,D+s][H[0]];F=F.toFixed(3);G=G.toFixed(3);var w=["M",D.toFixed(3),l.toFixed(3),"C",C,g,B,c,A.toFixed(3),b.toFixed(3),"C",B,c,G,g,D.toFixed(3),p.toFixed(3)].join(",");this.line.attr({path:w,"stroke-width":z});if(this.node2.attributes&&this.node2.attributes.branchText){this.text.show();this.text.attr({"text-anchor":"middle"});var f=this.node2.attributes.branchText;var q;var o=50;var s=(b-l);var r=-(A-D);var n=Math.sqrt(s*s+r*r);if(n===0){n=1}s*=5/n;r*=5/n;if(m){q=["M",A.toFixed(3),b.toFixed(3),"C",B,c,C,g,D.toFixed(3),l.toFixed(3)].join(",");s=-s;r=-r;if(this.node1.isRootNode()){o-=20}}else{q=["M",D.toFixed(3),l.toFixed(3),"C",C,g,B,c,A.toFixed(3),b.toFixed(3)].join(",");if(this.node1.isRootNode()){o+=20}}this.text_line.attr({path:q,transform:"t"+s.toFixed(3)+","+r.toFixed(3)});this.text.node.innerHTML='<textPath startOffset="'+o+'%" xlink:href="#'+this.text_line.node.id+'">'+f+"</textPath>"}else{this.text.hide()}};jLineStraight=function(b,a){jLineStraight.superclass.call(this,b,a)};extend(jLineStraight,jLine);jLineStraight.prototype.type="jLineStraight";jLineStraight.prototype.draw=function(){var f=this.getWidth();if(!f){f=1}var c=this.node1.body.getBBox();var a=this.node2.body.getBBox();var m=0;if(isFinite(c.width)){m=c.width}var k=0;if(isFinite(a.width)){k=a.width}var o=this.node2.getInputPort();var l=this.node1.getOutputPort();var g=l.x.toFixed(3),b=o.x.toFixed(3),p=l.y.toFixed(3),n=o.y.toFixed(3);var q=["M",g,p,"L",b,n].join(",");this.line.attr({path:q})};jLineStraightDashed=function(b,a){jLineStraightDashed.superclass.call(this,b,a)};extend(jLineStraightDashed,jLine);jLineStraightDashed.prototype.type="jLineStraightDashed";jLineStraightDashed.prototype.draw=function(){var f=this.getWidth();if(!f){f=1}var c=this.node1.body.getBBox();var a=this.node2.body.getBBox();var m=0;if(isFinite(c.width)){m=c.width}var k=0;if(isFinite(a.width)){k=a.width}var o=this.node2.getInputPort();var l=this.node1.getOutputPort();var g=l.x.toFixed(3),b=o.x.toFixed(3),p=l.y.toFixed(3),n=o.y.toFixed(3);var q=["M",g,p,"L",b,n].join(",");this.line.attr({path:q,"stroke-dasharray":"-"})};jLinePolygonal=function(b,a){jLinePolygonal.superclass.call(this,b,a)};extend(jLinePolygonal,jLine);jLinePolygonal.prototype.type="jLinePolygonal";jLinePolygonal.prototype.draw=function(){var f=this.getWidth();if(!f){f=1}var c=this.node1.body.getBBox();var a=this.node2.body.getBBox();var m=0;if(isFinite(c.width)){m=c.width}var k=0;if(isFinite(a.width)){k=a.width}var p=this.node2.getInputPort();var l=this.node1.getOutputPort();var g=l.x.toFixed(0),b=p.x.toFixed(0),q=l.y.toFixed(0),o=p.y.toFixed(0);var n=parseInt(q)+10;var r=["M",g,q,"L",g,n,"L",b,n,"L",b,o,].join(",");this.line.attr({path:r,fill:"none"})};jLinePolygonal2=function(b,a){jLinePolygonal2.superclass.call(this,b,a)};extend(jLinePolygonal2,jLine);jLinePolygonal2.prototype.type="jLinePolygonal2";jLinePolygonal2.prototype.draw=function(){var f=this.getWidth();if(!f){f=1}var c=this.node1.body.getBBox();var a=this.node2.body.getBBox();var m=0;if(isFinite(c.width)){m=c.width}var k=0;if(isFinite(a.width)){k=a.width}var o=this.node2.getInputPort();var l=this.node1.getOutputPort();var g=l.x.toFixed(0),b=o.x.toFixed(0),p=l.y.toFixed(0),n=o.y.toFixed(0);var q=["M",g,p,"L",g,n,"L",b,n,"L",g,n].join(",");this.line.attr({path:q,fill:"none"})};jLineFish=function(b,a){this.HGAP=10;this.VGAP=10;this.angle=90;jLineFish.superclass.call(this,b,a)};extend(jLineFish,jLine);jLineFish.prototype.type="jLineFish";jLineFish.prototype.draw=function(){var f=this.getWidth();if(!f){f=1}var b=this.node1.getSize();var a=this.node2.getSize();var o=0;if(isFinite(b.width)){o=b.width}var m=0;if(isFinite(a.width)){m=a.width}var g=0,c=0,s=0,r=0;var l=this.node2.getUnChildren();var q=Math.sin(Math.PI*(90-this.angle)/180);var t=Math.cos(Math.PI*(90-this.angle)/180);var p=Math.tan(Math.PI*(90-this.angle)/180);if(this.node2.isVertical()){if(this.node2.isTopSide()){g=this.node2.getInputPort().x;s=this.node2.getInputPort().y;var n=this.node2.getTreeHeight();if(l!=null&&l.length>0){n-=l[0].getTreeHeight()}r=s-parseFloat(this.node2.getTreeHeight())+7;if(l!=null&&l.length>0){n+=this.VGAP;r+=l[0].getTreeHeight()-this.VGAP-4;c+=4*p}c+=g+(n-7)*p;g-=this.VGAP*p;s+=this.VGAP}else{g=this.node2.getOutputPort().x-this.node2.body.getBBox().width*q;if(this.node2.getDepth()>1){g+=4}s=this.node1.getOutputPort().y+this.VGAP;c=g+(this.node2.body.getBBox().width-3)*q;r=s+(this.node2.body.getBBox().width-3)*t;if(l!=null&&l.length>0){var k=l[l.length-1];var n=this.node2.getTreeHeight()-k.getTreeHeight()+k.body.getBBox().height;c=Math.max(c,g+n*p);r=Math.max(r,s+n)}g-=this.VGAP*p;s-=this.VGAP}}else{g=this.node2.getLocation().x-this.HGAP-2;s=this.node2.getLocation().y+this.node2.getSize().height;c=g+this.node2.getTreeWidth()+this.HGAP-2;r=s;var l=this.node2.getUnChildren();if(l!=null&&l.length>0){var k=l[l.length-1];c-=k.getTreeWidth()-k.getSize().width-this.HGAP;if(this.node2.isTopSide()){c-=5}else{c+=1}}if(this.node2.isTopSide()){g-=6}else{g+=2}}var u=["M",g,s,"L",c,r].join(",");this.line.attr({path:u})};ArrowLink=function(a){this.startNode=null;this.color="#006600";this.destination=a?a.id:null;this.destinationNode=a?a:null;this.endArrow="Default";this.endInclination="129;0;";this.id=this.createID();this.startArrow="None";this.startInclination="129;0;";this.arrowWidth=15;this.arrowHeight=8;this.defaultColor="#ff0000";this.line=RAPHAEL.path().attr({stroke:this.color,fill:"none"});this.arrowEnd=RAPHAEL.path().attr({stroke:this.color,fill:this.defaultColor});this.arrowStart=RAPHAEL.path().attr({stroke:this.color,fill:this.defaultColor});this.hided=false;this.lineness=4;this.txt="";this.text_line=RAPHAEL.path().attr({stroke:"transparent",fill:"transparent"});this.text_line.node.id="line_"+this.id;this.text=RAPHAEL.text();this.style=""};ArrowLink.prototype.type="ArrowLink";ArrowLink.prototype.remove=function(){if(this.removed){return false}this.line.remove();this.arrowEnd.remove();this.arrowStart.remove();this.removed=true;return true};ArrowLink.prototype.hide=function(){this.line.hide();this.arrowEnd.hide();this.arrowStart.hide();this.hided=true};ArrowLink.prototype.show=function(){this.line.show();this.arrowEnd.show();this.arrowStart.show();this.hided=false};ArrowLink.prototype.getColor=function(){if(this.color!=null){return this.color}else{return this.defaultColor}};ArrowLink.prototype.setColor=function(a){this.color=a};ArrowLink.prototype.setLineWidth=function(a){a==null?this.lineness=4:this.lineness=a;console.log(a)};ArrowLink.prototype.getLineWidth=function(){return this.lineness};ArrowLink.prototype.setText=function(a){a==null?this.txt="":this.txt=a};ArrowLink.prototype.getText=function(){return this.txt};ArrowLink.prototype.setStyle=function(a){if(a=="1"){this.style="line"}else{if(a=="2"){this.style="dask"}}};ArrowLink.prototype.getStyle=function(){if(this.style="line"){return 1}return 2};ArrowLink.prototype.setStart=function(a){if(a){this.startArrow="Default"}else{this.startArrow="None"}};ArrowLink.prototype.getStart=function(){if(this.startArrow=="None"){return 1}return 2};ArrowLink.prototype.setEnd=function(a){if(a){this.endArrow="Default"}else{this.endArrow="None"}};ArrowLink.prototype.getEnd=function(){if(this.endArrow=="None"){return 1}return 2};ArrowLink.prototype.createID=function(){var a="";while(!jMap.checkID(a)){a="Arrow_ID_"+parseInt(Math.random()*2000000000)}return a};ArrowLink.prototype.toXML=function(){var a=new StringBuffer();a.add("<arrowlink");a.add(' DESTINATION="'+this.destination+'"');if(this.color!=null){a.add('COLOR="'+this.color+'"')}if(this.endArrow!=null){a.add(' ENDARROW="'+this.endArrow+'"')}if(this.endInclination!=null){a.add(' ENDINCLINATION="'+this.endInclination+'"')}if(this.id!=null){a.add(' ID="'+this.id+'"')}if(this.startArrow!=null){a.add(' STARTARROW="'+this.startArrow+'"')}if(this.startInclination!=null){a.add(' STARTINCLINATION="'+this.startInclination+'"')}if(this.lineness!=null){a.add(' LINEWIDTH="'+this.lineness+'"')}if(this.text!=""){a.add(' TEXT="'+this.txt+'"')}if(this.style!=""){a.add(' STYLE="'+this.style+'"')}a.add("/>");return a.toString("\n")};ArrowLink.prototype.draw=function(){};CurveArrowLink=function(a){CurveArrowLink.superclass.call(this,a)};extend(CurveArrowLink,ArrowLink);CurveArrowLink.prototype.type="CurveArrowLink";CurveArrowLink.prototype.draw=function(){if(this.removed){return false}var t=jMap.getNodeById(this.destination);if(t==null||t.hided){return false}var A=this.getColor();var z=this.startNode.getOutputPort();var o=t.getOutputPort();var u=this.startInclination.split(";");var p=this.endInclination.split(";");var F=z.x,k=z.y,E=o.x,g=o.y,w=parseFloat(z.x)+parseFloat(u[0]),H=parseFloat(z.y)+parseFloat(u[1]),v=parseFloat(o.x)+parseFloat(p[0]),G=parseFloat(o.y)+parseFloat(p[1]);if(this.startNode.isLeft&&this.startNode.isLeft()){w=parseFloat(z.x)-parseFloat(u[0])}if(t.isLeft&&t.isLeft()){v=parseFloat(o.x)-parseFloat(p[0])}var x=["M",F.toFixed(3),k.toFixed(3),"C",w,H,v,G,E.toFixed(3),g.toFixed(3)].join(",");this.line&&this.line.attr({path:x,stroke:A});if(this.line){this.line.attr("stroke-dasharray","20");this.line.attr("stroke-width",this.lineness)}this.line&&(this.line.node.id=this.id);if(this.endArrow!="None"){var a=["M",E.toFixed(3),g.toFixed(3),"L",E+this.arrowWidth,g+this.arrowHeight,"L",E+this.arrowWidth,g-this.arrowHeight,"L",E,g].join(",");if(t.isLeft&&t.isLeft()){a=["M",E.toFixed(3),g.toFixed(3),"L",E-this.arrowWidth,g+this.arrowHeight,"L",E-this.arrowWidth,g-this.arrowHeight,"L",E,g].join(",")}this.arrowEnd&&this.arrowEnd.attr({path:a,stroke:A,fill:A})}if(this.startArrow!="None"){var c=["M",F.toFixed(3),k.toFixed(3),"L",F+this.arrowWidth,k+this.arrowHeight,"L",F+this.arrowWidth,k-this.arrowHeight,"L",F,k].join(",");if(t.isLeft&&t.isLeft()){c=["M",F.toFixed(3),k.toFixed(3),"L",F-this.arrowWidth,k+this.arrowHeight,"L",F-this.arrowWidth,k-this.arrowHeight,"L",F,k].join(",")}this.arrowStart&&this.arrowStart.attr({path:c,stroke:A,fill:A})}if(!this.hided&&this.text!=""&&this.text!=null&&this.text.node!=undefined){this.text.show();this.text.attr({"text-anchor":"middle"});var C=w;var B=v;var f=H;var b=v;var r;var n=50;var s=(b-k);var q=-(B-F);var m=Math.sqrt(s*s+q*q);if(m===0){m=1}s*=5/m;q*=5/m;var D=k>g;var l=F>E;if(D){if(l){r=["M",F.toFixed(3),k.toFixed(3),"C",w,H,v,G,E.toFixed(3),g.toFixed(3)].join(",");s=-s}else{r=["M",F.toFixed(3),k.toFixed(3),"C",w,H,v,G,E.toFixed(3),g.toFixed(3)].join(",");s=-s;q=-q}}else{if(l){r=["M",F.toFixed(3),k.toFixed(3),"C",w,H,v,G,E.toFixed(3),g.toFixed(3)].join(",")}else{r=["M",F.toFixed(3),k.toFixed(3),"C",w,H,v,G,E.toFixed(3),g.toFixed(3)].join(",")}}this.text_line.attr({path:r,transform:"t"+s.toFixed(3)+","+q.toFixed(3)});this.text.node.innerHTML='<textPath startOffset="'+n+'%" xlink:href="#'+this.text_line.node.id+'">'+this.txt+"</textPath>"}};RightAngleArrowLink=function(a){RightAngleArrowLink.superclass.call(this,a);this.defaultColor="#aaa"};extend(RightAngleArrowLink,ArrowLink);RightAngleArrowLink.prototype.type="RightAngleArrowLink";RightAngleArrowLink.prototype.draw=function(){if(this.removed){return false}var m=jMap.getNodeById(this.destination);if(m==null||m.hided){return false}var f=this.getColor();var b=this.startNode.getOutputPort();var l=m.getInputPort();var c=b.x,o=b.y,a=l.x,n=l.y;var k=this.startNode.getSize().width;var g=m.getSize().width;var p=["M",c.toFixed(3),o.toFixed(3),"L",c.toFixed(3),parseInt(o)+10];if(parseInt(o)>parseInt(n)-20){p=p.concat(["L",parseInt(c)+parseInt((parseInt(a)+parseInt(k)/2-parseInt(c)-parseInt(g)/2)/2),parseInt(o)+10]);p=p.concat(["L",parseInt(c)+parseInt((parseInt(a)+parseInt(k)/2-parseInt(c)-parseInt(g)/2)/2),parseInt(n)-10]);p=p.concat(["L",a.toFixed(3),parseInt(n)-10])}else{p=p.concat(["L",a.toFixed(3),parseInt(o)+10])}p=p.concat(["L",a.toFixed(3),n.toFixed(3)]);this.line&&this.line.attr({path:p.join(","),stroke:f})};